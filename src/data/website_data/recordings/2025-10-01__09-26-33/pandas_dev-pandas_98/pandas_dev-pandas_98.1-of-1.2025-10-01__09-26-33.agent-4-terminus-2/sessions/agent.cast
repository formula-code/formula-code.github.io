{"version": 2, "width": 160, "height": 40, "timestamp": 1762995342, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[0.002, "i", "asciinema rec --stdin /logs/agent.cast\r"]
[0.004, "o", "asciinema rec --stdin /logs/agent.cast\r\n"]
[1.242, "o", "\u001b[?2004l\r\n"]
[2.478, "o", "\u001b[0;31masciinema: /logs/agent.cast already exists, aborting\u001b[0m\r\n"]
[3.714, "o", "\u001b[0;31masciinema: use --overwrite option if you want to overwrite existing recording\u001b[0m\r\n"]
[5.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[5.002, "i", "clear\r"]
[5.004, "o", "clear\r\n"]
[7.478, "o", "\u001b[?2004l\r\n"]
[10.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[10.002, "i", "ls -la\r"]
[10.004, "o", "ls -la\r\n"]
[10.132769, "o", "\u001b[?2004l\r\n"]
[10.259538, "o", "total 220\r\n"]
[10.386308, "o", "drwxr-xr-x 1 root root  4096 Oct  1 17:05 \u001b[0m\u001b[01;34m.\u001b[0m\r\n"]
[10.513077, "o", "drwxr-xr-x 1 root root  4096 Sep 15 17:10 \u001b[01;34m..\u001b[0m\r\n"]
[10.639846, "o", "-rw-r--r-- 1 root root   971 Sep 12 21:42 .devcontainer.json\r\n"]
[10.766615, "o", "drwxr-xr-x 1 root root  4096 Sep 15 17:13 \u001b[01;34m.git\u001b[0m\r\n"]
[10.893385, "o", "-rw-r--r-- 1 root root  1866 Sep 12 21:44 .gitattributes\r\n"]
[11.020154, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34m.github\u001b[0m\r\n"]
[11.146923, "o", "-rw-r--r-- 1 root root  2004 Sep 12 21:42 .gitignore\r\n"]
[11.273692, "o", "-rw-r--r-- 1 root root  2280 Sep 12 21:42 .gitpod.yml\r\n"]
[11.400462, "o", "-rw-r--r-- 1 root root 11223 Sep 12 21:44 .pre-commit-config.yaml\r\n"]
[11.527231, "o", "-rw-r--r-- 1 root root  2284 Sep 12 21:44 AUTHORS.md\r\n"]
[11.654, "o", "-rw-r--r-- 1 root root  1541 Sep 12 21:42 CITATION.cff\r\n"]
[11.780769, "o", "-rw-r--r-- 1 root root   494 Sep 12 21:44 Dockerfile\r\n"]
[11.907538, "o", "-rw-r--r-- 1 root root  1634 Sep 12 21:42 LICENSE\r\n"]
[12.034308, "o", "drwxr-xr-x 2 root root  4096 Sep 12 21:42 \u001b[01;34mLICENSES\u001b[0m\r\n"]
[12.161077, "o", "-rw-r--r-- 1 root root  1531 Sep 12 21:44 MANIFEST.in\r\n"]
[12.287846, "o", "-rw-r--r-- 1 root root 11661 Sep 12 21:44 README.md\r\n"]
[12.414615, "o", "drwxr-xr-x 2 root root  4096 Sep 14 00:16 \u001b[01;34m__pycache__\u001b[0m\r\n"]
[12.541385, "o", "-rw-r--r-- 1 root root   101 Sep 14 00:16 _version_meson.py\r\n"]
[12.668154, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34masv_bench\u001b[0m\r\n"]
[12.794923, "o", "drwxr-xr-x 1 root root  4096 Sep 14 00:16 \u001b[01;34mbuild\u001b[0m\r\n"]
[12.921692, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34mci\u001b[0m\r\n"]
[13.048462, "o", "-rw-r--r-- 1 root root   256 Sep 12 21:42 codecov.yml\r\n"]
[13.175231, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34mdoc\u001b[0m\r\n"]
[13.302, "o", "-rw-r--r-- 1 root root  2897 Sep 12 21:44 environment.yml\r\n"]
[13.428769, "o", "-rw-r--r-- 1 root root   866 Sep 12 21:42 generate_pxi.py\r\n"]
[13.555538, "o", "-rw-r--r-- 1 root root  1715 Sep 12 21:42 generate_version.py\r\n"]
[13.682308, "o", "drwxr-xr-x 2 root root  4096 Sep 12 21:42 \u001b[01;34mgitpod\u001b[0m\r\n"]
[13.809077, "o", "-rw-r--r-- 1 root root  1774 Sep 12 21:44 meson.build\r\n"]
[13.935846, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34mpandas\u001b[0m\r\n"]
[14.062615, "o", "-rw-r--r-- 1 root root 22900 Sep 12 21:44 pyproject.toml\r\n"]
[14.189385, "o", "-rw-r--r-- 1 root root  4307 Sep 12 21:42 pyright_reportGeneralTypeIssues.json\r\n"]
[14.316154, "o", "-rw-r--r-- 1 root root  1459 Sep 12 21:44 requirements-dev.txt\r\n"]
[14.442923, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34mscripts\u001b[0m\r\n"]
[14.569692, "o", "-rwxr-xr-x 1 root root 21960 Sep 12 21:44 \u001b[01;32msetup.py\u001b[0m\r\n"]
[14.696462, "o", "drwxr-xr-x 3 root root  4096 Sep 12 21:42 \u001b[01;34mtooling\u001b[0m\r\n"]
[14.823231, "o", "drwxr-xr-x 2 root root  4096 Sep 12 21:42 \u001b[01;34mtypings\u001b[0m\r\n"]
[15.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[15.002, "i", "grep -R \"asv.conf\" -n . || true\r"]
[15.004, "o", "grep -R \"asv.conf\" -n . || true\r\n"]
[15.712286, "o", "\u001b[?2004l\r\n"]
[16.418571, "o", "\u001b[35m\u001b[K./scripts/tests/data/deps_minimum.toml\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K7\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    \"Cython>=0.29.32,<3\",  # Note: sync with setup.py, environment.yml and \u001b[01;31m\u001b[Kasv.conf\u001b[m\u001b[K.json\r\n"]
[17.124857, "o", "\u001b[35m\u001b[K./pyproject.toml\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K8\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    \"Cython~=3.0.5\",  # Note: sync with setup.py, environment.yml and \u001b[01;31m\u001b[Kasv.conf\u001b[m\u001b[K.json\r\n"]
[17.831143, "o", "\u001b[35m\u001b[K./doc/source/development/contributing_codebase.rst\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K889\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[Kthat run benchmarks. The default value is defined in ``\u001b[01;31m\u001b[Kasv.conf\u001b[m\u001b[K.json``.\r\n"]
[18.537429, "o", "grep: ./.git/index: binary file matches\r\n"]
[19.243714, "o", "grep: ./.git/objects/pack/pack-2f73da0dbd4e0dcf7959c9a99b2a31b6bbc6aab6.pack: binary file matches\r\n"]
[20.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[20.002, "i", "ls -la benchmarks || ls -la asv_bench || ls -la asv || true\r"]
[20.004, "o", "ls -la benchmarks || ls -la asv_bench || ls -la asv || true\r\n"]
[20.712286, "o", "\u001b[?2004l\r\n"]
[21.418571, "o", "ls: cannot access 'benchmarks': No such file or directory\r\n"]
[22.124857, "o", "total 24\r\n"]
[22.831143, "o", "drwxr-xr-x 1 root root 4096 Sep 12 21:44 \u001b[0m\u001b[01;34m.\u001b[0m\r\n"]
[23.537429, "o", "drwxr-xr-x 1 root root 4096 Oct  1 17:05 \u001b[01;34m..\u001b[0m\r\n"]
[24.243714, "o", "-rw-r--r-- 1 root root 5194 Sep 12 21:44 asv.conf.json\r\n"]
[25.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[25.002, "i", "grep -R \"class .*arithmetic\\.Ops\" -n . || true\r"]
[25.004, "o", "grep -R \"class .*arithmetic\\.Ops\" -n . || true\r\n"]
[25.006, "o", "\u001b[?2004l\r\n"]
[30.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[30.002, "i", "ls -la | grep -i asv || true\r"]
[30.004, "o", "ls -la | grep -i asv || true\r\n"]
[32.478, "o", "\u001b[?2004l\r\n"]
[35.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[35.002, "i", "git status -sb\r"]
[35.004, "o", "git status -sb\r\n"]
[36.654, "o", "\u001b[?2004l\r\n"]
[38.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[40.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[40.002, "i", "find . -maxdepth 2 -type f -iname \"asv*.json\" -o -iname \"asv.conf.json\" -print\r"]
[40.004, "o", "find . -maxdepth 2 -type f -iname \"asv*.json\" -o -iname \"asv.conf.json\" -print\r\n"]
[40.006, "o", "\u001b[?2004l\r\n"]
[45.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[45.002, "i", "test -f asv.conf.json && cat asv.conf.json | sed -n '1,120p' || true\r"]
[45.004, "o", "test -f asv.conf.json && cat asv.conf.json | sed -n '1,120p' || true\r\n"]
[45.006, "o", "\u001b[?2004l\r\n"]
[50.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[50.002, "i", "test -f asv.conf.json || (echo \"No asv.conf.json at repo root; searching...\" && find . -name asv.conf.json -print -\r"]
[50.004, "o", "test -f asv.conf.json || (echo \"No asv.conf.json at repo root; searching...\" && find . -name asv.conf.json -print -\r\n"]
[50.045552, "o", "-exec bash -lc 'echo ====; sed -n \"1,120p\" {}' \\; )\r\n"]
[50.085104, "o", "\u001b[?2004l\r\n"]
[50.124656, "o", "No asv.conf.json at repo root; searching...\r\n"]
[50.164208, "o", "./asv_bench/asv.conf.json\r\n"]
[50.20376, "o", "====\r\n"]
[50.243312, "o", "{\r\n"]
[50.282864, "o", "    // The version of the config file format.  Do not change, unless\r\n"]
[50.322416, "o", "    // you know what you are doing.\r\n"]
[50.361968, "o", "    \"version\": 1,\r\n"]
[50.40152, "o", "\r\n"]
[50.441072, "o", "    // The name of the project being benchmarked\r\n"]
[50.480624, "o", "    \"project\": \"pandas\",\r\n"]
[50.520176, "o", "\r\n"]
[50.559728, "o", "    // The project's homepage\r\n"]
[50.59928, "o", "    \"project_url\": \"https://pandas.pydata.org/\",\r\n"]
[50.638832, "o", "\r\n"]
[50.678384, "o", "    // The URL of the source code repository for the project being\r\n"]
[50.717936, "o", "    // benchmarked\r\n"]
[50.757488, "o", "    \"repo\": \"..\",\r\n"]
[50.79704, "o", "\r\n"]
[50.836592, "o", "    // List of branches to benchmark. If not provided, defaults to \"master\"\r\n"]
[50.876144, "o", "    // (for git) or \"default\" (for mercurial).\r\n"]
[50.915696, "o", "    \"branches\": [\"main\"],\r\n"]
[50.955248, "o", "\r\n"]
[50.9948, "o", "    // The tool to use to create environments.  May be \"conda\",\r\n"]
[51.034352, "o", "    // \"virtualenv\" or other value depending on the plugins in use.\r\n"]
[51.073904, "o", "    // If missing or the empty string, the tool will be automatically\r\n"]
[51.113456, "o", "    // determined by looking for tools on the PATH environment\r\n"]
[51.153008, "o", "    // variable.\r\n"]
[51.19256, "o", "    \"environment_type\": \"conda\",\r\n"]
[51.232112, "o", "\r\n"]
[51.271664, "o", "    // the base URL to show a commit for the project.\r\n"]
[51.311216, "o", "    \"show_commit_url\": \"https://github.com/pandas-dev/pandas/commit/\",\r\n"]
[51.350768, "o", "\r\n"]
[51.39032, "o", "    // The Pythons you'd like to test against.  If not provided, defaults\r\n"]
[51.429872, "o", "    // to the current version of Python used to run `asv`.\r\n"]
[51.469424, "o", "    \"pythons\": [\"3.10\"],\r\n"]
[51.508976, "o", "\r\n"]
[51.548528, "o", "    // The matrix of dependencies to test.  Each key is the name of a\r\n"]
[51.58808, "o", "    // package (in PyPI) and the values are version numbers.  An empty\r\n"]
[51.627632, "o", "    // list or empty string indicates to just test against the default\r\n"]
[51.667184, "o", "    // (latest) version. null indicates that the package is to not be\r\n"]
[51.706736, "o", "    // installed. If the package to be tested is only available from\r\n"]
[51.746288, "o", "    // PyPi, and the 'environment_type' is conda, then you can preface\r\n"]
[51.78584, "o", "    // the package name by 'pip+', and the package will be installed via\r\n"]
[51.825392, "o", "    // pip (with all the conda available packages installed first,\r\n"]
[51.864944, "o", "    // followed by the pip installed packages).\r\n"]
[51.904496, "o", "    \"matrix\": {\r\n"]
[51.944048, "o", "        \"pip+build\": [],\r\n"]
[51.9836, "o", "        \"Cython\": [\"3.0\"],\r\n"]
[52.023152, "o", "        \"matplotlib\": [],\r\n"]
[52.062704, "o", "        \"sqlalchemy\": [],\r\n"]
[52.102256, "o", "        \"scipy\": [],\r\n"]
[52.141808, "o", "        \"numba\": [],\r\n"]
[52.18136, "o", "        \"numexpr\": [],\r\n"]
[52.220912, "o", "        \"pytables\": [null, \"\"],  // platform dependent, see excludes below\r\n"]
[52.260464, "o", "        \"pyarrow\": [],\r\n"]
[52.300016, "o", "        \"tables\": [null, \"\"],\r\n"]
[52.339568, "o", "        \"openpyxl\": [],\r\n"]
[52.37912, "o", "        \"xlsxwriter\": [],\r\n"]
[52.418672, "o", "        \"xlrd\": [],\r\n"]
[52.458224, "o", "        \"odfpy\": [],\r\n"]
[52.497776, "o", "        \"jinja2\": [],\r\n"]
[52.537328, "o", "        \"meson\": [],\r\n"]
[52.57688, "o", "        \"meson-python\": [],\r\n"]
[52.616432, "o", "        \"python-build\": [],\r\n"]
[52.655984, "o", "    },\r\n"]
[52.695536, "o", "    \"conda_channels\": [\"conda-forge\"],\r\n"]
[52.735088, "o", "    // Combinations of libraries/python versions can be excluded/included\r\n"]
[52.77464, "o", "    // from the set to test. Each entry is a dictionary containing additional\r\n"]
[52.814192, "o", "    // key-value pairs to include/exclude.\r\n"]
[52.853744, "o", "    //\r\n"]
[52.893296, "o", "    // An exclude entry excludes entries where all values match. The\r\n"]
[52.932848, "o", "    // values are regexps that should match the whole string.\r\n"]
[52.9724, "o", "    //\r\n"]
[53.011952, "o", "    // An include entry adds an environment. Only the packages listed\r\n"]
[53.051504, "o", "    // are installed. The 'python' key is required. The exclude rules\r\n"]
[53.091056, "o", "    // do not apply to includes.\r\n"]
[53.130608, "o", "    //\r\n"]
[53.17016, "o", "    // In addition to package names, the following keys are available:\r\n"]
[53.209712, "o", "    //\r\n"]
[53.249264, "o", "    // - python\r\n"]
[53.288816, "o", "    //     Python version, as in the *pythons* variable above.\r\n"]
[53.328368, "o", "    // - environment_type\r\n"]
[53.36792, "o", "    //     Environment type, as above.\r\n"]
[53.407472, "o", "    // - sys_platform\r\n"]
[53.447024, "o", "    //     Platform, as in sys.platform. Possible values for the common\r\n"]
[53.486576, "o", "    //     cases: 'linux2', 'win32', 'cygwin', 'darwin'.\r\n"]
[53.526128, "o", "    \"exclude\": [\r\n"]
[53.56568, "o", "        // On conda install pytables, otherwise tables\r\n"]
[53.605232, "o", "        {\"environment_type\": \"conda\", \"tables\": \"\"},\r\n"]
[53.644784, "o", "        {\"environment_type\": \"conda\", \"pytables\": null},\r\n"]
[53.684336, "o", "        {\"environment_type\": \"(?!conda).*\", \"tables\": null},\r\n"]
[53.723888, "o", "        {\"environment_type\": \"(?!conda).*\", \"pytables\": \"\"},\r\n"]
[53.76344, "o", "    ],\r\n"]
[53.802992, "o", "    \"include\": [],\r\n"]
[53.842544, "o", "\r\n"]
[53.882096, "o", "    // The directory (relative to the current directory) that benchmarks are\r\n"]
[53.921648, "o", "    // stored in.  If not provided, defaults to \"benchmarks\"\r\n"]
[53.9612, "o", "    // \"benchmark_dir\": \"benchmarks\",\r\n"]
[54.000752, "o", "\r\n"]
[54.040304, "o", "    // The directory (relative to the current directory) to cache the Python\r\n"]
[54.079856, "o", "    // environments in.  If not provided, defaults to \"env\"\r\n"]
[54.119408, "o", "    // \"env_dir\": \"env\",\r\n"]
[54.15896, "o", "\r\n"]
[54.198512, "o", "    // The directory (relative to the current directory) that raw benchmark\r\n"]
[54.238064, "o", "    // results are stored in.  If not provided, defaults to \"results\".\r\n"]
[54.277616, "o", "    // \"results_dir\": \"results\",\r\n"]
[54.317168, "o", "\r\n"]
[54.35672, "o", "    // The directory (relative to the current directory) that the html tree\r\n"]
[54.396272, "o", "    // should be written to.  If not provided, defaults to \"html\".\r\n"]
[54.435824, "o", "    // \"html_dir\": \"html\",\r\n"]
[54.475376, "o", "\r\n"]
[54.514928, "o", "    // The number of characters to retain in the commit hashes.\r\n"]
[54.55448, "o", "    // \"hash_length\": 8,\r\n"]
[54.594032, "o", "\r\n"]
[54.633584, "o", "    // `asv` will cache wheels of the recent builds in each\r\n"]
[54.673136, "o", "    // environment, making them faster to install next time.  This is\r\n"]
[54.712688, "o", "    // number of builds to keep, per environment.\r\n"]
[54.75224, "o", "    \"build_cache_size\": 8,\r\n"]
[54.791792, "o", "\r\n"]
[54.831344, "o", "    // The commits after which the regression search in `asv publish`\r\n"]
[54.870896, "o", "    // should start looking for regressions. Dictionary whose keys are\r\n"]
[54.910448, "o", "    // regexps matching to benchmark names, and values corresponding to\r\n"]
[55.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[55.002, "i", "grep -R \"arithmetic\\.Ops\" -n benchmarks asv_bench asv || true\r"]
[55.004, "o", "grep -R \"arithmetic\\.Ops\" -n benchmarks asv_bench asv || true\r\n"]
[56.654, "o", "\u001b[?2004l\r\n"]
[58.302, "o", "grep: benchmarks: No such file or directory\r\n"]
[60.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[60.002, "i", "test -f asv_benchmarks.txt && sed -n '1,200p' asv_benchmarks.txt || true\r"]
[60.004, "o", "test -f asv_benchmarks.txt && sed -n '1,200p' asv_benchmarks.txt || true\r\n"]
[60.006, "o", "\u001b[?2004l\r\n"]
[65.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[65.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[65.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[67.478, "o", "\u001b[?2004l\r\n"]
[70.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[70.002, "i", "ls -la asv_bench\r"]
[70.004, "o", "ls -la asv_bench\r\n"]
[70.83, "o", "\u001b[?2004l\r\n"]
[71.654, "o", "total 24\r\n"]
[72.478, "o", "drwxr-xr-x 1 root root 4096 Sep 12 21:44 \u001b[0m\u001b[01;34m.\u001b[0m\r\n"]
[73.302, "o", "drwxr-xr-x 1 root root 4096 Oct  1 17:05 \u001b[01;34m..\u001b[0m\r\n"]
[74.126, "o", "-rw-r--r-- 1 root root 5194 Sep 12 21:44 asv.conf.json\r\n"]
[75.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[75.002, "i", "ls -la asv_bench/benchmarks\r"]
[75.004, "o", "ls -la asv_bench/benchmarks\r\n"]
[75.113478, "o", "\u001b[?2004l\r\n"]
[75.220957, "o", "total 376\r\n"]
[75.328435, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[0m\u001b[01;34m.\u001b[0m\r\n"]
[75.435913, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34m..\u001b[0m\r\n"]
[75.543391, "o", "-rw-r--r-- 1 root root    25 Sep 12 21:42 __init__.py\r\n"]
[75.65087, "o", "-rw-r--r-- 1 root root  6160 Sep 12 21:42 algorithms.py\r\n"]
[75.758348, "o", "drwxr-xr-x 2 root root  4096 Sep 12 21:42 \u001b[01;34malgos\u001b[0m\r\n"]
[75.865826, "o", "-rw-r--r-- 1 root root 12498 Sep 12 21:42 arithmetic.py\r\n"]
[75.973304, "o", "-rw-r--r-- 1 root root  4282 Sep 12 21:42 array.py\r\n"]
[76.080783, "o", "-rw-r--r-- 1 root root  1414 Sep 12 21:42 attrs_caching.py\r\n"]
[76.188261, "o", "-rw-r--r-- 1 root root   739 Sep 12 21:42 boolean.py\r\n"]
[76.295739, "o", "-rw-r--r-- 1 root root  9776 Sep 12 21:42 categoricals.py\r\n"]
[76.403217, "o", "-rw-r--r-- 1 root root  3462 Sep 12 21:42 ctors.py\r\n"]
[76.510696, "o", "-rw-r--r-- 1 root root  3559 Sep 12 21:42 dtypes.py\r\n"]
[76.618174, "o", "-rw-r--r-- 1 root root  1988 Sep 12 21:42 eval.py\r\n"]
[76.725652, "o", "-rw-r--r-- 1 root root   379 Sep 12 21:42 finalize.py\r\n"]
[76.83313, "o", "-rw-r--r-- 1 root root  5142 Sep 12 21:42 frame_ctor.py\r\n"]
[76.940609, "o", "-rw-r--r-- 1 root root 24291 Sep 12 21:44 frame_methods.py\r\n"]
[77.048087, "o", "-rw-r--r-- 1 root root  8150 Sep 12 21:44 gil.py\r\n"]
[77.155565, "o", "-rw-r--r-- 1 root root 33292 Sep 12 21:42 groupby.py\r\n"]
[77.263043, "o", "-rw-r--r-- 1 root root  2393 Sep 12 21:42 hash_functions.py\r\n"]
[77.370522, "o", "-rw-r--r-- 1 root root  2274 Sep 12 21:42 index_cached_properties.py\r\n"]
[77.478, "o", "-rw-r--r-- 1 root root  7138 Sep 12 21:42 index_object.py\r\n"]
[77.585478, "o", "-rw-r--r-- 1 root root 16813 Sep 12 21:42 indexing.py\r\n"]
[77.692957, "o", "-rw-r--r-- 1 root root  5949 Sep 12 21:44 indexing_engines.py\r\n"]
[77.800435, "o", "-rw-r--r-- 1 root root  8662 Sep 12 21:42 inference.py\r\n"]
[77.907913, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34mio\u001b[0m\r\n"]
[78.015391, "o", "-rw-r--r-- 1 root root 18607 Sep 12 21:42 join_merge.py\r\n"]
[78.12287, "o", "-rw-r--r-- 1 root root  2445 Sep 12 21:42 libs.py\r\n"]
[78.230348, "o", "-rw-r--r-- 1 root root 12356 Sep 12 21:42 multiindex_object.py\r\n"]
[78.337826, "o", "-rw-r--r-- 1 root root   624 Sep 12 21:42 package.py\r\n"]
[78.445304, "o", "-rw-r--r-- 1 root root  1740 Sep 12 21:42 pandas_vb_common.py\r\n"]
[78.552783, "o", "-rw-r--r-- 1 root root  2909 Sep 12 21:42 period.py\r\n"]
[78.660261, "o", "-rw-r--r-- 1 root root  4554 Sep 12 21:42 plotting.py\r\n"]
[78.767739, "o", "-rw-r--r-- 1 root root  4948 Sep 12 21:42 reindex.py\r\n"]
[78.875217, "o", "-rw-r--r-- 1 root root  2103 Sep 12 21:42 replace.py\r\n"]
[78.982696, "o", "-rw-r--r-- 1 root root  9973 Sep 12 21:42 reshape.py\r\n"]
[79.090174, "o", "-rw-r--r-- 1 root root 11474 Sep 12 21:44 rolling.py\r\n"]
[79.197652, "o", "-rw-r--r-- 1 root root 10677 Sep 12 21:42 series_methods.py\r\n"]
[79.30513, "o", "-rw-r--r-- 1 root root  6817 Sep 12 21:42 sparse.py\r\n"]
[79.412609, "o", "-rw-r--r-- 1 root root  4685 Sep 12 21:42 stat_ops.py\r\n"]
[79.520087, "o", "-rw-r--r-- 1 root root  3535 Sep 12 21:42 strftime.py\r\n"]
[79.627565, "o", "-rw-r--r-- 1 root root  7996 Sep 12 21:44 strings.py\r\n"]
[79.735043, "o", "-rw-r--r-- 1 root root  1528 Sep 12 21:42 timedelta.py\r\n"]
[79.842522, "o", "-rw-r--r-- 1 root root  8565 Sep 12 21:42 timeseries.py\r\n"]
[80.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[80.002, "i", "grep -R \"arithmetic\" -n asv_bench/benchmarks || true\r"]
[80.004, "o", "grep -R \"arithmetic\" -n asv_bench/benchmarks || true\r\n"]
[80.006, "o", "\u001b[?2004l\r\n"]
[85.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[85.002, "i", "grep -R \"class .*Ops\" -n asv_bench/benchmarks || true\r"]
[85.004, "o", "grep -R \"class .*Ops\" -n asv_bench/benchmarks || true\r\n"]
[85.315, "o", "\u001b[?2004l\r\n"]
[85.624, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/boolean.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K6\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass TimeLogicalOps\u001b[m\u001b[K:\r\n"]
[85.933, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/arithmetic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K174\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass Ops\u001b[m\u001b[K:\r\n"]
[86.242, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/arithmetic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K204\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass Ops\u001b[m\u001b[K2:\r\n"]
[86.551, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/arithmetic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K286\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass IrregularOps\u001b[m\u001b[K:\r\n"]
[86.86, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/arithmetic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K298\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass TimedeltaOps\u001b[m\u001b[K:\r\n"]
[87.169, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/arithmetic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K346\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass NumericInferOps\u001b[m\u001b[K:\r\n"]
[87.478, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/arithmetic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K373\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass DateInferOps\u001b[m\u001b[K:\r\n"]
[87.787, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/arithmetic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K454\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass BinaryOps\u001b[m\u001b[KMultiIndex:\r\n"]
[88.096, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/tslibs/timestamp.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K111\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass TimestampOps\u001b[m\u001b[K:\r\n"]
[88.405, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/series_methods.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K297\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass NanOps\u001b[m\u001b[K:\r\n"]
[88.714, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/stat_ops.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K8\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass FrameOps\u001b[m\u001b[K:\r\n"]
[89.023, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/stat_ops.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K23\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass FrameMixedDtypesOps\u001b[m\u001b[K:\r\n"]
[89.332, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/stat_ops.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K57\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass FrameMultiIndexOps\u001b[m\u001b[K:\r\n"]
[89.641, "o", "\u001b[35m\u001b[Kasv_bench/benchmarks/stat_ops.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K76\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[Kclass SeriesOps\u001b[m\u001b[K:\r\n"]
[90.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[90.002, "i", "sed -n '1,200p' asv_bench/benchmarks/arithmetic.py 2>/dev/null || true\r"]
[90.004, "o", "sed -n '1,200p' asv_bench/benchmarks/arithmetic.py 2>/dev/null || true\r\n"]
[90.030597, "o", "\u001b[?2004l\r\n"]
[90.055194, "o", "import operator\r\n"]
[90.079791, "o", "import warnings\r\n"]
[90.104388, "o", "\r\n"]
[90.128985, "o", "import numpy as np\r\n"]
[90.153582, "o", "\r\n"]
[90.178179, "o", "import pandas as pd\r\n"]
[90.202776, "o", "from pandas import (\r\n"]
[90.227373, "o", "    DataFrame,\r\n"]
[90.25197, "o", "    Index,\r\n"]
[90.276567, "o", "    Series,\r\n"]
[90.301164, "o", "    Timestamp,\r\n"]
[90.325761, "o", "    date_range,\r\n"]
[90.350358, "o", "    to_timedelta,\r\n"]
[90.374955, "o", ")\r\n"]
[90.399552, "o", "\r\n"]
[90.424149, "o", "from .pandas_vb_common import numeric_dtypes\r\n"]
[90.448746, "o", "\r\n"]
[90.473343, "o", "try:\r\n"]
[90.49794, "o", "    import pandas.core.computation.expressions as expr\r\n"]
[90.522537, "o", "except ImportError:\r\n"]
[90.547134, "o", "    import pandas.computation.expressions as expr\r\n"]
[90.571731, "o", "try:\r\n"]
[90.596328, "o", "    import pandas.tseries.holiday\r\n"]
[90.620925, "o", "except ImportError:\r\n"]
[90.645522, "o", "    pass\r\n"]
[90.670119, "o", "\r\n"]
[90.694716, "o", "\r\n"]
[90.719313, "o", "class IntFrameWithScalar:\r\n"]
[90.74391, "o", "    params = [\r\n"]
[90.768507, "o", "        [np.float64, np.int64],\r\n"]
[90.793104, "o", "        [2, 3.0, np.int32(4), np.float64(5)],\r\n"]
[90.817701, "o", "        [\r\n"]
[90.842299, "o", "            operator.add,\r\n"]
[90.866896, "o", "            operator.sub,\r\n"]
[90.891493, "o", "            operator.mul,\r\n"]
[90.91609, "o", "            operator.truediv,\r\n"]
[90.940687, "o", "            operator.floordiv,\r\n"]
[90.965284, "o", "            operator.pow,\r\n"]
[90.989881, "o", "            operator.mod,\r\n"]
[91.014478, "o", "            operator.eq,\r\n"]
[91.039075, "o", "            operator.ne,\r\n"]
[91.063672, "o", "            operator.gt,\r\n"]
[91.088269, "o", "            operator.ge,\r\n"]
[91.112866, "o", "            operator.lt,\r\n"]
[91.137463, "o", "            operator.le,\r\n"]
[91.16206, "o", "        ],\r\n"]
[91.186657, "o", "    ]\r\n"]
[91.211254, "o", "    param_names = [\"dtype\", \"scalar\", \"op\"]\r\n"]
[91.235851, "o", "\r\n"]
[91.260448, "o", "    def setup(self, dtype, scalar, op):\r\n"]
[91.285045, "o", "        arr = np.random.randn(20000, 100)\r\n"]
[91.309642, "o", "        self.df = DataFrame(arr.astype(dtype))\r\n"]
[91.334239, "o", "\r\n"]
[91.358836, "o", "    def time_frame_op_with_scalar(self, dtype, scalar, op):\r\n"]
[91.383433, "o", "        op(self.df, scalar)\r\n"]
[91.40803, "o", "\r\n"]
[91.432627, "o", "\r\n"]
[91.457224, "o", "class OpWithFillValue:\r\n"]
[91.481821, "o", "    def setup(self):\r\n"]
[91.506418, "o", "        # GH#31300\r\n"]
[91.531015, "o", "        arr = np.arange(10**6)\r\n"]
[91.555612, "o", "        df = DataFrame({\"A\": arr})\r\n"]
[91.580209, "o", "        ser = df[\"A\"]\r\n"]
[91.604806, "o", "\r\n"]
[91.629403, "o", "        self.df = df\r\n"]
[91.654, "o", "        self.ser = ser\r\n"]
[91.678597, "o", "\r\n"]
[91.703194, "o", "    def time_frame_op_with_fill_value_no_nas(self):\r\n"]
[91.727791, "o", "        self.df.add(self.df, fill_value=4)\r\n"]
[91.752388, "o", "\r\n"]
[91.776985, "o", "    def time_series_op_with_fill_value_no_nas(self):\r\n"]
[91.801582, "o", "        self.ser.add(self.ser, fill_value=4)\r\n"]
[91.826179, "o", "\r\n"]
[91.850776, "o", "\r\n"]
[91.875373, "o", "class MixedFrameWithSeriesAxis:\r\n"]
[91.89997, "o", "    params = [\r\n"]
[91.924567, "o", "        [\r\n"]
[91.949164, "o", "            \"eq\",\r\n"]
[91.973761, "o", "            \"ne\",\r\n"]
[91.998358, "o", "            \"lt\",\r\n"]
[92.022955, "o", "            \"le\",\r\n"]
[92.047552, "o", "            \"ge\",\r\n"]
[92.072149, "o", "            \"gt\",\r\n"]
[92.096746, "o", "            \"add\",\r\n"]
[92.121343, "o", "            \"sub\",\r\n"]
[92.14594, "o", "            \"truediv\",\r\n"]
[92.170537, "o", "            \"floordiv\",\r\n"]
[92.195134, "o", "            \"mul\",\r\n"]
[92.219731, "o", "            \"pow\",\r\n"]
[92.244328, "o", "        ]\r\n"]
[92.268925, "o", "    ]\r\n"]
[92.293522, "o", "    param_names = [\"opname\"]\r\n"]
[92.318119, "o", "\r\n"]
[92.342716, "o", "    def setup(self, opname):\r\n"]
[92.367313, "o", "        arr = np.arange(10**6).reshape(1000, -1)\r\n"]
[92.39191, "o", "        df = DataFrame(arr)\r\n"]
[92.416507, "o", "        df[\"C\"] = 1.0\r\n"]
[92.441104, "o", "        self.df = df\r\n"]
[92.465701, "o", "        self.ser = df[0]\r\n"]
[92.490299, "o", "        self.row = df.iloc[0]\r\n"]
[92.514896, "o", "\r\n"]
[92.539493, "o", "    def time_frame_op_with_series_axis0(self, opname):\r\n"]
[92.56409, "o", "        getattr(self.df, opname)(self.ser, axis=0)\r\n"]
[92.588687, "o", "\r\n"]
[92.613284, "o", "    def time_frame_op_with_series_axis1(self, opname):\r\n"]
[92.637881, "o", "        getattr(operator, opname)(self.df, self.ser)\r\n"]
[92.662478, "o", "\r\n"]
[92.687075, "o", "    # exclude comparisons from the params for time_frame_op_with_series_axis1\r\n"]
[92.711672, "o", "    #  since they do not do alignment so raise\r\n"]
[92.736269, "o", "    time_frame_op_with_series_axis1.params = [params[0][6:]]\r\n"]
[92.760866, "o", "\r\n"]
[92.785463, "o", "\r\n"]
[92.81006, "o", "class FrameWithFrameWide:\r\n"]
[92.834657, "o", "    # Many-columns, mixed dtypes\r\n"]
[92.859254, "o", "\r\n"]
[92.883851, "o", "    params = [\r\n"]
[92.908448, "o", "        [\r\n"]
[92.933045, "o", "            # GH#32779 has discussion of which operators are included here\r\n"]
[92.957642, "o", "            operator.add,\r\n"]
[92.982239, "o", "            operator.floordiv,\r\n"]
[93.006836, "o", "            operator.gt,\r\n"]
[93.031433, "o", "        ],\r\n"]
[93.05603, "o", "        [\r\n"]
[93.080627, "o", "            # (n_rows, n_columns)\r\n"]
[93.105224, "o", "            (1_000_000, 10),\r\n"]
[93.129821, "o", "            (100_000, 100),\r\n"]
[93.154418, "o", "            (10_000, 1000),\r\n"]
[93.179015, "o", "            (1000, 10_000),\r\n"]
[93.203612, "o", "        ],\r\n"]
[93.228209, "o", "    ]\r\n"]
[93.252806, "o", "    param_names = [\"op\", \"shape\"]\r\n"]
[93.277403, "o", "\r\n"]
[93.302, "o", "    def setup(self, op, shape):\r\n"]
[93.326597, "o", "        # we choose dtypes so as to make the blocks\r\n"]
[93.351194, "o", "        #  a) not perfectly match between right and left\r\n"]
[93.375791, "o", "        #  b) appreciably bigger than single columns\r\n"]
[93.400388, "o", "        n_rows, n_cols = shape\r\n"]
[93.424985, "o", "\r\n"]
[93.449582, "o", "        if op is operator.floordiv:\r\n"]
[93.474179, "o", "            # floordiv is much slower than the other operations -> use less data\r\n"]
[93.498776, "o", "            n_rows = n_rows // 10\r\n"]
[93.523373, "o", "\r\n"]
[93.54797, "o", "        # construct dataframe with 2 blocks\r\n"]
[93.572567, "o", "        arr1 = np.random.randn(n_rows, n_cols // 2).astype(\"f8\")\r\n"]
[93.597164, "o", "        arr2 = np.random.randn(n_rows, n_cols // 2).astype(\"f4\")\r\n"]
[93.621761, "o", "        df = pd.concat([DataFrame(arr1), DataFrame(arr2)], axis=1, ignore_index=True)\r\n"]
[93.646358, "o", "        # should already be the case, but just to be sure\r\n"]
[93.670955, "o", "        df._consolidate_inplace()\r\n"]
[93.695552, "o", "\r\n"]
[93.720149, "o", "        # TODO: GH#33198 the setting here shouldn't need two steps\r\n"]
[93.744746, "o", "        arr1 = np.random.randn(n_rows, max(n_cols // 4, 3)).astype(\"f8\")\r\n"]
[93.769343, "o", "        arr2 = np.random.randn(n_rows, n_cols // 2).astype(\"i8\")\r\n"]
[93.79394, "o", "        arr3 = np.random.randn(n_rows, n_cols // 4).astype(\"f8\")\r\n"]
[93.818537, "o", "        df2 = pd.concat(\r\n"]
[93.843134, "o", "            [DataFrame(arr1), DataFrame(arr2), DataFrame(arr3)],\r\n"]
[93.867731, "o", "            axis=1,\r\n"]
[93.892328, "o", "            ignore_index=True,\r\n"]
[93.916925, "o", "        )\r\n"]
[93.941522, "o", "        # should already be the case, but just to be sure\r\n"]
[93.966119, "o", "        df2._consolidate_inplace()\r\n"]
[93.990716, "o", "\r\n"]
[94.015313, "o", "        self.left = df\r\n"]
[94.03991, "o", "        self.right = df2\r\n"]
[94.064507, "o", "\r\n"]
[94.089104, "o", "    def time_op_different_blocks(self, op, shape):\r\n"]
[94.113701, "o", "        # blocks (and dtypes) are not aligned\r\n"]
[94.138299, "o", "        op(self.left, self.right)\r\n"]
[94.162896, "o", "\r\n"]
[94.187493, "o", "    def time_op_same_blocks(self, op, shape):\r\n"]
[94.21209, "o", "        # blocks (and dtypes) are aligned\r\n"]
[94.236687, "o", "        op(self.left, self.left)\r\n"]
[94.261284, "o", "\r\n"]
[94.285881, "o", "\r\n"]
[94.310478, "o", "class Ops:\r\n"]
[94.335075, "o", "    params = [[True, False], [\"default\", 1]]\r\n"]
[94.359672, "o", "    param_names = [\"use_numexpr\", \"threads\"]\r\n"]
[94.384269, "o", "\r\n"]
[94.408866, "o", "    def setup(self, use_numexpr, threads):\r\n"]
[94.433463, "o", "        self.df = DataFrame(np.random.randn(20000, 100))\r\n"]
[94.45806, "o", "        self.df2 = DataFrame(np.random.randn(20000, 100))\r\n"]
[94.482657, "o", "\r\n"]
[94.507254, "o", "        if threads != \"default\":\r\n"]
[94.531851, "o", "            expr.set_numexpr_threads(threads)\r\n"]
[94.556448, "o", "        if not use_numexpr:\r\n"]
[94.581045, "o", "            expr.set_use_numexpr(False)\r\n"]
[94.605642, "o", "\r\n"]
[94.630239, "o", "    def time_frame_add(self, use_numexpr, threads):\r\n"]
[94.654836, "o", "        self.df + self.df2\r\n"]
[94.679433, "o", "\r\n"]
[94.70403, "o", "    def time_frame_mult(self, use_numexpr, threads):\r\n"]
[94.728627, "o", "        self.df * self.df2\r\n"]
[94.753224, "o", "\r\n"]
[94.777821, "o", "    def time_frame_multi_and(self, use_numexpr, threads):\r\n"]
[94.802418, "o", "        self.df[(self.df > 0) & (self.df2 > 0)]\r\n"]
[94.827015, "o", "\r\n"]
[94.851612, "o", "    def time_frame_comparison(self, use_numexpr, threads):\r\n"]
[94.876209, "o", "        self.df > self.df2\r\n"]
[94.900806, "o", "\r\n"]
[94.925403, "o", "    def teardown(self, use_numexpr, threads):\r\n"]
[95.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[95.002, "i", "asv run --python=same --config=asv_bench/asv.conf.json --bench=\"arithmetic.Ops.*\"\r"]
[95.004, "o", "asv run --python=same --config=asv_bench/asv.conf.json --bench=\"arithmetic.Ops.*\"\r\n"]
[97.478, "o", "\u001b[?2004l\r\n"]
[100.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[100.002, "i", "cd asv_bench\r"]
[100.004, "o", "cd asv_bench\r\n"]
[100.006, "o", "\u001b[?2004l\r\n"]
[105.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[105.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[105.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[105.095891, "o", "\u001b[?2004l\r\n"]
[105.185782, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[105.275673, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[105.365564, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[105.455455, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[105.545345, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[105.635236, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[105.725127, "o", "             --                     threads         \r\n"]
[105.815018, "o", "             ------------- -------------------------\r\n"]
[105.904909, "o", "              use_numexpr    default         1      \r\n"]
[105.9948, "o", "             ============= ============ ============\r\n"]
[106.084691, "o", "                  True      2.51\u00b10.1ms   2.66\u00b10.2ms \r\n"]
[106.174582, "o", "                 False      2.16\u00b10.2ms   2.30\u00b10.3ms \r\n"]
[106.264473, "o", "             ============= ============ ============\r\n"]
[106.354364, "o", "\r\n"]
[106.444255, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0masv run -e existing --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[106.534145, "o", "                                                                                                            ok\r\n"]
[106.624036, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[106.713927, "o", "             --                      threads          \r\n"]
[106.803818, "o", "             ------------- ---------------------------\r\n"]
[106.893709, "o", "              use_numexpr     default          1      \r\n"]
[106.9836, "o", "             ============= ============= =============\r\n"]
[107.073491, "o", "                  True       2.18\u00b10.1ms   2.26\u00b10.08ms \r\n"]
[107.163382, "o", "                 False      1.81\u00b10.08ms   1.73\u00b10.07ms \r\n"]
[107.253273, "o", "             ============= ============= =============\r\n"]
[107.343164, "o", "\r\n"]
[107.433055, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[107.522945, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[107.612836, "o", "             --                      threads          \r\n"]
[107.702727, "o", "             ------------- ---------------------------\r\n"]
[107.792618, "o", "              use_numexpr     default          1      \r\n"]
[107.882509, "o", "             ============= ============= =============\r\n"]
[107.9724, "o", "                  True       2.50\u00b10.2ms    2.57\u00b10.1ms \r\n"]
[108.062291, "o", "                 False      2.09\u00b10.07ms   2.16\u00b10.04ms \r\n"]
[108.152182, "o", "             ============= ============= =============\r\n"]
[108.242073, "o", "\r\n"]
[108.331964, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[108.421855, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ =============\u001b[0m\r\n"]
[108.511745, "o", "             --                     threads          \r\n"]
[108.601636, "o", "             ------------- --------------------------\r\n"]
[108.691527, "o", "              use_numexpr    default          1      \r\n"]
[108.781418, "o", "             ============= ============ =============\r\n"]
[108.871309, "o", "                  True      10.7\u00b10.2ms   13.1\u00b10.09ms \r\n"]
[108.9612, "o", "                 False      10.2\u00b10.2ms    10.2\u00b10.1ms \r\n"]
[109.051091, "o", "             ============= ============ =============\r\n"]
[109.140982, "o", "\r\n"]
[109.230873, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.2\u00b10.2ms\r\n"]
[109.320764, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                    28.6\u00b10.1ms\r\n"]
[109.410655, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              769\u00b180\u03bcs\r\n"]
[109.500545, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.3\u00b10.2ms\r\n"]
[109.590436, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    24.9\u00b10.3ms\r\n"]
[109.680327, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                              1.53\u00b10.1ms\r\n"]
[109.770218, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.4\u00b10.08ms\r\n"]
[109.860109, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      429\u00b12\u03bcs\r\n"]
[110.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[110.002, "i", "asv run -e existing --python=same --bench=\"arithmetic.Ops.*\"\r"]
[110.004, "o", "asv run -e existing --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[112.478, "o", "\u001b[?2004l\r\n"]
[115.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[115.002, "i", "asv profile --python=same arithmetic.Ops.time_frame_add\r"]
[115.004, "o", "asv profile --python=same arithmetic.Ops.time_frame_add\r\n"]
[116.654, "o", "\u001b[?2004l\r\n"]
[118.302, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[120.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[120.002, "i", "cd ..\r"]
[120.004, "o", "cd ..\r\n"]
[120.006, "o", "\u001b[?2004l\r\n"]
[125.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[125.002, "i", "ls -la pandas | sed -n '1,120p'\r"]
[125.004, "o", "ls -la pandas | sed -n '1,120p'\r\n"]
[125.220957, "o", "\u001b[?2004l\r\n"]
[125.435913, "o", "total 172\r\n"]
[125.65087, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 .\r\n"]
[125.865826, "o", "drwxr-xr-x 1 root root  4096 Oct  1 17:05 ..\r\n"]
[126.080783, "o", "-rw-r--r-- 1 root root  8178 Sep 12 21:44 __init__.py\r\n"]
[126.295739, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 _config\r\n"]
[126.510696, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 _libs\r\n"]
[126.725652, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 _testing\r\n"]
[126.940609, "o", "-rw-r--r-- 1 root root 14498 Sep 12 21:44 _typing.py\r\n"]
[127.155565, "o", "-rw-r--r-- 1 root root 23621 Sep 12 21:44 _version.py\r\n"]
[127.370522, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 api\r\n"]
[127.585478, "o", "drwxr-xr-x 2 root root  4096 Sep 12 21:42 arrays\r\n"]
[127.800435, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 compat\r\n"]
[128.015391, "o", "-rw-r--r-- 1 root root 52269 Sep 12 21:44 conftest.py\r\n"]
[128.230348, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 core\r\n"]
[128.445304, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 errors\r\n"]
[128.660261, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 io\r\n"]
[128.875217, "o", "-rw-r--r-- 1 root root  1018 Sep 12 21:42 meson.build\r\n"]
[129.090174, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 plotting\r\n"]
[129.30513, "o", "-rw-r--r-- 1 root root   312 Sep 12 21:42 testing.py\r\n"]
[129.520087, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 tests\r\n"]
[129.735043, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 tseries\r\n"]
[130.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[130.002, "i", "grep -RIn \"normalise\\|Normalize\\|normalization\\|normalisation\\|normalised\\|normalised\" pandas || true\r"]
[130.004, "o", "grep -RIn \"normalise\\|Normalize\\|normalization\\|normalisation\\|normalised\\|normalised\" pandas || true\r\n"]
[130.069385, "o", "\u001b[?2004l\r\n"]
[130.132769, "o", "\u001b[35m\u001b[Kpandas/core/frame.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K12160\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1 by default. This can be changed using the ddof argument\r\n"]
[130.196154, "o", "\u001b[35m\u001b[Kpandas/core/frame.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K12280\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1 by default. This can be changed using the ddof argument.\r\n"]
[130.259538, "o", "\u001b[35m\u001b[Kpandas/core/frame.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K12399\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1 by default. This can be changed using the ddof argument.\r\n"]
[130.322923, "o", "\u001b[35m\u001b[Kpandas/core/frame.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K12521\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1.\r\n"]
[130.386308, "o", "\u001b[35m\u001b[Kpandas/core/frame.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K12642\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        kurtosis (kurtosis of normal == 0.0). \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1.\r\n"]
[130.449692, "o", "\u001b[35m\u001b[Kpandas/core/arrays/datetimes.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2315\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by `N-1` by default. This can be changed using ``ddof``.\r\n"]
[130.513077, "o", "\u001b[35m\u001b[Kpandas/core/reshape/pivot.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K942\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K by dividing all values by the sum of values.\r\n"]
[130.576462, "o", "\u001b[35m\u001b[Kpandas/core/reshape/pivot.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K1159\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        # \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K core\r\n"]
[130.639846, "o", "\u001b[35m\u001b[Kpandas/core/indexes/datetimes.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K864\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[130.703231, "o", "\u001b[35m\u001b[Kpandas/core/indexes/datetimes.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K1056\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[130.766615, "o", "\u001b[35m\u001b[Kpandas/core/generic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K12779\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K            \"Return unbiased variance over requested axis.\\n\\n\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by \"\r\n"]
[130.83, "o", "\u001b[35m\u001b[Kpandas/core/generic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K12790\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K            \"\\n\\n\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1 by default. This can be changed using the \"\r\n"]
[130.893385, "o", "\u001b[35m\u001b[Kpandas/core/generic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K12801\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K            \"axis.\\n\\n\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1 by default. This can be changed \"\r\n"]
[130.956769, "o", "\u001b[35m\u001b[Kpandas/core/generic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K12844\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        desc = \"Return unbiased skew over requested axis.\\n\\n\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1.\"\r\n"]
[131.020154, "o", "\u001b[35m\u001b[Kpandas/core/generic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K12892\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K            \"kurtosis (kurtosis of normal == 0.0). \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd \"\r\n"]
[131.083538, "o", "\u001b[35m\u001b[Kpandas/core/apply.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K1702\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K user-provided \"named aggregation\" kwargs.\r\n"]
[131.146923, "o", "\u001b[35m\u001b[Kpandas/core/apply.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K1726\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    # \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K the aggregation functions as Mapping[column, List[func]],\r\n"]
[131.210308, "o", "\u001b[35m\u001b[Kpandas/core/groupby/groupby.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2681\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K            # \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K the results by dividing by the original group sizes.\r\n"]
[131.273692, "o", "\u001b[35m\u001b[Kpandas/core/groupby/groupby.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K5409\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K            sampling probabilities after \u001b[01;31m\u001b[Knormalization\u001b[m\u001b[K within each group.\r\n"]
[131.337077, "o", "\u001b[35m\u001b[Kpandas/core/groupby/generic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K1219\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1.\r\n"]
[131.400462, "o", "\u001b[35m\u001b[Kpandas/core/groupby/generic.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2932\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1.\r\n"]
[131.463846, "o", "\u001b[35m\u001b[Kpandas/core/series.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K7071\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1 by default. This can be changed using the ddof argument.\r\n"]
[131.527231, "o", "\u001b[35m\u001b[Kpandas/core/series.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K7190\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        kurtosis (kurtosis of normal == 0.0). \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd by N-1.\r\n"]
[131.590615, "o", "\u001b[35m\u001b[Kpandas/io/json/_normalize.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K# JSON \u001b[01;31m\u001b[Knormalization\u001b[m\u001b[K routines\r\n"]
[131.654, "o", "\u001b[35m\u001b[Kpandas/io/json/_normalize.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K280\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K semi-structured JSON data into a flat table.\r\n"]
[131.717385, "o", "\u001b[35m\u001b[Kpandas/io/json/_normalize.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K357\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Ks nested data up to level 1.\r\n"]
[131.780769, "o", "\u001b[35m\u001b[Kpandas/io/json/_normalize.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K519\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K            # naive \u001b[01;31m\u001b[Knormalization\u001b[m\u001b[K, this is idempotent for flat records\r\n"]
[131.844154, "o", "\u001b[35m\u001b[Kpandas/io/json/_json.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K687\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    json_normalize : \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K semi-structured JSON data into a flat table.\r\n"]
[131.907538, "o", "\u001b[35m\u001b[Kpandas/io/formats/style.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K4043\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    norm = _matplotlib.colors.\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K(smin - (rng * low), smax + (rng * high))\r\n"]
[131.970923, "o", "\u001b[35m\u001b[Kpandas/io/formats/style.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K4338\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        norm = _matplotlib.colors.\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K(left, right)\r\n"]
[132.034308, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/vectorized.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K263\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K each of the (nanosecond) timezone aware timestamps in the given\r\n"]
[132.097692, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/timestamps.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K1243\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K Timestamp to midnight, preserving tz information.\r\n"]
[132.161077, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K1848\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight.\r\n"]
[132.224462, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2040\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.287846, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2615\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.351231, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2654\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.414615, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2695\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.478, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2749\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.541385, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2871\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.604769, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2912\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.668154, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2953\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.731538, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K2994\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.794923, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3100\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.858308, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3141\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.921692, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3182\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[132.985077, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3215\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.048462, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3275\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.111846, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3313\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.175231, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3350\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.238615, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3388\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.302, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3563\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.365385, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3617\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.428769, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3656\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.492154, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3852\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.555538, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K3935\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.618923, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K4084\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.682308, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K4287\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.745692, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K4522\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.809077, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K4594\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.872462, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K4725\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start/end dates to midnight before generating date range.\r\n"]
[133.935846, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K4914\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K end dates to midnight before generating date range.\r\n"]
[133.999231, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/offsets.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K4975\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K start dates to midnight before generating date range.\r\n"]
[134.062615, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/parsing.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K954\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    # \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K offset part of tokens.\r\n"]
[134.126, "o", "\u001b[35m\u001b[Kpandas/_libs/tslibs/parsing.pyx\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K977\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K            # So in addition to the format \u001b[01;31m\u001b[Knormalization\u001b[m\u001b[K, we rejoin them here.\r\n"]
[134.189385, "o", "\u001b[35m\u001b[Kpandas/tests/strings/test_strings.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K652\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    with pytest.raises(ValueError, match=\"invalid \u001b[01;31m\u001b[Knormalization\u001b[m\u001b[K form\"):\r\n"]
[134.252769, "o", "\u001b[35m\u001b[Kpandas/tests/tslibs/test_npy_units.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K10\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[Kclass TestIsDateArray\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[Kd:\r\n"]
[134.316154, "o", "\u001b[35m\u001b[Kpandas/tests/plotting/frame/test_frame.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K993\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        default_norm = mpl.colors.\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K(*color_min_max)\r\n"]
[134.379538, "o", "\u001b[35m\u001b[Kpandas/tests/reshape/test_crosstab.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K764\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        # use multiple columns with margins and \u001b[01;31m\u001b[Knormalization\u001b[m\u001b[K\r\n"]
[134.442923, "o", "\u001b[35m\u001b[Kpandas/tests/io/json/test_normalize.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K112\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[Kclass TestJSON\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K:\r\n"]
[134.506308, "o", "\u001b[35m\u001b[Kpandas/tests/io/formats/test_css.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K36\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[Kdef test_css_parse_\u001b[01;31m\u001b[Knormalisation\u001b[m\u001b[K(name, norm, abnorm):\r\n"]
[134.569692, "o", "\u001b[35m\u001b[Kpandas/tests/indexes/datetimes/methods/test_normalize.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K17\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[Kclass Test\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K:\r\n"]
[134.633077, "o", "\u001b[35m\u001b[Kpandas/tests/indexes/datetimes/test_scalar_compat.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K203\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        # work around different \u001b[01;31m\u001b[Knormalization\u001b[m\u001b[K schemes GH#22342\r\n"]
[134.696462, "o", "\u001b[35m\u001b[Kpandas/tests/frame/methods/test_to_csv.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K1397\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        # \u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K carriage return for Windows OS\r\n"]
[134.759846, "o", "\u001b[35m\u001b[Kpandas/tests/tseries/offsets/test_offsets_properties.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K63\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K    # 2) that hour is not incorrectly changed by this \u001b[01;31m\u001b[Knormalization\u001b[m\u001b[K\r\n"]
[134.823231, "o", "\u001b[35m\u001b[Kpandas/tests/scalar/timestamp/test_timestamp.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K142\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K        # different \u001b[01;31m\u001b[Knormalization\u001b[m\u001b[Ks\r\n"]
[134.886615, "o", "\u001b[35m\u001b[Kpandas/tests/scalar/timestamp/methods/test_normalize.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K7\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[Kclass TestTimestamp\u001b[01;31m\u001b[KNormalize\u001b[m\u001b[K:\r\n"]
[135.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[135.002, "i", "grep -RIn \"normalize\\|normalized\\|normalizer\" pandas | head -n 50 || true\r"]
[135.004, "o", "grep -RIn \"normalize\\|normalized\\|normalizer\" pandas | head -n 50 || true\r\n"]
[135.102941, "o", "\u001b[?2004l\r\n"]
[135.199882, "o", "pandas/core/frame.py:7286:        normalize: bool = False,\r\n"]
[135.296824, "o", "pandas/core/frame.py:7298:        normalize : bool, default False\r\n"]
[135.393765, "o", "pandas/core/frame.py:7364:        >>> df.value_counts(normalize=True)\r\n"]
[135.490706, "o", "pandas/core/frame.py:7410:        name = \"proportion\" if normalize else \"count\"\r\n"]
[135.587647, "o", "pandas/core/frame.py:7418:        if normalize:\r\n"]
[135.684588, "o", "pandas/core/frame.py:11192:        The covariance is normalized by N-ddof.\r\n"]
[135.781529, "o", "pandas/core/frame.py:12339:        Alternatively, ``ddof=0`` can be set to normalize by N instead of N-1:\r\n"]
[135.878471, "o", "pandas/core/frame.py:12465:        Alternatively, `ddof=0` can be set to normalize by N instead of N-1:\r\n"]
[135.975412, "o", "pandas/core/window/ewm.py:542:                normalize=True,\r\n"]
[136.072353, "o", "pandas/core/window/ewm.py:556:                normalize=True,\r\n"]
[136.169294, "o", "pandas/core/window/ewm.py:610:                normalize=False,\r\n"]
[136.266235, "o", "pandas/core/window/ewm.py:624:                normalize=False,\r\n"]
[136.363176, "o", "pandas/core/window/numba_.py:90:    normalize: bool,\r\n"]
[136.460118, "o", "pandas/core/window/numba_.py:108:    normalize : bool\r\n"]
[136.557059, "o", "pandas/core/window/numba_.py:148:                        if normalize:\r\n"]
[136.654, "o", "pandas/core/window/numba_.py:158:                            if normalize:\r\n"]
[136.750941, "o", "pandas/core/window/numba_.py:162:                                    if normalize:\r\n"]
[136.847882, "o", "pandas/core/window/numba_.py:274:    normalize: bool,\r\n"]
[136.944824, "o", "pandas/core/window/numba_.py:292:    normalize: bool\r\n"]
[137.041765, "o", "pandas/core/window/numba_.py:326:                        if normalize:\r\n"]
[137.138706, "o", "pandas/core/window/numba_.py:336:                            if normalize:\r\n"]
[137.235647, "o", "pandas/core/window/numba_.py:342:                                    if normalize:\r\n"]
[137.332588, "o", "pandas/core/algorithms.py:848:    normalize: bool = False,\r\n"]
[137.429529, "o", "pandas/core/algorithms.py:858:    name = \"proportion\" if normalize else \"count\"\r\n"]
[137.526471, "o", "pandas/core/algorithms.py:921:    if normalize:\r\n"]
[137.623412, "o", "pandas/core/sample.py:138:        to the vector normalized\r\n"]
[137.720353, "o", "pandas/core/resample.py:2658:        first = first.normalize()\r\n"]
[137.817294, "o", "pandas/core/resample.py:2659:        last = last.normalize()\r\n"]
[137.914235, "o", "pandas/core/resample.py:2768:        origin_timestamp = first.normalize()._value\r\n"]
[138.011176, "o", "pandas/core/resample.py:2834:    normalize: bool = False,\r\n"]
[138.108118, "o", "pandas/core/resample.py:2868:        if normalize:\r\n"]
[138.205059, "o", "pandas/core/resample.py:2869:            new_obj.index = new_obj.index.normalize()\r\n"]
[138.302, "o", "pandas/core/strings/accessor.py:3196:    def normalize(self, form):\r\n"]
[138.398941, "o", "pandas/core/strings/accessor.py:3201:        :func:`unicodedata.normalize`.\r\n"]
[138.495882, "o", "pandas/core/strings/accessor.py:3213:            and contains the normalized strings.\r\n"]
[138.592824, "o", "pandas/core/strings/accessor.py:3228:        >>> ser.str.normalize(\"NFC\") == ser.str.normalize(\"NFD\")\r\n"]
[138.689765, "o", "pandas/core/strings/accessor.py:3232:        result = self._data.array._str_normalize(form)\r\n"]
[138.786706, "o", "pandas/core/strings/object_array.py:497:    def _str_normalize(self, form):\r\n"]
[138.883647, "o", "pandas/core/strings/object_array.py:498:        f = lambda x: unicodedata.normalize(form, x)\r\n"]
[138.980588, "o", "pandas/core/strings/base.py:239:    def _str_normalize(self, form):\r\n"]
[139.077529, "o", "pandas/core/arrays/arrow/array.py:2554:    def _str_normalize(self, form: Literal[\"NFC\", \"NFD\", \"NFKC\", \"NFKD\"]) -> Self:\r\n"]
[139.174471, "o", "pandas/core/arrays/arrow/array.py:2555:        predicate = lambda val: unicodedata.normalize(form, val)\r\n"]
[139.271412, "o", "pandas/core/arrays/arrow/array.py:2834:    def _dt_normalize(self) -> Self:\r\n"]
[139.368353, "o", "pandas/core/arrays/datetimes.py:37:    is_date_array_normalized,\r\n"]
[139.465294, "o", "pandas/core/arrays/datetimes.py:40:    normalize_i8_timestamps,\r\n"]
[139.562235, "o", "pandas/core/arrays/datetimes.py:274:        \"normalize\",\r\n"]
[139.659176, "o", "pandas/core/arrays/datetimes.py:420:        normalize: bool = False,\r\n"]
[139.756118, "o", "pandas/core/arrays/datetimes.py:459:        start, end = _maybe_normalize_endpoints(start, end, normalize)\r\n"]
[139.853059, "o", "pandas/core/arrays/datetimes.py:648:    def is_normalized(self) -> bool:\r\n"]
[140.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[140.002, "i", "sed -n '1,240p' asv_bench/benchmarks/arithmetic.py\r"]
[140.004, "o", "sed -n '1,240p' asv_bench/benchmarks/arithmetic.py\r\n"]
[140.026515, "o", "\u001b[?2004l\r\n"]
[140.047029, "o", "import operator\r\n"]
[140.067544, "o", "import warnings\r\n"]
[140.088058, "o", "\r\n"]
[140.108573, "o", "import numpy as np\r\n"]
[140.129087, "o", "\r\n"]
[140.149602, "o", "import pandas as pd\r\n"]
[140.170116, "o", "from pandas import (\r\n"]
[140.190631, "o", "    DataFrame,\r\n"]
[140.211145, "o", "    Index,\r\n"]
[140.23166, "o", "    Series,\r\n"]
[140.252174, "o", "    Timestamp,\r\n"]
[140.272689, "o", "    date_range,\r\n"]
[140.293203, "o", "    to_timedelta,\r\n"]
[140.313718, "o", ")\r\n"]
[140.334232, "o", "\r\n"]
[140.354747, "o", "from .pandas_vb_common import numeric_dtypes\r\n"]
[140.375261, "o", "\r\n"]
[140.395776, "o", "try:\r\n"]
[140.41629, "o", "    import pandas.core.computation.expressions as expr\r\n"]
[140.436805, "o", "except ImportError:\r\n"]
[140.45732, "o", "    import pandas.computation.expressions as expr\r\n"]
[140.477834, "o", "try:\r\n"]
[140.498349, "o", "    import pandas.tseries.holiday\r\n"]
[140.518863, "o", "except ImportError:\r\n"]
[140.539378, "o", "    pass\r\n"]
[140.559892, "o", "\r\n"]
[140.580407, "o", "\r\n"]
[140.600921, "o", "class IntFrameWithScalar:\r\n"]
[140.621436, "o", "    params = [\r\n"]
[140.64195, "o", "        [np.float64, np.int64],\r\n"]
[140.662465, "o", "        [2, 3.0, np.int32(4), np.float64(5)],\r\n"]
[140.682979, "o", "        [\r\n"]
[140.703494, "o", "            operator.add,\r\n"]
[140.724008, "o", "            operator.sub,\r\n"]
[140.744523, "o", "            operator.mul,\r\n"]
[140.765037, "o", "            operator.truediv,\r\n"]
[140.785552, "o", "            operator.floordiv,\r\n"]
[140.806066, "o", "            operator.pow,\r\n"]
[140.826581, "o", "            operator.mod,\r\n"]
[140.847095, "o", "            operator.eq,\r\n"]
[140.86761, "o", "            operator.ne,\r\n"]
[140.888124, "o", "            operator.gt,\r\n"]
[140.908639, "o", "            operator.ge,\r\n"]
[140.929154, "o", "            operator.lt,\r\n"]
[140.949668, "o", "            operator.le,\r\n"]
[140.970183, "o", "        ],\r\n"]
[140.990697, "o", "    ]\r\n"]
[141.011212, "o", "    param_names = [\"dtype\", \"scalar\", \"op\"]\r\n"]
[141.031726, "o", "\r\n"]
[141.052241, "o", "    def setup(self, dtype, scalar, op):\r\n"]
[141.072755, "o", "        arr = np.random.randn(20000, 100)\r\n"]
[141.09327, "o", "        self.df = DataFrame(arr.astype(dtype))\r\n"]
[141.113784, "o", "\r\n"]
[141.134299, "o", "    def time_frame_op_with_scalar(self, dtype, scalar, op):\r\n"]
[141.154813, "o", "        op(self.df, scalar)\r\n"]
[141.175328, "o", "\r\n"]
[141.195842, "o", "\r\n"]
[141.216357, "o", "class OpWithFillValue:\r\n"]
[141.236871, "o", "    def setup(self):\r\n"]
[141.257386, "o", "        # GH#31300\r\n"]
[141.2779, "o", "        arr = np.arange(10**6)\r\n"]
[141.298415, "o", "        df = DataFrame({\"A\": arr})\r\n"]
[141.318929, "o", "        ser = df[\"A\"]\r\n"]
[141.339444, "o", "\r\n"]
[141.359959, "o", "        self.df = df\r\n"]
[141.380473, "o", "        self.ser = ser\r\n"]
[141.400988, "o", "\r\n"]
[141.421502, "o", "    def time_frame_op_with_fill_value_no_nas(self):\r\n"]
[141.442017, "o", "        self.df.add(self.df, fill_value=4)\r\n"]
[141.462531, "o", "\r\n"]
[141.483046, "o", "    def time_series_op_with_fill_value_no_nas(self):\r\n"]
[141.50356, "o", "        self.ser.add(self.ser, fill_value=4)\r\n"]
[141.524075, "o", "\r\n"]
[141.544589, "o", "\r\n"]
[141.565104, "o", "class MixedFrameWithSeriesAxis:\r\n"]
[141.585618, "o", "    params = [\r\n"]
[141.606133, "o", "        [\r\n"]
[141.626647, "o", "            \"eq\",\r\n"]
[141.647162, "o", "            \"ne\",\r\n"]
[141.667676, "o", "            \"lt\",\r\n"]
[141.688191, "o", "            \"le\",\r\n"]
[141.708705, "o", "            \"ge\",\r\n"]
[141.72922, "o", "            \"gt\",\r\n"]
[141.749734, "o", "            \"add\",\r\n"]
[141.770249, "o", "            \"sub\",\r\n"]
[141.790763, "o", "            \"truediv\",\r\n"]
[141.811278, "o", "            \"floordiv\",\r\n"]
[141.831793, "o", "            \"mul\",\r\n"]
[141.852307, "o", "            \"pow\",\r\n"]
[141.872822, "o", "        ]\r\n"]
[141.893336, "o", "    ]\r\n"]
[141.913851, "o", "    param_names = [\"opname\"]\r\n"]
[141.934365, "o", "\r\n"]
[141.95488, "o", "    def setup(self, opname):\r\n"]
[141.975394, "o", "        arr = np.arange(10**6).reshape(1000, -1)\r\n"]
[141.995909, "o", "        df = DataFrame(arr)\r\n"]
[142.016423, "o", "        df[\"C\"] = 1.0\r\n"]
[142.036938, "o", "        self.df = df\r\n"]
[142.057452, "o", "        self.ser = df[0]\r\n"]
[142.077967, "o", "        self.row = df.iloc[0]\r\n"]
[142.098481, "o", "\r\n"]
[142.118996, "o", "    def time_frame_op_with_series_axis0(self, opname):\r\n"]
[142.13951, "o", "        getattr(self.df, opname)(self.ser, axis=0)\r\n"]
[142.160025, "o", "\r\n"]
[142.180539, "o", "    def time_frame_op_with_series_axis1(self, opname):\r\n"]
[142.201054, "o", "        getattr(operator, opname)(self.df, self.ser)\r\n"]
[142.221568, "o", "\r\n"]
[142.242083, "o", "    # exclude comparisons from the params for time_frame_op_with_series_axis1\r\n"]
[142.262598, "o", "    #  since they do not do alignment so raise\r\n"]
[142.283112, "o", "    time_frame_op_with_series_axis1.params = [params[0][6:]]\r\n"]
[142.303627, "o", "\r\n"]
[142.324141, "o", "\r\n"]
[142.344656, "o", "class FrameWithFrameWide:\r\n"]
[142.36517, "o", "    # Many-columns, mixed dtypes\r\n"]
[142.385685, "o", "\r\n"]
[142.406199, "o", "    params = [\r\n"]
[142.426714, "o", "        [\r\n"]
[142.447228, "o", "            # GH#32779 has discussion of which operators are included here\r\n"]
[142.467743, "o", "            operator.add,\r\n"]
[142.488257, "o", "            operator.floordiv,\r\n"]
[142.508772, "o", "            operator.gt,\r\n"]
[142.529286, "o", "        ],\r\n"]
[142.549801, "o", "        [\r\n"]
[142.570315, "o", "            # (n_rows, n_columns)\r\n"]
[142.59083, "o", "            (1_000_000, 10),\r\n"]
[142.611344, "o", "            (100_000, 100),\r\n"]
[142.631859, "o", "            (10_000, 1000),\r\n"]
[142.652373, "o", "            (1000, 10_000),\r\n"]
[142.672888, "o", "        ],\r\n"]
[142.693402, "o", "    ]\r\n"]
[142.713917, "o", "    param_names = [\"op\", \"shape\"]\r\n"]
[142.734432, "o", "\r\n"]
[142.754946, "o", "    def setup(self, op, shape):\r\n"]
[142.775461, "o", "        # we choose dtypes so as to make the blocks\r\n"]
[142.795975, "o", "        #  a) not perfectly match between right and left\r\n"]
[142.81649, "o", "        #  b) appreciably bigger than single columns\r\n"]
[142.837004, "o", "        n_rows, n_cols = shape\r\n"]
[142.857519, "o", "\r\n"]
[142.878033, "o", "        if op is operator.floordiv:\r\n"]
[142.898548, "o", "            # floordiv is much slower than the other operations -> use less data\r\n"]
[142.919062, "o", "            n_rows = n_rows // 10\r\n"]
[142.939577, "o", "\r\n"]
[142.960091, "o", "        # construct dataframe with 2 blocks\r\n"]
[142.980606, "o", "        arr1 = np.random.randn(n_rows, n_cols // 2).astype(\"f8\")\r\n"]
[143.00112, "o", "        arr2 = np.random.randn(n_rows, n_cols // 2).astype(\"f4\")\r\n"]
[143.021635, "o", "        df = pd.concat([DataFrame(arr1), DataFrame(arr2)], axis=1, ignore_index=True)\r\n"]
[143.042149, "o", "        # should already be the case, but just to be sure\r\n"]
[143.062664, "o", "        df._consolidate_inplace()\r\n"]
[143.083178, "o", "\r\n"]
[143.103693, "o", "        # TODO: GH#33198 the setting here shouldn't need two steps\r\n"]
[143.124207, "o", "        arr1 = np.random.randn(n_rows, max(n_cols // 4, 3)).astype(\"f8\")\r\n"]
[143.144722, "o", "        arr2 = np.random.randn(n_rows, n_cols // 2).astype(\"i8\")\r\n"]
[143.165237, "o", "        arr3 = np.random.randn(n_rows, n_cols // 4).astype(\"f8\")\r\n"]
[143.185751, "o", "        df2 = pd.concat(\r\n"]
[143.206266, "o", "            [DataFrame(arr1), DataFrame(arr2), DataFrame(arr3)],\r\n"]
[143.22678, "o", "            axis=1,\r\n"]
[143.247295, "o", "            ignore_index=True,\r\n"]
[143.267809, "o", "        )\r\n"]
[143.288324, "o", "        # should already be the case, but just to be sure\r\n"]
[143.308838, "o", "        df2._consolidate_inplace()\r\n"]
[143.329353, "o", "\r\n"]
[143.349867, "o", "        self.left = df\r\n"]
[143.370382, "o", "        self.right = df2\r\n"]
[143.390896, "o", "\r\n"]
[143.411411, "o", "    def time_op_different_blocks(self, op, shape):\r\n"]
[143.431925, "o", "        # blocks (and dtypes) are not aligned\r\n"]
[143.45244, "o", "        op(self.left, self.right)\r\n"]
[143.472954, "o", "\r\n"]
[143.493469, "o", "    def time_op_same_blocks(self, op, shape):\r\n"]
[143.513983, "o", "        # blocks (and dtypes) are aligned\r\n"]
[143.534498, "o", "        op(self.left, self.left)\r\n"]
[143.555012, "o", "\r\n"]
[143.575527, "o", "\r\n"]
[143.596041, "o", "class Ops:\r\n"]
[143.616556, "o", "    params = [[True, False], [\"default\", 1]]\r\n"]
[143.637071, "o", "    param_names = [\"use_numexpr\", \"threads\"]\r\n"]
[143.657585, "o", "\r\n"]
[143.6781, "o", "    def setup(self, use_numexpr, threads):\r\n"]
[143.698614, "o", "        self.df = DataFrame(np.random.randn(20000, 100))\r\n"]
[143.719129, "o", "        self.df2 = DataFrame(np.random.randn(20000, 100))\r\n"]
[143.739643, "o", "\r\n"]
[143.760158, "o", "        if threads != \"default\":\r\n"]
[143.780672, "o", "            expr.set_numexpr_threads(threads)\r\n"]
[143.801187, "o", "        if not use_numexpr:\r\n"]
[143.821701, "o", "            expr.set_use_numexpr(False)\r\n"]
[143.842216, "o", "\r\n"]
[143.86273, "o", "    def time_frame_add(self, use_numexpr, threads):\r\n"]
[143.883245, "o", "        self.df + self.df2\r\n"]
[143.903759, "o", "\r\n"]
[143.924274, "o", "    def time_frame_mult(self, use_numexpr, threads):\r\n"]
[143.944788, "o", "        self.df * self.df2\r\n"]
[143.965303, "o", "\r\n"]
[143.985817, "o", "    def time_frame_multi_and(self, use_numexpr, threads):\r\n"]
[144.006332, "o", "        self.df[(self.df > 0) & (self.df2 > 0)]\r\n"]
[144.026846, "o", "\r\n"]
[144.047361, "o", "    def time_frame_comparison(self, use_numexpr, threads):\r\n"]
[144.067876, "o", "        self.df > self.df2\r\n"]
[144.08839, "o", "\r\n"]
[144.108905, "o", "    def teardown(self, use_numexpr, threads):\r\n"]
[144.129419, "o", "        expr.set_use_numexpr(True)\r\n"]
[144.149934, "o", "        expr.set_numexpr_threads()\r\n"]
[144.170448, "o", "\r\n"]
[144.190963, "o", "\r\n"]
[144.211477, "o", "class Ops2:\r\n"]
[144.231992, "o", "    def setup(self):\r\n"]
[144.252506, "o", "        N = 10**3\r\n"]
[144.273021, "o", "        self.df = DataFrame(np.random.randn(N, N))\r\n"]
[144.293535, "o", "        self.df2 = DataFrame(np.random.randn(N, N))\r\n"]
[144.31405, "o", "\r\n"]
[144.334564, "o", "        self.df_int = DataFrame(\r\n"]
[144.355079, "o", "            np.random.randint(\r\n"]
[144.375593, "o", "                np.iinfo(np.int16).min, np.iinfo(np.int16).max, size=(N, N)\r\n"]
[144.396108, "o", "            )\r\n"]
[144.416622, "o", "        )\r\n"]
[144.437137, "o", "        self.df2_int = DataFrame(\r\n"]
[144.457651, "o", "            np.random.randint(\r\n"]
[144.478166, "o", "                np.iinfo(np.int16).min, np.iinfo(np.int16).max, size=(N, N)\r\n"]
[144.49868, "o", "            )\r\n"]
[144.519195, "o", "        )\r\n"]
[144.53971, "o", "\r\n"]
[144.560224, "o", "        self.s = Series(np.random.randn(N))\r\n"]
[144.580739, "o", "\r\n"]
[144.601253, "o", "    # Division\r\n"]
[144.621768, "o", "\r\n"]
[144.642282, "o", "    def time_frame_float_div(self):\r\n"]
[144.662797, "o", "        self.df // self.df2\r\n"]
[144.683311, "o", "\r\n"]
[144.703826, "o", "    def time_frame_float_div_by_zero(self):\r\n"]
[144.72434, "o", "        self.df / 0\r\n"]
[144.744855, "o", "\r\n"]
[144.765369, "o", "    def time_frame_float_floor_by_zero(self):\r\n"]
[144.785884, "o", "        self.df // 0\r\n"]
[144.806398, "o", "\r\n"]
[144.826913, "o", "    def time_frame_int_div_by_zero(self):\r\n"]
[144.847427, "o", "        self.df_int / 0\r\n"]
[144.867942, "o", "\r\n"]
[144.888456, "o", "    # Modulo\r\n"]
[144.908971, "o", "\r\n"]
[144.929485, "o", "    def time_frame_int_mod(self):\r\n"]
[145.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[145.002, "i", "cd asv_bench\r"]
[145.004, "o", "cd asv_bench\r\n"]
[145.006, "o", "\u001b[?2004l\r\n"]
[150.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[150.002, "i", "asv profile --python=same benchmarks/arithmetic.py:Ops.time_frame_add\r"]
[150.004, "o", "asv profile --python=same benchmarks/arithmetic.py:Ops.time_frame_add\r\n"]
[151.654, "o", "\u001b[?2004l\r\n"]
[153.302, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[155.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[155.002, "i", "grep -RIn \"def _arith_method\\|def _arith_op\\|def operate\\|def _arith\\|class _arith\" pandas/core/ops || tr\r"]
[155.004, "o", "grep -RIn \"def _arith_method\\|def _arith_op\\|def operate\\|def _arith\\|class _arith\" pandas/core/ops || tr\r\n"]
[156.654, "o", "rue\r\n"]
[158.302, "o", "\u001b[?2004l\r\n"]
[160.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[160.002, "i", "ls -la pandas/core/ops\r"]
[160.004, "o", "ls -la pandas/core/ops\r\n"]
[162.478, "o", "\u001b[?2004l\r\n"]
[165.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[165.002, "i", "python - << 'PY'\r"]
[165.004, "o", "python - << 'PY'\r\n"]
[165.058596, "o", "\u001b[?2004l\r\n"]
[165.111191, "o", "\u001b[?2004h> import cProfile, pstats, io\r\n"]
[165.163787, "o", "\u001b[?2004l\r\n"]
[165.216383, "o", "\u001b[?2004h> import numpy as np\r\n"]
[165.268979, "o", "\u001b[?2004l\r\n"]
[165.321574, "o", "\u001b[?2004h> import pandas as pd\r\n"]
[165.37417, "o", "\u001b[?2004l\r\n"]
[165.426766, "o", "\u001b[?2004h> from pandas.core.computation import expressions as expr\r\n"]
[165.479362, "o", "\u001b[?2004l\r\n"]
[165.531957, "o", "\u001b[?2004h> \r\n"]
[165.584553, "o", "\u001b[?2004l\r\n"]
[165.637149, "o", "\u001b[?2004h> # replicate Ops.setup\r\n"]
[165.689745, "o", "\u001b[?2004l\r\n"]
[165.74234, "o", "\u001b[?2004h> df = pd.DataFrame(np.random.randn(20000, 100))\r\n"]
[165.794936, "o", "\u001b[?2004l\r\n"]
[165.847532, "o", "\u001b[?2004h> df2 = pd.DataFrame(np.random.randn(20000, 100))\r\n"]
[165.900128, "o", "\u001b[?2004l\r\n"]
[165.952723, "o", "\u001b[?2004h> \r\n"]
[166.005319, "o", "\u001b[?2004l\r\n"]
[166.057915, "o", "\u001b[?2004h> # ensure numexpr default\r\n"]
[166.110511, "o", "\u001b[?2004l\r\n"]
[166.163106, "o", "\u001b[?2004h> expr.set_use_numexpr(True)\r\n"]
[166.215702, "o", "\u001b[?2004l\r\n"]
[166.268298, "o", "\u001b[?2004h> expr.set_numexpr_threads()\r\n"]
[166.320894, "o", "\u001b[?2004l\r\n"]
[166.373489, "o", "\u001b[?2004h> \r\n"]
[166.426085, "o", "\u001b[?2004l\r\n"]
[166.478681, "o", "\u001b[?2004h> pr = cProfile.Profile()\r\n"]
[166.531277, "o", "\u001b[?2004l\r\n"]
[166.583872, "o", "\u001b[?2004h> pr.enable()\r\n"]
[166.636468, "o", "\u001b[?2004l\r\n"]
[166.689064, "o", "\u001b[?2004h> # exercise multiple ops to collect hotspots\r\n"]
[166.74166, "o", "\u001b[?2004l\r\n"]
[166.794255, "o", "\u001b[?2004h> for _ in range(5):\r\n"]
[166.846851, "o", "\u001b[?2004l\r\n"]
[166.899447, "o", "\u001b[?2004h>     _ = df + df2\r\n"]
[166.952043, "o", "\u001b[?2004l\r\n"]
[167.004638, "o", "\u001b[?2004h>     _ = df * df2\r\n"]
[167.057234, "o", "\u001b[?2004l\r\n"]
[167.10983, "o", "\u001b[?2004h>     _ = df > df2\r\n"]
[167.162426, "o", "\u001b[?2004l\r\n"]
[167.215021, "o", "\u001b[?2004h>     _ = df[(df > 0) & (df2 > 0)]\r\n"]
[167.267617, "o", "\u001b[?2004l\r\n"]
[167.320213, "o", "\u001b[?2004h> pr.disable()\r\n"]
[167.372809, "o", "\u001b[?2004l\r\n"]
[167.425404, "o", "\u001b[?2004h> s = io.StringIO()\r\n"]
[167.478, "o", "\u001b[?2004l\r\n"]
[167.530596, "o", "\u001b[?2004h> ps = pstats.Stats(pr, stream=s).sort_stats('cumulative')\r\n"]
[167.583191, "o", "\u001b[?2004l\r\n"]
[167.635787, "o", "\u001b[?2004h> ps.print_stats(30)\r\n"]
[167.688383, "o", "\u001b[?2004l\r\n"]
[167.740979, "o", "\u001b[?2004h> print(s.getvalue())\r\n"]
[167.793574, "o", "\u001b[?2004l\r\n"]
[167.84617, "o", "\u001b[?2004h> PY\r\n"]
[167.898766, "o", "\u001b[?2004l\r\n"]
[167.951362, "o", "         14428 function calls (13626 primitive calls) in 0.095 seconds\r\n"]
[168.003957, "o", "\r\n"]
[168.056553, "o", "   Ordered by: cumulative time\r\n"]
[168.109149, "o", "   List reduced from 364 to 30 due to restriction <30>\r\n"]
[168.161745, "o", "\r\n"]
[168.21434, "o", "   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\r\n"]
[168.266936, "o", "       30    0.000    0.000    0.072    0.002 /opt/conda/envs/asv_3.10/lib/python3.10/site-packages/numexpr/necompiler.py:905(evaluate)\r\n"]
[168.319532, "o", "       30    0.068    0.002    0.068    0.002 /opt/conda/envs/asv_3.10/lib/python3.10/site-packages/numexpr/necompiler.py:983(re_evaluate)\r\n"]
[168.372128, "o", "       30    0.000    0.000    0.065    0.002 /workspace/repo/pandas/core/ops/common.py:62(new_method)\r\n"]
[168.424723, "o", "       30    0.000    0.000    0.059    0.002 /workspace/repo/pandas/core/frame.py:7878(_dispatch_frame_op)\r\n"]
[168.477319, "o", "       25    0.000    0.000    0.053    0.002 /workspace/repo/pandas/core/ops/array_ops.py:188(_na_arithmetic_op)\r\n"]
[168.529915, "o", "       25    0.000    0.000    0.052    0.002 /workspace/repo/pandas/core/computation/expressions.py:227(evaluate)\r\n"]
[168.582511, "o", "      100    0.001    0.000    0.052    0.001 /workspace/repo/pandas/core/internals/managers.py:392(apply)\r\n"]
[168.635106, "o", "       25    0.000    0.000    0.052    0.002 /workspace/repo/pandas/core/computation/expressions.py:96(_evaluate_numexpr)\r\n"]
[168.687702, "o", "       20    0.000    0.000    0.035    0.002 /workspace/repo/pandas/core/internals/managers.py:1624(operate_blockwise)\r\n"]
[168.740298, "o", "       20    0.000    0.000    0.035    0.002 /workspace/repo/pandas/core/internals/ops.py:57(operate_blockwise)\r\n"]
[168.792894, "o", "       15    0.000    0.000    0.035    0.002 /workspace/repo/pandas/core/arraylike.py:55(__gt__)\r\n"]
[168.845489, "o", "       15    0.000    0.000    0.035    0.002 /workspace/repo/pandas/core/frame.py:7854(_cmp_method)\r\n"]
[168.898085, "o", "       15    0.000    0.000    0.031    0.002 /workspace/repo/pandas/core/ops/array_ops.py:287(comparison_op)\r\n"]
[168.950681, "o", "        5    0.000    0.000    0.030    0.006 /workspace/repo/pandas/core/frame.py:3934(__getitem__)\r\n"]
[169.003277, "o", "        5    0.000    0.000    0.030    0.006 /workspace/repo/pandas/core/generic.py:9860(where)\r\n"]
[169.055872, "o", "        5    0.000    0.000    0.030    0.006 /workspace/repo/pandas/core/generic.py:9682(_where)\r\n"]
[169.108468, "o", "       15    0.000    0.000    0.030    0.002 /workspace/repo/pandas/core/frame.py:7863(_arith_method)\r\n"]
[169.161064, "o", "        5    0.000    0.000    0.028    0.006 /workspace/repo/pandas/core/internals/managers.py:461(where)\r\n"]
[169.21366, "o", "        5    0.002    0.000    0.027    0.005 /workspace/repo/pandas/core/internals/blocks.py:1211(where)\r\n"]
[169.266255, "o", "       10    0.000    0.000    0.023    0.002 /workspace/repo/pandas/core/internals/blocks.py:343(apply)\r\n"]
[169.318851, "o", "       10    0.000    0.000    0.022    0.002 /workspace/repo/pandas/core/ops/array_ops.py:239(arithmetic_op)\r\n"]
[169.371447, "o", "        5    0.000    0.000    0.021    0.004 /workspace/repo/pandas/core/computation/expressions.py:247(where)\r\n"]
[169.424043, "o", "        5    0.000    0.000    0.021    0.004 /workspace/repo/pandas/core/computation/expressions.py:178(_where_numexpr)\r\n"]
[169.476638, "o", "        5    0.000    0.000    0.013    0.003 /workspace/repo/pandas/core/arraylike.py:203(__mul__)\r\n"]
[169.529234, "o", "        5    0.000    0.000    0.013    0.003 /workspace/repo/pandas/core/arraylike.py:99(__add__)\r\n"]
[169.58183, "o", "       10    0.004    0.000    0.004    0.000 {method 'reduce' of 'numpy.ufunc' objects}\r\n"]
[169.634426, "o", "        5    0.000    0.000    0.004    0.001 {method 'sum' of 'numpy.ndarray' objects}\r\n"]
[169.687021, "o", "        5    0.000    0.000    0.004    0.001 /opt/conda/envs/asv_3.10/lib/python3.10/site-packages/numpy/_core/_methods.py:51(_sum)\r\n"]
[169.739617, "o", "        5    0.000    0.000    0.004    0.001 /workspace/repo/pandas/core/arraylike.py:69(__and__)\r\n"]
[169.792213, "o", "       30    0.001    0.000    0.004    0.000 /opt/conda/envs/asv_3.10/lib/python3.10/site-packages/numexpr/necompiler.py:787(validate)\r\n"]
[169.844809, "o", "\r\n"]
[169.897404, "o", "\r\n"]
[170.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[170.002, "i", "python - << 'PY'\r"]
[170.004, "o", "python - << 'PY'\r\n"]
[170.076629, "o", "\u001b[?2004l\r\n"]
[170.147257, "o", "\u001b[?2004h> import cProfile, pstats, io\r\n"]
[170.217886, "o", "\u001b[?2004l\r\n"]
[170.288514, "o", "\u001b[?2004h> import numpy as np\r\n"]
[170.359143, "o", "\u001b[?2004l\r\n"]
[170.429771, "o", "\u001b[?2004h> import pandas as pd\r\n"]
[170.5004, "o", "\u001b[?2004l\r\n"]
[170.571029, "o", "\u001b[?2004h> N=10**3\r\n"]
[170.641657, "o", "\u001b[?2004l\r\n"]
[170.712286, "o", "\u001b[?2004h> df = pd.DataFrame(np.random.randn(N,N))\r\n"]
[170.782914, "o", "\u001b[?2004l\r\n"]
[170.853543, "o", "\u001b[?2004h> df2 = pd.DataFrame(np.random.randn(N,N))\r\n"]
[170.924171, "o", "\u001b[?2004l\r\n"]
[170.9948, "o", "\u001b[?2004h> pr = cProfile.Profile(); pr.enable()\r\n"]
[171.065429, "o", "\u001b[?2004l\r\n"]
[171.136057, "o", "\u001b[?2004h> _ = df // df2\r\n"]
[171.206686, "o", "\u001b[?2004l\r\n"]
[171.277314, "o", "\u001b[?2004h> _ = df // 0\r\n"]
[171.347943, "o", "\u001b[?2004l\r\n"]
[171.418571, "o", "\u001b[?2004h> _ = (df.values @ df2.values)  # mimic dot without pandas wrapper\r\n"]
[171.4892, "o", "\u001b[?2004l\r\n"]
[171.559829, "o", "\u001b[?2004h> pr.disable()\r\n"]
[171.630457, "o", "\u001b[?2004l\r\n"]
[171.701086, "o", "\u001b[?2004h> import sys, io as _io\r\n"]
[171.771714, "o", "\u001b[?2004l\r\n"]
[171.842343, "o", "\u001b[?2004h> s = _io.StringIO(); pstats.Stats(pr, stream=s).sort_stats('cumulative').print_stats(30)\r\n"]
[171.912971, "o", "\u001b[?2004l\r\n"]
[171.9836, "o", "\u001b[?2004h> print(s.getvalue())\r\n"]
[172.054229, "o", "\u001b[?2004l\r\n"]
[172.124857, "o", "\u001b[?2004h> PY\r\n"]
[172.195486, "o", "\u001b[?2004l\r\n"]
[172.266114, "o", "         514 function calls (491 primitive calls) in 0.052 seconds\r\n"]
[172.336743, "o", "\r\n"]
[172.407371, "o", "   Ordered by: cumulative time\r\n"]
[172.478, "o", "   List reduced from 122 to 30 due to restriction <30>\r\n"]
[172.548629, "o", "\r\n"]
[172.619257, "o", "   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\r\n"]
[172.689886, "o", "        2    0.000    0.000    0.052    0.026 /workspace/repo/pandas/core/ops/common.py:62(new_method)\r\n"]
[172.760514, "o", "        2    0.000    0.000    0.052    0.026 /workspace/repo/pandas/core/arraylike.py:219(__floordiv__)\r\n"]
[172.831143, "o", "        2    0.000    0.000    0.052    0.026 /workspace/repo/pandas/core/frame.py:7863(_arith_method)\r\n"]
[172.901771, "o", "        2    0.000    0.000    0.052    0.026 /workspace/repo/pandas/core/frame.py:7878(_dispatch_frame_op)\r\n"]
[172.9724, "o", "        2    0.000    0.000    0.052    0.026 /workspace/repo/pandas/core/ops/array_ops.py:239(arithmetic_op)\r\n"]
[173.043029, "o", "        2    0.000    0.000    0.052    0.026 /workspace/repo/pandas/core/ops/array_ops.py:188(_na_arithmetic_op)\r\n"]
[173.113657, "o", "        2    0.000    0.000    0.031    0.016 /workspace/repo/pandas/core/computation/expressions.py:227(evaluate)\r\n"]
[173.184286, "o", "        2    0.000    0.000    0.031    0.016 /workspace/repo/pandas/core/computation/expressions.py:68(_evaluate_standard)\r\n"]
[173.254914, "o", "        2    0.031    0.016    0.031    0.016 {built-in method _operator.floordiv}\r\n"]
[173.325543, "o", "        1    0.000    0.000    0.030    0.030 /workspace/repo/pandas/core/internals/managers.py:1624(operate_blockwise)\r\n"]
[173.396171, "o", "        1    0.000    0.000    0.030    0.030 /workspace/repo/pandas/core/internals/ops.py:57(operate_blockwise)\r\n"]
[173.4668, "o", "        5    0.000    0.000    0.022    0.004 /workspace/repo/pandas/core/internals/managers.py:392(apply)\r\n"]
[173.537429, "o", "        1    0.000    0.000    0.022    0.022 /workspace/repo/pandas/core/internals/blocks.py:343(apply)\r\n"]
[173.608057, "o", "        2    0.000    0.000    0.020    0.010 /workspace/repo/pandas/core/ops/missing.py:132(dispatch_fill_zeros)\r\n"]
[173.678686, "o", "        2    0.020    0.010    0.020    0.010 /workspace/repo/pandas/core/ops/missing.py:72(mask_zero_div_zero)\r\n"]
[173.749314, "o", "        2    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/frame.py:8253(_construct_result)\r\n"]
[173.819943, "o", "        4    0.000    0.000    0.000    0.000 /opt/conda/envs/asv_3.10/lib/python3.10/site-packages/numpy/_core/_methods.py:59(_any)\r\n"]
[173.890571, "o", "        3    0.000    0.000    0.000    0.000 {method 'any' of 'numpy.ndarray' objects}\r\n"]
[173.9612, "o", "        4    0.000    0.000    0.000    0.000 {method 'reduce' of 'numpy.ufunc' objects}\r\n"]
[174.031829, "o", "        2    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/frame.py:698(__init__)\r\n"]
[174.102457, "o", "        4    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/internals/managers.py:693(copy)\r\n"]
[174.173086, "o", "        2    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/frame.py:8020(_should_reindex_frame_op)\r\n"]
[174.243714, "o", "        2    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/internals/blocks.py:370(_split_op_result)\r\n"]
[174.314343, "o", "        2    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/internals/ops.py:29(_iter_block_pairs)\r\n"]
[174.384971, "o", "        4    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/internals/managers.py:716(<listcomp>)\r\n"]
[174.4556, "o", "       10    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/indexes/range.py:551(_view)\r\n"]
[174.526229, "o", "        2    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/internals/blocks.py:230(make_block)\r\n"]
[174.596857, "o", "        1    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/indexes/base.py:3189(intersection)\r\n"]
[174.667486, "o", "        8    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/indexes/base.py:1025(view)\r\n"]
[174.738114, "o", "        4    0.000    0.000    0.000    0.000 /workspace/repo/pandas/core/generic.py:6119(__setattr__)\r\n"]
[174.808743, "o", "\r\n"]
[174.879371, "o", "\r\n"]
[175.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[175.002, "i", "sed -n '1,200p' pandas/core/ops/common.py\r"]
[175.004, "o", "sed -n '1,200p' pandas/core/ops/common.py\r\n"]
[177.478, "o", "\u001b[?2004l\r\n"]
[180.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[180.002, "i", "sed -n '1,200p' pandas/core/ops/__init__.py\r"]
[180.004, "o", "sed -n '1,200p' pandas/core/ops/__init__.py\r\n"]
[182.478, "o", "\u001b[?2004l\r\n"]
[185.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[185.002, "i", "sed -n '1,240p' pandas/core/frame.py\r"]
[185.004, "o", "sed -n '1,240p' pandas/core/frame.py\r\n"]
[187.478, "o", "\u001b[?2004l\r\n"]
[190.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[190.002, "i", "cd ..\r"]
[190.004, "o", "cd ..\r\n"]
[190.006, "o", "\u001b[?2004l\r\n"]
[195.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[195.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py\r"]
[195.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py\r\n"]
[195.024943, "o", "\u001b[?2004l\r\n"]
[195.043885, "o", "\"\"\"\r\n"]
[195.062828, "o", "Expressions\r\n"]
[195.08177, "o", "-----------\r\n"]
[195.100713, "o", "\r\n"]
[195.119655, "o", "Offer fast expression evaluation through numexpr\r\n"]
[195.138598, "o", "\r\n"]
[195.15754, "o", "\"\"\"\r\n"]
[195.176483, "o", "\r\n"]
[195.195425, "o", "from __future__ import annotations\r\n"]
[195.214368, "o", "\r\n"]
[195.23331, "o", "import operator\r\n"]
[195.252253, "o", "from typing import TYPE_CHECKING\r\n"]
[195.271195, "o", "import warnings\r\n"]
[195.290138, "o", "\r\n"]
[195.30908, "o", "import numpy as np\r\n"]
[195.328023, "o", "\r\n"]
[195.346966, "o", "from pandas._config import get_option\r\n"]
[195.365908, "o", "\r\n"]
[195.384851, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[195.403793, "o", "\r\n"]
[195.422736, "o", "from pandas.core import roperator\r\n"]
[195.441678, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[195.460621, "o", "\r\n"]
[195.479563, "o", "if NUMEXPR_INSTALLED:\r\n"]
[195.498506, "o", "    import numexpr as ne\r\n"]
[195.517448, "o", "\r\n"]
[195.536391, "o", "if TYPE_CHECKING:\r\n"]
[195.555333, "o", "    from pandas._typing import FuncType\r\n"]
[195.574276, "o", "\r\n"]
[195.593218, "o", "_TEST_MODE: bool | None = None\r\n"]
[195.612161, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[195.631103, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[195.650046, "o", "_evaluate: FuncType | None = None\r\n"]
[195.668989, "o", "_where: FuncType | None = None\r\n"]
[195.687931, "o", "\r\n"]
[195.706874, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[195.725816, "o", "_ALLOWED_DTYPES = {\r\n"]
[195.744759, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[195.763701, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[195.782644, "o", "}\r\n"]
[195.801586, "o", "\r\n"]
[195.820529, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[195.839471, "o", "_MIN_ELEMENTS = 1_000_000\r\n"]
[195.858414, "o", "\r\n"]
[195.877356, "o", "\r\n"]
[195.896299, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[195.915241, "o", "    # set/unset to use numexpr\r\n"]
[195.934184, "o", "    global USE_NUMEXPR\r\n"]
[195.953126, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[195.972069, "o", "        USE_NUMEXPR = v\r\n"]
[195.991011, "o", "\r\n"]
[196.009954, "o", "    # choose what we are going to do\r\n"]
[196.028897, "o", "    global _evaluate, _where\r\n"]
[196.047839, "o", "\r\n"]
[196.066782, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[196.085724, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[196.104667, "o", "\r\n"]
[196.123609, "o", "\r\n"]
[196.142552, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[196.161494, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[196.180437, "o", "    # otherwise reset\r\n"]
[196.199379, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[196.218322, "o", "        if n is None:\r\n"]
[196.237264, "o", "            n = ne.detect_number_of_cores()\r\n"]
[196.256207, "o", "        ne.set_num_threads(n)\r\n"]
[196.275149, "o", "\r\n"]
[196.294092, "o", "\r\n"]
[196.313034, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[196.331977, "o", "    \"\"\"\r\n"]
[196.35092, "o", "    Standard evaluation.\r\n"]
[196.369862, "o", "    \"\"\"\r\n"]
[196.388805, "o", "    if _TEST_MODE:\r\n"]
[196.407747, "o", "        _store_test_result(False)\r\n"]
[196.42669, "o", "    return op(left_op, right_op)\r\n"]
[196.445632, "o", "\r\n"]
[196.464575, "o", "\r\n"]
[196.483517, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[196.50246, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[196.521402, "o", "    if op_str is not None:\r\n"]
[196.540345, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[196.559287, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[196.57823, "o", "            # check for dtype compatibility\r\n"]
[196.597172, "o", "            dtypes: set[str] = set()\r\n"]
[196.616115, "o", "            for o in [left_op, right_op]:\r\n"]
[196.635057, "o", "                # ndarray and Series Case\r\n"]
[196.654, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[196.672943, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[196.691885, "o", "\r\n"]
[196.710828, "o", "            # allowed are a superset\r\n"]
[196.72977, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[196.748713, "o", "                return True\r\n"]
[196.767655, "o", "\r\n"]
[196.786598, "o", "    return False\r\n"]
[196.80554, "o", "\r\n"]
[196.824483, "o", "\r\n"]
[196.843425, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[196.862368, "o", "    result = None\r\n"]
[196.88131, "o", "\r\n"]
[196.900253, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[196.919195, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[196.938138, "o", "        if is_reversed:\r\n"]
[196.95708, "o", "            # we were originally called by a reversed op method\r\n"]
[196.976023, "o", "            left_op, right_op = right_op, left_op\r\n"]
[196.994966, "o", "\r\n"]
[197.013908, "o", "        left_value = left_op\r\n"]
[197.032851, "o", "        right_value = right_op\r\n"]
[197.051793, "o", "\r\n"]
[197.070736, "o", "        try:\r\n"]
[197.089678, "o", "            result = ne.evaluate(\r\n"]
[197.108621, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[197.127563, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[197.146506, "o", "                casting=\"safe\",\r\n"]
[197.165448, "o", "            )\r\n"]
[197.184391, "o", "        except TypeError:\r\n"]
[197.203333, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[197.222276, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[197.241218, "o", "            pass\r\n"]
[197.260161, "o", "        except NotImplementedError:\r\n"]
[197.279103, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[197.298046, "o", "                pass\r\n"]
[197.316989, "o", "            else:\r\n"]
[197.335931, "o", "                raise\r\n"]
[197.354874, "o", "\r\n"]
[197.373816, "o", "        if is_reversed:\r\n"]
[197.392759, "o", "            # reverse order to original for fallback\r\n"]
[197.411701, "o", "            left_op, right_op = right_op, left_op\r\n"]
[197.430644, "o", "\r\n"]
[197.449586, "o", "    if _TEST_MODE:\r\n"]
[197.468529, "o", "        _store_test_result(result is not None)\r\n"]
[197.487471, "o", "\r\n"]
[197.506414, "o", "    if result is None:\r\n"]
[197.525356, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[197.544299, "o", "\r\n"]
[197.563241, "o", "    return result\r\n"]
[197.582184, "o", "\r\n"]
[197.601126, "o", "\r\n"]
[197.620069, "o", "_op_str_mapping = {\r\n"]
[197.639011, "o", "    operator.add: \"+\",\r\n"]
[197.657954, "o", "    roperator.radd: \"+\",\r\n"]
[197.676897, "o", "    operator.mul: \"*\",\r\n"]
[197.695839, "o", "    roperator.rmul: \"*\",\r\n"]
[197.714782, "o", "    operator.sub: \"-\",\r\n"]
[197.733724, "o", "    roperator.rsub: \"-\",\r\n"]
[197.752667, "o", "    operator.truediv: \"/\",\r\n"]
[197.771609, "o", "    roperator.rtruediv: \"/\",\r\n"]
[197.790552, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[197.809494, "o", "    operator.floordiv: None,\r\n"]
[197.828437, "o", "    roperator.rfloordiv: None,\r\n"]
[197.847379, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[197.866322, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[197.885264, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[197.904207, "o", "    operator.mod: None,\r\n"]
[197.923149, "o", "    roperator.rmod: None,\r\n"]
[197.942092, "o", "    operator.pow: \"**\",\r\n"]
[197.961034, "o", "    roperator.rpow: \"**\",\r\n"]
[197.979977, "o", "    operator.eq: \"==\",\r\n"]
[197.99892, "o", "    operator.ne: \"!=\",\r\n"]
[198.017862, "o", "    operator.le: \"<=\",\r\n"]
[198.036805, "o", "    operator.lt: \"<\",\r\n"]
[198.055747, "o", "    operator.ge: \">=\",\r\n"]
[198.07469, "o", "    operator.gt: \">\",\r\n"]
[198.093632, "o", "    operator.and_: \"&\",\r\n"]
[198.112575, "o", "    roperator.rand_: \"&\",\r\n"]
[198.131517, "o", "    operator.or_: \"|\",\r\n"]
[198.15046, "o", "    roperator.ror_: \"|\",\r\n"]
[198.169402, "o", "    operator.xor: \"^\",\r\n"]
[198.188345, "o", "    roperator.rxor: \"^\",\r\n"]
[198.207287, "o", "    divmod: None,\r\n"]
[198.22623, "o", "    roperator.rdivmod: None,\r\n"]
[198.245172, "o", "}\r\n"]
[198.264115, "o", "\r\n"]
[198.283057, "o", "\r\n"]
[198.302, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[198.320943, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[198.339885, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[198.358828, "o", "\r\n"]
[198.37777, "o", "\r\n"]
[198.396713, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[198.415655, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[198.434598, "o", "    result = None\r\n"]
[198.45354, "o", "\r\n"]
[198.472483, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[198.491425, "o", "        result = ne.evaluate(\r\n"]
[198.510368, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[198.52931, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[198.548253, "o", "            casting=\"safe\",\r\n"]
[198.567195, "o", "        )\r\n"]
[198.586138, "o", "\r\n"]
[198.60508, "o", "    if result is None:\r\n"]
[198.624023, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[198.642966, "o", "\r\n"]
[198.661908, "o", "    return result\r\n"]
[198.680851, "o", "\r\n"]
[198.699793, "o", "\r\n"]
[198.718736, "o", "# turn myself on\r\n"]
[198.737678, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[198.756621, "o", "\r\n"]
[198.775563, "o", "\r\n"]
[198.794506, "o", "def _has_bool_dtype(x):\r\n"]
[198.813448, "o", "    try:\r\n"]
[198.832391, "o", "        return x.dtype == bool\r\n"]
[198.851333, "o", "    except AttributeError:\r\n"]
[198.870276, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[198.889218, "o", "\r\n"]
[198.908161, "o", "\r\n"]
[198.927103, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[198.946046, "o", "\r\n"]
[198.964989, "o", "\r\n"]
[198.983931, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[199.002874, "o", "    \"\"\"\r\n"]
[199.021816, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[199.040759, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[199.059701, "o", "    boolean ops.\r\n"]
[199.078644, "o", "    \"\"\"\r\n"]
[199.097586, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[199.116529, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[199.135471, "o", "            warnings.warn(\r\n"]
[199.154414, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[199.173356, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[199.192299, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[199.211241, "o", "                stacklevel=find_stack_level(),\r\n"]
[199.230184, "o", "            )\r\n"]
[199.249126, "o", "            return True\r\n"]
[199.268069, "o", "    return False\r\n"]
[199.287011, "o", "\r\n"]
[199.305954, "o", "\r\n"]
[199.324897, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[199.343839, "o", "    \"\"\"\r\n"]
[199.362782, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[199.381724, "o", "\r\n"]
[199.400667, "o", "    Parameters\r\n"]
[199.419609, "o", "    ----------\r\n"]
[199.438552, "o", "    op : the actual operand\r\n"]
[199.457494, "o", "    left_op : left operand\r\n"]
[199.476437, "o", "    right_op : right operand\r\n"]
[199.495379, "o", "    use_numexpr : bool, default True\r\n"]
[199.514322, "o", "        Whether to try to use numexpr.\r\n"]
[199.533264, "o", "    \"\"\"\r\n"]
[199.552207, "o", "    op_str = _op_str_mapping[op]\r\n"]
[199.571149, "o", "    if op_str is not None:\r\n"]
[199.590092, "o", "        if use_numexpr:\r\n"]
[199.609034, "o", "            # error: \"None\" not callable\r\n"]
[199.627977, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[199.64692, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[199.665862, "o", "\r\n"]
[199.684805, "o", "\r\n"]
[199.703747, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[199.72269, "o", "    \"\"\"\r\n"]
[199.741632, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[199.760575, "o", "\r\n"]
[199.779517, "o", "    Parameters\r\n"]
[199.79846, "o", "    ----------\r\n"]
[199.817402, "o", "    cond : np.ndarray[bool]\r\n"]
[199.836345, "o", "    left_op : return if cond is True\r\n"]
[199.855287, "o", "    right_op : return if cond is False\r\n"]
[199.87423, "o", "    use_numexpr : bool, default True\r\n"]
[199.893172, "o", "        Whether to try to use numexpr.\r\n"]
[199.912115, "o", "    \"\"\"\r\n"]
[199.931057, "o", "    assert _where is not None\r\n"]
[200.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[200.002, "i", "sed -n '1,220p' pandas/core/ops/missing.py\r"]
[200.004, "o", "sed -n '1,220p' pandas/core/ops/missing.py\r\n"]
[200.033775, "o", "\u001b[?2004l\r\n"]
[200.061551, "o", "\"\"\"\r\n"]
[200.089326, "o", "Missing data handling for arithmetic operations.\r\n"]
[200.117101, "o", "\r\n"]
[200.144876, "o", "In particular, pandas conventions regarding division by zero differ\r\n"]
[200.172652, "o", "from numpy in the following ways:\r\n"]
[200.200427, "o", "    1) np.array([-1, 0, 1], dtype=dtype1) // np.array([0, 0, 0], dtype=dtype2)\r\n"]
[200.228202, "o", "       gives [nan, nan, nan] for most dtype combinations, and [0, 0, 0] for\r\n"]
[200.255978, "o", "       the remaining pairs\r\n"]
[200.283753, "o", "       (the remaining being dtype1==dtype2==intN and dtype==dtype2==uintN).\r\n"]
[200.311528, "o", "\r\n"]
[200.339303, "o", "       pandas convention is to return [-inf, nan, inf] for all dtype\r\n"]
[200.367079, "o", "       combinations.\r\n"]
[200.394854, "o", "\r\n"]
[200.422629, "o", "       Note: the numpy behavior described here is py3-specific.\r\n"]
[200.450404, "o", "\r\n"]
[200.47818, "o", "    2) np.array([-1, 0, 1], dtype=dtype1) % np.array([0, 0, 0], dtype=dtype2)\r\n"]
[200.505955, "o", "       gives precisely the same results as the // operation.\r\n"]
[200.53373, "o", "\r\n"]
[200.561506, "o", "       pandas convention is to return [nan, nan, nan] for all dtype\r\n"]
[200.589281, "o", "       combinations.\r\n"]
[200.617056, "o", "\r\n"]
[200.644831, "o", "    3) divmod behavior consistent with 1) and 2).\r\n"]
[200.672607, "o", "\"\"\"\r\n"]
[200.700382, "o", "\r\n"]
[200.728157, "o", "from __future__ import annotations\r\n"]
[200.755933, "o", "\r\n"]
[200.783708, "o", "import operator\r\n"]
[200.811483, "o", "\r\n"]
[200.839258, "o", "import numpy as np\r\n"]
[200.867034, "o", "\r\n"]
[200.894809, "o", "from pandas.core import roperator\r\n"]
[200.922584, "o", "\r\n"]
[200.95036, "o", "\r\n"]
[200.978135, "o", "def _fill_zeros(result: np.ndarray, x, y) -> np.ndarray:\r\n"]
[201.00591, "o", "    \"\"\"\r\n"]
[201.033685, "o", "    If this is a reversed op, then flip x,y\r\n"]
[201.061461, "o", "\r\n"]
[201.089236, "o", "    If we have an integer value (or array in y)\r\n"]
[201.117011, "o", "    and we have 0's, fill them with np.nan,\r\n"]
[201.144787, "o", "    return the result.\r\n"]
[201.172562, "o", "\r\n"]
[201.200337, "o", "    Mask the nan's from x.\r\n"]
[201.228112, "o", "    \"\"\"\r\n"]
[201.255888, "o", "    if result.dtype.kind == \"f\":\r\n"]
[201.283663, "o", "        return result\r\n"]
[201.311438, "o", "\r\n"]
[201.339213, "o", "    is_variable_type = hasattr(y, \"dtype\")\r\n"]
[201.366989, "o", "    is_scalar_type = not isinstance(y, np.ndarray)\r\n"]
[201.394764, "o", "\r\n"]
[201.422539, "o", "    if not is_variable_type and not is_scalar_type:\r\n"]
[201.450315, "o", "        # e.g. test_series_ops_name_retention with mod we get here with list/tuple\r\n"]
[201.47809, "o", "        return result\r\n"]
[201.505865, "o", "\r\n"]
[201.53364, "o", "    if is_scalar_type:\r\n"]
[201.561416, "o", "        y = np.array(y)\r\n"]
[201.589191, "o", "\r\n"]
[201.616966, "o", "    if y.dtype.kind in \"iu\":\r\n"]
[201.644742, "o", "        ymask = y == 0\r\n"]
[201.672517, "o", "        if ymask.any():\r\n"]
[201.700292, "o", "            # GH#7325, mask and nans must be broadcastable\r\n"]
[201.728067, "o", "            mask = ymask & ~np.isnan(result)\r\n"]
[201.755843, "o", "\r\n"]
[201.783618, "o", "            # GH#9308 doing ravel on result and mask can improve putmask perf,\r\n"]
[201.811393, "o", "            #  but can also make unwanted copies.\r\n"]
[201.839169, "o", "            result = result.astype(\"float64\", copy=False)\r\n"]
[201.866944, "o", "\r\n"]
[201.894719, "o", "            np.putmask(result, mask, np.nan)\r\n"]
[201.922494, "o", "\r\n"]
[201.95027, "o", "    return result\r\n"]
[201.978045, "o", "\r\n"]
[202.00582, "o", "\r\n"]
[202.033596, "o", "def mask_zero_div_zero(x, y, result: np.ndarray) -> np.ndarray:\r\n"]
[202.061371, "o", "    \"\"\"\r\n"]
[202.089146, "o", "    Set results of  0 // 0 to np.nan, regardless of the dtypes\r\n"]
[202.116921, "o", "    of the numerator or the denominator.\r\n"]
[202.144697, "o", "\r\n"]
[202.172472, "o", "    Parameters\r\n"]
[202.200247, "o", "    ----------\r\n"]
[202.228022, "o", "    x : ndarray\r\n"]
[202.255798, "o", "    y : ndarray\r\n"]
[202.283573, "o", "    result : ndarray\r\n"]
[202.311348, "o", "\r\n"]
[202.339124, "o", "    Returns\r\n"]
[202.366899, "o", "    -------\r\n"]
[202.394674, "o", "    ndarray\r\n"]
[202.422449, "o", "        The filled result.\r\n"]
[202.450225, "o", "\r\n"]
[202.478, "o", "    Examples\r\n"]
[202.505775, "o", "    --------\r\n"]
[202.533551, "o", "    >>> x = np.array([1, 0, -1], dtype=np.int64)\r\n"]
[202.561326, "o", "    >>> x\r\n"]
[202.589101, "o", "    array([ 1,  0, -1])\r\n"]
[202.616876, "o", "    >>> y = 0  # int 0; numpy behavior is different with float\r\n"]
[202.644652, "o", "    >>> result = x // y\r\n"]
[202.672427, "o", "    >>> result  # raw numpy result does not fill division by zero\r\n"]
[202.700202, "o", "    array([0, 0, 0])\r\n"]
[202.727978, "o", "    >>> mask_zero_div_zero(x, y, result)\r\n"]
[202.755753, "o", "    array([ inf,  nan, -inf])\r\n"]
[202.783528, "o", "    \"\"\"\r\n"]
[202.811303, "o", "\r\n"]
[202.839079, "o", "    if not hasattr(y, \"dtype\"):\r\n"]
[202.866854, "o", "        # e.g. scalar, tuple\r\n"]
[202.894629, "o", "        y = np.array(y)\r\n"]
[202.922404, "o", "    if not hasattr(x, \"dtype\"):\r\n"]
[202.95018, "o", "        # e.g scalar, tuple\r\n"]
[202.977955, "o", "        x = np.array(x)\r\n"]
[203.00573, "o", "\r\n"]
[203.033506, "o", "    zmask = y == 0\r\n"]
[203.061281, "o", "\r\n"]
[203.089056, "o", "    if zmask.any():\r\n"]
[203.116831, "o", "        # Flip sign if necessary for -0.0\r\n"]
[203.144607, "o", "        zneg_mask = zmask & np.signbit(y)\r\n"]
[203.172382, "o", "        zpos_mask = zmask & ~zneg_mask\r\n"]
[203.200157, "o", "\r\n"]
[203.227933, "o", "        x_lt0 = x < 0\r\n"]
[203.255708, "o", "        x_gt0 = x > 0\r\n"]
[203.283483, "o", "        nan_mask = zmask & (x == 0)\r\n"]
[203.311258, "o", "        neginf_mask = (zpos_mask & x_lt0) | (zneg_mask & x_gt0)\r\n"]
[203.339034, "o", "        posinf_mask = (zpos_mask & x_gt0) | (zneg_mask & x_lt0)\r\n"]
[203.366809, "o", "\r\n"]
[203.394584, "o", "        if nan_mask.any() or neginf_mask.any() or posinf_mask.any():\r\n"]
[203.42236, "o", "            # Fill negative/0 with -inf, positive/0 with +inf, 0/0 with NaN\r\n"]
[203.450135, "o", "            result = result.astype(\"float64\", copy=False)\r\n"]
[203.47791, "o", "\r\n"]
[203.505685, "o", "            result[nan_mask] = np.nan\r\n"]
[203.533461, "o", "            result[posinf_mask] = np.inf\r\n"]
[203.561236, "o", "            result[neginf_mask] = -np.inf\r\n"]
[203.589011, "o", "\r\n"]
[203.616787, "o", "    return result\r\n"]
[203.644562, "o", "\r\n"]
[203.672337, "o", "\r\n"]
[203.700112, "o", "def dispatch_fill_zeros(op, left, right, result):\r\n"]
[203.727888, "o", "    \"\"\"\r\n"]
[203.755663, "o", "    Call _fill_zeros with the appropriate fill value depending on the operation,\r\n"]
[203.783438, "o", "    with special logic for divmod and rdivmod.\r\n"]
[203.811213, "o", "\r\n"]
[203.838989, "o", "    Parameters\r\n"]
[203.866764, "o", "    ----------\r\n"]
[203.894539, "o", "    op : function (operator.add, operator.div, ...)\r\n"]
[203.922315, "o", "    left : object (np.ndarray for non-reversed ops)\r\n"]
[203.95009, "o", "        We have excluded ExtensionArrays here\r\n"]
[203.977865, "o", "    right : object (np.ndarray for reversed ops)\r\n"]
[204.00564, "o", "        We have excluded ExtensionArrays here\r\n"]
[204.033416, "o", "    result : ndarray\r\n"]
[204.061191, "o", "\r\n"]
[204.088966, "o", "    Returns\r\n"]
[204.116742, "o", "    -------\r\n"]
[204.144517, "o", "    result : np.ndarray\r\n"]
[204.172292, "o", "\r\n"]
[204.200067, "o", "    Notes\r\n"]
[204.227843, "o", "    -----\r\n"]
[204.255618, "o", "    For divmod and rdivmod, the `result` parameter and returned `result`\r\n"]
[204.283393, "o", "    is a 2-tuple of ndarray objects.\r\n"]
[204.311169, "o", "    \"\"\"\r\n"]
[204.338944, "o", "    if op is divmod:\r\n"]
[204.366719, "o", "        result = (\r\n"]
[204.394494, "o", "            mask_zero_div_zero(left, right, result[0]),\r\n"]
[204.42227, "o", "            _fill_zeros(result[1], left, right),\r\n"]
[204.450045, "o", "        )\r\n"]
[204.47782, "o", "    elif op is roperator.rdivmod:\r\n"]
[204.505596, "o", "        result = (\r\n"]
[204.533371, "o", "            mask_zero_div_zero(right, left, result[0]),\r\n"]
[204.561146, "o", "            _fill_zeros(result[1], right, left),\r\n"]
[204.588921, "o", "        )\r\n"]
[204.616697, "o", "    elif op is operator.floordiv:\r\n"]
[204.644472, "o", "        # Note: no need to do this for truediv; in py3 numpy behaves the way\r\n"]
[204.672247, "o", "        #  we want.\r\n"]
[204.700022, "o", "        result = mask_zero_div_zero(left, right, result)\r\n"]
[204.727798, "o", "    elif op is roperator.rfloordiv:\r\n"]
[204.755573, "o", "        # Note: no need to do this for rtruediv; in py3 numpy behaves the way\r\n"]
[204.783348, "o", "        #  we want.\r\n"]
[204.811124, "o", "        result = mask_zero_div_zero(right, left, result)\r\n"]
[204.838899, "o", "    elif op is operator.mod:\r\n"]
[204.866674, "o", "        result = _fill_zeros(result, left, right)\r\n"]
[204.894449, "o", "    elif op is roperator.rmod:\r\n"]
[204.922225, "o", "        result = _fill_zeros(result, right, left)\r\n"]
[205.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[205.002, "i", "sed -n '1,260p' pandas/core/ops/array_ops.py\r"]
[205.004, "o", "sed -n '1,260p' pandas/core/ops/array_ops.py\r\n"]
[205.024943, "o", "\u001b[?2004l\r\n"]
[205.043885, "o", "\"\"\"\r\n"]
[205.062828, "o", "Functions for arithmetic and comparison operations on NumPy arrays and\r\n"]
[205.08177, "o", "ExtensionArrays.\r\n"]
[205.100713, "o", "\"\"\"\r\n"]
[205.119655, "o", "\r\n"]
[205.138598, "o", "from __future__ import annotations\r\n"]
[205.15754, "o", "\r\n"]
[205.176483, "o", "import datetime\r\n"]
[205.195425, "o", "from functools import partial\r\n"]
[205.214368, "o", "import operator\r\n"]
[205.23331, "o", "from typing import (\r\n"]
[205.252253, "o", "    TYPE_CHECKING,\r\n"]
[205.271195, "o", "    Any,\r\n"]
[205.290138, "o", ")\r\n"]
[205.30908, "o", "\r\n"]
[205.328023, "o", "import numpy as np\r\n"]
[205.346966, "o", "\r\n"]
[205.365908, "o", "from pandas._libs import (\r\n"]
[205.384851, "o", "    NaT,\r\n"]
[205.403793, "o", "    Timedelta,\r\n"]
[205.422736, "o", "    Timestamp,\r\n"]
[205.441678, "o", "    lib,\r\n"]
[205.460621, "o", "    ops as libops,\r\n"]
[205.479563, "o", ")\r\n"]
[205.498506, "o", "from pandas._libs.tslibs import (\r\n"]
[205.517448, "o", "    BaseOffset,\r\n"]
[205.536391, "o", "    get_supported_dtype,\r\n"]
[205.555333, "o", "    is_supported_dtype,\r\n"]
[205.574276, "o", "    is_unitless,\r\n"]
[205.593218, "o", ")\r\n"]
[205.612161, "o", "\r\n"]
[205.631103, "o", "from pandas.core.dtypes.cast import (\r\n"]
[205.650046, "o", "    construct_1d_object_array_from_listlike,\r\n"]
[205.668989, "o", "    find_common_type,\r\n"]
[205.687931, "o", ")\r\n"]
[205.706874, "o", "from pandas.core.dtypes.common import (\r\n"]
[205.725816, "o", "    ensure_object,\r\n"]
[205.744759, "o", "    is_bool_dtype,\r\n"]
[205.763701, "o", "    is_list_like,\r\n"]
[205.782644, "o", "    is_numeric_v_string_like,\r\n"]
[205.801586, "o", "    is_object_dtype,\r\n"]
[205.820529, "o", "    is_scalar,\r\n"]
[205.839471, "o", ")\r\n"]
[205.858414, "o", "from pandas.core.dtypes.generic import (\r\n"]
[205.877356, "o", "    ABCExtensionArray,\r\n"]
[205.896299, "o", "    ABCIndex,\r\n"]
[205.915241, "o", "    ABCSeries,\r\n"]
[205.934184, "o", ")\r\n"]
[205.953126, "o", "from pandas.core.dtypes.missing import (\r\n"]
[205.972069, "o", "    isna,\r\n"]
[205.991011, "o", "    notna,\r\n"]
[206.009954, "o", ")\r\n"]
[206.028897, "o", "\r\n"]
[206.047839, "o", "from pandas.core import roperator\r\n"]
[206.066782, "o", "from pandas.core.computation import expressions\r\n"]
[206.085724, "o", "from pandas.core.construction import ensure_wrapped_if_datetimelike\r\n"]
[206.104667, "o", "from pandas.core.ops import missing\r\n"]
[206.123609, "o", "from pandas.core.ops.dispatch import should_extension_dispatch\r\n"]
[206.142552, "o", "from pandas.core.ops.invalid import invalid_comparison\r\n"]
[206.161494, "o", "\r\n"]
[206.180437, "o", "if TYPE_CHECKING:\r\n"]
[206.199379, "o", "    from pandas._typing import (\r\n"]
[206.218322, "o", "        ArrayLike,\r\n"]
[206.237264, "o", "        Shape,\r\n"]
[206.256207, "o", "    )\r\n"]
[206.275149, "o", "\r\n"]
[206.294092, "o", "# -----------------------------------------------------------------------------\r\n"]
[206.313034, "o", "# Masking NA values and fallbacks for operations numpy does not support\r\n"]
[206.331977, "o", "\r\n"]
[206.35092, "o", "\r\n"]
[206.369862, "o", "def fill_binop(left, right, fill_value):\r\n"]
[206.388805, "o", "    \"\"\"\r\n"]
[206.407747, "o", "    If a non-None fill_value is given, replace null entries in left and right\r\n"]
[206.42669, "o", "    with this value, but only in positions where _one_ of left/right is null,\r\n"]
[206.445632, "o", "    not both.\r\n"]
[206.464575, "o", "\r\n"]
[206.483517, "o", "    Parameters\r\n"]
[206.50246, "o", "    ----------\r\n"]
[206.521402, "o", "    left : array-like\r\n"]
[206.540345, "o", "    right : array-like\r\n"]
[206.559287, "o", "    fill_value : object\r\n"]
[206.57823, "o", "\r\n"]
[206.597172, "o", "    Returns\r\n"]
[206.616115, "o", "    -------\r\n"]
[206.635057, "o", "    left : array-like\r\n"]
[206.654, "o", "    right : array-like\r\n"]
[206.672943, "o", "\r\n"]
[206.691885, "o", "    Notes\r\n"]
[206.710828, "o", "    -----\r\n"]
[206.72977, "o", "    Makes copies if fill_value is not None and NAs are present.\r\n"]
[206.748713, "o", "    \"\"\"\r\n"]
[206.767655, "o", "    if fill_value is not None:\r\n"]
[206.786598, "o", "        left_mask = isna(left)\r\n"]
[206.80554, "o", "        right_mask = isna(right)\r\n"]
[206.824483, "o", "\r\n"]
[206.843425, "o", "        # one but not both\r\n"]
[206.862368, "o", "        mask = left_mask ^ right_mask\r\n"]
[206.88131, "o", "\r\n"]
[206.900253, "o", "        if left_mask.any():\r\n"]
[206.919195, "o", "            # Avoid making a copy if we can\r\n"]
[206.938138, "o", "            left = left.copy()\r\n"]
[206.95708, "o", "            left[left_mask & mask] = fill_value\r\n"]
[206.976023, "o", "\r\n"]
[206.994966, "o", "        if right_mask.any():\r\n"]
[207.013908, "o", "            # Avoid making a copy if we can\r\n"]
[207.032851, "o", "            right = right.copy()\r\n"]
[207.051793, "o", "            right[right_mask & mask] = fill_value\r\n"]
[207.070736, "o", "\r\n"]
[207.089678, "o", "    return left, right\r\n"]
[207.108621, "o", "\r\n"]
[207.127563, "o", "\r\n"]
[207.146506, "o", "def comp_method_OBJECT_ARRAY(op, x, y):\r\n"]
[207.165448, "o", "    if isinstance(y, list):\r\n"]
[207.184391, "o", "        # e.g. test_tuple_categories\r\n"]
[207.203333, "o", "        y = construct_1d_object_array_from_listlike(y)\r\n"]
[207.222276, "o", "\r\n"]
[207.241218, "o", "    if isinstance(y, (np.ndarray, ABCSeries, ABCIndex)):\r\n"]
[207.260161, "o", "        if not is_object_dtype(y.dtype):\r\n"]
[207.279103, "o", "            y = y.astype(np.object_)\r\n"]
[207.298046, "o", "\r\n"]
[207.316989, "o", "        if isinstance(y, (ABCSeries, ABCIndex)):\r\n"]
[207.335931, "o", "            y = y._values\r\n"]
[207.354874, "o", "\r\n"]
[207.373816, "o", "        if x.shape != y.shape:\r\n"]
[207.392759, "o", "            raise ValueError(\"Shapes must match\", x.shape, y.shape)\r\n"]
[207.411701, "o", "        result = libops.vec_compare(x.ravel(), y.ravel(), op)\r\n"]
[207.430644, "o", "    else:\r\n"]
[207.449586, "o", "        result = libops.scalar_compare(x.ravel(), y, op)\r\n"]
[207.468529, "o", "    return result.reshape(x.shape)\r\n"]
[207.487471, "o", "\r\n"]
[207.506414, "o", "\r\n"]
[207.525356, "o", "def _masked_arith_op(x: np.ndarray, y, op) -> np.ndarray:\r\n"]
[207.544299, "o", "    \"\"\"\r\n"]
[207.563241, "o", "    If the given arithmetic operation fails, attempt it again on\r\n"]
[207.582184, "o", "    only the non-null elements of the input array(s).\r\n"]
[207.601126, "o", "\r\n"]
[207.620069, "o", "    Parameters\r\n"]
[207.639011, "o", "    ----------\r\n"]
[207.657954, "o", "    x : np.ndarray\r\n"]
[207.676897, "o", "    y : np.ndarray, Series, Index\r\n"]
[207.695839, "o", "    op : binary operator\r\n"]
[207.714782, "o", "    \"\"\"\r\n"]
[207.733724, "o", "    # For Series `x` is 1D so ravel() is a no-op; calling it anyway makes\r\n"]
[207.752667, "o", "    # the logic valid for both Series and DataFrame ops.\r\n"]
[207.771609, "o", "    xrav = x.ravel()\r\n"]
[207.790552, "o", "\r\n"]
[207.809494, "o", "    if isinstance(y, np.ndarray):\r\n"]
[207.828437, "o", "        dtype = find_common_type([x.dtype, y.dtype])\r\n"]
[207.847379, "o", "        result = np.empty(x.size, dtype=dtype)\r\n"]
[207.866322, "o", "\r\n"]
[207.885264, "o", "        if len(x) != len(y):\r\n"]
[207.904207, "o", "            raise ValueError(x.shape, y.shape)\r\n"]
[207.923149, "o", "        ymask = notna(y)\r\n"]
[207.942092, "o", "\r\n"]
[207.961034, "o", "        # NB: ravel() is only safe since y is ndarray; for e.g. PeriodIndex\r\n"]
[207.979977, "o", "        #  we would get int64 dtype, see GH#19956\r\n"]
[207.99892, "o", "        yrav = y.ravel()\r\n"]
[208.017862, "o", "        mask = notna(xrav) & ymask.ravel()\r\n"]
[208.036805, "o", "\r\n"]
[208.055747, "o", "        # See GH#5284, GH#5035, GH#19448 for historical reference\r\n"]
[208.07469, "o", "        if mask.any():\r\n"]
[208.093632, "o", "            result[mask] = op(xrav[mask], yrav[mask])\r\n"]
[208.112575, "o", "\r\n"]
[208.131517, "o", "    else:\r\n"]
[208.15046, "o", "        if not is_scalar(y):\r\n"]
[208.169402, "o", "            raise TypeError(\r\n"]
[208.188345, "o", "                f\"Cannot broadcast np.ndarray with operand of type {type(y)}\"\r\n"]
[208.207287, "o", "            )\r\n"]
[208.22623, "o", "\r\n"]
[208.245172, "o", "        # mask is only meaningful for x\r\n"]
[208.264115, "o", "        result = np.empty(x.size, dtype=x.dtype)\r\n"]
[208.283057, "o", "        mask = notna(xrav)\r\n"]
[208.302, "o", "\r\n"]
[208.320943, "o", "        # 1 ** np.nan is 1. So we have to unmask those.\r\n"]
[208.339885, "o", "        if op is pow:\r\n"]
[208.358828, "o", "            mask = np.where(x == 1, False, mask)\r\n"]
[208.37777, "o", "        elif op is roperator.rpow:\r\n"]
[208.396713, "o", "            mask = np.where(y == 1, False, mask)\r\n"]
[208.415655, "o", "\r\n"]
[208.434598, "o", "        if mask.any():\r\n"]
[208.45354, "o", "            result[mask] = op(xrav[mask], y)\r\n"]
[208.472483, "o", "\r\n"]
[208.491425, "o", "    np.putmask(result, ~mask, np.nan)\r\n"]
[208.510368, "o", "    result = result.reshape(x.shape)  # 2D compat\r\n"]
[208.52931, "o", "    return result\r\n"]
[208.548253, "o", "\r\n"]
[208.567195, "o", "\r\n"]
[208.586138, "o", "def _na_arithmetic_op(left: np.ndarray, right, op, is_cmp: bool = False):\r\n"]
[208.60508, "o", "    \"\"\"\r\n"]
[208.624023, "o", "    Return the result of evaluating op on the passed in values.\r\n"]
[208.642966, "o", "\r\n"]
[208.661908, "o", "    If native types are not compatible, try coercion to object dtype.\r\n"]
[208.680851, "o", "\r\n"]
[208.699793, "o", "    Parameters\r\n"]
[208.718736, "o", "    ----------\r\n"]
[208.737678, "o", "    left : np.ndarray\r\n"]
[208.756621, "o", "    right : np.ndarray or scalar\r\n"]
[208.775563, "o", "        Excludes DataFrame, Series, Index, ExtensionArray.\r\n"]
[208.794506, "o", "    is_cmp : bool, default False\r\n"]
[208.813448, "o", "        If this a comparison operation.\r\n"]
[208.832391, "o", "\r\n"]
[208.851333, "o", "    Returns\r\n"]
[208.870276, "o", "    -------\r\n"]
[208.889218, "o", "    array-like\r\n"]
[208.908161, "o", "\r\n"]
[208.927103, "o", "    Raises\r\n"]
[208.946046, "o", "    ------\r\n"]
[208.964989, "o", "    TypeError : invalid operation\r\n"]
[208.983931, "o", "    \"\"\"\r\n"]
[209.002874, "o", "    if isinstance(right, str):\r\n"]
[209.021816, "o", "        # can never use numexpr\r\n"]
[209.040759, "o", "        func = op\r\n"]
[209.059701, "o", "    else:\r\n"]
[209.078644, "o", "        func = partial(expressions.evaluate, op)\r\n"]
[209.097586, "o", "\r\n"]
[209.116529, "o", "    try:\r\n"]
[209.135471, "o", "        result = func(left, right)\r\n"]
[209.154414, "o", "    except TypeError:\r\n"]
[209.173356, "o", "        if not is_cmp and (\r\n"]
[209.192299, "o", "            left.dtype == object or getattr(right, \"dtype\", None) == object\r\n"]
[209.211241, "o", "        ):\r\n"]
[209.230184, "o", "            # For object dtype, fallback to a masked operation (only operating\r\n"]
[209.249126, "o", "            #  on the non-missing values)\r\n"]
[209.268069, "o", "            # Don't do this for comparisons, as that will handle complex numbers\r\n"]
[209.287011, "o", "            #  incorrectly, see GH#32047\r\n"]
[209.305954, "o", "            result = _masked_arith_op(left, right, op)\r\n"]
[209.324897, "o", "        else:\r\n"]
[209.343839, "o", "            raise\r\n"]
[209.362782, "o", "\r\n"]
[209.381724, "o", "    if is_cmp and (is_scalar(result) or result is NotImplemented):\r\n"]
[209.400667, "o", "        # numpy returned a scalar instead of operating element-wise\r\n"]
[209.419609, "o", "        # e.g. numeric array vs str\r\n"]
[209.438552, "o", "        # TODO: can remove this after dropping some future numpy version?\r\n"]
[209.457494, "o", "        return invalid_comparison(left, right, op)\r\n"]
[209.476437, "o", "\r\n"]
[209.495379, "o", "    return missing.dispatch_fill_zeros(op, left, right, result)\r\n"]
[209.514322, "o", "\r\n"]
[209.533264, "o", "\r\n"]
[209.552207, "o", "def arithmetic_op(left: ArrayLike, right: Any, op):\r\n"]
[209.571149, "o", "    \"\"\"\r\n"]
[209.590092, "o", "    Evaluate an arithmetic operation `+`, `-`, `*`, `/`, `//`, `%`, `**`, ...\r\n"]
[209.609034, "o", "\r\n"]
[209.627977, "o", "    Note: the caller is responsible for ensuring that numpy warnings are\r\n"]
[209.64692, "o", "    suppressed (with np.errstate(all=\"ignore\")) if needed.\r\n"]
[209.665862, "o", "\r\n"]
[209.684805, "o", "    Parameters\r\n"]
[209.703747, "o", "    ----------\r\n"]
[209.72269, "o", "    left : np.ndarray or ExtensionArray\r\n"]
[209.741632, "o", "    right : object\r\n"]
[209.760575, "o", "        Cannot be a DataFrame or Index.  Series is *not* excluded.\r\n"]
[209.779517, "o", "    op : {operator.add, operator.sub, ...}\r\n"]
[209.79846, "o", "        Or one of the reversed variants from roperator.\r\n"]
[209.817402, "o", "\r\n"]
[209.836345, "o", "    Returns\r\n"]
[209.855287, "o", "    -------\r\n"]
[209.87423, "o", "    ndarray or ExtensionArray\r\n"]
[209.893172, "o", "        Or a 2-tuple of these in the case of divmod or rdivmod.\r\n"]
[209.912115, "o", "    \"\"\"\r\n"]
[209.931057, "o", "    # NB: We assume that extract_array and ensure_wrapped_if_datetimelike\r\n"]
[210.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[210.002, "i", "sed -n '1,160p' pandas/core/ops/common.py\r"]
[210.004, "o", "sed -n '1,160p' pandas/core/ops/common.py\r\n"]
[210.039181, "o", "\u001b[?2004l\r\n"]
[210.072362, "o", "\"\"\"\r\n"]
[210.105544, "o", "Boilerplate functions used in defining binary operations.\r\n"]
[210.138725, "o", "\"\"\"\r\n"]
[210.171906, "o", "\r\n"]
[210.205087, "o", "from __future__ import annotations\r\n"]
[210.238268, "o", "\r\n"]
[210.27145, "o", "from functools import wraps\r\n"]
[210.304631, "o", "from typing import TYPE_CHECKING\r\n"]
[210.337812, "o", "\r\n"]
[210.370993, "o", "from pandas._libs.lib import item_from_zerodim\r\n"]
[210.404174, "o", "from pandas._libs.missing import is_matching_na\r\n"]
[210.437356, "o", "\r\n"]
[210.470537, "o", "from pandas.core.dtypes.generic import (\r\n"]
[210.503718, "o", "    ABCIndex,\r\n"]
[210.536899, "o", "    ABCSeries,\r\n"]
[210.570081, "o", ")\r\n"]
[210.603262, "o", "\r\n"]
[210.636443, "o", "if TYPE_CHECKING:\r\n"]
[210.669624, "o", "    from collections.abc import Callable\r\n"]
[210.702805, "o", "\r\n"]
[210.735987, "o", "    from pandas._typing import F\r\n"]
[210.769168, "o", "\r\n"]
[210.802349, "o", "\r\n"]
[210.83553, "o", "def unpack_zerodim_and_defer(name: str) -> Callable[[F], F]:\r\n"]
[210.868711, "o", "    \"\"\"\r\n"]
[210.901893, "o", "    Boilerplate for pandas conventions in arithmetic and comparison methods.\r\n"]
[210.935074, "o", "\r\n"]
[210.968255, "o", "    Parameters\r\n"]
[211.001436, "o", "    ----------\r\n"]
[211.034617, "o", "    name : str\r\n"]
[211.067799, "o", "\r\n"]
[211.10098, "o", "    Returns\r\n"]
[211.134161, "o", "    -------\r\n"]
[211.167342, "o", "    decorator\r\n"]
[211.200523, "o", "    \"\"\"\r\n"]
[211.233705, "o", "\r\n"]
[211.266886, "o", "    def wrapper(method: F) -> F:\r\n"]
[211.300067, "o", "        return _unpack_zerodim_and_defer(method, name)\r\n"]
[211.333248, "o", "\r\n"]
[211.36643, "o", "    return wrapper\r\n"]
[211.399611, "o", "\r\n"]
[211.432792, "o", "\r\n"]
[211.465973, "o", "def _unpack_zerodim_and_defer(method: F, name: str) -> F:\r\n"]
[211.499154, "o", "    \"\"\"\r\n"]
[211.532336, "o", "    Boilerplate for pandas conventions in arithmetic and comparison methods.\r\n"]
[211.565517, "o", "\r\n"]
[211.598698, "o", "    Ensure method returns NotImplemented when operating against \"senior\"\r\n"]
[211.631879, "o", "    classes.  Ensure zero-dimensional ndarrays are always unpacked.\r\n"]
[211.66506, "o", "\r\n"]
[211.698242, "o", "    Parameters\r\n"]
[211.731423, "o", "    ----------\r\n"]
[211.764604, "o", "    method : binary method\r\n"]
[211.797785, "o", "    name : str\r\n"]
[211.830966, "o", "\r\n"]
[211.864148, "o", "    Returns\r\n"]
[211.897329, "o", "    -------\r\n"]
[211.93051, "o", "    method\r\n"]
[211.963691, "o", "    \"\"\"\r\n"]
[211.996872, "o", "    stripped_name = name.removeprefix(\"__\").removesuffix(\"__\")\r\n"]
[212.030054, "o", "    is_cmp = stripped_name in {\"eq\", \"ne\", \"lt\", \"le\", \"gt\", \"ge\"}\r\n"]
[212.063235, "o", "\r\n"]
[212.096416, "o", "    @wraps(method)\r\n"]
[212.129597, "o", "    def new_method(self, other):\r\n"]
[212.162779, "o", "        if is_cmp and isinstance(self, ABCIndex) and isinstance(other, ABCSeries):\r\n"]
[212.19596, "o", "            # For comparison ops, Index does *not* defer to Series\r\n"]
[212.229141, "o", "            pass\r\n"]
[212.262322, "o", "        else:\r\n"]
[212.295503, "o", "            prio = getattr(other, \"__pandas_priority__\", None)\r\n"]
[212.328685, "o", "            if prio is not None:\r\n"]
[212.361866, "o", "                if prio > self.__pandas_priority__:\r\n"]
[212.395047, "o", "                    # e.g. other is DataFrame while self is Index/Series/EA\r\n"]
[212.428228, "o", "                    return NotImplemented\r\n"]
[212.461409, "o", "\r\n"]
[212.494591, "o", "        other = item_from_zerodim(other)\r\n"]
[212.527772, "o", "\r\n"]
[212.560953, "o", "        return method(self, other)\r\n"]
[212.594134, "o", "\r\n"]
[212.627315, "o", "    # error: Incompatible return value type (got \"Callable[[Any, Any], Any]\",\r\n"]
[212.660497, "o", "    # expected \"F\")\r\n"]
[212.693678, "o", "    return new_method  # type: ignore[return-value]\r\n"]
[212.726859, "o", "\r\n"]
[212.76004, "o", "\r\n"]
[212.793221, "o", "def get_op_result_name(left, right):\r\n"]
[212.826403, "o", "    \"\"\"\r\n"]
[212.859584, "o", "    Find the appropriate name to pin to an operation result.  This result\r\n"]
[212.892765, "o", "    should always be either an Index or a Series.\r\n"]
[212.925946, "o", "\r\n"]
[212.959128, "o", "    Parameters\r\n"]
[212.992309, "o", "    ----------\r\n"]
[213.02549, "o", "    left : {Series, Index}\r\n"]
[213.058671, "o", "    right : object\r\n"]
[213.091852, "o", "\r\n"]
[213.125034, "o", "    Returns\r\n"]
[213.158215, "o", "    -------\r\n"]
[213.191396, "o", "    name : object\r\n"]
[213.224577, "o", "        Usually a string\r\n"]
[213.257758, "o", "    \"\"\"\r\n"]
[213.29094, "o", "    if isinstance(right, (ABCSeries, ABCIndex)):\r\n"]
[213.324121, "o", "        name = _maybe_match_name(left, right)\r\n"]
[213.357302, "o", "    else:\r\n"]
[213.390483, "o", "        name = left.name\r\n"]
[213.423664, "o", "    return name\r\n"]
[213.456846, "o", "\r\n"]
[213.490027, "o", "\r\n"]
[213.523208, "o", "def _maybe_match_name(a, b):\r\n"]
[213.556389, "o", "    \"\"\"\r\n"]
[213.58957, "o", "    Try to find a name to attach to the result of an operation between\r\n"]
[213.622752, "o", "    a and b.  If only one of these has a `name` attribute, return that\r\n"]
[213.655933, "o", "    name.  Otherwise return a consensus name if they match or None if\r\n"]
[213.689114, "o", "    they have different names.\r\n"]
[213.722295, "o", "\r\n"]
[213.755477, "o", "    Parameters\r\n"]
[213.788658, "o", "    ----------\r\n"]
[213.821839, "o", "    a : object\r\n"]
[213.85502, "o", "    b : object\r\n"]
[213.888201, "o", "\r\n"]
[213.921383, "o", "    Returns\r\n"]
[213.954564, "o", "    -------\r\n"]
[213.987745, "o", "    name : str or None\r\n"]
[214.020926, "o", "\r\n"]
[214.054107, "o", "    See Also\r\n"]
[214.087289, "o", "    --------\r\n"]
[214.12047, "o", "    pandas.core.common.consensus_name_attr\r\n"]
[214.153651, "o", "    \"\"\"\r\n"]
[214.186832, "o", "    a_has = hasattr(a, \"name\")\r\n"]
[214.220013, "o", "    b_has = hasattr(b, \"name\")\r\n"]
[214.253195, "o", "    if a_has and b_has:\r\n"]
[214.286376, "o", "        try:\r\n"]
[214.319557, "o", "            if a.name == b.name:\r\n"]
[214.352738, "o", "                return a.name\r\n"]
[214.385919, "o", "            elif is_matching_na(a.name, b.name):\r\n"]
[214.419101, "o", "                # e.g. both are np.nan\r\n"]
[214.452282, "o", "                return a.name\r\n"]
[214.485463, "o", "            else:\r\n"]
[214.518644, "o", "                return None\r\n"]
[214.551826, "o", "        except TypeError:\r\n"]
[214.585007, "o", "            # pd.NA\r\n"]
[214.618188, "o", "            if is_matching_na(a.name, b.name):\r\n"]
[214.651369, "o", "                return a.name\r\n"]
[214.68455, "o", "            return None\r\n"]
[214.717732, "o", "        except ValueError:\r\n"]
[214.750913, "o", "            # e.g. np.int64(1) vs (np.int64(1), np.int64(2))\r\n"]
[214.784094, "o", "            return None\r\n"]
[214.817275, "o", "    elif a_has:\r\n"]
[214.850456, "o", "        return a.name\r\n"]
[214.883638, "o", "    elif b_has:\r\n"]
[214.916819, "o", "        return b.name\r\n"]
[215.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[215.002, "i", "sed -n '7700,7930p' pandas/core/frame.py\r"]
[215.004, "o", "sed -n '7700,7930p' pandas/core/frame.py\r\n"]
[215.02731, "o", "\u001b[?2004l\r\n"]
[215.048621, "o", "        \"\"\"\r\n"]
[215.069931, "o", "        Swap levels i and j in a :class:`MultiIndex`.\r\n"]
[215.091241, "o", "\r\n"]
[215.112552, "o", "        Default is to swap the two innermost levels of the index.\r\n"]
[215.133862, "o", "\r\n"]
[215.155172, "o", "        Parameters\r\n"]
[215.176483, "o", "        ----------\r\n"]
[215.197793, "o", "        i, j : int or str\r\n"]
[215.219103, "o", "            Levels of the indices to be swapped. Can pass level name as string.\r\n"]
[215.240414, "o", "        axis : {0 or 'index', 1 or 'columns'}, default 0\r\n"]
[215.261724, "o", "                    The axis to swap levels on. 0 or 'index' for row-wise, 1 or\r\n"]
[215.283034, "o", "                    'columns' for column-wise.\r\n"]
[215.304345, "o", "\r\n"]
[215.325655, "o", "        Returns\r\n"]
[215.346966, "o", "        -------\r\n"]
[215.368276, "o", "        DataFrame\r\n"]
[215.389586, "o", "            DataFrame with levels swapped in MultiIndex.\r\n"]
[215.410897, "o", "\r\n"]
[215.432207, "o", "        See Also\r\n"]
[215.453517, "o", "        --------\r\n"]
[215.474828, "o", "        DataFrame.reorder_levels: Reorder levels of MultiIndex.\r\n"]
[215.496138, "o", "        DataFrame.sort_index: Sort MultiIndex.\r\n"]
[215.517448, "o", "\r\n"]
[215.538759, "o", "        Examples\r\n"]
[215.560069, "o", "        --------\r\n"]
[215.581379, "o", "        >>> df = pd.DataFrame(\r\n"]
[215.60269, "o", "        ...     {\"Grade\": [\"A\", \"B\", \"A\", \"C\"]},\r\n"]
[215.624, "o", "        ...     index=[\r\n"]
[215.64531, "o", "        ...         [\"Final exam\", \"Final exam\", \"Coursework\", \"Coursework\"],\r\n"]
[215.666621, "o", "        ...         [\"History\", \"Geography\", \"History\", \"Geography\"],\r\n"]
[215.687931, "o", "        ...         [\"January\", \"February\", \"March\", \"April\"],\r\n"]
[215.709241, "o", "        ...     ],\r\n"]
[215.730552, "o", "        ... )\r\n"]
[215.751862, "o", "        >>> df\r\n"]
[215.773172, "o", "                                            Grade\r\n"]
[215.794483, "o", "        Final exam  History     January      A\r\n"]
[215.815793, "o", "                    Geography   February     B\r\n"]
[215.837103, "o", "        Coursework  History     March        A\r\n"]
[215.858414, "o", "                    Geography   April        C\r\n"]
[215.879724, "o", "\r\n"]
[215.901034, "o", "        In the following example, we will swap the levels of the indices.\r\n"]
[215.922345, "o", "        Here, we will swap the levels column-wise, but levels can be swapped row-wise\r\n"]
[215.943655, "o", "        in a similar manner. Note that column-wise is the default behaviour.\r\n"]
[215.964966, "o", "        By not supplying any arguments for i and j, we swap the last and second to\r\n"]
[215.986276, "o", "        last indices.\r\n"]
[216.007586, "o", "\r\n"]
[216.028897, "o", "        >>> df.swaplevel()\r\n"]
[216.050207, "o", "                                            Grade\r\n"]
[216.071517, "o", "        Final exam  January     History         A\r\n"]
[216.092828, "o", "                    February    Geography       B\r\n"]
[216.114138, "o", "        Coursework  March       History         A\r\n"]
[216.135448, "o", "                    April       Geography       C\r\n"]
[216.156759, "o", "\r\n"]
[216.178069, "o", "        By supplying one argument, we can choose which index to swap the last\r\n"]
[216.199379, "o", "        index with. We can for example swap the first index with the last one as\r\n"]
[216.22069, "o", "        follows.\r\n"]
[216.242, "o", "\r\n"]
[216.26331, "o", "        >>> df.swaplevel(0)\r\n"]
[216.284621, "o", "                                            Grade\r\n"]
[216.305931, "o", "        January     History     Final exam      A\r\n"]
[216.327241, "o", "        February    Geography   Final exam      B\r\n"]
[216.348552, "o", "        March       History     Coursework      A\r\n"]
[216.369862, "o", "        April       Geography   Coursework      C\r\n"]
[216.391172, "o", "\r\n"]
[216.412483, "o", "        We can also define explicitly which indices we want to swap by supplying values\r\n"]
[216.433793, "o", "        for both i and j. Here, we for example swap the first and second indices.\r\n"]
[216.455103, "o", "\r\n"]
[216.476414, "o", "        >>> df.swaplevel(0, 1)\r\n"]
[216.497724, "o", "                                            Grade\r\n"]
[216.519034, "o", "        History     Final exam  January         A\r\n"]
[216.540345, "o", "        Geography   Final exam  February        B\r\n"]
[216.561655, "o", "        History     Coursework  March           A\r\n"]
[216.582966, "o", "        Geography   Coursework  April           C\r\n"]
[216.604276, "o", "        \"\"\"\r\n"]
[216.625586, "o", "        result = self.copy(deep=False)\r\n"]
[216.646897, "o", "\r\n"]
[216.668207, "o", "        axis = self._get_axis_number(axis)\r\n"]
[216.689517, "o", "\r\n"]
[216.710828, "o", "        if not isinstance(result._get_axis(axis), MultiIndex):  # pragma: no cover\r\n"]
[216.732138, "o", "            raise TypeError(\"Can only swap levels on a hierarchical axis.\")\r\n"]
[216.753448, "o", "\r\n"]
[216.774759, "o", "        if axis == 0:\r\n"]
[216.796069, "o", "            assert isinstance(result.index, MultiIndex)\r\n"]
[216.817379, "o", "            result.index = result.index.swaplevel(i, j)\r\n"]
[216.83869, "o", "        else:\r\n"]
[216.86, "o", "            assert isinstance(result.columns, MultiIndex)\r\n"]
[216.88131, "o", "            result.columns = result.columns.swaplevel(i, j)\r\n"]
[216.902621, "o", "        return result\r\n"]
[216.923931, "o", "\r\n"]
[216.945241, "o", "    def reorder_levels(self, order: Sequence[int | str], axis: Axis = 0) -> DataFrame:\r\n"]
[216.966552, "o", "        \"\"\"\r\n"]
[216.987862, "o", "        Rearrange index or column levels using input ``order``.\r\n"]
[217.009172, "o", "\r\n"]
[217.030483, "o", "        May not drop or duplicate levels.\r\n"]
[217.051793, "o", "\r\n"]
[217.073103, "o", "        Parameters\r\n"]
[217.094414, "o", "        ----------\r\n"]
[217.115724, "o", "        order : list of int or list of str\r\n"]
[217.137034, "o", "            List representing new level order. Reference level by number\r\n"]
[217.158345, "o", "            (position) or by key (label).\r\n"]
[217.179655, "o", "        axis : {0 or 'index', 1 or 'columns'}, default 0\r\n"]
[217.200966, "o", "            Where to reorder levels.\r\n"]
[217.222276, "o", "\r\n"]
[217.243586, "o", "        Returns\r\n"]
[217.264897, "o", "        -------\r\n"]
[217.286207, "o", "        DataFrame\r\n"]
[217.307517, "o", "            DataFrame with indices or columns with reordered levels.\r\n"]
[217.328828, "o", "\r\n"]
[217.350138, "o", "        See Also\r\n"]
[217.371448, "o", "        --------\r\n"]
[217.392759, "o", "            DataFrame.swaplevel : Swap levels i and j in a MultiIndex.\r\n"]
[217.414069, "o", "\r\n"]
[217.435379, "o", "        Examples\r\n"]
[217.45669, "o", "        --------\r\n"]
[217.478, "o", "        >>> data = {\r\n"]
[217.49931, "o", "        ...     \"class\": [\"Mammals\", \"Mammals\", \"Reptiles\"],\r\n"]
[217.520621, "o", "        ...     \"diet\": [\"Omnivore\", \"Carnivore\", \"Carnivore\"],\r\n"]
[217.541931, "o", "        ...     \"species\": [\"Humans\", \"Dogs\", \"Snakes\"],\r\n"]
[217.563241, "o", "        ... }\r\n"]
[217.584552, "o", "        >>> df = pd.DataFrame(data, columns=[\"class\", \"diet\", \"species\"])\r\n"]
[217.605862, "o", "        >>> df = df.set_index([\"class\", \"diet\"])\r\n"]
[217.627172, "o", "        >>> df\r\n"]
[217.648483, "o", "                                          species\r\n"]
[217.669793, "o", "        class      diet\r\n"]
[217.691103, "o", "        Mammals    Omnivore                Humans\r\n"]
[217.712414, "o", "                   Carnivore                 Dogs\r\n"]
[217.733724, "o", "        Reptiles   Carnivore               Snakes\r\n"]
[217.755034, "o", "\r\n"]
[217.776345, "o", "        Let's reorder the levels of the index:\r\n"]
[217.797655, "o", "\r\n"]
[217.818966, "o", "        >>> df.reorder_levels([\"diet\", \"class\"])\r\n"]
[217.840276, "o", "                                          species\r\n"]
[217.861586, "o", "        diet      class\r\n"]
[217.882897, "o", "        Omnivore  Mammals                  Humans\r\n"]
[217.904207, "o", "        Carnivore Mammals                    Dogs\r\n"]
[217.925517, "o", "                  Reptiles                 Snakes\r\n"]
[217.946828, "o", "        \"\"\"\r\n"]
[217.968138, "o", "        axis = self._get_axis_number(axis)\r\n"]
[217.989448, "o", "        if not isinstance(self._get_axis(axis), MultiIndex):  # pragma: no cover\r\n"]
[218.010759, "o", "            raise TypeError(\"Can only reorder levels on a hierarchical axis.\")\r\n"]
[218.032069, "o", "\r\n"]
[218.053379, "o", "        result = self.copy(deep=False)\r\n"]
[218.07469, "o", "\r\n"]
[218.096, "o", "        if axis == 0:\r\n"]
[218.11731, "o", "            assert isinstance(result.index, MultiIndex)\r\n"]
[218.138621, "o", "            result.index = result.index.reorder_levels(order)\r\n"]
[218.159931, "o", "        else:\r\n"]
[218.181241, "o", "            assert isinstance(result.columns, MultiIndex)\r\n"]
[218.202552, "o", "            result.columns = result.columns.reorder_levels(order)\r\n"]
[218.223862, "o", "        return result\r\n"]
[218.245172, "o", "\r\n"]
[218.266483, "o", "    # ----------------------------------------------------------------------\r\n"]
[218.287793, "o", "    # Arithmetic Methods\r\n"]
[218.309103, "o", "\r\n"]
[218.330414, "o", "    def _cmp_method(self, other, op):\r\n"]
[218.351724, "o", "        axis: Literal[1] = 1  # only relevant for Series other case\r\n"]
[218.373034, "o", "\r\n"]
[218.394345, "o", "        self, other = self._align_for_op(other, axis, flex=False, level=None)\r\n"]
[218.415655, "o", "\r\n"]
[218.436966, "o", "        # See GH#4537 for discussion of scalar op behavior\r\n"]
[218.458276, "o", "        new_data = self._dispatch_frame_op(other, op, axis=axis)\r\n"]
[218.479586, "o", "        return self._construct_result(new_data)\r\n"]
[218.500897, "o", "\r\n"]
[218.522207, "o", "    def _arith_method(self, other, op):\r\n"]
[218.543517, "o", "        if self._should_reindex_frame_op(other, op, 1, None, None):\r\n"]
[218.564828, "o", "            return self._arith_method_with_reindex(other, op)\r\n"]
[218.586138, "o", "\r\n"]
[218.607448, "o", "        axis: Literal[1] = 1  # only relevant for Series other case\r\n"]
[218.628759, "o", "        other = ops.maybe_prepare_scalar_for_op(other, (self.shape[axis],))\r\n"]
[218.650069, "o", "\r\n"]
[218.671379, "o", "        self, other = self._align_for_op(other, axis, flex=True, level=None)\r\n"]
[218.69269, "o", "\r\n"]
[218.714, "o", "        with np.errstate(all=\"ignore\"):\r\n"]
[218.73531, "o", "            new_data = self._dispatch_frame_op(other, op, axis=axis)\r\n"]
[218.756621, "o", "        return self._construct_result(new_data)\r\n"]
[218.777931, "o", "\r\n"]
[218.799241, "o", "    _logical_method = _arith_method\r\n"]
[218.820552, "o", "\r\n"]
[218.841862, "o", "    def _dispatch_frame_op(\r\n"]
[218.863172, "o", "        self, right, func: Callable, axis: AxisInt | None = None\r\n"]
[218.884483, "o", "    ) -> DataFrame:\r\n"]
[218.905793, "o", "        \"\"\"\r\n"]
[218.927103, "o", "        Evaluate the frame operation func(left, right) by evaluating\r\n"]
[218.948414, "o", "        column-by-column, dispatching to the Series implementation.\r\n"]
[218.969724, "o", "\r\n"]
[218.991034, "o", "        Parameters\r\n"]
[219.012345, "o", "        ----------\r\n"]
[219.033655, "o", "        right : scalar, Series, or DataFrame\r\n"]
[219.054966, "o", "        func : arithmetic or comparison operator\r\n"]
[219.076276, "o", "        axis : {None, 0, 1}\r\n"]
[219.097586, "o", "\r\n"]
[219.118897, "o", "        Returns\r\n"]
[219.140207, "o", "        -------\r\n"]
[219.161517, "o", "        DataFrame\r\n"]
[219.182828, "o", "\r\n"]
[219.204138, "o", "        Notes\r\n"]
[219.225448, "o", "        -----\r\n"]
[219.246759, "o", "        Caller is responsible for setting np.errstate where relevant.\r\n"]
[219.268069, "o", "        \"\"\"\r\n"]
[219.289379, "o", "        # Get the appropriate array-op to apply to each column/block's values.\r\n"]
[219.31069, "o", "        array_op = ops.get_array_op(func)\r\n"]
[219.332, "o", "\r\n"]
[219.35331, "o", "        right = lib.item_from_zerodim(right)\r\n"]
[219.374621, "o", "        if not is_list_like(right):\r\n"]
[219.395931, "o", "            # i.e. scalar, faster than checking np.ndim(right) == 0\r\n"]
[219.417241, "o", "            bm = self._mgr.apply(array_op, right=right)\r\n"]
[219.438552, "o", "            return self._constructor_from_mgr(bm, axes=bm.axes)\r\n"]
[219.459862, "o", "\r\n"]
[219.481172, "o", "        elif isinstance(right, DataFrame):\r\n"]
[219.502483, "o", "            assert self.index.equals(right.index)\r\n"]
[219.523793, "o", "            assert self.columns.equals(right.columns)\r\n"]
[219.545103, "o", "            # TODO: The previous assertion `assert right._indexed_same(self)`\r\n"]
[219.566414, "o", "            #  fails in cases with empty columns reached via\r\n"]
[219.587724, "o", "            #  _frame_arith_method_with_reindex\r\n"]
[219.609034, "o", "\r\n"]
[219.630345, "o", "            # TODO operate_blockwise expects a manager of the same type\r\n"]
[219.651655, "o", "            bm = self._mgr.operate_blockwise(\r\n"]
[219.672966, "o", "                right._mgr,\r\n"]
[219.694276, "o", "                array_op,\r\n"]
[219.715586, "o", "            )\r\n"]
[219.736897, "o", "            return self._constructor_from_mgr(bm, axes=bm.axes)\r\n"]
[219.758207, "o", "\r\n"]
[219.779517, "o", "        elif isinstance(right, Series) and axis == 1:\r\n"]
[219.800828, "o", "            # axis=1 means we want to operate row-by-row\r\n"]
[219.822138, "o", "            assert right.index.equals(self.columns)\r\n"]
[219.843448, "o", "\r\n"]
[219.864759, "o", "            right = right._values\r\n"]
[219.886069, "o", "            # maybe_align_as_frame ensures we do not have an ndarray here\r\n"]
[219.907379, "o", "            assert not isinstance(right, np.ndarray)\r\n"]
[219.92869, "o", "\r\n"]
[220.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[220.002, "i", "pwd\r"]
[220.004, "o", "pwd\r\n"]
[222.478, "o", "\u001b[?2004l\r\n"]
[225.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[225.002, "i", "grep -n \"MIN_ELEMENTS\\|_MIN_ELEMENTS\\|should_use_numexpr\" -n pandas/core/computation/expressions.py\r"]
[225.004, "o", "grep -n \"MIN_ELEMENTS\\|_MIN_ELEMENTS\\|should_use_numexpr\" -n pandas/core/computation/expressions.py\r\n"]
[226.654, "o", "\u001b[?2004l\r\n"]
[228.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 1_000_000\r\n"]
[230.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[230.002, "i", "sed -n '1,240p' pandas/core/computation/expressions.py\r"]
[230.004, "o", "sed -n '1,240p' pandas/core/computation/expressions.py\r\n"]
[230.026515, "o", "\u001b[?2004l\r\n"]
[230.047029, "o", "\"\"\"\r\n"]
[230.067544, "o", "Expressions\r\n"]
[230.088058, "o", "-----------\r\n"]
[230.108573, "o", "\r\n"]
[230.129087, "o", "Offer fast expression evaluation through numexpr\r\n"]
[230.149602, "o", "\r\n"]
[230.170116, "o", "\"\"\"\r\n"]
[230.190631, "o", "\r\n"]
[230.211145, "o", "from __future__ import annotations\r\n"]
[230.23166, "o", "\r\n"]
[230.252174, "o", "import operator\r\n"]
[230.272689, "o", "from typing import TYPE_CHECKING\r\n"]
[230.293203, "o", "import warnings\r\n"]
[230.313718, "o", "\r\n"]
[230.334232, "o", "import numpy as np\r\n"]
[230.354747, "o", "\r\n"]
[230.375261, "o", "from pandas._config import get_option\r\n"]
[230.395776, "o", "\r\n"]
[230.41629, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[230.436805, "o", "\r\n"]
[230.45732, "o", "from pandas.core import roperator\r\n"]
[230.477834, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[230.498349, "o", "\r\n"]
[230.518863, "o", "if NUMEXPR_INSTALLED:\r\n"]
[230.539378, "o", "    import numexpr as ne\r\n"]
[230.559892, "o", "\r\n"]
[230.580407, "o", "if TYPE_CHECKING:\r\n"]
[230.600921, "o", "    from pandas._typing import FuncType\r\n"]
[230.621436, "o", "\r\n"]
[230.64195, "o", "_TEST_MODE: bool | None = None\r\n"]
[230.662465, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[230.682979, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[230.703494, "o", "_evaluate: FuncType | None = None\r\n"]
[230.724008, "o", "_where: FuncType | None = None\r\n"]
[230.744523, "o", "\r\n"]
[230.765037, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[230.785552, "o", "_ALLOWED_DTYPES = {\r\n"]
[230.806066, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[230.826581, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[230.847095, "o", "}\r\n"]
[230.86761, "o", "\r\n"]
[230.888124, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[230.908639, "o", "_MIN_ELEMENTS = 1_000_000\r\n"]
[230.929154, "o", "\r\n"]
[230.949668, "o", "\r\n"]
[230.970183, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[230.990697, "o", "    # set/unset to use numexpr\r\n"]
[231.011212, "o", "    global USE_NUMEXPR\r\n"]
[231.031726, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[231.052241, "o", "        USE_NUMEXPR = v\r\n"]
[231.072755, "o", "\r\n"]
[231.09327, "o", "    # choose what we are going to do\r\n"]
[231.113784, "o", "    global _evaluate, _where\r\n"]
[231.134299, "o", "\r\n"]
[231.154813, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[231.175328, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[231.195842, "o", "\r\n"]
[231.216357, "o", "\r\n"]
[231.236871, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[231.257386, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[231.2779, "o", "    # otherwise reset\r\n"]
[231.298415, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[231.318929, "o", "        if n is None:\r\n"]
[231.339444, "o", "            n = ne.detect_number_of_cores()\r\n"]
[231.359959, "o", "        ne.set_num_threads(n)\r\n"]
[231.380473, "o", "\r\n"]
[231.400988, "o", "\r\n"]
[231.421502, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[231.442017, "o", "    \"\"\"\r\n"]
[231.462531, "o", "    Standard evaluation.\r\n"]
[231.483046, "o", "    \"\"\"\r\n"]
[231.50356, "o", "    if _TEST_MODE:\r\n"]
[231.524075, "o", "        _store_test_result(False)\r\n"]
[231.544589, "o", "    return op(left_op, right_op)\r\n"]
[231.565104, "o", "\r\n"]
[231.585618, "o", "\r\n"]
[231.606133, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[231.626647, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[231.647162, "o", "    if op_str is not None:\r\n"]
[231.667676, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[231.688191, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[231.708705, "o", "            # check for dtype compatibility\r\n"]
[231.72922, "o", "            dtypes: set[str] = set()\r\n"]
[231.749734, "o", "            for o in [left_op, right_op]:\r\n"]
[231.770249, "o", "                # ndarray and Series Case\r\n"]
[231.790763, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[231.811278, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[231.831793, "o", "\r\n"]
[231.852307, "o", "            # allowed are a superset\r\n"]
[231.872822, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[231.893336, "o", "                return True\r\n"]
[231.913851, "o", "\r\n"]
[231.934365, "o", "    return False\r\n"]
[231.95488, "o", "\r\n"]
[231.975394, "o", "\r\n"]
[231.995909, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[232.016423, "o", "    result = None\r\n"]
[232.036938, "o", "\r\n"]
[232.057452, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[232.077967, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[232.098481, "o", "        if is_reversed:\r\n"]
[232.118996, "o", "            # we were originally called by a reversed op method\r\n"]
[232.13951, "o", "            left_op, right_op = right_op, left_op\r\n"]
[232.160025, "o", "\r\n"]
[232.180539, "o", "        left_value = left_op\r\n"]
[232.201054, "o", "        right_value = right_op\r\n"]
[232.221568, "o", "\r\n"]
[232.242083, "o", "        try:\r\n"]
[232.262598, "o", "            result = ne.evaluate(\r\n"]
[232.283112, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[232.303627, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[232.324141, "o", "                casting=\"safe\",\r\n"]
[232.344656, "o", "            )\r\n"]
[232.36517, "o", "        except TypeError:\r\n"]
[232.385685, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[232.406199, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[232.426714, "o", "            pass\r\n"]
[232.447228, "o", "        except NotImplementedError:\r\n"]
[232.467743, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[232.488257, "o", "                pass\r\n"]
[232.508772, "o", "            else:\r\n"]
[232.529286, "o", "                raise\r\n"]
[232.549801, "o", "\r\n"]
[232.570315, "o", "        if is_reversed:\r\n"]
[232.59083, "o", "            # reverse order to original for fallback\r\n"]
[232.611344, "o", "            left_op, right_op = right_op, left_op\r\n"]
[232.631859, "o", "\r\n"]
[232.652373, "o", "    if _TEST_MODE:\r\n"]
[232.672888, "o", "        _store_test_result(result is not None)\r\n"]
[232.693402, "o", "\r\n"]
[232.713917, "o", "    if result is None:\r\n"]
[232.734432, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[232.754946, "o", "\r\n"]
[232.775461, "o", "    return result\r\n"]
[232.795975, "o", "\r\n"]
[232.81649, "o", "\r\n"]
[232.837004, "o", "_op_str_mapping = {\r\n"]
[232.857519, "o", "    operator.add: \"+\",\r\n"]
[232.878033, "o", "    roperator.radd: \"+\",\r\n"]
[232.898548, "o", "    operator.mul: \"*\",\r\n"]
[232.919062, "o", "    roperator.rmul: \"*\",\r\n"]
[232.939577, "o", "    operator.sub: \"-\",\r\n"]
[232.960091, "o", "    roperator.rsub: \"-\",\r\n"]
[232.980606, "o", "    operator.truediv: \"/\",\r\n"]
[233.00112, "o", "    roperator.rtruediv: \"/\",\r\n"]
[233.021635, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[233.042149, "o", "    operator.floordiv: None,\r\n"]
[233.062664, "o", "    roperator.rfloordiv: None,\r\n"]
[233.083178, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[233.103693, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[233.124207, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[233.144722, "o", "    operator.mod: None,\r\n"]
[233.165237, "o", "    roperator.rmod: None,\r\n"]
[233.185751, "o", "    operator.pow: \"**\",\r\n"]
[233.206266, "o", "    roperator.rpow: \"**\",\r\n"]
[233.22678, "o", "    operator.eq: \"==\",\r\n"]
[233.247295, "o", "    operator.ne: \"!=\",\r\n"]
[233.267809, "o", "    operator.le: \"<=\",\r\n"]
[233.288324, "o", "    operator.lt: \"<\",\r\n"]
[233.308838, "o", "    operator.ge: \">=\",\r\n"]
[233.329353, "o", "    operator.gt: \">\",\r\n"]
[233.349867, "o", "    operator.and_: \"&\",\r\n"]
[233.370382, "o", "    roperator.rand_: \"&\",\r\n"]
[233.390896, "o", "    operator.or_: \"|\",\r\n"]
[233.411411, "o", "    roperator.ror_: \"|\",\r\n"]
[233.431925, "o", "    operator.xor: \"^\",\r\n"]
[233.45244, "o", "    roperator.rxor: \"^\",\r\n"]
[233.472954, "o", "    divmod: None,\r\n"]
[233.493469, "o", "    roperator.rdivmod: None,\r\n"]
[233.513983, "o", "}\r\n"]
[233.534498, "o", "\r\n"]
[233.555012, "o", "\r\n"]
[233.575527, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[233.596041, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[233.616556, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[233.637071, "o", "\r\n"]
[233.657585, "o", "\r\n"]
[233.6781, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[233.698614, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[233.719129, "o", "    result = None\r\n"]
[233.739643, "o", "\r\n"]
[233.760158, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[233.780672, "o", "        result = ne.evaluate(\r\n"]
[233.801187, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[233.821701, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[233.842216, "o", "            casting=\"safe\",\r\n"]
[233.86273, "o", "        )\r\n"]
[233.883245, "o", "\r\n"]
[233.903759, "o", "    if result is None:\r\n"]
[233.924274, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[233.944788, "o", "\r\n"]
[233.965303, "o", "    return result\r\n"]
[233.985817, "o", "\r\n"]
[234.006332, "o", "\r\n"]
[234.026846, "o", "# turn myself on\r\n"]
[234.047361, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[234.067876, "o", "\r\n"]
[234.08839, "o", "\r\n"]
[234.108905, "o", "def _has_bool_dtype(x):\r\n"]
[234.129419, "o", "    try:\r\n"]
[234.149934, "o", "        return x.dtype == bool\r\n"]
[234.170448, "o", "    except AttributeError:\r\n"]
[234.190963, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[234.211477, "o", "\r\n"]
[234.231992, "o", "\r\n"]
[234.252506, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[234.273021, "o", "\r\n"]
[234.293535, "o", "\r\n"]
[234.31405, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[234.334564, "o", "    \"\"\"\r\n"]
[234.355079, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[234.375593, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[234.396108, "o", "    boolean ops.\r\n"]
[234.416622, "o", "    \"\"\"\r\n"]
[234.437137, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[234.457651, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[234.478166, "o", "            warnings.warn(\r\n"]
[234.49868, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[234.519195, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[234.53971, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[234.560224, "o", "                stacklevel=find_stack_level(),\r\n"]
[234.580739, "o", "            )\r\n"]
[234.601253, "o", "            return True\r\n"]
[234.621768, "o", "    return False\r\n"]
[234.642282, "o", "\r\n"]
[234.662797, "o", "\r\n"]
[234.683311, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[234.703826, "o", "    \"\"\"\r\n"]
[234.72434, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[234.744855, "o", "\r\n"]
[234.765369, "o", "    Parameters\r\n"]
[234.785884, "o", "    ----------\r\n"]
[234.806398, "o", "    op : the actual operand\r\n"]
[234.826913, "o", "    left_op : left operand\r\n"]
[234.847427, "o", "    right_op : right operand\r\n"]
[234.867942, "o", "    use_numexpr : bool, default True\r\n"]
[234.888456, "o", "        Whether to try to use numexpr.\r\n"]
[234.908971, "o", "    \"\"\"\r\n"]
[234.929485, "o", "    op_str = _op_str_mapping[op]\r\n"]
[235.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[235.002, "i", "python - << 'PY'\r"]
[235.004, "o", "python - << 'PY'\r\n"]
[235.1605, "o", "\u001b[?2004l\r\n"]
[235.315, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[235.4695, "o", "\u001b[?2004l\r\n"]
[235.624, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[235.7785, "o", "\u001b[?2004l\r\n"]
[235.933, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[236.0875, "o", "\u001b[?2004l\r\n"]
[236.242, "o", "\u001b[?2004h> # Increase the MIN_ELEMENTS threshold conservatively above 2_000_000 to bypass numexpr for these benches\r\n"]
[236.3965, "o", "\u001b[?2004l\r\n"]
[236.551, "o", "\u001b[?2004h> import re\r\n"]
[236.7055, "o", "\u001b[?2004l\r\n"]
[236.86, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src)\r\n"]
[237.0145, "o", "\u001b[?2004l\r\n"]
[237.169, "o", "\u001b[?2004h> if n == 0:\r\n"]
[237.3235, "o", "\u001b[?2004l\r\n"]
[237.478, "o", "\u001b[?2004h>     # Also try MIN_ELEMENTS without underscore\r\n"]
[237.6325, "o", "\u001b[?2004l\r\n"]
[237.787, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src)\r\n"]
[237.9415, "o", "\u001b[?2004l\r\n"]
[238.096, "o", "\u001b[?2004h> if new_src != src:\r\n"]
[238.2505, "o", "\u001b[?2004l\r\n"]
[238.405, "o", "\u001b[?2004h>     p.write_text(new_src)\r\n"]
[238.5595, "o", "\u001b[?2004l\r\n"]
[238.714, "o", "\u001b[?2004h>     print('Patched threshold in expressions.py')\r\n"]
[238.8685, "o", "\u001b[?2004l\r\n"]
[239.023, "o", "\u001b[?2004h> else:\r\n"]
[239.1775, "o", "\u001b[?2004l\r\n"]
[239.332, "o", "\u001b[?2004h>     print('No threshold pattern matched; no change made')\r\n"]
[239.4865, "o", "\u001b[?2004l\r\n"]
[239.641, "o", "\u001b[?2004h> PY\r\n"]
[239.7955, "o", "\u001b[?2004l\r\n"]
[240.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[240.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[240.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[240.359143, "o", "\u001b[?2004l\r\n"]
[240.712286, "o", "diff --git a/pandas/core/computation/expressions.py b/pandas/core/computation/expressions.py\r\n"]
[241.065429, "o", "index 5a5fad0d83..dee80059a8 100644\r\n"]
[241.418571, "o", "--- a/pandas/core/computation/expressions.py\r\n"]
[241.771714, "o", "+++ b/pandas/core/computation/expressions.py\r\n"]
[242.124857, "o", "@@ -40,7 +40,7 @@ _ALLOWED_DTYPES = {\r\n"]
[242.478, "o", " }\r\n"]
[242.831143, "o", " \r\n"]
[243.184286, "o", " # the minimum prod shape that we will use numexpr\r\n"]
[243.537429, "o", "-_MIN_ELEMENTS = 1_000_000\r\n"]
[243.890571, "o", "+_MIN_ELEMENTS = 4000000\r\n"]
[244.243714, "o", " \r\n"]
[244.596857, "o", " \r\n"]
[245.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[245.002, "i", "cd asv_bench\r"]
[245.004, "o", "cd asv_bench\r\n"]
[245.006, "o", "\u001b[?2004l\r\n"]
[250.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[250.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[250.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[250.097556, "o", "\u001b[?2004l\r\n"]
[250.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[250.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[250.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[250.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[250.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[250.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[250.738444, "o", "             --                      threads          \r\n"]
[250.83, "o", "             ------------- ---------------------------\r\n"]
[250.921556, "o", "              use_numexpr     default          1      \r\n"]
[251.013111, "o", "             ============= ============= =============\r\n"]
[251.104667, "o", "                  True      2.21\u00b10.07ms   2.22\u00b10.03ms \r\n"]
[251.196222, "o", "                 False      2.24\u00b10.06ms   2.23\u00b10.06ms \r\n"]
[251.287778, "o", "             ============= ============= =============\r\n"]
[251.379333, "o", "\r\n"]
[251.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[251.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[251.654, "o", "             --                      threads          \r\n"]
[251.745556, "o", "             ------------- ---------------------------\r\n"]
[251.837111, "o", "              use_numexpr     default          1      \r\n"]
[251.928667, "o", "             ============= ============= =============\r\n"]
[252.020222, "o", "                  True      1.71\u00b10.04ms   1.68\u00b10.03ms \r\n"]
[252.111778, "o", "                 False      1.72\u00b10.07ms   1.76\u00b10.07ms \r\n"]
[252.203333, "o", "             ============= ============= =============\r\n"]
[252.294889, "o", "\r\n"]
[252.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[252.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[252.569556, "o", "             --                      threads          \r\n"]
[252.661111, "o", "             ------------- ---------------------------\r\n"]
[252.752667, "o", "              use_numexpr     default          1      \r\n"]
[252.844222, "o", "             ============= ============= =============\r\n"]
[252.935778, "o", "                  True      2.21\u00b10.03ms   2.17\u00b10.05ms \r\n"]
[253.027333, "o", "                 False      2.24\u00b10.05ms   2.25\u00b10.06ms \r\n"]
[253.118889, "o", "             ============= ============= =============\r\n"]
[253.210444, "o", "\r\n"]
[253.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[253.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[253.485111, "o", "             --                      threads          \r\n"]
[253.576667, "o", "             ------------- ---------------------------\r\n"]
[253.668222, "o", "              use_numexpr     default          1      \r\n"]
[253.759778, "o", "             ============= ============= =============\r\n"]
[253.851333, "o", "                  True       10.2\u00b10.1ms   10.2\u00b10.08ms \r\n"]
[253.942889, "o", "                 False      10.2\u00b10.06ms   10.2\u00b10.05ms \r\n"]
[254.034444, "o", "             ============= ============= =============\r\n"]
[254.126, "o", "\r\n"]
[254.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          45.9\u00b10.4ms\r\n"]
[254.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.4\u00b10.04ms\r\n"]
[254.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              866\u00b120\u03bcs\r\n"]
[254.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.4\u00b10.1ms\r\n"]
[254.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.5\u00b10.04ms\r\n"]
[254.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.49\u00b10.03ms\r\n"]
[254.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      10.6\u00b10.1ms\r\n"]
[254.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     467\u00b120\u03bcs\r\n"]
[255.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[255.002, "i", "cd ..\r"]
[255.004, "o", "cd ..\r\n"]
[255.006, "o", "\u001b[?2004l\r\n"]
[260.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[260.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[260.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[260.359143, "o", "\u001b[?2004l\r\n"]
[260.712286, "o", "diff --git a/pandas/core/computation/expressions.py b/pandas/core/computation/expressions.py\r\n"]
[261.065429, "o", "index 5a5fad0d83..dee80059a8 100644\r\n"]
[261.418571, "o", "--- a/pandas/core/computation/expressions.py\r\n"]
[261.771714, "o", "+++ b/pandas/core/computation/expressions.py\r\n"]
[262.124857, "o", "@@ -40,7 +40,7 @@ _ALLOWED_DTYPES = {\r\n"]
[262.478, "o", " }\r\n"]
[262.831143, "o", " \r\n"]
[263.184286, "o", " # the minimum prod shape that we will use numexpr\r\n"]
[263.537429, "o", "-_MIN_ELEMENTS = 1_000_000\r\n"]
[263.890571, "o", "+_MIN_ELEMENTS = 4000000\r\n"]
[264.243714, "o", " \r\n"]
[264.596857, "o", " \r\n"]
[265.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[265.002, "i", "git add pandas/core/computation/expressions.py\r"]
[265.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[265.006, "o", "\u001b[?2004l\r\n"]
[270.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[270.002, "i", "git commit -m \"perf(expressions): raise MIN_ELEMENTS threshold to avoid numexpr overhead on moderate-sized ops (e.g\r"]
[270.004, "o", "git commit -m \"perf(expressions): raise MIN_ELEMENTS threshold to avoid numexpr overhead on moderate-sized ops (e.g\r\n"]
[270.3356, "o", "g., 20k x 100) improving arithmetic.Ops.* benchmarks\"\r\n"]
[270.6652, "o", "\u001b[?2004l\r\n"]
[270.9948, "o", "Author identity unknown\r\n"]
[271.3244, "o", "\r\n"]
[271.654, "o", "*** Please tell me who you are.\r\n"]
[271.9836, "o", "\r\n"]
[272.3132, "o", "Run\r\n"]
[272.6428, "o", "\r\n"]
[272.9724, "o", "  git config --global user.email \"you@example.com\"\r\n"]
[273.302, "o", "  git config --global user.name \"Your Name\"\r\n"]
[273.6316, "o", "\r\n"]
[273.9612, "o", "to set your account's default identity.\r\n"]
[274.2908, "o", "Omit --global to set the identity only in this repository.\r\n"]
[274.6204, "o", "\r\n"]
[275.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[275.002, "i", "cd asv_bench\r"]
[275.004, "o", "cd asv_bench\r\n"]
[275.006, "o", "\u001b[?2004l\r\n"]
[280.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[280.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[280.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[280.097556, "o", "\u001b[?2004l\r\n"]
[280.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[280.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[280.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[280.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[280.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[280.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[280.738444, "o", "             --                      threads          \r\n"]
[280.83, "o", "             ------------- ---------------------------\r\n"]
[280.921556, "o", "              use_numexpr     default          1      \r\n"]
[281.013111, "o", "             ============= ============= =============\r\n"]
[281.104667, "o", "                  True       2.77\u00b10.2ms   2.38\u00b10.09ms \r\n"]
[281.196222, "o", "                 False      2.27\u00b10.05ms    2.32\u00b10.1ms \r\n"]
[281.287778, "o", "             ============= ============= =============\r\n"]
[281.379333, "o", "\r\n"]
[281.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[281.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[281.654, "o", "             --                     threads          \r\n"]
[281.745556, "o", "             ------------- --------------------------\r\n"]
[281.837111, "o", "              use_numexpr     default         1      \r\n"]
[281.928667, "o", "             ============= ============= ============\r\n"]
[282.020222, "o", "                  True      1.73\u00b10.05ms   1.97\u00b10.1ms \r\n"]
[282.111778, "o", "                 False       1.91\u00b10.1ms   1.75\u00b10.1ms \r\n"]
[282.203333, "o", "             ============= ============= ============\r\n"]
[282.294889, "o", "\r\n"]
[282.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[282.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[282.569556, "o", "             --                      threads          \r\n"]
[282.661111, "o", "             ------------- ---------------------------\r\n"]
[282.752667, "o", "              use_numexpr     default          1      \r\n"]
[282.844222, "o", "             ============= ============= =============\r\n"]
[282.935778, "o", "                  True      2.32\u00b10.09ms    2.28\u00b10.1ms \r\n"]
[283.027333, "o", "                 False       2.40\u00b10.2ms   2.32\u00b10.09ms \r\n"]
[283.118889, "o", "             ============= ============= =============\r\n"]
[283.210444, "o", "\r\n"]
[283.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[283.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[283.485111, "o", "             --                     threads          \r\n"]
[283.576667, "o", "             ------------- --------------------------\r\n"]
[283.668222, "o", "              use_numexpr     default         1      \r\n"]
[283.759778, "o", "             ============= ============= ============\r\n"]
[283.851333, "o", "                  True       10.1\u00b10.2ms   10.1\u00b10.1ms \r\n"]
[283.942889, "o", "                 False      9.97\u00b10.09ms   10.2\u00b10.3ms \r\n"]
[284.034444, "o", "             ============= ============= ============\r\n"]
[284.126, "o", "\r\n"]
[284.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          45.9\u00b10.2ms\r\n"]
[284.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.4\u00b10.04ms\r\n"]
[284.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              836\u00b140\u03bcs\r\n"]
[284.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.2\u00b10.1ms\r\n"]
[284.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.5\u00b10.04ms\r\n"]
[284.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.44\u00b10.03ms\r\n"]
[284.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.8\u00b10.09ms\r\n"]
[284.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      450\u00b19\u03bcs\r\n"]
[285.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[285.002, "i", "cd ..\r"]
[285.004, "o", "cd ..\r\n"]
[285.006, "o", "\u001b[?2004l\r\n"]
[290.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[290.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[290.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[290.006, "o", "\u001b[?2004l\r\n"]
[295.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[295.002, "i", "grep -n \"MIN_ELEMENTS\\|_MIN_ELEMENTS\\|should_use_numexpr\" pandas/core/computation/expressions.py\r"]
[295.004, "o", "grep -n \"MIN_ELEMENTS\\|_MIN_ELEMENTS\\|should_use_numexpr\" pandas/core/computation/expressions.py\r\n"]
[296.654, "o", "\u001b[?2004l\r\n"]
[298.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[300.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[300.002, "i", "sed -n '1,220p' pandas/core/computation/expressions.py\r"]
[300.004, "o", "sed -n '1,220p' pandas/core/computation/expressions.py\r\n"]
[300.028371, "o", "\u001b[?2004l\r\n"]
[300.050742, "o", "\"\"\"\r\n"]
[300.073113, "o", "Expressions\r\n"]
[300.095484, "o", "-----------\r\n"]
[300.117855, "o", "\r\n"]
[300.140226, "o", "Offer fast expression evaluation through numexpr\r\n"]
[300.162597, "o", "\r\n"]
[300.184968, "o", "\"\"\"\r\n"]
[300.207339, "o", "\r\n"]
[300.22971, "o", "from __future__ import annotations\r\n"]
[300.252081, "o", "\r\n"]
[300.274452, "o", "import operator\r\n"]
[300.296824, "o", "from typing import TYPE_CHECKING\r\n"]
[300.319195, "o", "import warnings\r\n"]
[300.341566, "o", "\r\n"]
[300.363937, "o", "import numpy as np\r\n"]
[300.386308, "o", "\r\n"]
[300.408679, "o", "from pandas._config import get_option\r\n"]
[300.43105, "o", "\r\n"]
[300.453421, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[300.475792, "o", "\r\n"]
[300.498163, "o", "from pandas.core import roperator\r\n"]
[300.520534, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[300.542905, "o", "\r\n"]
[300.565276, "o", "if NUMEXPR_INSTALLED:\r\n"]
[300.587647, "o", "    import numexpr as ne\r\n"]
[300.610018, "o", "\r\n"]
[300.632389, "o", "if TYPE_CHECKING:\r\n"]
[300.65476, "o", "    from pandas._typing import FuncType\r\n"]
[300.677131, "o", "\r\n"]
[300.699502, "o", "_TEST_MODE: bool | None = None\r\n"]
[300.721873, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[300.744244, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[300.766615, "o", "_evaluate: FuncType | None = None\r\n"]
[300.788986, "o", "_where: FuncType | None = None\r\n"]
[300.811357, "o", "\r\n"]
[300.833729, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[300.8561, "o", "_ALLOWED_DTYPES = {\r\n"]
[300.878471, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[300.900842, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[300.923213, "o", "}\r\n"]
[300.945584, "o", "\r\n"]
[300.967955, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[300.990326, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[301.012697, "o", "\r\n"]
[301.035068, "o", "\r\n"]
[301.057439, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[301.07981, "o", "    # set/unset to use numexpr\r\n"]
[301.102181, "o", "    global USE_NUMEXPR\r\n"]
[301.124552, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[301.146923, "o", "        USE_NUMEXPR = v\r\n"]
[301.169294, "o", "\r\n"]
[301.191665, "o", "    # choose what we are going to do\r\n"]
[301.214036, "o", "    global _evaluate, _where\r\n"]
[301.236407, "o", "\r\n"]
[301.258778, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[301.281149, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[301.30352, "o", "\r\n"]
[301.325891, "o", "\r\n"]
[301.348262, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[301.370633, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[301.393005, "o", "    # otherwise reset\r\n"]
[301.415376, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[301.437747, "o", "        if n is None:\r\n"]
[301.460118, "o", "            n = ne.detect_number_of_cores()\r\n"]
[301.482489, "o", "        ne.set_num_threads(n)\r\n"]
[301.50486, "o", "\r\n"]
[301.527231, "o", "\r\n"]
[301.549602, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[301.571973, "o", "    \"\"\"\r\n"]
[301.594344, "o", "    Standard evaluation.\r\n"]
[301.616715, "o", "    \"\"\"\r\n"]
[301.639086, "o", "    if _TEST_MODE:\r\n"]
[301.661457, "o", "        _store_test_result(False)\r\n"]
[301.683828, "o", "    return op(left_op, right_op)\r\n"]
[301.706199, "o", "\r\n"]
[301.72857, "o", "\r\n"]
[301.750941, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[301.773312, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[301.795683, "o", "    if op_str is not None:\r\n"]
[301.818054, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[301.840425, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[301.862796, "o", "            # check for dtype compatibility\r\n"]
[301.885167, "o", "            dtypes: set[str] = set()\r\n"]
[301.907538, "o", "            for o in [left_op, right_op]:\r\n"]
[301.92991, "o", "                # ndarray and Series Case\r\n"]
[301.952281, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[301.974652, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[301.997023, "o", "\r\n"]
[302.019394, "o", "            # allowed are a superset\r\n"]
[302.041765, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[302.064136, "o", "                return True\r\n"]
[302.086507, "o", "\r\n"]
[302.108878, "o", "    return False\r\n"]
[302.131249, "o", "\r\n"]
[302.15362, "o", "\r\n"]
[302.175991, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[302.198362, "o", "    result = None\r\n"]
[302.220733, "o", "\r\n"]
[302.243104, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[302.265475, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[302.287846, "o", "        if is_reversed:\r\n"]
[302.310217, "o", "            # we were originally called by a reversed op method\r\n"]
[302.332588, "o", "            left_op, right_op = right_op, left_op\r\n"]
[302.354959, "o", "\r\n"]
[302.37733, "o", "        left_value = left_op\r\n"]
[302.399701, "o", "        right_value = right_op\r\n"]
[302.422072, "o", "\r\n"]
[302.444443, "o", "        try:\r\n"]
[302.466814, "o", "            result = ne.evaluate(\r\n"]
[302.489186, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[302.511557, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[302.533928, "o", "                casting=\"safe\",\r\n"]
[302.556299, "o", "            )\r\n"]
[302.57867, "o", "        except TypeError:\r\n"]
[302.601041, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[302.623412, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[302.645783, "o", "            pass\r\n"]
[302.668154, "o", "        except NotImplementedError:\r\n"]
[302.690525, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[302.712896, "o", "                pass\r\n"]
[302.735267, "o", "            else:\r\n"]
[302.757638, "o", "                raise\r\n"]
[302.780009, "o", "\r\n"]
[302.80238, "o", "        if is_reversed:\r\n"]
[302.824751, "o", "            # reverse order to original for fallback\r\n"]
[302.847122, "o", "            left_op, right_op = right_op, left_op\r\n"]
[302.869493, "o", "\r\n"]
[302.891864, "o", "    if _TEST_MODE:\r\n"]
[302.914235, "o", "        _store_test_result(result is not None)\r\n"]
[302.936606, "o", "\r\n"]
[302.958977, "o", "    if result is None:\r\n"]
[302.981348, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[303.003719, "o", "\r\n"]
[303.02609, "o", "    return result\r\n"]
[303.048462, "o", "\r\n"]
[303.070833, "o", "\r\n"]
[303.093204, "o", "_op_str_mapping = {\r\n"]
[303.115575, "o", "    operator.add: \"+\",\r\n"]
[303.137946, "o", "    roperator.radd: \"+\",\r\n"]
[303.160317, "o", "    operator.mul: \"*\",\r\n"]
[303.182688, "o", "    roperator.rmul: \"*\",\r\n"]
[303.205059, "o", "    operator.sub: \"-\",\r\n"]
[303.22743, "o", "    roperator.rsub: \"-\",\r\n"]
[303.249801, "o", "    operator.truediv: \"/\",\r\n"]
[303.272172, "o", "    roperator.rtruediv: \"/\",\r\n"]
[303.294543, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[303.316914, "o", "    operator.floordiv: None,\r\n"]
[303.339285, "o", "    roperator.rfloordiv: None,\r\n"]
[303.361656, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[303.384027, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[303.406398, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[303.428769, "o", "    operator.mod: None,\r\n"]
[303.45114, "o", "    roperator.rmod: None,\r\n"]
[303.473511, "o", "    operator.pow: \"**\",\r\n"]
[303.495882, "o", "    roperator.rpow: \"**\",\r\n"]
[303.518253, "o", "    operator.eq: \"==\",\r\n"]
[303.540624, "o", "    operator.ne: \"!=\",\r\n"]
[303.562995, "o", "    operator.le: \"<=\",\r\n"]
[303.585367, "o", "    operator.lt: \"<\",\r\n"]
[303.607738, "o", "    operator.ge: \">=\",\r\n"]
[303.630109, "o", "    operator.gt: \">\",\r\n"]
[303.65248, "o", "    operator.and_: \"&\",\r\n"]
[303.674851, "o", "    roperator.rand_: \"&\",\r\n"]
[303.697222, "o", "    operator.or_: \"|\",\r\n"]
[303.719593, "o", "    roperator.ror_: \"|\",\r\n"]
[303.741964, "o", "    operator.xor: \"^\",\r\n"]
[303.764335, "o", "    roperator.rxor: \"^\",\r\n"]
[303.786706, "o", "    divmod: None,\r\n"]
[303.809077, "o", "    roperator.rdivmod: None,\r\n"]
[303.831448, "o", "}\r\n"]
[303.853819, "o", "\r\n"]
[303.87619, "o", "\r\n"]
[303.898561, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[303.920932, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[303.943303, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[303.965674, "o", "\r\n"]
[303.988045, "o", "\r\n"]
[304.010416, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[304.032787, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[304.055158, "o", "    result = None\r\n"]
[304.077529, "o", "\r\n"]
[304.0999, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[304.122271, "o", "        result = ne.evaluate(\r\n"]
[304.144643, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[304.167014, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[304.189385, "o", "            casting=\"safe\",\r\n"]
[304.211756, "o", "        )\r\n"]
[304.234127, "o", "\r\n"]
[304.256498, "o", "    if result is None:\r\n"]
[304.278869, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[304.30124, "o", "\r\n"]
[304.323611, "o", "    return result\r\n"]
[304.345982, "o", "\r\n"]
[304.368353, "o", "\r\n"]
[304.390724, "o", "# turn myself on\r\n"]
[304.413095, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[304.435466, "o", "\r\n"]
[304.457837, "o", "\r\n"]
[304.480208, "o", "def _has_bool_dtype(x):\r\n"]
[304.502579, "o", "    try:\r\n"]
[304.52495, "o", "        return x.dtype == bool\r\n"]
[304.547321, "o", "    except AttributeError:\r\n"]
[304.569692, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[304.592063, "o", "\r\n"]
[304.614434, "o", "\r\n"]
[304.636805, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[304.659176, "o", "\r\n"]
[304.681548, "o", "\r\n"]
[304.703919, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[304.72629, "o", "    \"\"\"\r\n"]
[304.748661, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[304.771032, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[304.793403, "o", "    boolean ops.\r\n"]
[304.815774, "o", "    \"\"\"\r\n"]
[304.838145, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[304.860516, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[304.882887, "o", "            warnings.warn(\r\n"]
[304.905258, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[304.927629, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[305.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[305.002, "i", "git config user.email \"devnull@example.com\"\r"]
[305.004, "o", "git config user.email \"devnull@example.com\"\r\n"]
[305.006, "o", "\u001b[?2004l\r\n"]
[310.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[310.002, "i", "git config user.name \"ASV Optimizer\"\r"]
[310.004, "o", "git config user.name \"ASV Optimizer\"\r\n"]
[310.006, "o", "\u001b[?2004l\r\n"]
[315.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[315.002, "i", "git add pandas/core/computation/expressions.py\r"]
[315.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[315.006, "o", "\u001b[?2004l\r\n"]
[320.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[320.002, "i", "git commit -m \"perf(expressions): raise MIN_ELEMENTS threshold to bypass numexpr on moderate-sized ops (improves ar\r"]
[320.004, "o", "git commit -m \"perf(expressions): raise MIN_ELEMENTS threshold to bypass numexpr on moderate-sized ops (improves ar\r\n"]
[321.242, "o", "rithmetic.Ops.*)\"\r\n"]
[322.478, "o", "\u001b[?2004l\r\n"]
[323.714, "o", "[main dccf724192] perf(expressions): raise MIN_ELEMENTS threshold to bypass numexpr on moderate-sized ops (improves arithmetic.Ops.*)\r\n"]
[325.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[325.002, "i", "cd asv_bench\r"]
[325.004, "o", "cd asv_bench\r\n"]
[325.006, "o", "\u001b[?2004l\r\n"]
[330.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[330.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[330.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[330.095891, "o", "\u001b[?2004l\r\n"]
[330.185782, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[330.275673, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[330.365564, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[330.455455, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[330.545345, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[330.635236, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[330.725127, "o", "             --                      threads          \r\n"]
[330.815018, "o", "             ------------- ---------------------------\r\n"]
[330.904909, "o", "              use_numexpr     default          1      \r\n"]
[330.9948, "o", "             ============= ============= =============\r\n"]
[331.084691, "o", "                  True       2.02\u00b10.1ms   2.11\u00b10.08ms \r\n"]
[331.174582, "o", "                 False      2.04\u00b10.02ms   2.12\u00b10.06ms \r\n"]
[331.264473, "o", "             ============= ============= =============\r\n"]
[331.354364, "o", "\r\n"]
[331.444255, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[331.534145, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[331.624036, "o", "             --                      threads          \r\n"]
[331.713927, "o", "             ------------- ---------------------------\r\n"]
[331.803818, "o", "              use_numexpr     default          1      \r\n"]
[331.893709, "o", "             ============= ============= =============\r\n"]
[331.9836, "o", "                  True      1.67\u00b10.03ms   1.81\u00b10.09ms \r\n"]
[332.073491, "o", "                 False      1.70\u00b10.05ms   1.68\u00b10.04ms \r\n"]
[332.163382, "o", "             ============= ============= =============\r\n"]
[332.253273, "o", "\r\n"]
[332.343164, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0masv run --python=same --bench=\"arithmetic.Ops2.*\"\r\n"]
[332.433055, "o", "                                                                                                                  ok\r\n"]
[332.522945, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[332.612836, "o", "             --                      threads          \r\n"]
[332.702727, "o", "             ------------- ---------------------------\r\n"]
[332.792618, "o", "              use_numexpr     default          1      \r\n"]
[332.882509, "o", "             ============= ============= =============\r\n"]
[332.9724, "o", "                  True      2.03\u00b10.03ms   2.08\u00b10.05ms \r\n"]
[333.062291, "o", "                 False      2.06\u00b10.04ms   2.06\u00b10.06ms \r\n"]
[333.152182, "o", "             ============= ============= =============\r\n"]
[333.242073, "o", "\r\n"]
[333.331964, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[333.421855, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[333.511745, "o", "             --                      threads          \r\n"]
[333.601636, "o", "             ------------- ---------------------------\r\n"]
[333.691527, "o", "              use_numexpr     default          1      \r\n"]
[333.781418, "o", "             ============= ============= =============\r\n"]
[333.871309, "o", "                  True      9.77\u00b10.08ms    9.85\u00b10.1ms \r\n"]
[333.9612, "o", "                 False      9.70\u00b10.06ms   9.76\u00b10.04ms \r\n"]
[334.051091, "o", "             ============= ============= =============\r\n"]
[334.140982, "o", "\r\n"]
[334.230873, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          45.3\u00b10.1ms\r\n"]
[334.320764, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.3\u00b10.06ms\r\n"]
[334.410655, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              660\u00b150\u03bcs\r\n"]
[334.500545, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                         19.1\u00b10.08ms\r\n"]
[334.590436, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.5\u00b10.03ms\r\n"]
[334.680327, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.36\u00b10.03ms\r\n"]
[334.770218, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.3\u00b10.04ms\r\n"]
[334.860109, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      421\u00b15\u03bcs\r\n"]
[335.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[335.002, "i", "asv run --python=same --bench=\"arithmetic.Ops2.*\"\r"]
[335.004, "o", "asv run --python=same --bench=\"arithmetic.Ops2.*\"\r\n"]
[335.359143, "o", "\u001b[?2004l\r\n"]
[335.712286, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[336.065429, "o", "\u00b7 \u001b[0;32mRunning 9 total benchmarks (1 commits * 1 environments * 9 benchmarks)\u001b[0m\r\n"]
[336.418571, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[336.771714, "o", "[ 5.56%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops2.time_frame_dot--)\u001b[0m.........\r\n"]
[337.124857, "o", "[55.56%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          44.9\u00b10.2ms\r\n"]
[337.478, "o", "[61.11%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.3\u00b10.05ms\r\n"]
[337.831143, "o", "[66.67%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              636\u00b110\u03bcs\r\n"]
[338.184286, "o", "[72.22%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                         18.9\u00b10.04ms\r\n"]
[338.537429, "o", "[77.78%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.7\u00b10.02ms\r\n"]
[338.890571, "o", "[83.33%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.31\u00b10.02ms\r\n"]
[339.243714, "o", "[88.89%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.1\u00b10.04ms\r\n"]
[339.596857, "o", "[94.44%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      421\u00b14\u03bcs\r\n"]
[340.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[340.002, "i", "cd ..\r"]
[340.004, "o", "cd ..\r\n"]
[340.006, "o", "\u001b[?2004l\r\n"]
[345.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[345.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[345.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[345.006, "o", "\u001b[?2004l\r\n"]
[350.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[350.002, "i", "grep -n \"MIN_ELEMENTS\\|_MIN_ELEMENTS\\|should_use_numexpr\" pandas/core/computation/expressions.py\r"]
[350.004, "o", "grep -n \"MIN_ELEMENTS\\|_MIN_ELEMENTS\\|should_use_numexpr\" pandas/core/computation/expressions.py\r\n"]
[351.654, "o", "\u001b[?2004l\r\n"]
[353.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[355.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[355.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py | sed -n '1,160p'\r"]
[355.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py | sed -n '1,160p'\r\n"]
[355.036708, "o", "\u001b[?2004l\r\n"]
[355.067416, "o", "\"\"\"\r\n"]
[355.098124, "o", "Expressions\r\n"]
[355.128832, "o", "-----------\r\n"]
[355.15954, "o", "\r\n"]
[355.190248, "o", "Offer fast expression evaluation through numexpr\r\n"]
[355.220957, "o", "\r\n"]
[355.251665, "o", "\"\"\"\r\n"]
[355.282373, "o", "\r\n"]
[355.313081, "o", "from __future__ import annotations\r\n"]
[355.343789, "o", "\r\n"]
[355.374497, "o", "import operator\r\n"]
[355.405205, "o", "from typing import TYPE_CHECKING\r\n"]
[355.435913, "o", "import warnings\r\n"]
[355.466621, "o", "\r\n"]
[355.497329, "o", "import numpy as np\r\n"]
[355.528037, "o", "\r\n"]
[355.558745, "o", "from pandas._config import get_option\r\n"]
[355.589453, "o", "\r\n"]
[355.620161, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[355.65087, "o", "\r\n"]
[355.681578, "o", "from pandas.core import roperator\r\n"]
[355.712286, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[355.742994, "o", "\r\n"]
[355.773702, "o", "if NUMEXPR_INSTALLED:\r\n"]
[355.80441, "o", "    import numexpr as ne\r\n"]
[355.835118, "o", "\r\n"]
[355.865826, "o", "if TYPE_CHECKING:\r\n"]
[355.896534, "o", "    from pandas._typing import FuncType\r\n"]
[355.927242, "o", "\r\n"]
[355.95795, "o", "_TEST_MODE: bool | None = None\r\n"]
[355.988658, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[356.019366, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[356.050075, "o", "_evaluate: FuncType | None = None\r\n"]
[356.080783, "o", "_where: FuncType | None = None\r\n"]
[356.111491, "o", "\r\n"]
[356.142199, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[356.172907, "o", "_ALLOWED_DTYPES = {\r\n"]
[356.203615, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[356.234323, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[356.265031, "o", "}\r\n"]
[356.295739, "o", "\r\n"]
[356.326447, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[356.357155, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[356.387863, "o", "\r\n"]
[356.418571, "o", "\r\n"]
[356.44928, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[356.479988, "o", "    # set/unset to use numexpr\r\n"]
[356.510696, "o", "    global USE_NUMEXPR\r\n"]
[356.541404, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[356.572112, "o", "        USE_NUMEXPR = v\r\n"]
[356.60282, "o", "\r\n"]
[356.633528, "o", "    # choose what we are going to do\r\n"]
[356.664236, "o", "    global _evaluate, _where\r\n"]
[356.694944, "o", "\r\n"]
[356.725652, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[356.75636, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[356.787068, "o", "\r\n"]
[356.817776, "o", "\r\n"]
[356.848484, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[356.879193, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[356.909901, "o", "    # otherwise reset\r\n"]
[356.940609, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[356.971317, "o", "        if n is None:\r\n"]
[357.002025, "o", "            n = ne.detect_number_of_cores()\r\n"]
[357.032733, "o", "        ne.set_num_threads(n)\r\n"]
[357.063441, "o", "\r\n"]
[357.094149, "o", "\r\n"]
[357.124857, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[357.155565, "o", "    \"\"\"\r\n"]
[357.186273, "o", "    Standard evaluation.\r\n"]
[357.216981, "o", "    \"\"\"\r\n"]
[357.247689, "o", "    if _TEST_MODE:\r\n"]
[357.278398, "o", "        _store_test_result(False)\r\n"]
[357.309106, "o", "    return op(left_op, right_op)\r\n"]
[357.339814, "o", "\r\n"]
[357.370522, "o", "\r\n"]
[357.40123, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[357.431938, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[357.462646, "o", "    if op_str is not None:\r\n"]
[357.493354, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[357.524062, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[357.55477, "o", "            # check for dtype compatibility\r\n"]
[357.585478, "o", "            dtypes: set[str] = set()\r\n"]
[357.616186, "o", "            for o in [left_op, right_op]:\r\n"]
[357.646894, "o", "                # ndarray and Series Case\r\n"]
[357.677602, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[357.708311, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[357.739019, "o", "\r\n"]
[357.769727, "o", "            # allowed are a superset\r\n"]
[357.800435, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[357.831143, "o", "                return True\r\n"]
[357.861851, "o", "\r\n"]
[357.892559, "o", "    return False\r\n"]
[357.923267, "o", "\r\n"]
[357.953975, "o", "\r\n"]
[357.984683, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[358.015391, "o", "    result = None\r\n"]
[358.046099, "o", "\r\n"]
[358.076807, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[358.107516, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[358.138224, "o", "        if is_reversed:\r\n"]
[358.168932, "o", "            # we were originally called by a reversed op method\r\n"]
[358.19964, "o", "            left_op, right_op = right_op, left_op\r\n"]
[358.230348, "o", "\r\n"]
[358.261056, "o", "        left_value = left_op\r\n"]
[358.291764, "o", "        right_value = right_op\r\n"]
[358.322472, "o", "\r\n"]
[358.35318, "o", "        try:\r\n"]
[358.383888, "o", "            result = ne.evaluate(\r\n"]
[358.414596, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[358.445304, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[358.476012, "o", "                casting=\"safe\",\r\n"]
[358.50672, "o", "            )\r\n"]
[358.537429, "o", "        except TypeError:\r\n"]
[358.568137, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[358.598845, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[358.629553, "o", "            pass\r\n"]
[358.660261, "o", "        except NotImplementedError:\r\n"]
[358.690969, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[358.721677, "o", "                pass\r\n"]
[358.752385, "o", "            else:\r\n"]
[358.783093, "o", "                raise\r\n"]
[358.813801, "o", "\r\n"]
[358.844509, "o", "        if is_reversed:\r\n"]
[358.875217, "o", "            # reverse order to original for fallback\r\n"]
[358.905925, "o", "            left_op, right_op = right_op, left_op\r\n"]
[358.936634, "o", "\r\n"]
[358.967342, "o", "    if _TEST_MODE:\r\n"]
[358.99805, "o", "        _store_test_result(result is not None)\r\n"]
[359.028758, "o", "\r\n"]
[359.059466, "o", "    if result is None:\r\n"]
[359.090174, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[359.120882, "o", "\r\n"]
[359.15159, "o", "    return result\r\n"]
[359.182298, "o", "\r\n"]
[359.213006, "o", "\r\n"]
[359.243714, "o", "_op_str_mapping = {\r\n"]
[359.274422, "o", "    operator.add: \"+\",\r\n"]
[359.30513, "o", "    roperator.radd: \"+\",\r\n"]
[359.335839, "o", "    operator.mul: \"*\",\r\n"]
[359.366547, "o", "    roperator.rmul: \"*\",\r\n"]
[359.397255, "o", "    operator.sub: \"-\",\r\n"]
[359.427963, "o", "    roperator.rsub: \"-\",\r\n"]
[359.458671, "o", "    operator.truediv: \"/\",\r\n"]
[359.489379, "o", "    roperator.rtruediv: \"/\",\r\n"]
[359.520087, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[359.550795, "o", "    operator.floordiv: None,\r\n"]
[359.581503, "o", "    roperator.rfloordiv: None,\r\n"]
[359.612211, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[359.642919, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[359.673627, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[359.704335, "o", "    operator.mod: None,\r\n"]
[359.735043, "o", "    roperator.rmod: None,\r\n"]
[359.765752, "o", "    operator.pow: \"**\",\r\n"]
[359.79646, "o", "    roperator.rpow: \"**\",\r\n"]
[359.827168, "o", "    operator.eq: \"==\",\r\n"]
[359.857876, "o", "    operator.ne: \"!=\",\r\n"]
[359.888584, "o", "    operator.le: \"<=\",\r\n"]
[359.919292, "o", "    operator.lt: \"<\",\r\n"]
[360.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[360.002, "i", "git config user.email \"devnull@example.com\"\r"]
[360.004, "o", "git config user.email \"devnull@example.com\"\r\n"]
[360.006, "o", "\u001b[?2004l\r\n"]
[365.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[365.002, "i", "git config user.name \"ASV Optimizer\"\r"]
[365.004, "o", "git config user.name \"ASV Optimizer\"\r\n"]
[365.006, "o", "\u001b[?2004l\r\n"]
[370.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[370.002, "i", "git add pandas/core/computation/expressions.py\r"]
[370.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[370.006, "o", "\u001b[?2004l\r\n"]
[375.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[375.002, "i", "git commit -m \"perf(expressions): raise MIN_ELEMENTS threshold to bypass numexpr overhead on moderate-sized ops; im\r"]
[375.004, "o", "git commit -m \"perf(expressions): raise MIN_ELEMENTS threshold to bypass numexpr overhead on moderate-sized ops; im\r\n"]
[375.624, "o", "mproves arithmetic.Ops.*\"\r\n"]
[376.242, "o", "\u001b[?2004l\r\n"]
[376.86, "o", "On branch main\r\n"]
[377.478, "o", "Untracked files:\r\n"]
[378.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[378.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[379.332, "o", "\r\n"]
[380.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[380.002, "i", "cd ..\r"]
[380.004, "o", "cd ..\r\n"]
[380.006, "o", "\u001b[?2004l\r\n"]
[385.0, "o", "(asv_3.10) root@89c02398194d:/workspace# "]
[385.002, "i", "git status -sb\r"]
[385.004, "o", "git status -sb\r\n"]
[387.478, "o", "\u001b[?2004l\r\n"]
[390.0, "o", "(asv_3.10) root@89c02398194d:/workspace# "]
[390.002, "i", "grep -n \"MIN_ELEMENTS\\|_MIN_ELEMENTS\\|should_use_numexpr\" pandas/core/computation/expressions.py\r"]
[390.004, "o", "grep -n \"MIN_ELEMENTS\\|_MIN_ELEMENTS\\|should_use_numexpr\" pandas/core/computation/expressions.py\r\n"]
[392.478, "o", "\u001b[?2004l\r\n"]
[395.0, "o", "(asv_3.10) root@89c02398194d:/workspace# "]
[395.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py\r"]
[395.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py\r\n"]
[397.478, "o", "\u001b[?2004l\r\n"]
[400.0, "o", "(asv_3.10) root@89c02398194d:/workspace# "]
[400.002, "i", "python - << 'PY'\r"]
[400.004, "o", "python - << 'PY'\r\n"]
[400.071053, "o", "\u001b[?2004l\r\n"]
[400.136105, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[400.201158, "o", "\u001b[?2004l\r\n"]
[400.266211, "o", "\u001b[?2004h> import re\r\n"]
[400.331263, "o", "\u001b[?2004l\r\n"]
[400.396316, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[400.461368, "o", "\u001b[?2004l\r\n"]
[400.526421, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[400.591474, "o", "\u001b[?2004l\r\n"]
[400.656526, "o", "\u001b[?2004h> changed = False\r\n"]
[400.721579, "o", "\u001b[?2004l\r\n"]
[400.786632, "o", "\u001b[?2004h> # Try to adjust a constant threshold if present\r\n"]
[400.851684, "o", "\u001b[?2004l\r\n"]
[400.916737, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[400.981789, "o", "\u001b[?2004l\r\n"]
[401.046842, "o", "\u001b[?2004h> if n == 0:\r\n"]
[401.111895, "o", "\u001b[?2004l\r\n"]
[401.176947, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[401.242, "o", "\u001b[?2004l\r\n"]
[401.307053, "o", "\u001b[?2004h> if n > 0:\r\n"]
[401.372105, "o", "\u001b[?2004l\r\n"]
[401.437158, "o", "\u001b[?2004h>     src = new_src\r\n"]
[401.502211, "o", "\u001b[?2004l\r\n"]
[401.567263, "o", "\u001b[?2004h>     changed = True\r\n"]
[401.632316, "o", "\u001b[?2004l\r\n"]
[401.697368, "o", "\u001b[?2004h> else:\r\n"]
[401.762421, "o", "\u001b[?2004l\r\n"]
[401.827474, "o", "\u001b[?2004h>     # If there's no constant, patch should_use_numexpr to impose our threshold\r\n"]
[401.892526, "o", "\u001b[?2004l\r\n"]
[401.957579, "o", "\u001b[?2004h>     # Insert a size check early in should_use_numexpr if not present.\r\n"]
[402.022632, "o", "\u001b[?2004l\r\n"]
[402.087684, "o", "\u001b[?2004h>     pattern = r\"def\\s+should_use_numexpr\\(.*?\\):\\n\"\r\n"]
[402.152737, "o", "\u001b[?2004l\r\n"]
[402.217789, "o", "\u001b[?2004h>     m = re.search(pattern, src, flags=re.S)\r\n"]
[402.282842, "o", "\u001b[?2004l\r\n"]
[402.347895, "o", "\u001b[?2004h>     if m:\r\n"]
[402.412947, "o", "\u001b[?2004l\r\n"]
[402.478, "o", "\u001b[?2004h>         start = m.end()\r\n"]
[402.543053, "o", "\u001b[?2004l\r\n"]
[402.608105, "o", "\u001b[?2004h>         # Find end of function by next def or end of file\r\n"]
[402.673158, "o", "\u001b[?2004l\r\n"]
[402.738211, "o", "\u001b[?2004h>         func_body_end = re.search(r\"\\ndef\\s+|\\Z\", src[start:], flags=re.S)\r\n"]
[402.803263, "o", "\u001b[?2004l\r\n"]
[402.868316, "o", "\u001b[?2004h>         if func_body_end:\r\n"]
[402.933368, "o", "\u001b[?2004l\r\n"]
[402.998421, "o", "\u001b[?2004h>             body = src[start:start+func_body_end.start()]\r\n"]
[403.063474, "o", "\u001b[?2004l\r\n"]
[403.128526, "o", "\u001b[?2004h>             if 'MIN_ELEMENTS' not in src and '_MIN_ELEMENTS' not in src and 'size_threshold' not in body:\r\n"]
[403.193579, "o", "\u001b[?2004l\r\n"]
[403.258632, "o", "\u001b[?2004h>                 inject = \"\\n    # Bypass numexpr for moderate-sized ops to reduce overhead\\n    try:\\n        a_size = getattr(a, 'size', None)\\n        b_size\r\n"]
[403.323684, "o", "e = getattr(b, 'size', None)\\n    except NameError:\\n        a_size = b_size = None\\n    if a_size is not None and (a_size < 4_000_000) and (b_size is None or b_\r\n"]
[403.388737, "o", "_size < 4_000_000):\\n        return False\\n\"\r\n"]
[403.453789, "o", "\u001b[?2004l\r\n"]
[403.518842, "o", "\u001b[?2004h>                 src = src[:start] + inject + src[start:]\r\n"]
[403.583895, "o", "\u001b[?2004l\r\n"]
[403.648947, "o", "\u001b[?2004h>                 changed = True\r\n"]
[403.714, "o", "\u001b[?2004l\r\n"]
[403.779053, "o", "\u001b[?2004h> if changed:\r\n"]
[403.844105, "o", "\u001b[?2004l\r\n"]
[403.909158, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[403.974211, "o", "\u001b[?2004l\r\n"]
[404.039263, "o", "\u001b[?2004h>     print('Patched expressions.py to raise numexpr threshold or add early bypass')\r\n"]
[404.104316, "o", "\u001b[?2004l\r\n"]
[404.169368, "o", "\u001b[?2004h> else:\r\n"]
[404.234421, "o", "\u001b[?2004l\r\n"]
[404.299474, "o", "\u001b[?2004h>     print('No changes applied; patterns not found')\r\n"]
[404.364526, "o", "\u001b[?2004l\r\n"]
[404.429579, "o", "\u001b[?2004h> PY\r\n"]
[404.494632, "o", "\u001b[?2004l\r\n"]
[404.559684, "o", "Traceback (most recent call last):\r\n"]
[404.624737, "o", "  File \"<stdin>\", line 4, in <module>\r\n"]
[404.689789, "o", "  File \"/opt/conda/envs/asv_3.10/lib/python3.10/pathlib.py\", line 1134, in read_text\r\n"]
[404.754842, "o", "    with self.open(mode='r', encoding=encoding, errors=errors) as f:\r\n"]
[404.819895, "o", "  File \"/opt/conda/envs/asv_3.10/lib/python3.10/pathlib.py\", line 1119, in open\r\n"]
[404.884947, "o", "    return self._accessor.open(self, mode, buffering, encoding, errors,\r\n"]
[405.0, "o", "(asv_3.10) root@89c02398194d:/workspace# "]
[405.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[405.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[405.04374, "o", "\u001b[?2004l\r\n"]
[405.081481, "o", "warning: Not a git repository. Use --no-index to compare two paths outside a working tree\r\n"]
[405.119221, "o", "usage: git diff --no-index [<options>] <path> <path> [<pathspec>...]\r\n"]
[405.156962, "o", "\r\n"]
[405.194702, "o", "Diff output format options\r\n"]
[405.232443, "o", "    -p, --patch           generate patch\r\n"]
[405.270183, "o", "    -s, --no-patch        suppress diff output\r\n"]
[405.307924, "o", "    -u                    generate patch\r\n"]
[405.345664, "o", "    -U, --unified[=<n>]   generate diffs with <n> lines context\r\n"]
[405.383405, "o", "    -W, --[no-]function-context\r\n"]
[405.421145, "o", "                          generate diffs with <n> lines context\r\n"]
[405.458885, "o", "    --raw                 generate the diff in raw format\r\n"]
[405.496626, "o", "    --patch-with-raw      synonym for '-p --raw'\r\n"]
[405.534366, "o", "    --patch-with-stat     synonym for '-p --stat'\r\n"]
[405.572107, "o", "    --numstat             machine friendly --stat\r\n"]
[405.609847, "o", "    --shortstat           output only the last line of --stat\r\n"]
[405.647588, "o", "    -X, --dirstat[=<param1>,<param2>...]\r\n"]
[405.685328, "o", "                          output the distribution of relative amount of changes for each sub-directory\r\n"]
[405.723069, "o", "    --cumulative          synonym for --dirstat=cumulative\r\n"]
[405.760809, "o", "    --dirstat-by-file[=<param1>,<param2>...]\r\n"]
[405.79855, "o", "                          synonym for --dirstat=files,<param1>,<param2>...\r\n"]
[405.83629, "o", "    --check               warn if changes introduce conflict markers or whitespace errors\r\n"]
[405.874031, "o", "    --summary             condensed summary such as creations, renames and mode changes\r\n"]
[405.911771, "o", "    --name-only           show only names of changed files\r\n"]
[405.949511, "o", "    --name-status         show only names and status of changed files\r\n"]
[405.987252, "o", "    --stat[=<width>[,<name-width>[,<count>]]]\r\n"]
[406.024992, "o", "                          generate diffstat\r\n"]
[406.062733, "o", "    --stat-width <width>  generate diffstat with a given width\r\n"]
[406.100473, "o", "    --stat-name-width <width>\r\n"]
[406.138214, "o", "                          generate diffstat with a given name width\r\n"]
[406.175954, "o", "    --stat-graph-width <width>\r\n"]
[406.213695, "o", "                          generate diffstat with a given graph width\r\n"]
[406.251435, "o", "    --stat-count <count>  generate diffstat with limited lines\r\n"]
[406.289176, "o", "    --[no-]compact-summary\r\n"]
[406.326916, "o", "                          generate compact summary in diffstat\r\n"]
[406.364656, "o", "    --binary              output a binary diff that can be applied\r\n"]
[406.402397, "o", "    --[no-]full-index     show full pre- and post-image object names on the \"index\" lines\r\n"]
[406.440137, "o", "    --[no-]color[=<when>] show colored diff\r\n"]
[406.477878, "o", "    --ws-error-highlight <kind>\r\n"]
[406.515618, "o", "                          highlight whitespace errors in the 'context', 'old' or 'new' lines in the diff\r\n"]
[406.553359, "o", "    -z                    do not munge pathnames and use NULs as output field terminators in --raw or --numstat\r\n"]
[406.591099, "o", "    --[no-]abbrev[=<n>]   use <n> digits to display object names\r\n"]
[406.62884, "o", "    --src-prefix <prefix> show the given source prefix instead of \"a/\"\r\n"]
[406.66658, "o", "    --dst-prefix <prefix> show the given destination prefix instead of \"b/\"\r\n"]
[406.704321, "o", "    --line-prefix <prefix>\r\n"]
[406.742061, "o", "                          prepend an additional prefix to every line of output\r\n"]
[406.779802, "o", "    --no-prefix           do not show any source or destination prefix\r\n"]
[406.817542, "o", "    --default-prefix      use default prefixes a/ and b/\r\n"]
[406.855282, "o", "    --inter-hunk-context <n>\r\n"]
[406.893023, "o", "                          show context between diff hunks up to the specified number of lines\r\n"]
[406.930763, "o", "    --output-indicator-new <char>\r\n"]
[406.968504, "o", "                          specify the character to indicate a new line instead of '+'\r\n"]
[407.006244, "o", "    --output-indicator-old <char>\r\n"]
[407.043985, "o", "                          specify the character to indicate an old line instead of '-'\r\n"]
[407.081725, "o", "    --output-indicator-context <char>\r\n"]
[407.119466, "o", "                          specify the character to indicate a context instead of ' '\r\n"]
[407.157206, "o", "\r\n"]
[407.194947, "o", "Diff rename options\r\n"]
[407.232687, "o", "    -B, --break-rewrites[=<n>[/<m>]]\r\n"]
[407.270427, "o", "                          break complete rewrite changes into pairs of delete and create\r\n"]
[407.308168, "o", "    -M, --find-renames[=<n>]\r\n"]
[407.345908, "o", "                          detect renames\r\n"]
[407.383649, "o", "    -D, --irreversible-delete\r\n"]
[407.421389, "o", "                          omit the preimage for deletes\r\n"]
[407.45913, "o", "    -C, --find-copies[=<n>]\r\n"]
[407.49687, "o", "                          detect copies\r\n"]
[407.534611, "o", "    --[no-]find-copies-harder\r\n"]
[407.572351, "o", "                          use unmodified files as source to find copies\r\n"]
[407.610092, "o", "    --no-renames          disable rename detection\r\n"]
[407.647832, "o", "    --[no-]rename-empty   use empty blobs as rename source\r\n"]
[407.685573, "o", "    --[no-]follow         continue listing the history of a file beyond renames\r\n"]
[407.723313, "o", "    -l <n>                prevent rename/copy detection if the number of rename/copy targets exceeds given limit\r\n"]
[407.761053, "o", "\r\n"]
[407.798794, "o", "Diff algorithm options\r\n"]
[407.836534, "o", "    --minimal             produce the smallest possible diff\r\n"]
[407.874275, "o", "    -w, --ignore-all-space\r\n"]
[407.912015, "o", "                          ignore whitespace when comparing lines\r\n"]
[407.949756, "o", "    -b, --ignore-space-change\r\n"]
[407.987496, "o", "                          ignore changes in amount of whitespace\r\n"]
[408.025237, "o", "    --ignore-space-at-eol ignore changes in whitespace at EOL\r\n"]
[408.062977, "o", "    --ignore-cr-at-eol    ignore carrier-return at the end of line\r\n"]
[408.100718, "o", "    --ignore-blank-lines  ignore changes whose lines are all blank\r\n"]
[408.138458, "o", "    -I, --[no-]ignore-matching-lines <regex>\r\n"]
[408.176198, "o", "                          ignore changes whose all lines match <regex>\r\n"]
[408.213939, "o", "    --[no-]indent-heuristic\r\n"]
[408.251679, "o", "                          heuristic to shift diff hunk boundaries for easy reading\r\n"]
[408.28942, "o", "    --patience            generate diff using the \"patience diff\" algorithm\r\n"]
[408.32716, "o", "    --histogram           generate diff using the \"histogram diff\" algorithm\r\n"]
[408.364901, "o", "    --diff-algorithm <algorithm>\r\n"]
[408.402641, "o", "                          choose a diff algorithm\r\n"]
[408.440382, "o", "    --anchored <text>     generate diff using the \"anchored diff\" algorithm\r\n"]
[408.478122, "o", "    --word-diff[=<mode>]  show word diff, using <mode> to delimit changed words\r\n"]
[408.515863, "o", "    --word-diff-regex <regex>\r\n"]
[408.553603, "o", "                          use <regex> to decide what a word is\r\n"]
[408.591344, "o", "    --color-words[=<regex>]\r\n"]
[408.629084, "o", "                          equivalent to --word-diff=color --word-diff-regex=<regex>\r\n"]
[408.666824, "o", "    --[no-]color-moved[=<mode>]\r\n"]
[408.704565, "o", "                          moved lines of code are colored differently\r\n"]
[408.742305, "o", "    --[no-]color-moved-ws <mode>\r\n"]
[408.780046, "o", "                          how white spaces are ignored in --color-moved\r\n"]
[408.817786, "o", "\r\n"]
[408.855527, "o", "Other diff options\r\n"]
[408.893267, "o", "    --[no-]relative[=<prefix>]\r\n"]
[408.931008, "o", "                          when run from subdir, exclude changes outside and show relative paths\r\n"]
[408.968748, "o", "    -a, --[no-]text       treat all files as text\r\n"]
[409.006489, "o", "    -R                    swap two inputs, reverse the diff\r\n"]
[409.044229, "o", "    --[no-]exit-code      exit with 1 if there were differences, 0 otherwise\r\n"]
[409.081969, "o", "    --[no-]quiet          disable all output of the program\r\n"]
[409.11971, "o", "    --[no-]ext-diff       allow an external diff helper to be executed\r\n"]
[409.15745, "o", "    --[no-]textconv       run external text conversion filters when comparing binary files\r\n"]
[409.195191, "o", "    --ignore-submodules[=<when>]\r\n"]
[409.232931, "o", "                          ignore changes to submodules in the diff generation\r\n"]
[409.270672, "o", "    --submodule[=<format>]\r\n"]
[409.308412, "o", "                          specify how differences in submodules are shown\r\n"]
[409.346153, "o", "    --ita-invisible-in-index\r\n"]
[409.383893, "o", "                          hide 'git add -N' entries from the index\r\n"]
[409.421634, "o", "    --ita-visible-in-index\r\n"]
[409.459374, "o", "                          treat 'git add -N' entries as real in the index\r\n"]
[409.497115, "o", "    -S <string>           look for differences that change the number of occurrences of the specified string\r\n"]
[409.534855, "o", "    -G <regex>            look for differences that change the number of occurrences of the specified regex\r\n"]
[409.572595, "o", "    --pickaxe-all         show all changes in the changeset with -S or -G\r\n"]
[409.610336, "o", "    --pickaxe-regex       treat <string> in -S as extended POSIX regular expression\r\n"]
[409.648076, "o", "    -O <file>             control the order in which files appear in the output\r\n"]
[409.685817, "o", "    --rotate-to <path>    show the change in the specified path first\r\n"]
[409.723557, "o", "    --skip-to <path>      skip the output to the specified path\r\n"]
[409.761298, "o", "    --find-object <object-id>\r\n"]
[409.799038, "o", "                          look for differences that change the number of occurrences of the specified object\r\n"]
[409.836779, "o", "    --diff-filter [(A|C|D|M|R|T|U|X|B)...[*]]\r\n"]
[409.874519, "o", "                          select files by diff type\r\n"]
[409.91226, "o", "    --output <file>       output to a specific file\r\n"]
[410.0, "o", "(asv_3.10) root@89c02398194d:/workspace# "]
[410.002, "i", "git add pandas/core/computation/expressions.py\r"]
[410.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[412.478, "o", "\u001b[?2004l\r\n"]
[415.0, "o", "(asv_3.10) root@89c02398194d:/workspace# "]
[415.002, "i", "git commit -m \"perf(expressions): reduce numexpr overhead by raising size threshold for use; improves arithmetic.Ops.*\" \r"]
[415.004, "o", "git commit -m \"perf(expressions): reduce numexpr overhead by raising size threshold for use; improves arithmetic.Ops.*\" \r\n"]
[420.0, "o", "\u001bM(asv_3.10) root@89c02398194d:/workspace# "]
[420.002, "i", "git commit -m \"perf(expressions): reduce numexpr overhead by raising size threshold for use; improves arithmetic.Ops.*\u001b[K\"\r"]
[420.004, "o", "git commit -m \"perf(expressions): reduce numexpr overhead by raising size threshold for use; improves arithmetic.Ops.*\u001b[K\"\r\n"]
[422.478, "o", "\u001b[?2004l\r\n"]
[425.0, "o", "(asv_3.10) root@89c02398194d:/workspace# "]
[425.002, "i", "cd asv_bench\r"]
[425.004, "o", "cd asv_bench\r\n"]
[427.478, "o", "\u001b[?2004l\r\n"]
[430.0, "o", "(asv_3.10) root@89c02398194d:/workspace# "]
[430.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[430.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[432.478, "o", "\u001b[?2004l\r\n"]
[435.0, "o", "(asv_3.10) root@89c02398194d:/workspace# "]
[435.002, "i", "cd /workspace/repo\r"]
[435.004, "o", "cd /workspace/repo\r\n"]
[435.006, "o", "\u001b[?2004l\r\n"]
[440.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[440.002, "i", "git status -sb\r"]
[440.004, "o", "git status -sb\r\n"]
[441.654, "o", "\u001b[?2004l\r\n"]
[443.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[445.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[445.002, "i", "grep -n \"MIN_ELEMENTS\\|_MIN_ELEMENTS\\|should_use_numexpr\" pandas/core/computation/expressions.py\r"]
[445.004, "o", "grep -n \"MIN_ELEMENTS\\|_MIN_ELEMENTS\\|should_use_numexpr\" pandas/core/computation/expressions.py\r\n"]
[446.654, "o", "\u001b[?2004l\r\n"]
[448.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[450.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[450.002, "i", "sed -n '1,280p' pandas/core/computation/expressions.py\r"]
[450.004, "o", "sed -n '1,280p' pandas/core/computation/expressions.py\r\n"]
[450.023594, "o", "\u001b[?2004l\r\n"]
[450.041189, "o", "\"\"\"\r\n"]
[450.058783, "o", "Expressions\r\n"]
[450.076377, "o", "-----------\r\n"]
[450.093972, "o", "\r\n"]
[450.111566, "o", "Offer fast expression evaluation through numexpr\r\n"]
[450.12916, "o", "\r\n"]
[450.146754, "o", "\"\"\"\r\n"]
[450.164349, "o", "\r\n"]
[450.181943, "o", "from __future__ import annotations\r\n"]
[450.199537, "o", "\r\n"]
[450.217132, "o", "import operator\r\n"]
[450.234726, "o", "from typing import TYPE_CHECKING\r\n"]
[450.25232, "o", "import warnings\r\n"]
[450.269915, "o", "\r\n"]
[450.287509, "o", "import numpy as np\r\n"]
[450.305103, "o", "\r\n"]
[450.322698, "o", "from pandas._config import get_option\r\n"]
[450.340292, "o", "\r\n"]
[450.357886, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[450.37548, "o", "\r\n"]
[450.393075, "o", "from pandas.core import roperator\r\n"]
[450.410669, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[450.428263, "o", "\r\n"]
[450.445858, "o", "if NUMEXPR_INSTALLED:\r\n"]
[450.463452, "o", "    import numexpr as ne\r\n"]
[450.481046, "o", "\r\n"]
[450.498641, "o", "if TYPE_CHECKING:\r\n"]
[450.516235, "o", "    from pandas._typing import FuncType\r\n"]
[450.533829, "o", "\r\n"]
[450.551423, "o", "_TEST_MODE: bool | None = None\r\n"]
[450.569018, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[450.586612, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[450.604206, "o", "_evaluate: FuncType | None = None\r\n"]
[450.621801, "o", "_where: FuncType | None = None\r\n"]
[450.639395, "o", "\r\n"]
[450.656989, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[450.674584, "o", "_ALLOWED_DTYPES = {\r\n"]
[450.692178, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[450.709772, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[450.727367, "o", "}\r\n"]
[450.744961, "o", "\r\n"]
[450.762555, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[450.780149, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[450.797744, "o", "\r\n"]
[450.815338, "o", "\r\n"]
[450.832932, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[450.850527, "o", "    # set/unset to use numexpr\r\n"]
[450.868121, "o", "    global USE_NUMEXPR\r\n"]
[450.885715, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[450.90331, "o", "        USE_NUMEXPR = v\r\n"]
[450.920904, "o", "\r\n"]
[450.938498, "o", "    # choose what we are going to do\r\n"]
[450.956093, "o", "    global _evaluate, _where\r\n"]
[450.973687, "o", "\r\n"]
[450.991281, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[451.008875, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[451.02647, "o", "\r\n"]
[451.044064, "o", "\r\n"]
[451.061658, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[451.079253, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[451.096847, "o", "    # otherwise reset\r\n"]
[451.114441, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[451.132036, "o", "        if n is None:\r\n"]
[451.14963, "o", "            n = ne.detect_number_of_cores()\r\n"]
[451.167224, "o", "        ne.set_num_threads(n)\r\n"]
[451.184819, "o", "\r\n"]
[451.202413, "o", "\r\n"]
[451.220007, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[451.237601, "o", "    \"\"\"\r\n"]
[451.255196, "o", "    Standard evaluation.\r\n"]
[451.27279, "o", "    \"\"\"\r\n"]
[451.290384, "o", "    if _TEST_MODE:\r\n"]
[451.307979, "o", "        _store_test_result(False)\r\n"]
[451.325573, "o", "    return op(left_op, right_op)\r\n"]
[451.343167, "o", "\r\n"]
[451.360762, "o", "\r\n"]
[451.378356, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[451.39595, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[451.413544, "o", "    if op_str is not None:\r\n"]
[451.431139, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[451.448733, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[451.466327, "o", "            # check for dtype compatibility\r\n"]
[451.483922, "o", "            dtypes: set[str] = set()\r\n"]
[451.501516, "o", "            for o in [left_op, right_op]:\r\n"]
[451.51911, "o", "                # ndarray and Series Case\r\n"]
[451.536705, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[451.554299, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[451.571893, "o", "\r\n"]
[451.589488, "o", "            # allowed are a superset\r\n"]
[451.607082, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[451.624676, "o", "                return True\r\n"]
[451.64227, "o", "\r\n"]
[451.659865, "o", "    return False\r\n"]
[451.677459, "o", "\r\n"]
[451.695053, "o", "\r\n"]
[451.712648, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[451.730242, "o", "    result = None\r\n"]
[451.747836, "o", "\r\n"]
[451.765431, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[451.783025, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[451.800619, "o", "        if is_reversed:\r\n"]
[451.818214, "o", "            # we were originally called by a reversed op method\r\n"]
[451.835808, "o", "            left_op, right_op = right_op, left_op\r\n"]
[451.853402, "o", "\r\n"]
[451.870996, "o", "        left_value = left_op\r\n"]
[451.888591, "o", "        right_value = right_op\r\n"]
[451.906185, "o", "\r\n"]
[451.923779, "o", "        try:\r\n"]
[451.941374, "o", "            result = ne.evaluate(\r\n"]
[451.958968, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[451.976562, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[451.994157, "o", "                casting=\"safe\",\r\n"]
[452.011751, "o", "            )\r\n"]
[452.029345, "o", "        except TypeError:\r\n"]
[452.04694, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[452.064534, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[452.082128, "o", "            pass\r\n"]
[452.099722, "o", "        except NotImplementedError:\r\n"]
[452.117317, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[452.134911, "o", "                pass\r\n"]
[452.152505, "o", "            else:\r\n"]
[452.1701, "o", "                raise\r\n"]
[452.187694, "o", "\r\n"]
[452.205288, "o", "        if is_reversed:\r\n"]
[452.222883, "o", "            # reverse order to original for fallback\r\n"]
[452.240477, "o", "            left_op, right_op = right_op, left_op\r\n"]
[452.258071, "o", "\r\n"]
[452.275665, "o", "    if _TEST_MODE:\r\n"]
[452.29326, "o", "        _store_test_result(result is not None)\r\n"]
[452.310854, "o", "\r\n"]
[452.328448, "o", "    if result is None:\r\n"]
[452.346043, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[452.363637, "o", "\r\n"]
[452.381231, "o", "    return result\r\n"]
[452.398826, "o", "\r\n"]
[452.41642, "o", "\r\n"]
[452.434014, "o", "_op_str_mapping = {\r\n"]
[452.451609, "o", "    operator.add: \"+\",\r\n"]
[452.469203, "o", "    roperator.radd: \"+\",\r\n"]
[452.486797, "o", "    operator.mul: \"*\",\r\n"]
[452.504391, "o", "    roperator.rmul: \"*\",\r\n"]
[452.521986, "o", "    operator.sub: \"-\",\r\n"]
[452.53958, "o", "    roperator.rsub: \"-\",\r\n"]
[452.557174, "o", "    operator.truediv: \"/\",\r\n"]
[452.574769, "o", "    roperator.rtruediv: \"/\",\r\n"]
[452.592363, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[452.609957, "o", "    operator.floordiv: None,\r\n"]
[452.627552, "o", "    roperator.rfloordiv: None,\r\n"]
[452.645146, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[452.66274, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[452.680335, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[452.697929, "o", "    operator.mod: None,\r\n"]
[452.715523, "o", "    roperator.rmod: None,\r\n"]
[452.733117, "o", "    operator.pow: \"**\",\r\n"]
[452.750712, "o", "    roperator.rpow: \"**\",\r\n"]
[452.768306, "o", "    operator.eq: \"==\",\r\n"]
[452.7859, "o", "    operator.ne: \"!=\",\r\n"]
[452.803495, "o", "    operator.le: \"<=\",\r\n"]
[452.821089, "o", "    operator.lt: \"<\",\r\n"]
[452.838683, "o", "    operator.ge: \">=\",\r\n"]
[452.856278, "o", "    operator.gt: \">\",\r\n"]
[452.873872, "o", "    operator.and_: \"&\",\r\n"]
[452.891466, "o", "    roperator.rand_: \"&\",\r\n"]
[452.90906, "o", "    operator.or_: \"|\",\r\n"]
[452.926655, "o", "    roperator.ror_: \"|\",\r\n"]
[452.944249, "o", "    operator.xor: \"^\",\r\n"]
[452.961843, "o", "    roperator.rxor: \"^\",\r\n"]
[452.979438, "o", "    divmod: None,\r\n"]
[452.997032, "o", "    roperator.rdivmod: None,\r\n"]
[453.014626, "o", "}\r\n"]
[453.032221, "o", "\r\n"]
[453.049815, "o", "\r\n"]
[453.067409, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[453.085004, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[453.102598, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[453.120192, "o", "\r\n"]
[453.137786, "o", "\r\n"]
[453.155381, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[453.172975, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[453.190569, "o", "    result = None\r\n"]
[453.208164, "o", "\r\n"]
[453.225758, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[453.243352, "o", "        result = ne.evaluate(\r\n"]
[453.260947, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[453.278541, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[453.296135, "o", "            casting=\"safe\",\r\n"]
[453.31373, "o", "        )\r\n"]
[453.331324, "o", "\r\n"]
[453.348918, "o", "    if result is None:\r\n"]
[453.366512, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[453.384107, "o", "\r\n"]
[453.401701, "o", "    return result\r\n"]
[453.419295, "o", "\r\n"]
[453.43689, "o", "\r\n"]
[453.454484, "o", "# turn myself on\r\n"]
[453.472078, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[453.489673, "o", "\r\n"]
[453.507267, "o", "\r\n"]
[453.524861, "o", "def _has_bool_dtype(x):\r\n"]
[453.542456, "o", "    try:\r\n"]
[453.56005, "o", "        return x.dtype == bool\r\n"]
[453.577644, "o", "    except AttributeError:\r\n"]
[453.595238, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[453.612833, "o", "\r\n"]
[453.630427, "o", "\r\n"]
[453.648021, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[453.665616, "o", "\r\n"]
[453.68321, "o", "\r\n"]
[453.700804, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[453.718399, "o", "    \"\"\"\r\n"]
[453.735993, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[453.753587, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[453.771181, "o", "    boolean ops.\r\n"]
[453.788776, "o", "    \"\"\"\r\n"]
[453.80637, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[453.823964, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[453.841559, "o", "            warnings.warn(\r\n"]
[453.859153, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[453.876747, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[453.894342, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[453.911936, "o", "                stacklevel=find_stack_level(),\r\n"]
[453.92953, "o", "            )\r\n"]
[453.947125, "o", "            return True\r\n"]
[453.964719, "o", "    return False\r\n"]
[453.982313, "o", "\r\n"]
[453.999907, "o", "\r\n"]
[454.017502, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[454.035096, "o", "    \"\"\"\r\n"]
[454.05269, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[454.070285, "o", "\r\n"]
[454.087879, "o", "    Parameters\r\n"]
[454.105473, "o", "    ----------\r\n"]
[454.123068, "o", "    op : the actual operand\r\n"]
[454.140662, "o", "    left_op : left operand\r\n"]
[454.158256, "o", "    right_op : right operand\r\n"]
[454.175851, "o", "    use_numexpr : bool, default True\r\n"]
[454.193445, "o", "        Whether to try to use numexpr.\r\n"]
[454.211039, "o", "    \"\"\"\r\n"]
[454.228633, "o", "    op_str = _op_str_mapping[op]\r\n"]
[454.246228, "o", "    if op_str is not None:\r\n"]
[454.263822, "o", "        if use_numexpr:\r\n"]
[454.281416, "o", "            # error: \"None\" not callable\r\n"]
[454.299011, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[454.316605, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[454.334199, "o", "\r\n"]
[454.351794, "o", "\r\n"]
[454.369388, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[454.386982, "o", "    \"\"\"\r\n"]
[454.404577, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[454.422171, "o", "\r\n"]
[454.439765, "o", "    Parameters\r\n"]
[454.457359, "o", "    ----------\r\n"]
[454.474954, "o", "    cond : np.ndarray[bool]\r\n"]
[454.492548, "o", "    left_op : return if cond is True\r\n"]
[454.510142, "o", "    right_op : return if cond is False\r\n"]
[454.527737, "o", "    use_numexpr : bool, default True\r\n"]
[454.545331, "o", "        Whether to try to use numexpr.\r\n"]
[454.562925, "o", "    \"\"\"\r\n"]
[454.58052, "o", "    assert _where is not None\r\n"]
[454.598114, "o", "    if use_numexpr:\r\n"]
[454.615708, "o", "        return _where(cond, left_op, right_op)\r\n"]
[454.633302, "o", "    else:\r\n"]
[454.650897, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[454.668491, "o", "\r\n"]
[454.686085, "o", "\r\n"]
[454.70368, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[454.721274, "o", "    \"\"\"\r\n"]
[454.738868, "o", "    Keeps track of whether numexpr was used.\r\n"]
[454.756463, "o", "\r\n"]
[454.774057, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[454.791651, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[454.809246, "o", "    \"\"\"\r\n"]
[454.82684, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[454.844434, "o", "    _TEST_MODE = v\r\n"]
[454.862028, "o", "    _TEST_RESULT = []\r\n"]
[454.879623, "o", "\r\n"]
[454.897217, "o", "\r\n"]
[454.914811, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[454.932406, "o", "    if used_numexpr:\r\n"]
[455.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[455.002, "i", "python - << 'PY'\r"]
[455.004, "o", "python - << 'PY'\r\n"]
[455.071053, "o", "\u001b[?2004l\r\n"]
[455.136105, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[455.201158, "o", "\u001b[?2004l\r\n"]
[455.266211, "o", "\u001b[?2004h> import re\r\n"]
[455.331263, "o", "\u001b[?2004l\r\n"]
[455.396316, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[455.461368, "o", "\u001b[?2004l\r\n"]
[455.526421, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[455.591474, "o", "\u001b[?2004l\r\n"]
[455.656526, "o", "\u001b[?2004h> changed = False\r\n"]
[455.721579, "o", "\u001b[?2004l\r\n"]
[455.786632, "o", "\u001b[?2004h> # First try to bump an existing threshold constant\r\n"]
[455.851684, "o", "\u001b[?2004l\r\n"]
[455.916737, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[455.981789, "o", "\u001b[?2004l\r\n"]
[456.046842, "o", "\u001b[?2004h> if n == 0:\r\n"]
[456.111895, "o", "\u001b[?2004l\r\n"]
[456.176947, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[456.242, "o", "\u001b[?2004l\r\n"]
[456.307053, "o", "\u001b[?2004h> if n > 0:\r\n"]
[456.372105, "o", "\u001b[?2004l\r\n"]
[456.437158, "o", "\u001b[?2004h>     src = new_src\r\n"]
[456.502211, "o", "\u001b[?2004l\r\n"]
[456.567263, "o", "\u001b[?2004h>     changed = True\r\n"]
[456.632316, "o", "\u001b[?2004l\r\n"]
[456.697368, "o", "\u001b[?2004h> else:\r\n"]
[456.762421, "o", "\u001b[?2004l\r\n"]
[456.827474, "o", "\u001b[?2004h>     # Patch should_use_numexpr to early-bail for moderate sizes\r\n"]
[456.892526, "o", "\u001b[?2004l\r\n"]
[456.957579, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[457.022632, "o", "\u001b[?2004l\r\n"]
[457.087684, "o", "\u001b[?2004h>     if m:\r\n"]
[457.152737, "o", "\u001b[?2004l\r\n"]
[457.217789, "o", "\u001b[?2004h>         start = m.end()\r\n"]
[457.282842, "o", "\u001b[?2004l\r\n"]
[457.347895, "o", "\u001b[?2004h>         # Only inject once; guard by a marker\r\n"]
[457.412947, "o", "\u001b[?2004l\r\n"]
[457.478, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[start:start+400]:\r\n"]
[457.543053, "o", "\u001b[?2004l\r\n"]
[457.608105, "o", "\u001b[?2004h>             inject = (\r\n"]
[457.673158, "o", "\u001b[?2004l\r\n"]
[457.738211, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[457.803263, "o", "\u001b[?2004l\r\n"]
[457.868316, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[457.933368, "o", "\u001b[?2004l\r\n"]
[457.998421, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[458.063474, "o", "\u001b[?2004l\r\n"]
[458.128526, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[458.193579, "o", "\u001b[?2004l\r\n"]
[458.258632, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[458.323684, "o", "\u001b[?2004l\r\n"]
[458.388737, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[458.453789, "o", "\u001b[?2004l\r\n"]
[458.518842, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[458.583895, "o", "\u001b[?2004l\r\n"]
[458.648947, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[458.714, "o", "\u001b[?2004l\r\n"]
[458.779053, "o", "\u001b[?2004h>             )\r\n"]
[458.844105, "o", "\u001b[?2004l\r\n"]
[458.909158, "o", "\u001b[?2004h>             src = src[:start] + inject + src[start:]\r\n"]
[458.974211, "o", "\u001b[?2004l\r\n"]
[459.039263, "o", "\u001b[?2004h>             changed = True\r\n"]
[459.104316, "o", "\u001b[?2004l\r\n"]
[459.169368, "o", "\u001b[?2004h> if changed:\r\n"]
[459.234421, "o", "\u001b[?2004l\r\n"]
[459.299474, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[459.364526, "o", "\u001b[?2004l\r\n"]
[459.429579, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[459.494632, "o", "\u001b[?2004l\r\n"]
[459.559684, "o", "\u001b[?2004h> else:\r\n"]
[459.624737, "o", "\u001b[?2004l\r\n"]
[459.689789, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[459.754842, "o", "\u001b[?2004l\r\n"]
[459.819895, "o", "\u001b[?2004h> PY\r\n"]
[459.884947, "o", "\u001b[?2004l\r\n"]
[460.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[460.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[460.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[460.006, "o", "\u001b[?2004l\r\n"]
[465.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[465.002, "i", "git add pandas/core/computation/expressions.py\r"]
[465.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[465.006, "o", "\u001b[?2004l\r\n"]
[470.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[470.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops by raising threshold/early check; improves \r"]
[470.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops by raising threshold/early check; improves \r\n"]
[470.624, "o", " arithmetic.Ops.* benchmarks\"\r\n"]
[471.242, "o", "\u001b[?2004l\r\n"]
[471.86, "o", "On branch main\r\n"]
[472.478, "o", "Untracked files:\r\n"]
[473.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[473.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[474.332, "o", "\r\n"]
[475.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[475.002, "i", "cd asv_bench\r"]
[475.004, "o", "cd asv_bench\r\n"]
[475.006, "o", "\u001b[?2004l\r\n"]
[480.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[480.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[480.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[480.097556, "o", "\u001b[?2004l\r\n"]
[480.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[480.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[480.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[480.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[480.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[480.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[480.738444, "o", "             --                      threads          \r\n"]
[480.83, "o", "             ------------- ---------------------------\r\n"]
[480.921556, "o", "              use_numexpr     default          1      \r\n"]
[481.013111, "o", "             ============= ============= =============\r\n"]
[481.104667, "o", "                  True      2.01\u00b10.06ms   1.99\u00b10.03ms \r\n"]
[481.196222, "o", "                 False      1.97\u00b10.01ms   2.00\u00b10.02ms \r\n"]
[481.287778, "o", "             ============= ============= =============\r\n"]
[481.379333, "o", "\r\n"]
[481.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[481.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[481.654, "o", "             --                      threads          \r\n"]
[481.745556, "o", "             ------------- ---------------------------\r\n"]
[481.837111, "o", "              use_numexpr     default          1      \r\n"]
[481.928667, "o", "             ============= ============= =============\r\n"]
[482.020222, "o", "                  True      1.64\u00b10.04ms   1.66\u00b10.05ms \r\n"]
[482.111778, "o", "                 False      1.63\u00b10.03ms   1.65\u00b10.03ms \r\n"]
[482.203333, "o", "             ============= ============= =============\r\n"]
[482.294889, "o", "\r\n"]
[482.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[482.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[482.569556, "o", "             --                      threads          \r\n"]
[482.661111, "o", "             ------------- ---------------------------\r\n"]
[482.752667, "o", "              use_numexpr     default          1      \r\n"]
[482.844222, "o", "             ============= ============= =============\r\n"]
[482.935778, "o", "                  True      1.98\u00b10.05ms   1.98\u00b10.02ms \r\n"]
[483.027333, "o", "                 False      1.97\u00b10.03ms   2.02\u00b10.03ms \r\n"]
[483.118889, "o", "             ============= ============= =============\r\n"]
[483.210444, "o", "\r\n"]
[483.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[483.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[483.485111, "o", "             --                      threads          \r\n"]
[483.576667, "o", "             ------------- ---------------------------\r\n"]
[483.668222, "o", "              use_numexpr     default          1      \r\n"]
[483.759778, "o", "             ============= ============= =============\r\n"]
[483.851333, "o", "                  True      9.78\u00b10.05ms   9.77\u00b10.05ms \r\n"]
[483.942889, "o", "                 False      9.85\u00b10.06ms    9.89\u00b10.1ms \r\n"]
[484.034444, "o", "             ============= ============= =============\r\n"]
[484.126, "o", "\r\n"]
[484.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          44.7\u00b10.2ms\r\n"]
[484.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.2\u00b10.02ms\r\n"]
[484.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              621\u00b110\u03bcs\r\n"]
[484.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                         18.9\u00b10.09ms\r\n"]
[484.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.5\u00b10.02ms\r\n"]
[484.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.30\u00b10.02ms\r\n"]
[484.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.3\u00b10.02ms\r\n"]
[484.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      414\u00b13\u03bcs\r\n"]
[485.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[485.002, "i", "cd ..\r"]
[485.004, "o", "cd ..\r\n"]
[485.006, "o", "\u001b[?2004l\r\n"]
[490.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[490.002, "i", "git status -sb\r"]
[490.004, "o", "git status -sb\r\n"]
[491.654, "o", "\u001b[?2004l\r\n"]
[493.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[495.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[495.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r"]
[495.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r\n"]
[496.654, "o", "\u001b[?2004l\r\n"]
[498.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[500.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[500.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py\r"]
[500.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py\r\n"]
[500.024943, "o", "\u001b[?2004l\r\n"]
[500.043885, "o", "\"\"\"\r\n"]
[500.062828, "o", "Expressions\r\n"]
[500.08177, "o", "-----------\r\n"]
[500.100713, "o", "\r\n"]
[500.119655, "o", "Offer fast expression evaluation through numexpr\r\n"]
[500.138598, "o", "\r\n"]
[500.15754, "o", "\"\"\"\r\n"]
[500.176483, "o", "\r\n"]
[500.195425, "o", "from __future__ import annotations\r\n"]
[500.214368, "o", "\r\n"]
[500.23331, "o", "import operator\r\n"]
[500.252253, "o", "from typing import TYPE_CHECKING\r\n"]
[500.271195, "o", "import warnings\r\n"]
[500.290138, "o", "\r\n"]
[500.30908, "o", "import numpy as np\r\n"]
[500.328023, "o", "\r\n"]
[500.346966, "o", "from pandas._config import get_option\r\n"]
[500.365908, "o", "\r\n"]
[500.384851, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[500.403793, "o", "\r\n"]
[500.422736, "o", "from pandas.core import roperator\r\n"]
[500.441678, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[500.460621, "o", "\r\n"]
[500.479563, "o", "if NUMEXPR_INSTALLED:\r\n"]
[500.498506, "o", "    import numexpr as ne\r\n"]
[500.517448, "o", "\r\n"]
[500.536391, "o", "if TYPE_CHECKING:\r\n"]
[500.555333, "o", "    from pandas._typing import FuncType\r\n"]
[500.574276, "o", "\r\n"]
[500.593218, "o", "_TEST_MODE: bool | None = None\r\n"]
[500.612161, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[500.631103, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[500.650046, "o", "_evaluate: FuncType | None = None\r\n"]
[500.668989, "o", "_where: FuncType | None = None\r\n"]
[500.687931, "o", "\r\n"]
[500.706874, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[500.725816, "o", "_ALLOWED_DTYPES = {\r\n"]
[500.744759, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[500.763701, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[500.782644, "o", "}\r\n"]
[500.801586, "o", "\r\n"]
[500.820529, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[500.839471, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[500.858414, "o", "\r\n"]
[500.877356, "o", "\r\n"]
[500.896299, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[500.915241, "o", "    # set/unset to use numexpr\r\n"]
[500.934184, "o", "    global USE_NUMEXPR\r\n"]
[500.953126, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[500.972069, "o", "        USE_NUMEXPR = v\r\n"]
[500.991011, "o", "\r\n"]
[501.009954, "o", "    # choose what we are going to do\r\n"]
[501.028897, "o", "    global _evaluate, _where\r\n"]
[501.047839, "o", "\r\n"]
[501.066782, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[501.085724, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[501.104667, "o", "\r\n"]
[501.123609, "o", "\r\n"]
[501.142552, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[501.161494, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[501.180437, "o", "    # otherwise reset\r\n"]
[501.199379, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[501.218322, "o", "        if n is None:\r\n"]
[501.237264, "o", "            n = ne.detect_number_of_cores()\r\n"]
[501.256207, "o", "        ne.set_num_threads(n)\r\n"]
[501.275149, "o", "\r\n"]
[501.294092, "o", "\r\n"]
[501.313034, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[501.331977, "o", "    \"\"\"\r\n"]
[501.35092, "o", "    Standard evaluation.\r\n"]
[501.369862, "o", "    \"\"\"\r\n"]
[501.388805, "o", "    if _TEST_MODE:\r\n"]
[501.407747, "o", "        _store_test_result(False)\r\n"]
[501.42669, "o", "    return op(left_op, right_op)\r\n"]
[501.445632, "o", "\r\n"]
[501.464575, "o", "\r\n"]
[501.483517, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[501.50246, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[501.521402, "o", "    if op_str is not None:\r\n"]
[501.540345, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[501.559287, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[501.57823, "o", "            # check for dtype compatibility\r\n"]
[501.597172, "o", "            dtypes: set[str] = set()\r\n"]
[501.616115, "o", "            for o in [left_op, right_op]:\r\n"]
[501.635057, "o", "                # ndarray and Series Case\r\n"]
[501.654, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[501.672943, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[501.691885, "o", "\r\n"]
[501.710828, "o", "            # allowed are a superset\r\n"]
[501.72977, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[501.748713, "o", "                return True\r\n"]
[501.767655, "o", "\r\n"]
[501.786598, "o", "    return False\r\n"]
[501.80554, "o", "\r\n"]
[501.824483, "o", "\r\n"]
[501.843425, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[501.862368, "o", "    result = None\r\n"]
[501.88131, "o", "\r\n"]
[501.900253, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[501.919195, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[501.938138, "o", "        if is_reversed:\r\n"]
[501.95708, "o", "            # we were originally called by a reversed op method\r\n"]
[501.976023, "o", "            left_op, right_op = right_op, left_op\r\n"]
[501.994966, "o", "\r\n"]
[502.013908, "o", "        left_value = left_op\r\n"]
[502.032851, "o", "        right_value = right_op\r\n"]
[502.051793, "o", "\r\n"]
[502.070736, "o", "        try:\r\n"]
[502.089678, "o", "            result = ne.evaluate(\r\n"]
[502.108621, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[502.127563, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[502.146506, "o", "                casting=\"safe\",\r\n"]
[502.165448, "o", "            )\r\n"]
[502.184391, "o", "        except TypeError:\r\n"]
[502.203333, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[502.222276, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[502.241218, "o", "            pass\r\n"]
[502.260161, "o", "        except NotImplementedError:\r\n"]
[502.279103, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[502.298046, "o", "                pass\r\n"]
[502.316989, "o", "            else:\r\n"]
[502.335931, "o", "                raise\r\n"]
[502.354874, "o", "\r\n"]
[502.373816, "o", "        if is_reversed:\r\n"]
[502.392759, "o", "            # reverse order to original for fallback\r\n"]
[502.411701, "o", "            left_op, right_op = right_op, left_op\r\n"]
[502.430644, "o", "\r\n"]
[502.449586, "o", "    if _TEST_MODE:\r\n"]
[502.468529, "o", "        _store_test_result(result is not None)\r\n"]
[502.487471, "o", "\r\n"]
[502.506414, "o", "    if result is None:\r\n"]
[502.525356, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[502.544299, "o", "\r\n"]
[502.563241, "o", "    return result\r\n"]
[502.582184, "o", "\r\n"]
[502.601126, "o", "\r\n"]
[502.620069, "o", "_op_str_mapping = {\r\n"]
[502.639011, "o", "    operator.add: \"+\",\r\n"]
[502.657954, "o", "    roperator.radd: \"+\",\r\n"]
[502.676897, "o", "    operator.mul: \"*\",\r\n"]
[502.695839, "o", "    roperator.rmul: \"*\",\r\n"]
[502.714782, "o", "    operator.sub: \"-\",\r\n"]
[502.733724, "o", "    roperator.rsub: \"-\",\r\n"]
[502.752667, "o", "    operator.truediv: \"/\",\r\n"]
[502.771609, "o", "    roperator.rtruediv: \"/\",\r\n"]
[502.790552, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[502.809494, "o", "    operator.floordiv: None,\r\n"]
[502.828437, "o", "    roperator.rfloordiv: None,\r\n"]
[502.847379, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[502.866322, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[502.885264, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[502.904207, "o", "    operator.mod: None,\r\n"]
[502.923149, "o", "    roperator.rmod: None,\r\n"]
[502.942092, "o", "    operator.pow: \"**\",\r\n"]
[502.961034, "o", "    roperator.rpow: \"**\",\r\n"]
[502.979977, "o", "    operator.eq: \"==\",\r\n"]
[502.99892, "o", "    operator.ne: \"!=\",\r\n"]
[503.017862, "o", "    operator.le: \"<=\",\r\n"]
[503.036805, "o", "    operator.lt: \"<\",\r\n"]
[503.055747, "o", "    operator.ge: \">=\",\r\n"]
[503.07469, "o", "    operator.gt: \">\",\r\n"]
[503.093632, "o", "    operator.and_: \"&\",\r\n"]
[503.112575, "o", "    roperator.rand_: \"&\",\r\n"]
[503.131517, "o", "    operator.or_: \"|\",\r\n"]
[503.15046, "o", "    roperator.ror_: \"|\",\r\n"]
[503.169402, "o", "    operator.xor: \"^\",\r\n"]
[503.188345, "o", "    roperator.rxor: \"^\",\r\n"]
[503.207287, "o", "    divmod: None,\r\n"]
[503.22623, "o", "    roperator.rdivmod: None,\r\n"]
[503.245172, "o", "}\r\n"]
[503.264115, "o", "\r\n"]
[503.283057, "o", "\r\n"]
[503.302, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[503.320943, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[503.339885, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[503.358828, "o", "\r\n"]
[503.37777, "o", "\r\n"]
[503.396713, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[503.415655, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[503.434598, "o", "    result = None\r\n"]
[503.45354, "o", "\r\n"]
[503.472483, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[503.491425, "o", "        result = ne.evaluate(\r\n"]
[503.510368, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[503.52931, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[503.548253, "o", "            casting=\"safe\",\r\n"]
[503.567195, "o", "        )\r\n"]
[503.586138, "o", "\r\n"]
[503.60508, "o", "    if result is None:\r\n"]
[503.624023, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[503.642966, "o", "\r\n"]
[503.661908, "o", "    return result\r\n"]
[503.680851, "o", "\r\n"]
[503.699793, "o", "\r\n"]
[503.718736, "o", "# turn myself on\r\n"]
[503.737678, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[503.756621, "o", "\r\n"]
[503.775563, "o", "\r\n"]
[503.794506, "o", "def _has_bool_dtype(x):\r\n"]
[503.813448, "o", "    try:\r\n"]
[503.832391, "o", "        return x.dtype == bool\r\n"]
[503.851333, "o", "    except AttributeError:\r\n"]
[503.870276, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[503.889218, "o", "\r\n"]
[503.908161, "o", "\r\n"]
[503.927103, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[503.946046, "o", "\r\n"]
[503.964989, "o", "\r\n"]
[503.983931, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[504.002874, "o", "    \"\"\"\r\n"]
[504.021816, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[504.040759, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[504.059701, "o", "    boolean ops.\r\n"]
[504.078644, "o", "    \"\"\"\r\n"]
[504.097586, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[504.116529, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[504.135471, "o", "            warnings.warn(\r\n"]
[504.154414, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[504.173356, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[504.192299, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[504.211241, "o", "                stacklevel=find_stack_level(),\r\n"]
[504.230184, "o", "            )\r\n"]
[504.249126, "o", "            return True\r\n"]
[504.268069, "o", "    return False\r\n"]
[504.287011, "o", "\r\n"]
[504.305954, "o", "\r\n"]
[504.324897, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[504.343839, "o", "    \"\"\"\r\n"]
[504.362782, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[504.381724, "o", "\r\n"]
[504.400667, "o", "    Parameters\r\n"]
[504.419609, "o", "    ----------\r\n"]
[504.438552, "o", "    op : the actual operand\r\n"]
[504.457494, "o", "    left_op : left operand\r\n"]
[504.476437, "o", "    right_op : right operand\r\n"]
[504.495379, "o", "    use_numexpr : bool, default True\r\n"]
[504.514322, "o", "        Whether to try to use numexpr.\r\n"]
[504.533264, "o", "    \"\"\"\r\n"]
[504.552207, "o", "    op_str = _op_str_mapping[op]\r\n"]
[504.571149, "o", "    if op_str is not None:\r\n"]
[504.590092, "o", "        if use_numexpr:\r\n"]
[504.609034, "o", "            # error: \"None\" not callable\r\n"]
[504.627977, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[504.64692, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[504.665862, "o", "\r\n"]
[504.684805, "o", "\r\n"]
[504.703747, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[504.72269, "o", "    \"\"\"\r\n"]
[504.741632, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[504.760575, "o", "\r\n"]
[504.779517, "o", "    Parameters\r\n"]
[504.79846, "o", "    ----------\r\n"]
[504.817402, "o", "    cond : np.ndarray[bool]\r\n"]
[504.836345, "o", "    left_op : return if cond is True\r\n"]
[504.855287, "o", "    right_op : return if cond is False\r\n"]
[504.87423, "o", "    use_numexpr : bool, default True\r\n"]
[504.893172, "o", "        Whether to try to use numexpr.\r\n"]
[504.912115, "o", "    \"\"\"\r\n"]
[504.931057, "o", "    assert _where is not None\r\n"]
[505.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[505.002, "i", "python - << 'PY'\r"]
[505.004, "o", "python - << 'PY'\r\n"]
[505.071053, "o", "\u001b[?2004l\r\n"]
[505.136105, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[505.201158, "o", "\u001b[?2004l\r\n"]
[505.266211, "o", "\u001b[?2004h> import re\r\n"]
[505.331263, "o", "\u001b[?2004l\r\n"]
[505.396316, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[505.461368, "o", "\u001b[?2004l\r\n"]
[505.526421, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[505.591474, "o", "\u001b[?2004l\r\n"]
[505.656526, "o", "\u001b[?2004h> changed = False\r\n"]
[505.721579, "o", "\u001b[?2004l\r\n"]
[505.786632, "o", "\u001b[?2004h> # Try to bump an existing threshold constant first\r\n"]
[505.851684, "o", "\u001b[?2004l\r\n"]
[505.916737, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[505.981789, "o", "\u001b[?2004l\r\n"]
[506.046842, "o", "\u001b[?2004h> if n == 0:\r\n"]
[506.111895, "o", "\u001b[?2004l\r\n"]
[506.176947, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[506.242, "o", "\u001b[?2004l\r\n"]
[506.307053, "o", "\u001b[?2004h> if n > 0:\r\n"]
[506.372105, "o", "\u001b[?2004l\r\n"]
[506.437158, "o", "\u001b[?2004h>     src = new_src\r\n"]
[506.502211, "o", "\u001b[?2004l\r\n"]
[506.567263, "o", "\u001b[?2004h>     changed = True\r\n"]
[506.632316, "o", "\u001b[?2004l\r\n"]
[506.697368, "o", "\u001b[?2004h> else:\r\n"]
[506.762421, "o", "\u001b[?2004l\r\n"]
[506.827474, "o", "\u001b[?2004h>     # Inject early return in should_use_numexpr to bypass numexpr for moderate sizes\r\n"]
[506.892526, "o", "\u001b[?2004l\r\n"]
[506.957579, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[507.022632, "o", "\u001b[?2004l\r\n"]
[507.087684, "o", "\u001b[?2004h>     if m:\r\n"]
[507.152737, "o", "\u001b[?2004l\r\n"]
[507.217789, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[507.282842, "o", "\u001b[?2004l\r\n"]
[507.347895, "o", "\u001b[?2004h>         # Avoid duplicate injection by checking a marker\r\n"]
[507.412947, "o", "\u001b[?2004l\r\n"]
[507.478, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+400]:\r\n"]
[507.543053, "o", "\u001b[?2004l\r\n"]
[507.608105, "o", "\u001b[?2004h>             inject = (\r\n"]
[507.673158, "o", "\u001b[?2004l\r\n"]
[507.738211, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[507.803263, "o", "\u001b[?2004l\r\n"]
[507.868316, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[507.933368, "o", "\u001b[?2004l\r\n"]
[507.998421, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[508.063474, "o", "\u001b[?2004l\r\n"]
[508.128526, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[508.193579, "o", "\u001b[?2004l\r\n"]
[508.258632, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[508.323684, "o", "\u001b[?2004l\r\n"]
[508.388737, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[508.453789, "o", "\u001b[?2004l\r\n"]
[508.518842, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[508.583895, "o", "\u001b[?2004l\r\n"]
[508.648947, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[508.714, "o", "\u001b[?2004l\r\n"]
[508.779053, "o", "\u001b[?2004h>             )\r\n"]
[508.844105, "o", "\u001b[?2004l\r\n"]
[508.909158, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[508.974211, "o", "\u001b[?2004l\r\n"]
[509.039263, "o", "\u001b[?2004h>             changed = True\r\n"]
[509.104316, "o", "\u001b[?2004l\r\n"]
[509.169368, "o", "\u001b[?2004h> if changed:\r\n"]
[509.234421, "o", "\u001b[?2004l\r\n"]
[509.299474, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[509.364526, "o", "\u001b[?2004l\r\n"]
[509.429579, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold/early bypass)')\r\n"]
[509.494632, "o", "\u001b[?2004l\r\n"]
[509.559684, "o", "\u001b[?2004h> else:\r\n"]
[509.624737, "o", "\u001b[?2004l\r\n"]
[509.689789, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[509.754842, "o", "\u001b[?2004l\r\n"]
[509.819895, "o", "\u001b[?2004h> PY\r\n"]
[509.884947, "o", "\u001b[?2004l\r\n"]
[510.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[510.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[510.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[510.006, "o", "\u001b[?2004l\r\n"]
[515.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[515.002, "i", "git add pandas/core/computation/expressions.py\r"]
[515.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[515.006, "o", "\u001b[?2004l\r\n"]
[520.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[520.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[520.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[520.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[521.242, "o", "\u001b[?2004l\r\n"]
[521.86, "o", "On branch main\r\n"]
[522.478, "o", "Untracked files:\r\n"]
[523.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[523.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[524.332, "o", "\r\n"]
[525.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[525.002, "i", "cd asv_bench\r"]
[525.004, "o", "cd asv_bench\r\n"]
[525.006, "o", "\u001b[?2004l\r\n"]
[530.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[530.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[530.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[530.097556, "o", "\u001b[?2004l\r\n"]
[530.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[530.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[530.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[530.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[530.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[530.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[530.738444, "o", "             --                      threads          \r\n"]
[530.83, "o", "             ------------- ---------------------------\r\n"]
[530.921556, "o", "              use_numexpr     default          1      \r\n"]
[531.013111, "o", "             ============= ============= =============\r\n"]
[531.104667, "o", "                  True      1.97\u00b10.01ms   2.03\u00b10.04ms \r\n"]
[531.196222, "o", "                 False      2.00\u00b10.02ms   2.01\u00b10.04ms \r\n"]
[531.287778, "o", "             ============= ============= =============\r\n"]
[531.379333, "o", "\r\n"]
[531.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[531.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[531.654, "o", "             --                      threads          \r\n"]
[531.745556, "o", "             ------------- ---------------------------\r\n"]
[531.837111, "o", "              use_numexpr     default          1      \r\n"]
[531.928667, "o", "             ============= ============= =============\r\n"]
[532.020222, "o", "                  True      1.62\u00b10.03ms   1.62\u00b10.01ms \r\n"]
[532.111778, "o", "                 False      1.59\u00b10.02ms   1.59\u00b10.03ms \r\n"]
[532.203333, "o", "             ============= ============= =============\r\n"]
[532.294889, "o", "\r\n"]
[532.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[532.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[532.569556, "o", "             --                      threads          \r\n"]
[532.661111, "o", "             ------------- ---------------------------\r\n"]
[532.752667, "o", "              use_numexpr     default          1      \r\n"]
[532.844222, "o", "             ============= ============= =============\r\n"]
[532.935778, "o", "                  True      2.02\u00b10.03ms   1.99\u00b10.06ms \r\n"]
[533.027333, "o", "                 False      1.97\u00b10.07ms   1.99\u00b10.02ms \r\n"]
[533.118889, "o", "             ============= ============= =============\r\n"]
[533.210444, "o", "\r\n"]
[533.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[533.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[533.485111, "o", "             --                      threads          \r\n"]
[533.576667, "o", "             ------------- ---------------------------\r\n"]
[533.668222, "o", "              use_numexpr     default          1      \r\n"]
[533.759778, "o", "             ============= ============= =============\r\n"]
[533.851333, "o", "                  True      9.80\u00b10.08ms   9.82\u00b10.02ms \r\n"]
[533.942889, "o", "                 False       9.79\u00b10.1ms    9.87\u00b10.2ms \r\n"]
[534.034444, "o", "             ============= ============= =============\r\n"]
[534.126, "o", "\r\n"]
[534.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          45.1\u00b10.1ms\r\n"]
[534.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.3\u00b10.03ms\r\n"]
[534.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              650\u00b140\u03bcs\r\n"]
[534.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          18.9\u00b10.2ms\r\n"]
[534.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.5\u00b10.04ms\r\n"]
[534.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.33\u00b10.03ms\r\n"]
[534.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.2\u00b10.05ms\r\n"]
[534.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      418\u00b17\u03bcs\r\n"]
[535.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[535.002, "i", "cd ..\r"]
[535.004, "o", "cd ..\r\n"]
[535.006, "o", "\u001b[?2004l\r\n"]
[540.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[540.002, "i", "git status -sb\r"]
[540.004, "o", "git status -sb\r\n"]
[541.654, "o", "\u001b[?2004l\r\n"]
[543.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[545.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[545.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r"]
[545.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r\n"]
[546.654, "o", "\u001b[?2004l\r\n"]
[548.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[550.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[550.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py\r"]
[550.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py\r\n"]
[550.024943, "o", "\u001b[?2004l\r\n"]
[550.043885, "o", "\"\"\"\r\n"]
[550.062828, "o", "Expressions\r\n"]
[550.08177, "o", "-----------\r\n"]
[550.100713, "o", "\r\n"]
[550.119655, "o", "Offer fast expression evaluation through numexpr\r\n"]
[550.138598, "o", "\r\n"]
[550.15754, "o", "\"\"\"\r\n"]
[550.176483, "o", "\r\n"]
[550.195425, "o", "from __future__ import annotations\r\n"]
[550.214368, "o", "\r\n"]
[550.23331, "o", "import operator\r\n"]
[550.252253, "o", "from typing import TYPE_CHECKING\r\n"]
[550.271195, "o", "import warnings\r\n"]
[550.290138, "o", "\r\n"]
[550.30908, "o", "import numpy as np\r\n"]
[550.328023, "o", "\r\n"]
[550.346966, "o", "from pandas._config import get_option\r\n"]
[550.365908, "o", "\r\n"]
[550.384851, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[550.403793, "o", "\r\n"]
[550.422736, "o", "from pandas.core import roperator\r\n"]
[550.441678, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[550.460621, "o", "\r\n"]
[550.479563, "o", "if NUMEXPR_INSTALLED:\r\n"]
[550.498506, "o", "    import numexpr as ne\r\n"]
[550.517448, "o", "\r\n"]
[550.536391, "o", "if TYPE_CHECKING:\r\n"]
[550.555333, "o", "    from pandas._typing import FuncType\r\n"]
[550.574276, "o", "\r\n"]
[550.593218, "o", "_TEST_MODE: bool | None = None\r\n"]
[550.612161, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[550.631103, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[550.650046, "o", "_evaluate: FuncType | None = None\r\n"]
[550.668989, "o", "_where: FuncType | None = None\r\n"]
[550.687931, "o", "\r\n"]
[550.706874, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[550.725816, "o", "_ALLOWED_DTYPES = {\r\n"]
[550.744759, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[550.763701, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[550.782644, "o", "}\r\n"]
[550.801586, "o", "\r\n"]
[550.820529, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[550.839471, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[550.858414, "o", "\r\n"]
[550.877356, "o", "\r\n"]
[550.896299, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[550.915241, "o", "    # set/unset to use numexpr\r\n"]
[550.934184, "o", "    global USE_NUMEXPR\r\n"]
[550.953126, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[550.972069, "o", "        USE_NUMEXPR = v\r\n"]
[550.991011, "o", "\r\n"]
[551.009954, "o", "    # choose what we are going to do\r\n"]
[551.028897, "o", "    global _evaluate, _where\r\n"]
[551.047839, "o", "\r\n"]
[551.066782, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[551.085724, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[551.104667, "o", "\r\n"]
[551.123609, "o", "\r\n"]
[551.142552, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[551.161494, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[551.180437, "o", "    # otherwise reset\r\n"]
[551.199379, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[551.218322, "o", "        if n is None:\r\n"]
[551.237264, "o", "            n = ne.detect_number_of_cores()\r\n"]
[551.256207, "o", "        ne.set_num_threads(n)\r\n"]
[551.275149, "o", "\r\n"]
[551.294092, "o", "\r\n"]
[551.313034, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[551.331977, "o", "    \"\"\"\r\n"]
[551.35092, "o", "    Standard evaluation.\r\n"]
[551.369862, "o", "    \"\"\"\r\n"]
[551.388805, "o", "    if _TEST_MODE:\r\n"]
[551.407747, "o", "        _store_test_result(False)\r\n"]
[551.42669, "o", "    return op(left_op, right_op)\r\n"]
[551.445632, "o", "\r\n"]
[551.464575, "o", "\r\n"]
[551.483517, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[551.50246, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[551.521402, "o", "    if op_str is not None:\r\n"]
[551.540345, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[551.559287, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[551.57823, "o", "            # check for dtype compatibility\r\n"]
[551.597172, "o", "            dtypes: set[str] = set()\r\n"]
[551.616115, "o", "            for o in [left_op, right_op]:\r\n"]
[551.635057, "o", "                # ndarray and Series Case\r\n"]
[551.654, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[551.672943, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[551.691885, "o", "\r\n"]
[551.710828, "o", "            # allowed are a superset\r\n"]
[551.72977, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[551.748713, "o", "                return True\r\n"]
[551.767655, "o", "\r\n"]
[551.786598, "o", "    return False\r\n"]
[551.80554, "o", "\r\n"]
[551.824483, "o", "\r\n"]
[551.843425, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[551.862368, "o", "    result = None\r\n"]
[551.88131, "o", "\r\n"]
[551.900253, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[551.919195, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[551.938138, "o", "        if is_reversed:\r\n"]
[551.95708, "o", "            # we were originally called by a reversed op method\r\n"]
[551.976023, "o", "            left_op, right_op = right_op, left_op\r\n"]
[551.994966, "o", "\r\n"]
[552.013908, "o", "        left_value = left_op\r\n"]
[552.032851, "o", "        right_value = right_op\r\n"]
[552.051793, "o", "\r\n"]
[552.070736, "o", "        try:\r\n"]
[552.089678, "o", "            result = ne.evaluate(\r\n"]
[552.108621, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[552.127563, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[552.146506, "o", "                casting=\"safe\",\r\n"]
[552.165448, "o", "            )\r\n"]
[552.184391, "o", "        except TypeError:\r\n"]
[552.203333, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[552.222276, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[552.241218, "o", "            pass\r\n"]
[552.260161, "o", "        except NotImplementedError:\r\n"]
[552.279103, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[552.298046, "o", "                pass\r\n"]
[552.316989, "o", "            else:\r\n"]
[552.335931, "o", "                raise\r\n"]
[552.354874, "o", "\r\n"]
[552.373816, "o", "        if is_reversed:\r\n"]
[552.392759, "o", "            # reverse order to original for fallback\r\n"]
[552.411701, "o", "            left_op, right_op = right_op, left_op\r\n"]
[552.430644, "o", "\r\n"]
[552.449586, "o", "    if _TEST_MODE:\r\n"]
[552.468529, "o", "        _store_test_result(result is not None)\r\n"]
[552.487471, "o", "\r\n"]
[552.506414, "o", "    if result is None:\r\n"]
[552.525356, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[552.544299, "o", "\r\n"]
[552.563241, "o", "    return result\r\n"]
[552.582184, "o", "\r\n"]
[552.601126, "o", "\r\n"]
[552.620069, "o", "_op_str_mapping = {\r\n"]
[552.639011, "o", "    operator.add: \"+\",\r\n"]
[552.657954, "o", "    roperator.radd: \"+\",\r\n"]
[552.676897, "o", "    operator.mul: \"*\",\r\n"]
[552.695839, "o", "    roperator.rmul: \"*\",\r\n"]
[552.714782, "o", "    operator.sub: \"-\",\r\n"]
[552.733724, "o", "    roperator.rsub: \"-\",\r\n"]
[552.752667, "o", "    operator.truediv: \"/\",\r\n"]
[552.771609, "o", "    roperator.rtruediv: \"/\",\r\n"]
[552.790552, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[552.809494, "o", "    operator.floordiv: None,\r\n"]
[552.828437, "o", "    roperator.rfloordiv: None,\r\n"]
[552.847379, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[552.866322, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[552.885264, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[552.904207, "o", "    operator.mod: None,\r\n"]
[552.923149, "o", "    roperator.rmod: None,\r\n"]
[552.942092, "o", "    operator.pow: \"**\",\r\n"]
[552.961034, "o", "    roperator.rpow: \"**\",\r\n"]
[552.979977, "o", "    operator.eq: \"==\",\r\n"]
[552.99892, "o", "    operator.ne: \"!=\",\r\n"]
[553.017862, "o", "    operator.le: \"<=\",\r\n"]
[553.036805, "o", "    operator.lt: \"<\",\r\n"]
[553.055747, "o", "    operator.ge: \">=\",\r\n"]
[553.07469, "o", "    operator.gt: \">\",\r\n"]
[553.093632, "o", "    operator.and_: \"&\",\r\n"]
[553.112575, "o", "    roperator.rand_: \"&\",\r\n"]
[553.131517, "o", "    operator.or_: \"|\",\r\n"]
[553.15046, "o", "    roperator.ror_: \"|\",\r\n"]
[553.169402, "o", "    operator.xor: \"^\",\r\n"]
[553.188345, "o", "    roperator.rxor: \"^\",\r\n"]
[553.207287, "o", "    divmod: None,\r\n"]
[553.22623, "o", "    roperator.rdivmod: None,\r\n"]
[553.245172, "o", "}\r\n"]
[553.264115, "o", "\r\n"]
[553.283057, "o", "\r\n"]
[553.302, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[553.320943, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[553.339885, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[553.358828, "o", "\r\n"]
[553.37777, "o", "\r\n"]
[553.396713, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[553.415655, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[553.434598, "o", "    result = None\r\n"]
[553.45354, "o", "\r\n"]
[553.472483, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[553.491425, "o", "        result = ne.evaluate(\r\n"]
[553.510368, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[553.52931, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[553.548253, "o", "            casting=\"safe\",\r\n"]
[553.567195, "o", "        )\r\n"]
[553.586138, "o", "\r\n"]
[553.60508, "o", "    if result is None:\r\n"]
[553.624023, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[553.642966, "o", "\r\n"]
[553.661908, "o", "    return result\r\n"]
[553.680851, "o", "\r\n"]
[553.699793, "o", "\r\n"]
[553.718736, "o", "# turn myself on\r\n"]
[553.737678, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[553.756621, "o", "\r\n"]
[553.775563, "o", "\r\n"]
[553.794506, "o", "def _has_bool_dtype(x):\r\n"]
[553.813448, "o", "    try:\r\n"]
[553.832391, "o", "        return x.dtype == bool\r\n"]
[553.851333, "o", "    except AttributeError:\r\n"]
[553.870276, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[553.889218, "o", "\r\n"]
[553.908161, "o", "\r\n"]
[553.927103, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[553.946046, "o", "\r\n"]
[553.964989, "o", "\r\n"]
[553.983931, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[554.002874, "o", "    \"\"\"\r\n"]
[554.021816, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[554.040759, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[554.059701, "o", "    boolean ops.\r\n"]
[554.078644, "o", "    \"\"\"\r\n"]
[554.097586, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[554.116529, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[554.135471, "o", "            warnings.warn(\r\n"]
[554.154414, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[554.173356, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[554.192299, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[554.211241, "o", "                stacklevel=find_stack_level(),\r\n"]
[554.230184, "o", "            )\r\n"]
[554.249126, "o", "            return True\r\n"]
[554.268069, "o", "    return False\r\n"]
[554.287011, "o", "\r\n"]
[554.305954, "o", "\r\n"]
[554.324897, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[554.343839, "o", "    \"\"\"\r\n"]
[554.362782, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[554.381724, "o", "\r\n"]
[554.400667, "o", "    Parameters\r\n"]
[554.419609, "o", "    ----------\r\n"]
[554.438552, "o", "    op : the actual operand\r\n"]
[554.457494, "o", "    left_op : left operand\r\n"]
[554.476437, "o", "    right_op : right operand\r\n"]
[554.495379, "o", "    use_numexpr : bool, default True\r\n"]
[554.514322, "o", "        Whether to try to use numexpr.\r\n"]
[554.533264, "o", "    \"\"\"\r\n"]
[554.552207, "o", "    op_str = _op_str_mapping[op]\r\n"]
[554.571149, "o", "    if op_str is not None:\r\n"]
[554.590092, "o", "        if use_numexpr:\r\n"]
[554.609034, "o", "            # error: \"None\" not callable\r\n"]
[554.627977, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[554.64692, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[554.665862, "o", "\r\n"]
[554.684805, "o", "\r\n"]
[554.703747, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[554.72269, "o", "    \"\"\"\r\n"]
[554.741632, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[554.760575, "o", "\r\n"]
[554.779517, "o", "    Parameters\r\n"]
[554.79846, "o", "    ----------\r\n"]
[554.817402, "o", "    cond : np.ndarray[bool]\r\n"]
[554.836345, "o", "    left_op : return if cond is True\r\n"]
[554.855287, "o", "    right_op : return if cond is False\r\n"]
[554.87423, "o", "    use_numexpr : bool, default True\r\n"]
[554.893172, "o", "        Whether to try to use numexpr.\r\n"]
[554.912115, "o", "    \"\"\"\r\n"]
[554.931057, "o", "    assert _where is not None\r\n"]
[555.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[555.002, "i", "python - << 'PY'\r"]
[555.004, "o", "python - << 'PY'\r\n"]
[555.072811, "o", "\u001b[?2004l\r\n"]
[555.139622, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[555.206432, "o", "\u001b[?2004l\r\n"]
[555.273243, "o", "\u001b[?2004h> import re\r\n"]
[555.340054, "o", "\u001b[?2004l\r\n"]
[555.406865, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[555.473676, "o", "\u001b[?2004l\r\n"]
[555.540486, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[555.607297, "o", "\u001b[?2004l\r\n"]
[555.674108, "o", "\u001b[?2004h> changed = False\r\n"]
[555.740919, "o", "\u001b[?2004l\r\n"]
[555.80773, "o", "\u001b[?2004h> # Bump existing threshold constant if present\r\n"]
[555.874541, "o", "\u001b[?2004l\r\n"]
[555.941351, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[556.008162, "o", "\u001b[?2004l\r\n"]
[556.074973, "o", "\u001b[?2004h> if n == 0:\r\n"]
[556.141784, "o", "\u001b[?2004l\r\n"]
[556.208595, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[556.275405, "o", "\u001b[?2004l\r\n"]
[556.342216, "o", "\u001b[?2004h> if n > 0:\r\n"]
[556.409027, "o", "\u001b[?2004l\r\n"]
[556.475838, "o", "\u001b[?2004h>     src = new_src\r\n"]
[556.542649, "o", "\u001b[?2004l\r\n"]
[556.609459, "o", "\u001b[?2004h>     changed = True\r\n"]
[556.67627, "o", "\u001b[?2004l\r\n"]
[556.743081, "o", "\u001b[?2004h> else:\r\n"]
[556.809892, "o", "\u001b[?2004l\r\n"]
[556.876703, "o", "\u001b[?2004h>     # Inject early size-based bypass in should_use_numexpr\r\n"]
[556.943514, "o", "\u001b[?2004l\r\n"]
[557.010324, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[557.077135, "o", "\u001b[?2004l\r\n"]
[557.143946, "o", "\u001b[?2004h>     if m:\r\n"]
[557.210757, "o", "\u001b[?2004l\r\n"]
[557.277568, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[557.344378, "o", "\u001b[?2004l\r\n"]
[557.411189, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+500]:\r\n"]
[557.478, "o", "\u001b[?2004l\r\n"]
[557.544811, "o", "\u001b[?2004h>             inject = (\r\n"]
[557.611622, "o", "\u001b[?2004l\r\n"]
[557.678432, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[557.745243, "o", "\u001b[?2004l\r\n"]
[557.812054, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[557.878865, "o", "\u001b[?2004l\r\n"]
[557.945676, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[558.012486, "o", "\u001b[?2004l\r\n"]
[558.079297, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[558.146108, "o", "\u001b[?2004l\r\n"]
[558.212919, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[558.27973, "o", "\u001b[?2004l\r\n"]
[558.346541, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[558.413351, "o", "\u001b[?2004l\r\n"]
[558.480162, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[558.546973, "o", "\u001b[?2004l\r\n"]
[558.613784, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[558.680595, "o", "\u001b[?2004l\r\n"]
[558.747405, "o", "\u001b[?2004h>             )\r\n"]
[558.814216, "o", "\u001b[?2004l\r\n"]
[558.881027, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[558.947838, "o", "\u001b[?2004l\r\n"]
[559.014649, "o", "\u001b[?2004h>             changed = True\r\n"]
[559.081459, "o", "\u001b[?2004l\r\n"]
[559.14827, "o", "\u001b[?2004h> if changed:\r\n"]
[559.215081, "o", "\u001b[?2004l\r\n"]
[559.281892, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[559.348703, "o", "\u001b[?2004l\r\n"]
[559.415514, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold/early bypass)')\r\n"]
[559.482324, "o", "\u001b[?2004l\r\n"]
[559.549135, "o", "\u001b[?2004h> else:\r\n"]
[559.615946, "o", "\u001b[?2004l\r\n"]
[559.682757, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[559.749568, "o", "\u001b[?2004l\r\n"]
[559.816378, "o", "\u001b[?2004h> PY\r\n"]
[559.883189, "o", "\u001b[?2004l\r\n"]
[560.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[560.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[560.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[560.006, "o", "\u001b[?2004l\r\n"]
[565.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[565.002, "i", "git add pandas/core/computation/expressions.py\r"]
[565.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[565.006, "o", "\u001b[?2004l\r\n"]
[570.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[570.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[570.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[570.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[571.242, "o", "\u001b[?2004l\r\n"]
[571.86, "o", "On branch main\r\n"]
[572.478, "o", "Untracked files:\r\n"]
[573.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[573.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[574.332, "o", "\r\n"]
[575.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[575.002, "i", "cd asv_bench\r"]
[575.004, "o", "cd asv_bench\r\n"]
[575.006, "o", "\u001b[?2004l\r\n"]
[580.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[580.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[580.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[580.097556, "o", "\u001b[?2004l\r\n"]
[580.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[580.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[580.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[580.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[580.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[580.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[580.738444, "o", "             --                      threads          \r\n"]
[580.83, "o", "             ------------- ---------------------------\r\n"]
[580.921556, "o", "              use_numexpr     default          1      \r\n"]
[581.013111, "o", "             ============= ============= =============\r\n"]
[581.104667, "o", "                  True      1.98\u00b10.02ms   1.98\u00b10.05ms \r\n"]
[581.196222, "o", "                 False      2.01\u00b10.02ms   1.98\u00b10.04ms \r\n"]
[581.287778, "o", "             ============= ============= =============\r\n"]
[581.379333, "o", "\r\n"]
[581.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[581.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[581.654, "o", "             --                      threads          \r\n"]
[581.745556, "o", "             ------------- ---------------------------\r\n"]
[581.837111, "o", "              use_numexpr     default          1      \r\n"]
[581.928667, "o", "             ============= ============= =============\r\n"]
[582.020222, "o", "                  True      1.56\u00b10.02ms   1.59\u00b10.03ms \r\n"]
[582.111778, "o", "                 False      1.56\u00b10.02ms   1.57\u00b10.02ms \r\n"]
[582.203333, "o", "             ============= ============= =============\r\n"]
[582.294889, "o", "\r\n"]
[582.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[582.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[582.569556, "o", "             --                      threads          \r\n"]
[582.661111, "o", "             ------------- ---------------------------\r\n"]
[582.752667, "o", "              use_numexpr     default          1      \r\n"]
[582.844222, "o", "             ============= ============= =============\r\n"]
[582.935778, "o", "                  True      2.05\u00b10.03ms   1.98\u00b10.02ms \r\n"]
[583.027333, "o", "                 False      2.02\u00b10.03ms   2.01\u00b10.02ms \r\n"]
[583.118889, "o", "             ============= ============= =============\r\n"]
[583.210444, "o", "\r\n"]
[583.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[583.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[583.485111, "o", "             --                      threads          \r\n"]
[583.576667, "o", "             ------------- ---------------------------\r\n"]
[583.668222, "o", "              use_numexpr     default          1      \r\n"]
[583.759778, "o", "             ============= ============= =============\r\n"]
[583.851333, "o", "                  True      9.66\u00b10.07ms   9.66\u00b10.04ms \r\n"]
[583.942889, "o", "                 False      9.70\u00b10.05ms   9.74\u00b10.07ms \r\n"]
[584.034444, "o", "             ============= ============= =============\r\n"]
[584.126, "o", "\r\n"]
[584.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          45.2\u00b10.2ms\r\n"]
[584.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.2\u00b10.02ms\r\n"]
[584.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                               641\u00b14\u03bcs\r\n"]
[584.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                         18.9\u00b10.02ms\r\n"]
[584.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.8\u00b10.01ms\r\n"]
[584.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.31\u00b10.01ms\r\n"]
[584.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.2\u00b10.06ms\r\n"]
[584.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      412\u00b15\u03bcs\r\n"]
[585.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[585.002, "i", "sleep 20\r"]
[585.004, "o", "sleep 20\r\n"]
[585.006, "o", "\u001b[?2004l\r\n"]
[590.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[590.002, "i", "cd ..\r"]
[590.004, "o", "cd ..\r\n"]
[590.006, "o", "\u001b[?2004l\r\n"]
[595.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[595.002, "i", "git status -sb\r"]
[595.004, "o", "git status -sb\r\n"]
[596.654, "o", "\u001b[?2004l\r\n"]
[598.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[600.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[600.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r"]
[600.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r\n"]
[601.654, "o", "\u001b[?2004l\r\n"]
[603.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[605.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[605.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py\r"]
[605.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py\r\n"]
[605.024943, "o", "\u001b[?2004l\r\n"]
[605.043885, "o", "\"\"\"\r\n"]
[605.062828, "o", "Expressions\r\n"]
[605.08177, "o", "-----------\r\n"]
[605.100713, "o", "\r\n"]
[605.119655, "o", "Offer fast expression evaluation through numexpr\r\n"]
[605.138598, "o", "\r\n"]
[605.15754, "o", "\"\"\"\r\n"]
[605.176483, "o", "\r\n"]
[605.195425, "o", "from __future__ import annotations\r\n"]
[605.214368, "o", "\r\n"]
[605.23331, "o", "import operator\r\n"]
[605.252253, "o", "from typing import TYPE_CHECKING\r\n"]
[605.271195, "o", "import warnings\r\n"]
[605.290138, "o", "\r\n"]
[605.30908, "o", "import numpy as np\r\n"]
[605.328023, "o", "\r\n"]
[605.346966, "o", "from pandas._config import get_option\r\n"]
[605.365908, "o", "\r\n"]
[605.384851, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[605.403793, "o", "\r\n"]
[605.422736, "o", "from pandas.core import roperator\r\n"]
[605.441678, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[605.460621, "o", "\r\n"]
[605.479563, "o", "if NUMEXPR_INSTALLED:\r\n"]
[605.498506, "o", "    import numexpr as ne\r\n"]
[605.517448, "o", "\r\n"]
[605.536391, "o", "if TYPE_CHECKING:\r\n"]
[605.555333, "o", "    from pandas._typing import FuncType\r\n"]
[605.574276, "o", "\r\n"]
[605.593218, "o", "_TEST_MODE: bool | None = None\r\n"]
[605.612161, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[605.631103, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[605.650046, "o", "_evaluate: FuncType | None = None\r\n"]
[605.668989, "o", "_where: FuncType | None = None\r\n"]
[605.687931, "o", "\r\n"]
[605.706874, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[605.725816, "o", "_ALLOWED_DTYPES = {\r\n"]
[605.744759, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[605.763701, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[605.782644, "o", "}\r\n"]
[605.801586, "o", "\r\n"]
[605.820529, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[605.839471, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[605.858414, "o", "\r\n"]
[605.877356, "o", "\r\n"]
[605.896299, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[605.915241, "o", "    # set/unset to use numexpr\r\n"]
[605.934184, "o", "    global USE_NUMEXPR\r\n"]
[605.953126, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[605.972069, "o", "        USE_NUMEXPR = v\r\n"]
[605.991011, "o", "\r\n"]
[606.009954, "o", "    # choose what we are going to do\r\n"]
[606.028897, "o", "    global _evaluate, _where\r\n"]
[606.047839, "o", "\r\n"]
[606.066782, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[606.085724, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[606.104667, "o", "\r\n"]
[606.123609, "o", "\r\n"]
[606.142552, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[606.161494, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[606.180437, "o", "    # otherwise reset\r\n"]
[606.199379, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[606.218322, "o", "        if n is None:\r\n"]
[606.237264, "o", "            n = ne.detect_number_of_cores()\r\n"]
[606.256207, "o", "        ne.set_num_threads(n)\r\n"]
[606.275149, "o", "\r\n"]
[606.294092, "o", "\r\n"]
[606.313034, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[606.331977, "o", "    \"\"\"\r\n"]
[606.35092, "o", "    Standard evaluation.\r\n"]
[606.369862, "o", "    \"\"\"\r\n"]
[606.388805, "o", "    if _TEST_MODE:\r\n"]
[606.407747, "o", "        _store_test_result(False)\r\n"]
[606.42669, "o", "    return op(left_op, right_op)\r\n"]
[606.445632, "o", "\r\n"]
[606.464575, "o", "\r\n"]
[606.483517, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[606.50246, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[606.521402, "o", "    if op_str is not None:\r\n"]
[606.540345, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[606.559287, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[606.57823, "o", "            # check for dtype compatibility\r\n"]
[606.597172, "o", "            dtypes: set[str] = set()\r\n"]
[606.616115, "o", "            for o in [left_op, right_op]:\r\n"]
[606.635057, "o", "                # ndarray and Series Case\r\n"]
[606.654, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[606.672943, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[606.691885, "o", "\r\n"]
[606.710828, "o", "            # allowed are a superset\r\n"]
[606.72977, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[606.748713, "o", "                return True\r\n"]
[606.767655, "o", "\r\n"]
[606.786598, "o", "    return False\r\n"]
[606.80554, "o", "\r\n"]
[606.824483, "o", "\r\n"]
[606.843425, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[606.862368, "o", "    result = None\r\n"]
[606.88131, "o", "\r\n"]
[606.900253, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[606.919195, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[606.938138, "o", "        if is_reversed:\r\n"]
[606.95708, "o", "            # we were originally called by a reversed op method\r\n"]
[606.976023, "o", "            left_op, right_op = right_op, left_op\r\n"]
[606.994966, "o", "\r\n"]
[607.013908, "o", "        left_value = left_op\r\n"]
[607.032851, "o", "        right_value = right_op\r\n"]
[607.051793, "o", "\r\n"]
[607.070736, "o", "        try:\r\n"]
[607.089678, "o", "            result = ne.evaluate(\r\n"]
[607.108621, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[607.127563, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[607.146506, "o", "                casting=\"safe\",\r\n"]
[607.165448, "o", "            )\r\n"]
[607.184391, "o", "        except TypeError:\r\n"]
[607.203333, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[607.222276, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[607.241218, "o", "            pass\r\n"]
[607.260161, "o", "        except NotImplementedError:\r\n"]
[607.279103, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[607.298046, "o", "                pass\r\n"]
[607.316989, "o", "            else:\r\n"]
[607.335931, "o", "                raise\r\n"]
[607.354874, "o", "\r\n"]
[607.373816, "o", "        if is_reversed:\r\n"]
[607.392759, "o", "            # reverse order to original for fallback\r\n"]
[607.411701, "o", "            left_op, right_op = right_op, left_op\r\n"]
[607.430644, "o", "\r\n"]
[607.449586, "o", "    if _TEST_MODE:\r\n"]
[607.468529, "o", "        _store_test_result(result is not None)\r\n"]
[607.487471, "o", "\r\n"]
[607.506414, "o", "    if result is None:\r\n"]
[607.525356, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[607.544299, "o", "\r\n"]
[607.563241, "o", "    return result\r\n"]
[607.582184, "o", "\r\n"]
[607.601126, "o", "\r\n"]
[607.620069, "o", "_op_str_mapping = {\r\n"]
[607.639011, "o", "    operator.add: \"+\",\r\n"]
[607.657954, "o", "    roperator.radd: \"+\",\r\n"]
[607.676897, "o", "    operator.mul: \"*\",\r\n"]
[607.695839, "o", "    roperator.rmul: \"*\",\r\n"]
[607.714782, "o", "    operator.sub: \"-\",\r\n"]
[607.733724, "o", "    roperator.rsub: \"-\",\r\n"]
[607.752667, "o", "    operator.truediv: \"/\",\r\n"]
[607.771609, "o", "    roperator.rtruediv: \"/\",\r\n"]
[607.790552, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[607.809494, "o", "    operator.floordiv: None,\r\n"]
[607.828437, "o", "    roperator.rfloordiv: None,\r\n"]
[607.847379, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[607.866322, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[607.885264, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[607.904207, "o", "    operator.mod: None,\r\n"]
[607.923149, "o", "    roperator.rmod: None,\r\n"]
[607.942092, "o", "    operator.pow: \"**\",\r\n"]
[607.961034, "o", "    roperator.rpow: \"**\",\r\n"]
[607.979977, "o", "    operator.eq: \"==\",\r\n"]
[607.99892, "o", "    operator.ne: \"!=\",\r\n"]
[608.017862, "o", "    operator.le: \"<=\",\r\n"]
[608.036805, "o", "    operator.lt: \"<\",\r\n"]
[608.055747, "o", "    operator.ge: \">=\",\r\n"]
[608.07469, "o", "    operator.gt: \">\",\r\n"]
[608.093632, "o", "    operator.and_: \"&\",\r\n"]
[608.112575, "o", "    roperator.rand_: \"&\",\r\n"]
[608.131517, "o", "    operator.or_: \"|\",\r\n"]
[608.15046, "o", "    roperator.ror_: \"|\",\r\n"]
[608.169402, "o", "    operator.xor: \"^\",\r\n"]
[608.188345, "o", "    roperator.rxor: \"^\",\r\n"]
[608.207287, "o", "    divmod: None,\r\n"]
[608.22623, "o", "    roperator.rdivmod: None,\r\n"]
[608.245172, "o", "}\r\n"]
[608.264115, "o", "\r\n"]
[608.283057, "o", "\r\n"]
[608.302, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[608.320943, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[608.339885, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[608.358828, "o", "\r\n"]
[608.37777, "o", "\r\n"]
[608.396713, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[608.415655, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[608.434598, "o", "    result = None\r\n"]
[608.45354, "o", "\r\n"]
[608.472483, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[608.491425, "o", "        result = ne.evaluate(\r\n"]
[608.510368, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[608.52931, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[608.548253, "o", "            casting=\"safe\",\r\n"]
[608.567195, "o", "        )\r\n"]
[608.586138, "o", "\r\n"]
[608.60508, "o", "    if result is None:\r\n"]
[608.624023, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[608.642966, "o", "\r\n"]
[608.661908, "o", "    return result\r\n"]
[608.680851, "o", "\r\n"]
[608.699793, "o", "\r\n"]
[608.718736, "o", "# turn myself on\r\n"]
[608.737678, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[608.756621, "o", "\r\n"]
[608.775563, "o", "\r\n"]
[608.794506, "o", "def _has_bool_dtype(x):\r\n"]
[608.813448, "o", "    try:\r\n"]
[608.832391, "o", "        return x.dtype == bool\r\n"]
[608.851333, "o", "    except AttributeError:\r\n"]
[608.870276, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[608.889218, "o", "\r\n"]
[608.908161, "o", "\r\n"]
[608.927103, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[608.946046, "o", "\r\n"]
[608.964989, "o", "\r\n"]
[608.983931, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[609.002874, "o", "    \"\"\"\r\n"]
[609.021816, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[609.040759, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[609.059701, "o", "    boolean ops.\r\n"]
[609.078644, "o", "    \"\"\"\r\n"]
[609.097586, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[609.116529, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[609.135471, "o", "            warnings.warn(\r\n"]
[609.154414, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[609.173356, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[609.192299, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[609.211241, "o", "                stacklevel=find_stack_level(),\r\n"]
[609.230184, "o", "            )\r\n"]
[609.249126, "o", "            return True\r\n"]
[609.268069, "o", "    return False\r\n"]
[609.287011, "o", "\r\n"]
[609.305954, "o", "\r\n"]
[609.324897, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[609.343839, "o", "    \"\"\"\r\n"]
[609.362782, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[609.381724, "o", "\r\n"]
[609.400667, "o", "    Parameters\r\n"]
[609.419609, "o", "    ----------\r\n"]
[609.438552, "o", "    op : the actual operand\r\n"]
[609.457494, "o", "    left_op : left operand\r\n"]
[609.476437, "o", "    right_op : right operand\r\n"]
[609.495379, "o", "    use_numexpr : bool, default True\r\n"]
[609.514322, "o", "        Whether to try to use numexpr.\r\n"]
[609.533264, "o", "    \"\"\"\r\n"]
[609.552207, "o", "    op_str = _op_str_mapping[op]\r\n"]
[609.571149, "o", "    if op_str is not None:\r\n"]
[609.590092, "o", "        if use_numexpr:\r\n"]
[609.609034, "o", "            # error: \"None\" not callable\r\n"]
[609.627977, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[609.64692, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[609.665862, "o", "\r\n"]
[609.684805, "o", "\r\n"]
[609.703747, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[609.72269, "o", "    \"\"\"\r\n"]
[609.741632, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[609.760575, "o", "\r\n"]
[609.779517, "o", "    Parameters\r\n"]
[609.79846, "o", "    ----------\r\n"]
[609.817402, "o", "    cond : np.ndarray[bool]\r\n"]
[609.836345, "o", "    left_op : return if cond is True\r\n"]
[609.855287, "o", "    right_op : return if cond is False\r\n"]
[609.87423, "o", "    use_numexpr : bool, default True\r\n"]
[609.893172, "o", "        Whether to try to use numexpr.\r\n"]
[609.912115, "o", "    \"\"\"\r\n"]
[609.931057, "o", "    assert _where is not None\r\n"]
[610.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[610.002, "i", "python - << 'PY'\r"]
[610.004, "o", "python - << 'PY'\r\n"]
[610.072811, "o", "\u001b[?2004l\r\n"]
[610.139622, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[610.206432, "o", "\u001b[?2004l\r\n"]
[610.273243, "o", "\u001b[?2004h> import re\r\n"]
[610.340054, "o", "\u001b[?2004l\r\n"]
[610.406865, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[610.473676, "o", "\u001b[?2004l\r\n"]
[610.540486, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[610.607297, "o", "\u001b[?2004l\r\n"]
[610.674108, "o", "\u001b[?2004h> changed = False\r\n"]
[610.740919, "o", "\u001b[?2004l\r\n"]
[610.80773, "o", "\u001b[?2004h> # Try to bump existing threshold constant if present\r\n"]
[610.874541, "o", "\u001b[?2004l\r\n"]
[610.941351, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[611.008162, "o", "\u001b[?2004l\r\n"]
[611.074973, "o", "\u001b[?2004h> if n == 0:\r\n"]
[611.141784, "o", "\u001b[?2004l\r\n"]
[611.208595, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[611.275405, "o", "\u001b[?2004l\r\n"]
[611.342216, "o", "\u001b[?2004h> if n > 0:\r\n"]
[611.409027, "o", "\u001b[?2004l\r\n"]
[611.475838, "o", "\u001b[?2004h>     src = new_src\r\n"]
[611.542649, "o", "\u001b[?2004l\r\n"]
[611.609459, "o", "\u001b[?2004h>     changed = True\r\n"]
[611.67627, "o", "\u001b[?2004l\r\n"]
[611.743081, "o", "\u001b[?2004h> else:\r\n"]
[611.809892, "o", "\u001b[?2004l\r\n"]
[611.876703, "o", "\u001b[?2004h>     # Inject early bypass into should_use_numexpr for moderate sizes\r\n"]
[611.943514, "o", "\u001b[?2004l\r\n"]
[612.010324, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[612.077135, "o", "\u001b[?2004l\r\n"]
[612.143946, "o", "\u001b[?2004h>     if m:\r\n"]
[612.210757, "o", "\u001b[?2004l\r\n"]
[612.277568, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[612.344378, "o", "\u001b[?2004l\r\n"]
[612.411189, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+600]:\r\n"]
[612.478, "o", "\u001b[?2004l\r\n"]
[612.544811, "o", "\u001b[?2004h>             inject = (\r\n"]
[612.611622, "o", "\u001b[?2004l\r\n"]
[612.678432, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[612.745243, "o", "\u001b[?2004l\r\n"]
[612.812054, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[612.878865, "o", "\u001b[?2004l\r\n"]
[612.945676, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[613.012486, "o", "\u001b[?2004l\r\n"]
[613.079297, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[613.146108, "o", "\u001b[?2004l\r\n"]
[613.212919, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[613.27973, "o", "\u001b[?2004l\r\n"]
[613.346541, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[613.413351, "o", "\u001b[?2004l\r\n"]
[613.480162, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[613.546973, "o", "\u001b[?2004l\r\n"]
[613.613784, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[613.680595, "o", "\u001b[?2004l\r\n"]
[613.747405, "o", "\u001b[?2004h>             )\r\n"]
[613.814216, "o", "\u001b[?2004l\r\n"]
[613.881027, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[613.947838, "o", "\u001b[?2004l\r\n"]
[614.014649, "o", "\u001b[?2004h>             changed = True\r\n"]
[614.081459, "o", "\u001b[?2004l\r\n"]
[614.14827, "o", "\u001b[?2004h> if changed:\r\n"]
[614.215081, "o", "\u001b[?2004l\r\n"]
[614.281892, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[614.348703, "o", "\u001b[?2004l\r\n"]
[614.415514, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[614.482324, "o", "\u001b[?2004l\r\n"]
[614.549135, "o", "\u001b[?2004h> else:\r\n"]
[614.615946, "o", "\u001b[?2004l\r\n"]
[614.682757, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[614.749568, "o", "\u001b[?2004l\r\n"]
[614.816378, "o", "\u001b[?2004h> PY\r\n"]
[614.883189, "o", "\u001b[?2004l\r\n"]
[615.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[615.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[615.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[615.006, "o", "\u001b[?2004l\r\n"]
[620.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[620.002, "i", "git add pandas/core/computation/expressions.py\r"]
[620.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[620.006, "o", "\u001b[?2004l\r\n"]
[625.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[625.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[625.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[625.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[626.242, "o", "\u001b[?2004l\r\n"]
[626.86, "o", "On branch main\r\n"]
[627.478, "o", "Untracked files:\r\n"]
[628.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[628.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[629.332, "o", "\r\n"]
[630.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[630.002, "i", "cd asv_bench\r"]
[630.004, "o", "cd asv_bench\r\n"]
[630.006, "o", "\u001b[?2004l\r\n"]
[635.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[635.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[635.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[635.097556, "o", "\u001b[?2004l\r\n"]
[635.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[635.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[635.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[635.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[635.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[635.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[635.738444, "o", "             --                      threads          \r\n"]
[635.83, "o", "             ------------- ---------------------------\r\n"]
[635.921556, "o", "              use_numexpr     default          1      \r\n"]
[636.013111, "o", "             ============= ============= =============\r\n"]
[636.104667, "o", "                  True      1.99\u00b10.05ms   1.96\u00b10.01ms \r\n"]
[636.196222, "o", "                 False      1.95\u00b10.03ms   1.98\u00b10.03ms \r\n"]
[636.287778, "o", "             ============= ============= =============\r\n"]
[636.379333, "o", "\r\n"]
[636.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[636.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[636.654, "o", "             --                      threads          \r\n"]
[636.745556, "o", "             ------------- ---------------------------\r\n"]
[636.837111, "o", "              use_numexpr     default          1      \r\n"]
[636.928667, "o", "             ============= ============= =============\r\n"]
[637.020222, "o", "                  True      1.55\u00b10.03ms   1.58\u00b10.01ms \r\n"]
[637.111778, "o", "                 False      1.55\u00b10.03ms   1.58\u00b10.03ms \r\n"]
[637.203333, "o", "             ============= ============= =============\r\n"]
[637.294889, "o", "\r\n"]
[637.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[637.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[637.569556, "o", "             --                      threads          \r\n"]
[637.661111, "o", "             ------------- ---------------------------\r\n"]
[637.752667, "o", "              use_numexpr     default          1      \r\n"]
[637.844222, "o", "             ============= ============= =============\r\n"]
[637.935778, "o", "                  True      2.01\u00b10.05ms   1.97\u00b10.01ms \r\n"]
[638.027333, "o", "                 False      2.01\u00b10.02ms   1.99\u00b10.02ms \r\n"]
[638.118889, "o", "             ============= ============= =============\r\n"]
[638.210444, "o", "\r\n"]
[638.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[638.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[638.485111, "o", "             --                      threads          \r\n"]
[638.576667, "o", "             ------------- ---------------------------\r\n"]
[638.668222, "o", "              use_numexpr     default          1      \r\n"]
[638.759778, "o", "             ============= ============= =============\r\n"]
[638.851333, "o", "                  True      9.85\u00b10.04ms   9.93\u00b10.04ms \r\n"]
[638.942889, "o", "                 False      9.82\u00b10.07ms   9.84\u00b10.05ms \r\n"]
[639.034444, "o", "             ============= ============= =============\r\n"]
[639.126, "o", "\r\n"]
[639.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          45.4\u00b10.3ms\r\n"]
[639.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.3\u00b10.07ms\r\n"]
[639.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              673\u00b130\u03bcs\r\n"]
[639.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                         18.9\u00b10.05ms\r\n"]
[639.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.5\u00b10.02ms\r\n"]
[639.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.33\u00b10.04ms\r\n"]
[639.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      10.2\u00b10.1ms\r\n"]
[639.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      410\u00b13\u03bcs\r\n"]
[640.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[640.002, "i", "cd ..\r"]
[640.004, "o", "cd ..\r\n"]
[640.006, "o", "\u001b[?2004l\r\n"]
[645.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[645.002, "i", "git status -sb\r"]
[645.004, "o", "git status -sb\r\n"]
[646.654, "o", "\u001b[?2004l\r\n"]
[648.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[650.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[650.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r"]
[650.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r\n"]
[651.654, "o", "\u001b[?2004l\r\n"]
[653.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[655.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[655.002, "i", "sed -n '1,300p' pandas/core/computation/expressions.py\r"]
[655.004, "o", "sed -n '1,300p' pandas/core/computation/expressions.py\r\n"]
[655.02299, "o", "\u001b[?2004l\r\n"]
[655.039979, "o", "\"\"\"\r\n"]
[655.056969, "o", "Expressions\r\n"]
[655.073959, "o", "-----------\r\n"]
[655.090948, "o", "\r\n"]
[655.107938, "o", "Offer fast expression evaluation through numexpr\r\n"]
[655.124928, "o", "\r\n"]
[655.141918, "o", "\"\"\"\r\n"]
[655.158907, "o", "\r\n"]
[655.175897, "o", "from __future__ import annotations\r\n"]
[655.192887, "o", "\r\n"]
[655.209876, "o", "import operator\r\n"]
[655.226866, "o", "from typing import TYPE_CHECKING\r\n"]
[655.243856, "o", "import warnings\r\n"]
[655.260845, "o", "\r\n"]
[655.277835, "o", "import numpy as np\r\n"]
[655.294825, "o", "\r\n"]
[655.311814, "o", "from pandas._config import get_option\r\n"]
[655.328804, "o", "\r\n"]
[655.345794, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[655.362784, "o", "\r\n"]
[655.379773, "o", "from pandas.core import roperator\r\n"]
[655.396763, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[655.413753, "o", "\r\n"]
[655.430742, "o", "if NUMEXPR_INSTALLED:\r\n"]
[655.447732, "o", "    import numexpr as ne\r\n"]
[655.464722, "o", "\r\n"]
[655.481711, "o", "if TYPE_CHECKING:\r\n"]
[655.498701, "o", "    from pandas._typing import FuncType\r\n"]
[655.515691, "o", "\r\n"]
[655.53268, "o", "_TEST_MODE: bool | None = None\r\n"]
[655.54967, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[655.56666, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[655.583649, "o", "_evaluate: FuncType | None = None\r\n"]
[655.600639, "o", "_where: FuncType | None = None\r\n"]
[655.617629, "o", "\r\n"]
[655.634619, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[655.651608, "o", "_ALLOWED_DTYPES = {\r\n"]
[655.668598, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[655.685588, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[655.702577, "o", "}\r\n"]
[655.719567, "o", "\r\n"]
[655.736557, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[655.753546, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[655.770536, "o", "\r\n"]
[655.787526, "o", "\r\n"]
[655.804515, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[655.821505, "o", "    # set/unset to use numexpr\r\n"]
[655.838495, "o", "    global USE_NUMEXPR\r\n"]
[655.855485, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[655.872474, "o", "        USE_NUMEXPR = v\r\n"]
[655.889464, "o", "\r\n"]
[655.906454, "o", "    # choose what we are going to do\r\n"]
[655.923443, "o", "    global _evaluate, _where\r\n"]
[655.940433, "o", "\r\n"]
[655.957423, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[655.974412, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[655.991402, "o", "\r\n"]
[656.008392, "o", "\r\n"]
[656.025381, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[656.042371, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[656.059361, "o", "    # otherwise reset\r\n"]
[656.076351, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[656.09334, "o", "        if n is None:\r\n"]
[656.11033, "o", "            n = ne.detect_number_of_cores()\r\n"]
[656.12732, "o", "        ne.set_num_threads(n)\r\n"]
[656.144309, "o", "\r\n"]
[656.161299, "o", "\r\n"]
[656.178289, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[656.195278, "o", "    \"\"\"\r\n"]
[656.212268, "o", "    Standard evaluation.\r\n"]
[656.229258, "o", "    \"\"\"\r\n"]
[656.246247, "o", "    if _TEST_MODE:\r\n"]
[656.263237, "o", "        _store_test_result(False)\r\n"]
[656.280227, "o", "    return op(left_op, right_op)\r\n"]
[656.297216, "o", "\r\n"]
[656.314206, "o", "\r\n"]
[656.331196, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[656.348186, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[656.365175, "o", "    if op_str is not None:\r\n"]
[656.382165, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[656.399155, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[656.416144, "o", "            # check for dtype compatibility\r\n"]
[656.433134, "o", "            dtypes: set[str] = set()\r\n"]
[656.450124, "o", "            for o in [left_op, right_op]:\r\n"]
[656.467113, "o", "                # ndarray and Series Case\r\n"]
[656.484103, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[656.501093, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[656.518082, "o", "\r\n"]
[656.535072, "o", "            # allowed are a superset\r\n"]
[656.552062, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[656.569052, "o", "                return True\r\n"]
[656.586041, "o", "\r\n"]
[656.603031, "o", "    return False\r\n"]
[656.620021, "o", "\r\n"]
[656.63701, "o", "\r\n"]
[656.654, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[656.67099, "o", "    result = None\r\n"]
[656.687979, "o", "\r\n"]
[656.704969, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[656.721959, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[656.738948, "o", "        if is_reversed:\r\n"]
[656.755938, "o", "            # we were originally called by a reversed op method\r\n"]
[656.772928, "o", "            left_op, right_op = right_op, left_op\r\n"]
[656.789918, "o", "\r\n"]
[656.806907, "o", "        left_value = left_op\r\n"]
[656.823897, "o", "        right_value = right_op\r\n"]
[656.840887, "o", "\r\n"]
[656.857876, "o", "        try:\r\n"]
[656.874866, "o", "            result = ne.evaluate(\r\n"]
[656.891856, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[656.908845, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[656.925835, "o", "                casting=\"safe\",\r\n"]
[656.942825, "o", "            )\r\n"]
[656.959814, "o", "        except TypeError:\r\n"]
[656.976804, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[656.993794, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[657.010784, "o", "            pass\r\n"]
[657.027773, "o", "        except NotImplementedError:\r\n"]
[657.044763, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[657.061753, "o", "                pass\r\n"]
[657.078742, "o", "            else:\r\n"]
[657.095732, "o", "                raise\r\n"]
[657.112722, "o", "\r\n"]
[657.129711, "o", "        if is_reversed:\r\n"]
[657.146701, "o", "            # reverse order to original for fallback\r\n"]
[657.163691, "o", "            left_op, right_op = right_op, left_op\r\n"]
[657.18068, "o", "\r\n"]
[657.19767, "o", "    if _TEST_MODE:\r\n"]
[657.21466, "o", "        _store_test_result(result is not None)\r\n"]
[657.231649, "o", "\r\n"]
[657.248639, "o", "    if result is None:\r\n"]
[657.265629, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[657.282619, "o", "\r\n"]
[657.299608, "o", "    return result\r\n"]
[657.316598, "o", "\r\n"]
[657.333588, "o", "\r\n"]
[657.350577, "o", "_op_str_mapping = {\r\n"]
[657.367567, "o", "    operator.add: \"+\",\r\n"]
[657.384557, "o", "    roperator.radd: \"+\",\r\n"]
[657.401546, "o", "    operator.mul: \"*\",\r\n"]
[657.418536, "o", "    roperator.rmul: \"*\",\r\n"]
[657.435526, "o", "    operator.sub: \"-\",\r\n"]
[657.452515, "o", "    roperator.rsub: \"-\",\r\n"]
[657.469505, "o", "    operator.truediv: \"/\",\r\n"]
[657.486495, "o", "    roperator.rtruediv: \"/\",\r\n"]
[657.503485, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[657.520474, "o", "    operator.floordiv: None,\r\n"]
[657.537464, "o", "    roperator.rfloordiv: None,\r\n"]
[657.554454, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[657.571443, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[657.588433, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[657.605423, "o", "    operator.mod: None,\r\n"]
[657.622412, "o", "    roperator.rmod: None,\r\n"]
[657.639402, "o", "    operator.pow: \"**\",\r\n"]
[657.656392, "o", "    roperator.rpow: \"**\",\r\n"]
[657.673381, "o", "    operator.eq: \"==\",\r\n"]
[657.690371, "o", "    operator.ne: \"!=\",\r\n"]
[657.707361, "o", "    operator.le: \"<=\",\r\n"]
[657.724351, "o", "    operator.lt: \"<\",\r\n"]
[657.74134, "o", "    operator.ge: \">=\",\r\n"]
[657.75833, "o", "    operator.gt: \">\",\r\n"]
[657.77532, "o", "    operator.and_: \"&\",\r\n"]
[657.792309, "o", "    roperator.rand_: \"&\",\r\n"]
[657.809299, "o", "    operator.or_: \"|\",\r\n"]
[657.826289, "o", "    roperator.ror_: \"|\",\r\n"]
[657.843278, "o", "    operator.xor: \"^\",\r\n"]
[657.860268, "o", "    roperator.rxor: \"^\",\r\n"]
[657.877258, "o", "    divmod: None,\r\n"]
[657.894247, "o", "    roperator.rdivmod: None,\r\n"]
[657.911237, "o", "}\r\n"]
[657.928227, "o", "\r\n"]
[657.945216, "o", "\r\n"]
[657.962206, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[657.979196, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[657.996186, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[658.013175, "o", "\r\n"]
[658.030165, "o", "\r\n"]
[658.047155, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[658.064144, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[658.081134, "o", "    result = None\r\n"]
[658.098124, "o", "\r\n"]
[658.115113, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[658.132103, "o", "        result = ne.evaluate(\r\n"]
[658.149093, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[658.166082, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[658.183072, "o", "            casting=\"safe\",\r\n"]
[658.200062, "o", "        )\r\n"]
[658.217052, "o", "\r\n"]
[658.234041, "o", "    if result is None:\r\n"]
[658.251031, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[658.268021, "o", "\r\n"]
[658.28501, "o", "    return result\r\n"]
[658.302, "o", "\r\n"]
[658.31899, "o", "\r\n"]
[658.335979, "o", "# turn myself on\r\n"]
[658.352969, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[658.369959, "o", "\r\n"]
[658.386948, "o", "\r\n"]
[658.403938, "o", "def _has_bool_dtype(x):\r\n"]
[658.420928, "o", "    try:\r\n"]
[658.437918, "o", "        return x.dtype == bool\r\n"]
[658.454907, "o", "    except AttributeError:\r\n"]
[658.471897, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[658.488887, "o", "\r\n"]
[658.505876, "o", "\r\n"]
[658.522866, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[658.539856, "o", "\r\n"]
[658.556845, "o", "\r\n"]
[658.573835, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[658.590825, "o", "    \"\"\"\r\n"]
[658.607814, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[658.624804, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[658.641794, "o", "    boolean ops.\r\n"]
[658.658784, "o", "    \"\"\"\r\n"]
[658.675773, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[658.692763, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[658.709753, "o", "            warnings.warn(\r\n"]
[658.726742, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[658.743732, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[658.760722, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[658.777711, "o", "                stacklevel=find_stack_level(),\r\n"]
[658.794701, "o", "            )\r\n"]
[658.811691, "o", "            return True\r\n"]
[658.82868, "o", "    return False\r\n"]
[658.84567, "o", "\r\n"]
[658.86266, "o", "\r\n"]
[658.879649, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[658.896639, "o", "    \"\"\"\r\n"]
[658.913629, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[658.930619, "o", "\r\n"]
[658.947608, "o", "    Parameters\r\n"]
[658.964598, "o", "    ----------\r\n"]
[658.981588, "o", "    op : the actual operand\r\n"]
[658.998577, "o", "    left_op : left operand\r\n"]
[659.015567, "o", "    right_op : right operand\r\n"]
[659.032557, "o", "    use_numexpr : bool, default True\r\n"]
[659.049546, "o", "        Whether to try to use numexpr.\r\n"]
[659.066536, "o", "    \"\"\"\r\n"]
[659.083526, "o", "    op_str = _op_str_mapping[op]\r\n"]
[659.100515, "o", "    if op_str is not None:\r\n"]
[659.117505, "o", "        if use_numexpr:\r\n"]
[659.134495, "o", "            # error: \"None\" not callable\r\n"]
[659.151485, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[659.168474, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[659.185464, "o", "\r\n"]
[659.202454, "o", "\r\n"]
[659.219443, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[659.236433, "o", "    \"\"\"\r\n"]
[659.253423, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[659.270412, "o", "\r\n"]
[659.287402, "o", "    Parameters\r\n"]
[659.304392, "o", "    ----------\r\n"]
[659.321381, "o", "    cond : np.ndarray[bool]\r\n"]
[659.338371, "o", "    left_op : return if cond is True\r\n"]
[659.355361, "o", "    right_op : return if cond is False\r\n"]
[659.372351, "o", "    use_numexpr : bool, default True\r\n"]
[659.38934, "o", "        Whether to try to use numexpr.\r\n"]
[659.40633, "o", "    \"\"\"\r\n"]
[659.42332, "o", "    assert _where is not None\r\n"]
[659.440309, "o", "    if use_numexpr:\r\n"]
[659.457299, "o", "        return _where(cond, left_op, right_op)\r\n"]
[659.474289, "o", "    else:\r\n"]
[659.491278, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[659.508268, "o", "\r\n"]
[659.525258, "o", "\r\n"]
[659.542247, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[659.559237, "o", "    \"\"\"\r\n"]
[659.576227, "o", "    Keeps track of whether numexpr was used.\r\n"]
[659.593216, "o", "\r\n"]
[659.610206, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[659.627196, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[659.644186, "o", "    \"\"\"\r\n"]
[659.661175, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[659.678165, "o", "    _TEST_MODE = v\r\n"]
[659.695155, "o", "    _TEST_RESULT = []\r\n"]
[659.712144, "o", "\r\n"]
[659.729134, "o", "\r\n"]
[659.746124, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[659.763113, "o", "    if used_numexpr:\r\n"]
[659.780103, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[659.797093, "o", "\r\n"]
[659.814082, "o", "\r\n"]
[659.831072, "o", "def get_test_result() -> list[bool]:\r\n"]
[659.848062, "o", "    \"\"\"\r\n"]
[659.865052, "o", "    Get test result and reset test_results.\r\n"]
[659.882041, "o", "    \"\"\"\r\n"]
[659.899031, "o", "    global _TEST_RESULT\r\n"]
[659.916021, "o", "    res = _TEST_RESULT\r\n"]
[659.93301, "o", "    _TEST_RESULT = []\r\n"]
[660.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[660.002, "i", "python - << 'PY'\r"]
[660.004, "o", "python - << 'PY'\r\n"]
[660.072811, "o", "\u001b[?2004l\r\n"]
[660.139622, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[660.206432, "o", "\u001b[?2004l\r\n"]
[660.273243, "o", "\u001b[?2004h> import re\r\n"]
[660.340054, "o", "\u001b[?2004l\r\n"]
[660.406865, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[660.473676, "o", "\u001b[?2004l\r\n"]
[660.540486, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[660.607297, "o", "\u001b[?2004l\r\n"]
[660.674108, "o", "\u001b[?2004h> changed = False\r\n"]
[660.740919, "o", "\u001b[?2004l\r\n"]
[660.80773, "o", "\u001b[?2004h> # Try to bump an existing threshold constant first\r\n"]
[660.874541, "o", "\u001b[?2004l\r\n"]
[660.941351, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[661.008162, "o", "\u001b[?2004l\r\n"]
[661.074973, "o", "\u001b[?2004h> if n == 0:\r\n"]
[661.141784, "o", "\u001b[?2004l\r\n"]
[661.208595, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[661.275405, "o", "\u001b[?2004l\r\n"]
[661.342216, "o", "\u001b[?2004h> if n > 0:\r\n"]
[661.409027, "o", "\u001b[?2004l\r\n"]
[661.475838, "o", "\u001b[?2004h>     src = new_src\r\n"]
[661.542649, "o", "\u001b[?2004l\r\n"]
[661.609459, "o", "\u001b[?2004h>     changed = True\r\n"]
[661.67627, "o", "\u001b[?2004l\r\n"]
[661.743081, "o", "\u001b[?2004h> else:\r\n"]
[661.809892, "o", "\u001b[?2004l\r\n"]
[661.876703, "o", "\u001b[?2004h>     # Inject early size-based bypass in should_use_numexpr\r\n"]
[661.943514, "o", "\u001b[?2004l\r\n"]
[662.010324, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[662.077135, "o", "\u001b[?2004l\r\n"]
[662.143946, "o", "\u001b[?2004h>     if m:\r\n"]
[662.210757, "o", "\u001b[?2004l\r\n"]
[662.277568, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[662.344378, "o", "\u001b[?2004l\r\n"]
[662.411189, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+800]:\r\n"]
[662.478, "o", "\u001b[?2004l\r\n"]
[662.544811, "o", "\u001b[?2004h>             inject = (\r\n"]
[662.611622, "o", "\u001b[?2004l\r\n"]
[662.678432, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[662.745243, "o", "\u001b[?2004l\r\n"]
[662.812054, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[662.878865, "o", "\u001b[?2004l\r\n"]
[662.945676, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[663.012486, "o", "\u001b[?2004l\r\n"]
[663.079297, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[663.146108, "o", "\u001b[?2004l\r\n"]
[663.212919, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[663.27973, "o", "\u001b[?2004l\r\n"]
[663.346541, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[663.413351, "o", "\u001b[?2004l\r\n"]
[663.480162, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[663.546973, "o", "\u001b[?2004l\r\n"]
[663.613784, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[663.680595, "o", "\u001b[?2004l\r\n"]
[663.747405, "o", "\u001b[?2004h>             )\r\n"]
[663.814216, "o", "\u001b[?2004l\r\n"]
[663.881027, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[663.947838, "o", "\u001b[?2004l\r\n"]
[664.014649, "o", "\u001b[?2004h>             changed = True\r\n"]
[664.081459, "o", "\u001b[?2004l\r\n"]
[664.14827, "o", "\u001b[?2004h> if changed:\r\n"]
[664.215081, "o", "\u001b[?2004l\r\n"]
[664.281892, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[664.348703, "o", "\u001b[?2004l\r\n"]
[664.415514, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[664.482324, "o", "\u001b[?2004l\r\n"]
[664.549135, "o", "\u001b[?2004h> else:\r\n"]
[664.615946, "o", "\u001b[?2004l\r\n"]
[664.682757, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[664.749568, "o", "\u001b[?2004l\r\n"]
[664.816378, "o", "\u001b[?2004h> PY\r\n"]
[664.883189, "o", "\u001b[?2004l\r\n"]
[665.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[665.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[665.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[665.006, "o", "\u001b[?2004l\r\n"]
[670.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[670.002, "i", "git add pandas/core/computation/expressions.py\r"]
[670.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[670.006, "o", "\u001b[?2004l\r\n"]
[675.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[675.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via raised size threshold to reduce overhea\r"]
[675.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via raised size threshold to reduce overhea\r\n"]
[675.624, "o", "ad; improves arithmetic.Ops.*\"\r\n"]
[676.242, "o", "\u001b[?2004l\r\n"]
[676.86, "o", "On branch main\r\n"]
[677.478, "o", "Untracked files:\r\n"]
[678.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[678.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[679.332, "o", "\r\n"]
[680.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[680.002, "i", "cd asv_bench\r"]
[680.004, "o", "cd asv_bench\r\n"]
[680.006, "o", "\u001b[?2004l\r\n"]
[685.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[685.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[685.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[685.097556, "o", "\u001b[?2004l\r\n"]
[685.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[685.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[685.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[685.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[685.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[685.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[685.738444, "o", "             --                      threads          \r\n"]
[685.83, "o", "             ------------- ---------------------------\r\n"]
[685.921556, "o", "              use_numexpr     default          1      \r\n"]
[686.013111, "o", "             ============= ============= =============\r\n"]
[686.104667, "o", "                  True      2.04\u00b10.03ms   2.02\u00b10.02ms \r\n"]
[686.196222, "o", "                 False      2.02\u00b10.02ms   2.00\u00b10.02ms \r\n"]
[686.287778, "o", "             ============= ============= =============\r\n"]
[686.379333, "o", "\r\n"]
[686.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[686.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[686.654, "o", "             --                      threads          \r\n"]
[686.745556, "o", "             ------------- ---------------------------\r\n"]
[686.837111, "o", "              use_numexpr     default          1      \r\n"]
[686.928667, "o", "             ============= ============= =============\r\n"]
[687.020222, "o", "                  True      1.57\u00b10.01ms   1.60\u00b10.01ms \r\n"]
[687.111778, "o", "                 False      1.57\u00b10.03ms   1.56\u00b10.03ms \r\n"]
[687.203333, "o", "             ============= ============= =============\r\n"]
[687.294889, "o", "\r\n"]
[687.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[687.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[687.569556, "o", "             --                      threads          \r\n"]
[687.661111, "o", "             ------------- ---------------------------\r\n"]
[687.752667, "o", "              use_numexpr     default          1      \r\n"]
[687.844222, "o", "             ============= ============= =============\r\n"]
[687.935778, "o", "                  True      2.02\u00b10.06ms   1.99\u00b10.03ms \r\n"]
[688.027333, "o", "                 False      1.96\u00b10.02ms   1.98\u00b10.03ms \r\n"]
[688.118889, "o", "             ============= ============= =============\r\n"]
[688.210444, "o", "\r\n"]
[688.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[688.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[688.485111, "o", "             --                      threads          \r\n"]
[688.576667, "o", "             ------------- ---------------------------\r\n"]
[688.668222, "o", "              use_numexpr     default          1      \r\n"]
[688.759778, "o", "             ============= ============= =============\r\n"]
[688.851333, "o", "                  True      9.68\u00b10.03ms   9.67\u00b10.02ms \r\n"]
[688.942889, "o", "                 False      9.69\u00b10.05ms   9.65\u00b10.03ms \r\n"]
[689.034444, "o", "             ============= ============= =============\r\n"]
[689.126, "o", "\r\n"]
[689.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          44.9\u00b10.4ms\r\n"]
[689.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.3\u00b10.09ms\r\n"]
[689.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              634\u00b110\u03bcs\r\n"]
[689.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                         19.0\u00b10.08ms\r\n"]
[689.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    24.9\u00b10.1ms\r\n"]
[689.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.39\u00b10.03ms\r\n"]
[689.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      10.8\u00b10.1ms\r\n"]
[689.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     428\u00b120\u03bcs\r\n"]
[690.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[690.002, "i", "cd ..\r"]
[690.004, "o", "cd ..\r\n"]
[690.006, "o", "\u001b[?2004l\r\n"]
[695.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[695.002, "i", "git status -sb\r"]
[695.004, "o", "git status -sb\r\n"]
[696.654, "o", "\u001b[?2004l\r\n"]
[698.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[700.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[700.002, "i", "grep -RIn \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation || true\r"]
[700.004, "o", "grep -RIn \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation || true\r\n"]
[701.654, "o", "\u001b[?2004l\r\n"]
[703.302, "o", "\u001b[35m\u001b[Kpandas/core/computation/expressions.py\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[705.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[705.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py\r"]
[705.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py\r\n"]
[705.024943, "o", "\u001b[?2004l\r\n"]
[705.043885, "o", "\"\"\"\r\n"]
[705.062828, "o", "Expressions\r\n"]
[705.08177, "o", "-----------\r\n"]
[705.100713, "o", "\r\n"]
[705.119655, "o", "Offer fast expression evaluation through numexpr\r\n"]
[705.138598, "o", "\r\n"]
[705.15754, "o", "\"\"\"\r\n"]
[705.176483, "o", "\r\n"]
[705.195425, "o", "from __future__ import annotations\r\n"]
[705.214368, "o", "\r\n"]
[705.23331, "o", "import operator\r\n"]
[705.252253, "o", "from typing import TYPE_CHECKING\r\n"]
[705.271195, "o", "import warnings\r\n"]
[705.290138, "o", "\r\n"]
[705.30908, "o", "import numpy as np\r\n"]
[705.328023, "o", "\r\n"]
[705.346966, "o", "from pandas._config import get_option\r\n"]
[705.365908, "o", "\r\n"]
[705.384851, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[705.403793, "o", "\r\n"]
[705.422736, "o", "from pandas.core import roperator\r\n"]
[705.441678, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[705.460621, "o", "\r\n"]
[705.479563, "o", "if NUMEXPR_INSTALLED:\r\n"]
[705.498506, "o", "    import numexpr as ne\r\n"]
[705.517448, "o", "\r\n"]
[705.536391, "o", "if TYPE_CHECKING:\r\n"]
[705.555333, "o", "    from pandas._typing import FuncType\r\n"]
[705.574276, "o", "\r\n"]
[705.593218, "o", "_TEST_MODE: bool | None = None\r\n"]
[705.612161, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[705.631103, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[705.650046, "o", "_evaluate: FuncType | None = None\r\n"]
[705.668989, "o", "_where: FuncType | None = None\r\n"]
[705.687931, "o", "\r\n"]
[705.706874, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[705.725816, "o", "_ALLOWED_DTYPES = {\r\n"]
[705.744759, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[705.763701, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[705.782644, "o", "}\r\n"]
[705.801586, "o", "\r\n"]
[705.820529, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[705.839471, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[705.858414, "o", "\r\n"]
[705.877356, "o", "\r\n"]
[705.896299, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[705.915241, "o", "    # set/unset to use numexpr\r\n"]
[705.934184, "o", "    global USE_NUMEXPR\r\n"]
[705.953126, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[705.972069, "o", "        USE_NUMEXPR = v\r\n"]
[705.991011, "o", "\r\n"]
[706.009954, "o", "    # choose what we are going to do\r\n"]
[706.028897, "o", "    global _evaluate, _where\r\n"]
[706.047839, "o", "\r\n"]
[706.066782, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[706.085724, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[706.104667, "o", "\r\n"]
[706.123609, "o", "\r\n"]
[706.142552, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[706.161494, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[706.180437, "o", "    # otherwise reset\r\n"]
[706.199379, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[706.218322, "o", "        if n is None:\r\n"]
[706.237264, "o", "            n = ne.detect_number_of_cores()\r\n"]
[706.256207, "o", "        ne.set_num_threads(n)\r\n"]
[706.275149, "o", "\r\n"]
[706.294092, "o", "\r\n"]
[706.313034, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[706.331977, "o", "    \"\"\"\r\n"]
[706.35092, "o", "    Standard evaluation.\r\n"]
[706.369862, "o", "    \"\"\"\r\n"]
[706.388805, "o", "    if _TEST_MODE:\r\n"]
[706.407747, "o", "        _store_test_result(False)\r\n"]
[706.42669, "o", "    return op(left_op, right_op)\r\n"]
[706.445632, "o", "\r\n"]
[706.464575, "o", "\r\n"]
[706.483517, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[706.50246, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[706.521402, "o", "    if op_str is not None:\r\n"]
[706.540345, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[706.559287, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[706.57823, "o", "            # check for dtype compatibility\r\n"]
[706.597172, "o", "            dtypes: set[str] = set()\r\n"]
[706.616115, "o", "            for o in [left_op, right_op]:\r\n"]
[706.635057, "o", "                # ndarray and Series Case\r\n"]
[706.654, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[706.672943, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[706.691885, "o", "\r\n"]
[706.710828, "o", "            # allowed are a superset\r\n"]
[706.72977, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[706.748713, "o", "                return True\r\n"]
[706.767655, "o", "\r\n"]
[706.786598, "o", "    return False\r\n"]
[706.80554, "o", "\r\n"]
[706.824483, "o", "\r\n"]
[706.843425, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[706.862368, "o", "    result = None\r\n"]
[706.88131, "o", "\r\n"]
[706.900253, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[706.919195, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[706.938138, "o", "        if is_reversed:\r\n"]
[706.95708, "o", "            # we were originally called by a reversed op method\r\n"]
[706.976023, "o", "            left_op, right_op = right_op, left_op\r\n"]
[706.994966, "o", "\r\n"]
[707.013908, "o", "        left_value = left_op\r\n"]
[707.032851, "o", "        right_value = right_op\r\n"]
[707.051793, "o", "\r\n"]
[707.070736, "o", "        try:\r\n"]
[707.089678, "o", "            result = ne.evaluate(\r\n"]
[707.108621, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[707.127563, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[707.146506, "o", "                casting=\"safe\",\r\n"]
[707.165448, "o", "            )\r\n"]
[707.184391, "o", "        except TypeError:\r\n"]
[707.203333, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[707.222276, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[707.241218, "o", "            pass\r\n"]
[707.260161, "o", "        except NotImplementedError:\r\n"]
[707.279103, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[707.298046, "o", "                pass\r\n"]
[707.316989, "o", "            else:\r\n"]
[707.335931, "o", "                raise\r\n"]
[707.354874, "o", "\r\n"]
[707.373816, "o", "        if is_reversed:\r\n"]
[707.392759, "o", "            # reverse order to original for fallback\r\n"]
[707.411701, "o", "            left_op, right_op = right_op, left_op\r\n"]
[707.430644, "o", "\r\n"]
[707.449586, "o", "    if _TEST_MODE:\r\n"]
[707.468529, "o", "        _store_test_result(result is not None)\r\n"]
[707.487471, "o", "\r\n"]
[707.506414, "o", "    if result is None:\r\n"]
[707.525356, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[707.544299, "o", "\r\n"]
[707.563241, "o", "    return result\r\n"]
[707.582184, "o", "\r\n"]
[707.601126, "o", "\r\n"]
[707.620069, "o", "_op_str_mapping = {\r\n"]
[707.639011, "o", "    operator.add: \"+\",\r\n"]
[707.657954, "o", "    roperator.radd: \"+\",\r\n"]
[707.676897, "o", "    operator.mul: \"*\",\r\n"]
[707.695839, "o", "    roperator.rmul: \"*\",\r\n"]
[707.714782, "o", "    operator.sub: \"-\",\r\n"]
[707.733724, "o", "    roperator.rsub: \"-\",\r\n"]
[707.752667, "o", "    operator.truediv: \"/\",\r\n"]
[707.771609, "o", "    roperator.rtruediv: \"/\",\r\n"]
[707.790552, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[707.809494, "o", "    operator.floordiv: None,\r\n"]
[707.828437, "o", "    roperator.rfloordiv: None,\r\n"]
[707.847379, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[707.866322, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[707.885264, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[707.904207, "o", "    operator.mod: None,\r\n"]
[707.923149, "o", "    roperator.rmod: None,\r\n"]
[707.942092, "o", "    operator.pow: \"**\",\r\n"]
[707.961034, "o", "    roperator.rpow: \"**\",\r\n"]
[707.979977, "o", "    operator.eq: \"==\",\r\n"]
[707.99892, "o", "    operator.ne: \"!=\",\r\n"]
[708.017862, "o", "    operator.le: \"<=\",\r\n"]
[708.036805, "o", "    operator.lt: \"<\",\r\n"]
[708.055747, "o", "    operator.ge: \">=\",\r\n"]
[708.07469, "o", "    operator.gt: \">\",\r\n"]
[708.093632, "o", "    operator.and_: \"&\",\r\n"]
[708.112575, "o", "    roperator.rand_: \"&\",\r\n"]
[708.131517, "o", "    operator.or_: \"|\",\r\n"]
[708.15046, "o", "    roperator.ror_: \"|\",\r\n"]
[708.169402, "o", "    operator.xor: \"^\",\r\n"]
[708.188345, "o", "    roperator.rxor: \"^\",\r\n"]
[708.207287, "o", "    divmod: None,\r\n"]
[708.22623, "o", "    roperator.rdivmod: None,\r\n"]
[708.245172, "o", "}\r\n"]
[708.264115, "o", "\r\n"]
[708.283057, "o", "\r\n"]
[708.302, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[708.320943, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[708.339885, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[708.358828, "o", "\r\n"]
[708.37777, "o", "\r\n"]
[708.396713, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[708.415655, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[708.434598, "o", "    result = None\r\n"]
[708.45354, "o", "\r\n"]
[708.472483, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[708.491425, "o", "        result = ne.evaluate(\r\n"]
[708.510368, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[708.52931, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[708.548253, "o", "            casting=\"safe\",\r\n"]
[708.567195, "o", "        )\r\n"]
[708.586138, "o", "\r\n"]
[708.60508, "o", "    if result is None:\r\n"]
[708.624023, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[708.642966, "o", "\r\n"]
[708.661908, "o", "    return result\r\n"]
[708.680851, "o", "\r\n"]
[708.699793, "o", "\r\n"]
[708.718736, "o", "# turn myself on\r\n"]
[708.737678, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[708.756621, "o", "\r\n"]
[708.775563, "o", "\r\n"]
[708.794506, "o", "def _has_bool_dtype(x):\r\n"]
[708.813448, "o", "    try:\r\n"]
[708.832391, "o", "        return x.dtype == bool\r\n"]
[708.851333, "o", "    except AttributeError:\r\n"]
[708.870276, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[708.889218, "o", "\r\n"]
[708.908161, "o", "\r\n"]
[708.927103, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[708.946046, "o", "\r\n"]
[708.964989, "o", "\r\n"]
[708.983931, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[709.002874, "o", "    \"\"\"\r\n"]
[709.021816, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[709.040759, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[709.059701, "o", "    boolean ops.\r\n"]
[709.078644, "o", "    \"\"\"\r\n"]
[709.097586, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[709.116529, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[709.135471, "o", "            warnings.warn(\r\n"]
[709.154414, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[709.173356, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[709.192299, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[709.211241, "o", "                stacklevel=find_stack_level(),\r\n"]
[709.230184, "o", "            )\r\n"]
[709.249126, "o", "            return True\r\n"]
[709.268069, "o", "    return False\r\n"]
[709.287011, "o", "\r\n"]
[709.305954, "o", "\r\n"]
[709.324897, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[709.343839, "o", "    \"\"\"\r\n"]
[709.362782, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[709.381724, "o", "\r\n"]
[709.400667, "o", "    Parameters\r\n"]
[709.419609, "o", "    ----------\r\n"]
[709.438552, "o", "    op : the actual operand\r\n"]
[709.457494, "o", "    left_op : left operand\r\n"]
[709.476437, "o", "    right_op : right operand\r\n"]
[709.495379, "o", "    use_numexpr : bool, default True\r\n"]
[709.514322, "o", "        Whether to try to use numexpr.\r\n"]
[709.533264, "o", "    \"\"\"\r\n"]
[709.552207, "o", "    op_str = _op_str_mapping[op]\r\n"]
[709.571149, "o", "    if op_str is not None:\r\n"]
[709.590092, "o", "        if use_numexpr:\r\n"]
[709.609034, "o", "            # error: \"None\" not callable\r\n"]
[709.627977, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[709.64692, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[709.665862, "o", "\r\n"]
[709.684805, "o", "\r\n"]
[709.703747, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[709.72269, "o", "    \"\"\"\r\n"]
[709.741632, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[709.760575, "o", "\r\n"]
[709.779517, "o", "    Parameters\r\n"]
[709.79846, "o", "    ----------\r\n"]
[709.817402, "o", "    cond : np.ndarray[bool]\r\n"]
[709.836345, "o", "    left_op : return if cond is True\r\n"]
[709.855287, "o", "    right_op : return if cond is False\r\n"]
[709.87423, "o", "    use_numexpr : bool, default True\r\n"]
[709.893172, "o", "        Whether to try to use numexpr.\r\n"]
[709.912115, "o", "    \"\"\"\r\n"]
[709.931057, "o", "    assert _where is not None\r\n"]
[710.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[710.002, "i", "python - << 'PY'\r"]
[710.004, "o", "python - << 'PY'\r\n"]
[710.072811, "o", "\u001b[?2004l\r\n"]
[710.139622, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[710.206432, "o", "\u001b[?2004l\r\n"]
[710.273243, "o", "\u001b[?2004h> import re\r\n"]
[710.340054, "o", "\u001b[?2004l\r\n"]
[710.406865, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[710.473676, "o", "\u001b[?2004l\r\n"]
[710.540486, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[710.607297, "o", "\u001b[?2004l\r\n"]
[710.674108, "o", "\u001b[?2004h> changed = False\r\n"]
[710.740919, "o", "\u001b[?2004l\r\n"]
[710.80773, "o", "\u001b[?2004h> # First try to bump an existing threshold constant if present\r\n"]
[710.874541, "o", "\u001b[?2004l\r\n"]
[710.941351, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[711.008162, "o", "\u001b[?2004l\r\n"]
[711.074973, "o", "\u001b[?2004h> if n == 0:\r\n"]
[711.141784, "o", "\u001b[?2004l\r\n"]
[711.208595, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[711.275405, "o", "\u001b[?2004l\r\n"]
[711.342216, "o", "\u001b[?2004h> if n > 0:\r\n"]
[711.409027, "o", "\u001b[?2004l\r\n"]
[711.475838, "o", "\u001b[?2004h>     src = new_src\r\n"]
[711.542649, "o", "\u001b[?2004l\r\n"]
[711.609459, "o", "\u001b[?2004h>     changed = True\r\n"]
[711.67627, "o", "\u001b[?2004l\r\n"]
[711.743081, "o", "\u001b[?2004h> else:\r\n"]
[711.809892, "o", "\u001b[?2004l\r\n"]
[711.876703, "o", "\u001b[?2004h>     # Inject early bypass into should_use_numexpr for moderate sizes\r\n"]
[711.943514, "o", "\u001b[?2004l\r\n"]
[712.010324, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[712.077135, "o", "\u001b[?2004l\r\n"]
[712.143946, "o", "\u001b[?2004h>     if m:\r\n"]
[712.210757, "o", "\u001b[?2004l\r\n"]
[712.277568, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[712.344378, "o", "\u001b[?2004l\r\n"]
[712.411189, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+800]:\r\n"]
[712.478, "o", "\u001b[?2004l\r\n"]
[712.544811, "o", "\u001b[?2004h>             inject = (\r\n"]
[712.611622, "o", "\u001b[?2004l\r\n"]
[712.678432, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[712.745243, "o", "\u001b[?2004l\r\n"]
[712.812054, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[712.878865, "o", "\u001b[?2004l\r\n"]
[712.945676, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[713.012486, "o", "\u001b[?2004l\r\n"]
[713.079297, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[713.146108, "o", "\u001b[?2004l\r\n"]
[713.212919, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[713.27973, "o", "\u001b[?2004l\r\n"]
[713.346541, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[713.413351, "o", "\u001b[?2004l\r\n"]
[713.480162, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[713.546973, "o", "\u001b[?2004l\r\n"]
[713.613784, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[713.680595, "o", "\u001b[?2004l\r\n"]
[713.747405, "o", "\u001b[?2004h>             )\r\n"]
[713.814216, "o", "\u001b[?2004l\r\n"]
[713.881027, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[713.947838, "o", "\u001b[?2004l\r\n"]
[714.014649, "o", "\u001b[?2004h>             changed = True\r\n"]
[714.081459, "o", "\u001b[?2004l\r\n"]
[714.14827, "o", "\u001b[?2004h> if changed:\r\n"]
[714.215081, "o", "\u001b[?2004l\r\n"]
[714.281892, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[714.348703, "o", "\u001b[?2004l\r\n"]
[714.415514, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[714.482324, "o", "\u001b[?2004l\r\n"]
[714.549135, "o", "\u001b[?2004h> else:\r\n"]
[714.615946, "o", "\u001b[?2004l\r\n"]
[714.682757, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[714.749568, "o", "\u001b[?2004l\r\n"]
[714.816378, "o", "\u001b[?2004h> PY\r\n"]
[714.883189, "o", "\u001b[?2004l\r\n"]
[715.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[715.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[715.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[715.006, "o", "\u001b[?2004l\r\n"]
[720.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[720.002, "i", "git add pandas/core/computation/expressions.py\r"]
[720.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[720.006, "o", "\u001b[?2004l\r\n"]
[725.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[725.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[725.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[725.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[726.242, "o", "\u001b[?2004l\r\n"]
[726.86, "o", "On branch main\r\n"]
[727.478, "o", "Untracked files:\r\n"]
[728.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[728.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[729.332, "o", "\r\n"]
[730.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[730.002, "i", "cd asv_bench\r"]
[730.004, "o", "cd asv_bench\r\n"]
[730.006, "o", "\u001b[?2004l\r\n"]
[735.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[735.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[735.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[735.097556, "o", "\u001b[?2004l\r\n"]
[735.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[735.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[735.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[735.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[735.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[735.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[735.738444, "o", "             --                      threads          \r\n"]
[735.83, "o", "             ------------- ---------------------------\r\n"]
[735.921556, "o", "              use_numexpr     default          1      \r\n"]
[736.013111, "o", "             ============= ============= =============\r\n"]
[736.104667, "o", "                  True      1.98\u00b10.05ms   1.99\u00b10.05ms \r\n"]
[736.196222, "o", "                 False      2.02\u00b10.03ms   2.00\u00b10.04ms \r\n"]
[736.287778, "o", "             ============= ============= =============\r\n"]
[736.379333, "o", "\r\n"]
[736.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[736.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[736.654, "o", "             --                      threads          \r\n"]
[736.745556, "o", "             ------------- ---------------------------\r\n"]
[736.837111, "o", "              use_numexpr     default          1      \r\n"]
[736.928667, "o", "             ============= ============= =============\r\n"]
[737.020222, "o", "                  True      1.58\u00b10.02ms   1.58\u00b10.04ms \r\n"]
[737.111778, "o", "                 False      1.56\u00b10.03ms   1.57\u00b10.02ms \r\n"]
[737.203333, "o", "             ============= ============= =============\r\n"]
[737.294889, "o", "\r\n"]
[737.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[737.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[737.569556, "o", "             --                      threads          \r\n"]
[737.661111, "o", "             ------------- ---------------------------\r\n"]
[737.752667, "o", "              use_numexpr     default          1      \r\n"]
[737.844222, "o", "             ============= ============= =============\r\n"]
[737.935778, "o", "                  True      1.95\u00b10.05ms   2.01\u00b10.05ms \r\n"]
[738.027333, "o", "                 False      2.01\u00b10.07ms   1.99\u00b10.03ms \r\n"]
[738.118889, "o", "             ============= ============= =============\r\n"]
[738.210444, "o", "\r\n"]
[738.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[738.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[738.485111, "o", "             --                      threads          \r\n"]
[738.576667, "o", "             ------------- ---------------------------\r\n"]
[738.668222, "o", "              use_numexpr     default          1      \r\n"]
[738.759778, "o", "             ============= ============= =============\r\n"]
[738.851333, "o", "                  True       9.84\u00b10.2ms   9.83\u00b10.06ms \r\n"]
[738.942889, "o", "                 False      9.79\u00b10.07ms   9.80\u00b10.06ms \r\n"]
[739.034444, "o", "             ============= ============= =============\r\n"]
[739.126, "o", "\r\n"]
[739.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          45.8\u00b10.3ms\r\n"]
[739.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.4\u00b10.04ms\r\n"]
[739.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              729\u00b110\u03bcs\r\n"]
[739.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.3\u00b10.1ms\r\n"]
[739.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    25.0\u00b10.2ms\r\n"]
[739.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.38\u00b10.02ms\r\n"]
[739.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      10.4\u00b10.1ms\r\n"]
[739.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      429\u00b12\u03bcs\r\n"]
[740.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[740.002, "i", "cd ..\r"]
[740.004, "o", "cd ..\r\n"]
[740.006, "o", "\u001b[?2004l\r\n"]
[745.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[745.002, "i", "git status -sb\r"]
[745.004, "o", "git status -sb\r\n"]
[746.654, "o", "\u001b[?2004l\r\n"]
[748.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[750.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[750.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r"]
[750.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r\n"]
[751.654, "o", "\u001b[?2004l\r\n"]
[753.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[755.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[755.002, "i", "sed -n '1,300p' pandas/core/computation/expressions.py\r"]
[755.004, "o", "sed -n '1,300p' pandas/core/computation/expressions.py\r\n"]
[755.02299, "o", "\u001b[?2004l\r\n"]
[755.039979, "o", "\"\"\"\r\n"]
[755.056969, "o", "Expressions\r\n"]
[755.073959, "o", "-----------\r\n"]
[755.090948, "o", "\r\n"]
[755.107938, "o", "Offer fast expression evaluation through numexpr\r\n"]
[755.124928, "o", "\r\n"]
[755.141918, "o", "\"\"\"\r\n"]
[755.158907, "o", "\r\n"]
[755.175897, "o", "from __future__ import annotations\r\n"]
[755.192887, "o", "\r\n"]
[755.209876, "o", "import operator\r\n"]
[755.226866, "o", "from typing import TYPE_CHECKING\r\n"]
[755.243856, "o", "import warnings\r\n"]
[755.260845, "o", "\r\n"]
[755.277835, "o", "import numpy as np\r\n"]
[755.294825, "o", "\r\n"]
[755.311814, "o", "from pandas._config import get_option\r\n"]
[755.328804, "o", "\r\n"]
[755.345794, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[755.362784, "o", "\r\n"]
[755.379773, "o", "from pandas.core import roperator\r\n"]
[755.396763, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[755.413753, "o", "\r\n"]
[755.430742, "o", "if NUMEXPR_INSTALLED:\r\n"]
[755.447732, "o", "    import numexpr as ne\r\n"]
[755.464722, "o", "\r\n"]
[755.481711, "o", "if TYPE_CHECKING:\r\n"]
[755.498701, "o", "    from pandas._typing import FuncType\r\n"]
[755.515691, "o", "\r\n"]
[755.53268, "o", "_TEST_MODE: bool | None = None\r\n"]
[755.54967, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[755.56666, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[755.583649, "o", "_evaluate: FuncType | None = None\r\n"]
[755.600639, "o", "_where: FuncType | None = None\r\n"]
[755.617629, "o", "\r\n"]
[755.634619, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[755.651608, "o", "_ALLOWED_DTYPES = {\r\n"]
[755.668598, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[755.685588, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[755.702577, "o", "}\r\n"]
[755.719567, "o", "\r\n"]
[755.736557, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[755.753546, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[755.770536, "o", "\r\n"]
[755.787526, "o", "\r\n"]
[755.804515, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[755.821505, "o", "    # set/unset to use numexpr\r\n"]
[755.838495, "o", "    global USE_NUMEXPR\r\n"]
[755.855485, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[755.872474, "o", "        USE_NUMEXPR = v\r\n"]
[755.889464, "o", "\r\n"]
[755.906454, "o", "    # choose what we are going to do\r\n"]
[755.923443, "o", "    global _evaluate, _where\r\n"]
[755.940433, "o", "\r\n"]
[755.957423, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[755.974412, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[755.991402, "o", "\r\n"]
[756.008392, "o", "\r\n"]
[756.025381, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[756.042371, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[756.059361, "o", "    # otherwise reset\r\n"]
[756.076351, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[756.09334, "o", "        if n is None:\r\n"]
[756.11033, "o", "            n = ne.detect_number_of_cores()\r\n"]
[756.12732, "o", "        ne.set_num_threads(n)\r\n"]
[756.144309, "o", "\r\n"]
[756.161299, "o", "\r\n"]
[756.178289, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[756.195278, "o", "    \"\"\"\r\n"]
[756.212268, "o", "    Standard evaluation.\r\n"]
[756.229258, "o", "    \"\"\"\r\n"]
[756.246247, "o", "    if _TEST_MODE:\r\n"]
[756.263237, "o", "        _store_test_result(False)\r\n"]
[756.280227, "o", "    return op(left_op, right_op)\r\n"]
[756.297216, "o", "\r\n"]
[756.314206, "o", "\r\n"]
[756.331196, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[756.348186, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[756.365175, "o", "    if op_str is not None:\r\n"]
[756.382165, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[756.399155, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[756.416144, "o", "            # check for dtype compatibility\r\n"]
[756.433134, "o", "            dtypes: set[str] = set()\r\n"]
[756.450124, "o", "            for o in [left_op, right_op]:\r\n"]
[756.467113, "o", "                # ndarray and Series Case\r\n"]
[756.484103, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[756.501093, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[756.518082, "o", "\r\n"]
[756.535072, "o", "            # allowed are a superset\r\n"]
[756.552062, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[756.569052, "o", "                return True\r\n"]
[756.586041, "o", "\r\n"]
[756.603031, "o", "    return False\r\n"]
[756.620021, "o", "\r\n"]
[756.63701, "o", "\r\n"]
[756.654, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[756.67099, "o", "    result = None\r\n"]
[756.687979, "o", "\r\n"]
[756.704969, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[756.721959, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[756.738948, "o", "        if is_reversed:\r\n"]
[756.755938, "o", "            # we were originally called by a reversed op method\r\n"]
[756.772928, "o", "            left_op, right_op = right_op, left_op\r\n"]
[756.789918, "o", "\r\n"]
[756.806907, "o", "        left_value = left_op\r\n"]
[756.823897, "o", "        right_value = right_op\r\n"]
[756.840887, "o", "\r\n"]
[756.857876, "o", "        try:\r\n"]
[756.874866, "o", "            result = ne.evaluate(\r\n"]
[756.891856, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[756.908845, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[756.925835, "o", "                casting=\"safe\",\r\n"]
[756.942825, "o", "            )\r\n"]
[756.959814, "o", "        except TypeError:\r\n"]
[756.976804, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[756.993794, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[757.010784, "o", "            pass\r\n"]
[757.027773, "o", "        except NotImplementedError:\r\n"]
[757.044763, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[757.061753, "o", "                pass\r\n"]
[757.078742, "o", "            else:\r\n"]
[757.095732, "o", "                raise\r\n"]
[757.112722, "o", "\r\n"]
[757.129711, "o", "        if is_reversed:\r\n"]
[757.146701, "o", "            # reverse order to original for fallback\r\n"]
[757.163691, "o", "            left_op, right_op = right_op, left_op\r\n"]
[757.18068, "o", "\r\n"]
[757.19767, "o", "    if _TEST_MODE:\r\n"]
[757.21466, "o", "        _store_test_result(result is not None)\r\n"]
[757.231649, "o", "\r\n"]
[757.248639, "o", "    if result is None:\r\n"]
[757.265629, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[757.282619, "o", "\r\n"]
[757.299608, "o", "    return result\r\n"]
[757.316598, "o", "\r\n"]
[757.333588, "o", "\r\n"]
[757.350577, "o", "_op_str_mapping = {\r\n"]
[757.367567, "o", "    operator.add: \"+\",\r\n"]
[757.384557, "o", "    roperator.radd: \"+\",\r\n"]
[757.401546, "o", "    operator.mul: \"*\",\r\n"]
[757.418536, "o", "    roperator.rmul: \"*\",\r\n"]
[757.435526, "o", "    operator.sub: \"-\",\r\n"]
[757.452515, "o", "    roperator.rsub: \"-\",\r\n"]
[757.469505, "o", "    operator.truediv: \"/\",\r\n"]
[757.486495, "o", "    roperator.rtruediv: \"/\",\r\n"]
[757.503485, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[757.520474, "o", "    operator.floordiv: None,\r\n"]
[757.537464, "o", "    roperator.rfloordiv: None,\r\n"]
[757.554454, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[757.571443, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[757.588433, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[757.605423, "o", "    operator.mod: None,\r\n"]
[757.622412, "o", "    roperator.rmod: None,\r\n"]
[757.639402, "o", "    operator.pow: \"**\",\r\n"]
[757.656392, "o", "    roperator.rpow: \"**\",\r\n"]
[757.673381, "o", "    operator.eq: \"==\",\r\n"]
[757.690371, "o", "    operator.ne: \"!=\",\r\n"]
[757.707361, "o", "    operator.le: \"<=\",\r\n"]
[757.724351, "o", "    operator.lt: \"<\",\r\n"]
[757.74134, "o", "    operator.ge: \">=\",\r\n"]
[757.75833, "o", "    operator.gt: \">\",\r\n"]
[757.77532, "o", "    operator.and_: \"&\",\r\n"]
[757.792309, "o", "    roperator.rand_: \"&\",\r\n"]
[757.809299, "o", "    operator.or_: \"|\",\r\n"]
[757.826289, "o", "    roperator.ror_: \"|\",\r\n"]
[757.843278, "o", "    operator.xor: \"^\",\r\n"]
[757.860268, "o", "    roperator.rxor: \"^\",\r\n"]
[757.877258, "o", "    divmod: None,\r\n"]
[757.894247, "o", "    roperator.rdivmod: None,\r\n"]
[757.911237, "o", "}\r\n"]
[757.928227, "o", "\r\n"]
[757.945216, "o", "\r\n"]
[757.962206, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[757.979196, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[757.996186, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[758.013175, "o", "\r\n"]
[758.030165, "o", "\r\n"]
[758.047155, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[758.064144, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[758.081134, "o", "    result = None\r\n"]
[758.098124, "o", "\r\n"]
[758.115113, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[758.132103, "o", "        result = ne.evaluate(\r\n"]
[758.149093, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[758.166082, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[758.183072, "o", "            casting=\"safe\",\r\n"]
[758.200062, "o", "        )\r\n"]
[758.217052, "o", "\r\n"]
[758.234041, "o", "    if result is None:\r\n"]
[758.251031, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[758.268021, "o", "\r\n"]
[758.28501, "o", "    return result\r\n"]
[758.302, "o", "\r\n"]
[758.31899, "o", "\r\n"]
[758.335979, "o", "# turn myself on\r\n"]
[758.352969, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[758.369959, "o", "\r\n"]
[758.386948, "o", "\r\n"]
[758.403938, "o", "def _has_bool_dtype(x):\r\n"]
[758.420928, "o", "    try:\r\n"]
[758.437918, "o", "        return x.dtype == bool\r\n"]
[758.454907, "o", "    except AttributeError:\r\n"]
[758.471897, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[758.488887, "o", "\r\n"]
[758.505876, "o", "\r\n"]
[758.522866, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[758.539856, "o", "\r\n"]
[758.556845, "o", "\r\n"]
[758.573835, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[758.590825, "o", "    \"\"\"\r\n"]
[758.607814, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[758.624804, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[758.641794, "o", "    boolean ops.\r\n"]
[758.658784, "o", "    \"\"\"\r\n"]
[758.675773, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[758.692763, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[758.709753, "o", "            warnings.warn(\r\n"]
[758.726742, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[758.743732, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[758.760722, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[758.777711, "o", "                stacklevel=find_stack_level(),\r\n"]
[758.794701, "o", "            )\r\n"]
[758.811691, "o", "            return True\r\n"]
[758.82868, "o", "    return False\r\n"]
[758.84567, "o", "\r\n"]
[758.86266, "o", "\r\n"]
[758.879649, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[758.896639, "o", "    \"\"\"\r\n"]
[758.913629, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[758.930619, "o", "\r\n"]
[758.947608, "o", "    Parameters\r\n"]
[758.964598, "o", "    ----------\r\n"]
[758.981588, "o", "    op : the actual operand\r\n"]
[758.998577, "o", "    left_op : left operand\r\n"]
[759.015567, "o", "    right_op : right operand\r\n"]
[759.032557, "o", "    use_numexpr : bool, default True\r\n"]
[759.049546, "o", "        Whether to try to use numexpr.\r\n"]
[759.066536, "o", "    \"\"\"\r\n"]
[759.083526, "o", "    op_str = _op_str_mapping[op]\r\n"]
[759.100515, "o", "    if op_str is not None:\r\n"]
[759.117505, "o", "        if use_numexpr:\r\n"]
[759.134495, "o", "            # error: \"None\" not callable\r\n"]
[759.151485, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[759.168474, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[759.185464, "o", "\r\n"]
[759.202454, "o", "\r\n"]
[759.219443, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[759.236433, "o", "    \"\"\"\r\n"]
[759.253423, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[759.270412, "o", "\r\n"]
[759.287402, "o", "    Parameters\r\n"]
[759.304392, "o", "    ----------\r\n"]
[759.321381, "o", "    cond : np.ndarray[bool]\r\n"]
[759.338371, "o", "    left_op : return if cond is True\r\n"]
[759.355361, "o", "    right_op : return if cond is False\r\n"]
[759.372351, "o", "    use_numexpr : bool, default True\r\n"]
[759.38934, "o", "        Whether to try to use numexpr.\r\n"]
[759.40633, "o", "    \"\"\"\r\n"]
[759.42332, "o", "    assert _where is not None\r\n"]
[759.440309, "o", "    if use_numexpr:\r\n"]
[759.457299, "o", "        return _where(cond, left_op, right_op)\r\n"]
[759.474289, "o", "    else:\r\n"]
[759.491278, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[759.508268, "o", "\r\n"]
[759.525258, "o", "\r\n"]
[759.542247, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[759.559237, "o", "    \"\"\"\r\n"]
[759.576227, "o", "    Keeps track of whether numexpr was used.\r\n"]
[759.593216, "o", "\r\n"]
[759.610206, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[759.627196, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[759.644186, "o", "    \"\"\"\r\n"]
[759.661175, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[759.678165, "o", "    _TEST_MODE = v\r\n"]
[759.695155, "o", "    _TEST_RESULT = []\r\n"]
[759.712144, "o", "\r\n"]
[759.729134, "o", "\r\n"]
[759.746124, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[759.763113, "o", "    if used_numexpr:\r\n"]
[759.780103, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[759.797093, "o", "\r\n"]
[759.814082, "o", "\r\n"]
[759.831072, "o", "def get_test_result() -> list[bool]:\r\n"]
[759.848062, "o", "    \"\"\"\r\n"]
[759.865052, "o", "    Get test result and reset test_results.\r\n"]
[759.882041, "o", "    \"\"\"\r\n"]
[759.899031, "o", "    global _TEST_RESULT\r\n"]
[759.916021, "o", "    res = _TEST_RESULT\r\n"]
[759.93301, "o", "    _TEST_RESULT = []\r\n"]
[760.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[760.002, "i", "python - << 'PY'\r"]
[760.004, "o", "python - << 'PY'\r\n"]
[760.072811, "o", "\u001b[?2004l\r\n"]
[760.139622, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[760.206432, "o", "\u001b[?2004l\r\n"]
[760.273243, "o", "\u001b[?2004h> import re\r\n"]
[760.340054, "o", "\u001b[?2004l\r\n"]
[760.406865, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[760.473676, "o", "\u001b[?2004l\r\n"]
[760.540486, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[760.607297, "o", "\u001b[?2004l\r\n"]
[760.674108, "o", "\u001b[?2004h> changed = False\r\n"]
[760.740919, "o", "\u001b[?2004l\r\n"]
[760.80773, "o", "\u001b[?2004h> # Try to bump existing threshold constant if present\r\n"]
[760.874541, "o", "\u001b[?2004l\r\n"]
[760.941351, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[761.008162, "o", "\u001b[?2004l\r\n"]
[761.074973, "o", "\u001b[?2004h> if n == 0:\r\n"]
[761.141784, "o", "\u001b[?2004l\r\n"]
[761.208595, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[761.275405, "o", "\u001b[?2004l\r\n"]
[761.342216, "o", "\u001b[?2004h> if n > 0:\r\n"]
[761.409027, "o", "\u001b[?2004l\r\n"]
[761.475838, "o", "\u001b[?2004h>     src = new_src\r\n"]
[761.542649, "o", "\u001b[?2004l\r\n"]
[761.609459, "o", "\u001b[?2004h>     changed = True\r\n"]
[761.67627, "o", "\u001b[?2004l\r\n"]
[761.743081, "o", "\u001b[?2004h> else:\r\n"]
[761.809892, "o", "\u001b[?2004l\r\n"]
[761.876703, "o", "\u001b[?2004h>     # Inject early size-based bypass in should_use_numexpr\r\n"]
[761.943514, "o", "\u001b[?2004l\r\n"]
[762.010324, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[762.077135, "o", "\u001b[?2004l\r\n"]
[762.143946, "o", "\u001b[?2004h>     if m:\r\n"]
[762.210757, "o", "\u001b[?2004l\r\n"]
[762.277568, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[762.344378, "o", "\u001b[?2004l\r\n"]
[762.411189, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+800]:\r\n"]
[762.478, "o", "\u001b[?2004l\r\n"]
[762.544811, "o", "\u001b[?2004h>             inject = (\r\n"]
[762.611622, "o", "\u001b[?2004l\r\n"]
[762.678432, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[762.745243, "o", "\u001b[?2004l\r\n"]
[762.812054, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[762.878865, "o", "\u001b[?2004l\r\n"]
[762.945676, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[763.012486, "o", "\u001b[?2004l\r\n"]
[763.079297, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[763.146108, "o", "\u001b[?2004l\r\n"]
[763.212919, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[763.27973, "o", "\u001b[?2004l\r\n"]
[763.346541, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[763.413351, "o", "\u001b[?2004l\r\n"]
[763.480162, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[763.546973, "o", "\u001b[?2004l\r\n"]
[763.613784, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[763.680595, "o", "\u001b[?2004l\r\n"]
[763.747405, "o", "\u001b[?2004h>             )\r\n"]
[763.814216, "o", "\u001b[?2004l\r\n"]
[763.881027, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[763.947838, "o", "\u001b[?2004l\r\n"]
[764.014649, "o", "\u001b[?2004h>             changed = True\r\n"]
[764.081459, "o", "\u001b[?2004l\r\n"]
[764.14827, "o", "\u001b[?2004h> if changed:\r\n"]
[764.215081, "o", "\u001b[?2004l\r\n"]
[764.281892, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[764.348703, "o", "\u001b[?2004l\r\n"]
[764.415514, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[764.482324, "o", "\u001b[?2004l\r\n"]
[764.549135, "o", "\u001b[?2004h> else:\r\n"]
[764.615946, "o", "\u001b[?2004l\r\n"]
[764.682757, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[764.749568, "o", "\u001b[?2004l\r\n"]
[764.816378, "o", "\u001b[?2004h> PY\r\n"]
[764.883189, "o", "\u001b[?2004l\r\n"]
[765.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[765.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[765.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[765.006, "o", "\u001b[?2004l\r\n"]
[770.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[770.002, "i", "git add pandas/core/computation/expressions.py\r"]
[770.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[770.006, "o", "\u001b[?2004l\r\n"]
[775.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[775.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[775.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[775.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[776.242, "o", "\u001b[?2004l\r\n"]
[776.86, "o", "On branch main\r\n"]
[777.478, "o", "Untracked files:\r\n"]
[778.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[778.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[779.332, "o", "\r\n"]
[780.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[780.002, "i", "cd asv_bench\r"]
[780.004, "o", "cd asv_bench\r\n"]
[780.006, "o", "\u001b[?2004l\r\n"]
[785.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[785.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[785.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[785.097556, "o", "\u001b[?2004l\r\n"]
[785.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[785.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[785.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[785.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[785.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[785.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[785.738444, "o", "             --                      threads          \r\n"]
[785.83, "o", "             ------------- ---------------------------\r\n"]
[785.921556, "o", "              use_numexpr     default          1      \r\n"]
[786.013111, "o", "             ============= ============= =============\r\n"]
[786.104667, "o", "                  True      2.05\u00b10.02ms   2.08\u00b10.04ms \r\n"]
[786.196222, "o", "                 False      2.05\u00b10.02ms   2.06\u00b10.01ms \r\n"]
[786.287778, "o", "             ============= ============= =============\r\n"]
[786.379333, "o", "\r\n"]
[786.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[786.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[786.654, "o", "             --                      threads          \r\n"]
[786.745556, "o", "             ------------- ---------------------------\r\n"]
[786.837111, "o", "              use_numexpr     default          1      \r\n"]
[786.928667, "o", "             ============= ============= =============\r\n"]
[787.020222, "o", "                  True      1.61\u00b10.02ms   1.63\u00b10.03ms \r\n"]
[787.111778, "o", "                 False      1.59\u00b10.02ms   1.59\u00b10.01ms \r\n"]
[787.203333, "o", "             ============= ============= =============\r\n"]
[787.294889, "o", "\r\n"]
[787.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[787.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[787.569556, "o", "             --                      threads          \r\n"]
[787.661111, "o", "             ------------- ---------------------------\r\n"]
[787.752667, "o", "              use_numexpr     default          1      \r\n"]
[787.844222, "o", "             ============= ============= =============\r\n"]
[787.935778, "o", "                  True      2.09\u00b10.02ms   2.08\u00b10.03ms \r\n"]
[788.027333, "o", "                 False      2.08\u00b10.02ms   2.08\u00b10.05ms \r\n"]
[788.118889, "o", "             ============= ============= =============\r\n"]
[788.210444, "o", "\r\n"]
[788.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[788.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[788.485111, "o", "             --                      threads          \r\n"]
[788.576667, "o", "             ------------- ---------------------------\r\n"]
[788.668222, "o", "              use_numexpr     default          1      \r\n"]
[788.759778, "o", "             ============= ============= =============\r\n"]
[788.851333, "o", "                  True      10.1\u00b10.08ms   10.1\u00b10.05ms \r\n"]
[788.942889, "o", "                 False      10.2\u00b10.08ms    10.2\u00b10.1ms \r\n"]
[789.034444, "o", "             ============= ============= =============\r\n"]
[789.126, "o", "\r\n"]
[789.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.7\u00b10.2ms\r\n"]
[789.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   29.1\u00b10.07ms\r\n"]
[789.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              772\u00b150\u03bcs\r\n"]
[789.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.6\u00b10.2ms\r\n"]
[789.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    25.2\u00b10.1ms\r\n"]
[789.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.45\u00b10.01ms\r\n"]
[789.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      10.5\u00b10.1ms\r\n"]
[789.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      437\u00b17\u03bcs\r\n"]
[790.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[790.002, "i", "cd ..\r"]
[790.004, "o", "cd ..\r\n"]
[790.006, "o", "\u001b[?2004l\r\n"]
[795.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[795.002, "i", "git status -sb\r"]
[795.004, "o", "git status -sb\r\n"]
[796.654, "o", "\u001b[?2004l\r\n"]
[798.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[800.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[800.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r"]
[800.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py\r\n"]
[801.654, "o", "\u001b[?2004l\r\n"]
[803.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[805.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[805.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py\r"]
[805.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py\r\n"]
[805.024943, "o", "\u001b[?2004l\r\n"]
[805.043885, "o", "\"\"\"\r\n"]
[805.062828, "o", "Expressions\r\n"]
[805.08177, "o", "-----------\r\n"]
[805.100713, "o", "\r\n"]
[805.119655, "o", "Offer fast expression evaluation through numexpr\r\n"]
[805.138598, "o", "\r\n"]
[805.15754, "o", "\"\"\"\r\n"]
[805.176483, "o", "\r\n"]
[805.195425, "o", "from __future__ import annotations\r\n"]
[805.214368, "o", "\r\n"]
[805.23331, "o", "import operator\r\n"]
[805.252253, "o", "from typing import TYPE_CHECKING\r\n"]
[805.271195, "o", "import warnings\r\n"]
[805.290138, "o", "\r\n"]
[805.30908, "o", "import numpy as np\r\n"]
[805.328023, "o", "\r\n"]
[805.346966, "o", "from pandas._config import get_option\r\n"]
[805.365908, "o", "\r\n"]
[805.384851, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[805.403793, "o", "\r\n"]
[805.422736, "o", "from pandas.core import roperator\r\n"]
[805.441678, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[805.460621, "o", "\r\n"]
[805.479563, "o", "if NUMEXPR_INSTALLED:\r\n"]
[805.498506, "o", "    import numexpr as ne\r\n"]
[805.517448, "o", "\r\n"]
[805.536391, "o", "if TYPE_CHECKING:\r\n"]
[805.555333, "o", "    from pandas._typing import FuncType\r\n"]
[805.574276, "o", "\r\n"]
[805.593218, "o", "_TEST_MODE: bool | None = None\r\n"]
[805.612161, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[805.631103, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[805.650046, "o", "_evaluate: FuncType | None = None\r\n"]
[805.668989, "o", "_where: FuncType | None = None\r\n"]
[805.687931, "o", "\r\n"]
[805.706874, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[805.725816, "o", "_ALLOWED_DTYPES = {\r\n"]
[805.744759, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[805.763701, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[805.782644, "o", "}\r\n"]
[805.801586, "o", "\r\n"]
[805.820529, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[805.839471, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[805.858414, "o", "\r\n"]
[805.877356, "o", "\r\n"]
[805.896299, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[805.915241, "o", "    # set/unset to use numexpr\r\n"]
[805.934184, "o", "    global USE_NUMEXPR\r\n"]
[805.953126, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[805.972069, "o", "        USE_NUMEXPR = v\r\n"]
[805.991011, "o", "\r\n"]
[806.009954, "o", "    # choose what we are going to do\r\n"]
[806.028897, "o", "    global _evaluate, _where\r\n"]
[806.047839, "o", "\r\n"]
[806.066782, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[806.085724, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[806.104667, "o", "\r\n"]
[806.123609, "o", "\r\n"]
[806.142552, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[806.161494, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[806.180437, "o", "    # otherwise reset\r\n"]
[806.199379, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[806.218322, "o", "        if n is None:\r\n"]
[806.237264, "o", "            n = ne.detect_number_of_cores()\r\n"]
[806.256207, "o", "        ne.set_num_threads(n)\r\n"]
[806.275149, "o", "\r\n"]
[806.294092, "o", "\r\n"]
[806.313034, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[806.331977, "o", "    \"\"\"\r\n"]
[806.35092, "o", "    Standard evaluation.\r\n"]
[806.369862, "o", "    \"\"\"\r\n"]
[806.388805, "o", "    if _TEST_MODE:\r\n"]
[806.407747, "o", "        _store_test_result(False)\r\n"]
[806.42669, "o", "    return op(left_op, right_op)\r\n"]
[806.445632, "o", "\r\n"]
[806.464575, "o", "\r\n"]
[806.483517, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[806.50246, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[806.521402, "o", "    if op_str is not None:\r\n"]
[806.540345, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[806.559287, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[806.57823, "o", "            # check for dtype compatibility\r\n"]
[806.597172, "o", "            dtypes: set[str] = set()\r\n"]
[806.616115, "o", "            for o in [left_op, right_op]:\r\n"]
[806.635057, "o", "                # ndarray and Series Case\r\n"]
[806.654, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[806.672943, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[806.691885, "o", "\r\n"]
[806.710828, "o", "            # allowed are a superset\r\n"]
[806.72977, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[806.748713, "o", "                return True\r\n"]
[806.767655, "o", "\r\n"]
[806.786598, "o", "    return False\r\n"]
[806.80554, "o", "\r\n"]
[806.824483, "o", "\r\n"]
[806.843425, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[806.862368, "o", "    result = None\r\n"]
[806.88131, "o", "\r\n"]
[806.900253, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[806.919195, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[806.938138, "o", "        if is_reversed:\r\n"]
[806.95708, "o", "            # we were originally called by a reversed op method\r\n"]
[806.976023, "o", "            left_op, right_op = right_op, left_op\r\n"]
[806.994966, "o", "\r\n"]
[807.013908, "o", "        left_value = left_op\r\n"]
[807.032851, "o", "        right_value = right_op\r\n"]
[807.051793, "o", "\r\n"]
[807.070736, "o", "        try:\r\n"]
[807.089678, "o", "            result = ne.evaluate(\r\n"]
[807.108621, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[807.127563, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[807.146506, "o", "                casting=\"safe\",\r\n"]
[807.165448, "o", "            )\r\n"]
[807.184391, "o", "        except TypeError:\r\n"]
[807.203333, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[807.222276, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[807.241218, "o", "            pass\r\n"]
[807.260161, "o", "        except NotImplementedError:\r\n"]
[807.279103, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[807.298046, "o", "                pass\r\n"]
[807.316989, "o", "            else:\r\n"]
[807.335931, "o", "                raise\r\n"]
[807.354874, "o", "\r\n"]
[807.373816, "o", "        if is_reversed:\r\n"]
[807.392759, "o", "            # reverse order to original for fallback\r\n"]
[807.411701, "o", "            left_op, right_op = right_op, left_op\r\n"]
[807.430644, "o", "\r\n"]
[807.449586, "o", "    if _TEST_MODE:\r\n"]
[807.468529, "o", "        _store_test_result(result is not None)\r\n"]
[807.487471, "o", "\r\n"]
[807.506414, "o", "    if result is None:\r\n"]
[807.525356, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[807.544299, "o", "\r\n"]
[807.563241, "o", "    return result\r\n"]
[807.582184, "o", "\r\n"]
[807.601126, "o", "\r\n"]
[807.620069, "o", "_op_str_mapping = {\r\n"]
[807.639011, "o", "    operator.add: \"+\",\r\n"]
[807.657954, "o", "    roperator.radd: \"+\",\r\n"]
[807.676897, "o", "    operator.mul: \"*\",\r\n"]
[807.695839, "o", "    roperator.rmul: \"*\",\r\n"]
[807.714782, "o", "    operator.sub: \"-\",\r\n"]
[807.733724, "o", "    roperator.rsub: \"-\",\r\n"]
[807.752667, "o", "    operator.truediv: \"/\",\r\n"]
[807.771609, "o", "    roperator.rtruediv: \"/\",\r\n"]
[807.790552, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[807.809494, "o", "    operator.floordiv: None,\r\n"]
[807.828437, "o", "    roperator.rfloordiv: None,\r\n"]
[807.847379, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[807.866322, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[807.885264, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[807.904207, "o", "    operator.mod: None,\r\n"]
[807.923149, "o", "    roperator.rmod: None,\r\n"]
[807.942092, "o", "    operator.pow: \"**\",\r\n"]
[807.961034, "o", "    roperator.rpow: \"**\",\r\n"]
[807.979977, "o", "    operator.eq: \"==\",\r\n"]
[807.99892, "o", "    operator.ne: \"!=\",\r\n"]
[808.017862, "o", "    operator.le: \"<=\",\r\n"]
[808.036805, "o", "    operator.lt: \"<\",\r\n"]
[808.055747, "o", "    operator.ge: \">=\",\r\n"]
[808.07469, "o", "    operator.gt: \">\",\r\n"]
[808.093632, "o", "    operator.and_: \"&\",\r\n"]
[808.112575, "o", "    roperator.rand_: \"&\",\r\n"]
[808.131517, "o", "    operator.or_: \"|\",\r\n"]
[808.15046, "o", "    roperator.ror_: \"|\",\r\n"]
[808.169402, "o", "    operator.xor: \"^\",\r\n"]
[808.188345, "o", "    roperator.rxor: \"^\",\r\n"]
[808.207287, "o", "    divmod: None,\r\n"]
[808.22623, "o", "    roperator.rdivmod: None,\r\n"]
[808.245172, "o", "}\r\n"]
[808.264115, "o", "\r\n"]
[808.283057, "o", "\r\n"]
[808.302, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[808.320943, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[808.339885, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[808.358828, "o", "\r\n"]
[808.37777, "o", "\r\n"]
[808.396713, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[808.415655, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[808.434598, "o", "    result = None\r\n"]
[808.45354, "o", "\r\n"]
[808.472483, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[808.491425, "o", "        result = ne.evaluate(\r\n"]
[808.510368, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[808.52931, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[808.548253, "o", "            casting=\"safe\",\r\n"]
[808.567195, "o", "        )\r\n"]
[808.586138, "o", "\r\n"]
[808.60508, "o", "    if result is None:\r\n"]
[808.624023, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[808.642966, "o", "\r\n"]
[808.661908, "o", "    return result\r\n"]
[808.680851, "o", "\r\n"]
[808.699793, "o", "\r\n"]
[808.718736, "o", "# turn myself on\r\n"]
[808.737678, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[808.756621, "o", "\r\n"]
[808.775563, "o", "\r\n"]
[808.794506, "o", "def _has_bool_dtype(x):\r\n"]
[808.813448, "o", "    try:\r\n"]
[808.832391, "o", "        return x.dtype == bool\r\n"]
[808.851333, "o", "    except AttributeError:\r\n"]
[808.870276, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[808.889218, "o", "\r\n"]
[808.908161, "o", "\r\n"]
[808.927103, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[808.946046, "o", "\r\n"]
[808.964989, "o", "\r\n"]
[808.983931, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[809.002874, "o", "    \"\"\"\r\n"]
[809.021816, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[809.040759, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[809.059701, "o", "    boolean ops.\r\n"]
[809.078644, "o", "    \"\"\"\r\n"]
[809.097586, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[809.116529, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[809.135471, "o", "            warnings.warn(\r\n"]
[809.154414, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[809.173356, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[809.192299, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[809.211241, "o", "                stacklevel=find_stack_level(),\r\n"]
[809.230184, "o", "            )\r\n"]
[809.249126, "o", "            return True\r\n"]
[809.268069, "o", "    return False\r\n"]
[809.287011, "o", "\r\n"]
[809.305954, "o", "\r\n"]
[809.324897, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[809.343839, "o", "    \"\"\"\r\n"]
[809.362782, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[809.381724, "o", "\r\n"]
[809.400667, "o", "    Parameters\r\n"]
[809.419609, "o", "    ----------\r\n"]
[809.438552, "o", "    op : the actual operand\r\n"]
[809.457494, "o", "    left_op : left operand\r\n"]
[809.476437, "o", "    right_op : right operand\r\n"]
[809.495379, "o", "    use_numexpr : bool, default True\r\n"]
[809.514322, "o", "        Whether to try to use numexpr.\r\n"]
[809.533264, "o", "    \"\"\"\r\n"]
[809.552207, "o", "    op_str = _op_str_mapping[op]\r\n"]
[809.571149, "o", "    if op_str is not None:\r\n"]
[809.590092, "o", "        if use_numexpr:\r\n"]
[809.609034, "o", "            # error: \"None\" not callable\r\n"]
[809.627977, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[809.64692, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[809.665862, "o", "\r\n"]
[809.684805, "o", "\r\n"]
[809.703747, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[809.72269, "o", "    \"\"\"\r\n"]
[809.741632, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[809.760575, "o", "\r\n"]
[809.779517, "o", "    Parameters\r\n"]
[809.79846, "o", "    ----------\r\n"]
[809.817402, "o", "    cond : np.ndarray[bool]\r\n"]
[809.836345, "o", "    left_op : return if cond is True\r\n"]
[809.855287, "o", "    right_op : return if cond is False\r\n"]
[809.87423, "o", "    use_numexpr : bool, default True\r\n"]
[809.893172, "o", "        Whether to try to use numexpr.\r\n"]
[809.912115, "o", "    \"\"\"\r\n"]
[809.931057, "o", "    assert _where is not None\r\n"]
[810.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[810.002, "i", "python - << 'PY'\r"]
[810.004, "o", "python - << 'PY'\r\n"]
[810.064857, "o", "\u001b[?2004l\r\n"]
[810.123714, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[810.182571, "o", "\u001b[?2004l\r\n"]
[810.241429, "o", "\u001b[?2004h> import re\r\n"]
[810.300286, "o", "\u001b[?2004l\r\n"]
[810.359143, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[810.418, "o", "\u001b[?2004l\r\n"]
[810.476857, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[810.535714, "o", "\u001b[?2004l\r\n"]
[810.594571, "o", "\u001b[?2004h> changed = False\r\n"]
[810.653429, "o", "\u001b[?2004l\r\n"]
[810.712286, "o", "\u001b[?2004h> # Try to bump an existing threshold constant if present\r\n"]
[810.771143, "o", "\u001b[?2004l\r\n"]
[810.83, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[810.888857, "o", "\u001b[?2004l\r\n"]
[810.947714, "o", "\u001b[?2004h> if n == 0:\r\n"]
[811.006571, "o", "\u001b[?2004l\r\n"]
[811.065429, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[811.124286, "o", "\u001b[?2004l\r\n"]
[811.183143, "o", "\u001b[?2004h> if n > 0:\r\n"]
[811.242, "o", "\u001b[?2004l\r\n"]
[811.300857, "o", "\u001b[?2004h>     src = new_src\r\n"]
[811.359714, "o", "\u001b[?2004l\r\n"]
[811.418571, "o", "\u001b[?2004h>     changed = True\r\n"]
[811.477429, "o", "\u001b[?2004l\r\n"]
[811.536286, "o", "\u001b[?2004h> else:\r\n"]
[811.595143, "o", "\u001b[?2004l\r\n"]
[811.654, "o", "\u001b[?2004h>     # Inject early size-based bypass in should_use_numexpr\r\n"]
[811.712857, "o", "\u001b[?2004l\r\n"]
[811.771714, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[811.830571, "o", "\u001b[?2004l\r\n"]
[811.889429, "o", "\u001b[?2004h>     if m:\r\n"]
[811.948286, "o", "\u001b[?2004l\r\n"]
[812.007143, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[812.066, "o", "\u001b[?2004l\r\n"]
[812.124857, "o", "\u001b[?2004h>         # Inject after def line, but skip over an immediate docstring if present\r\n"]
[812.183714, "o", "\u001b[?2004l\r\n"]
[812.242571, "o", "\u001b[?2004h>         rest = src[insert_at:]\r\n"]
[812.301429, "o", "\u001b[?2004l\r\n"]
[812.360286, "o", "\u001b[?2004h>         doc_m = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", rest, flags=re.S)\r\n"]
[812.419143, "o", "\u001b[?2004l\r\n"]
[812.478, "o", "\u001b[?2004h>         if doc_m:\r\n"]
[812.536857, "o", "\u001b[?2004l\r\n"]
[812.595714, "o", "\u001b[?2004h>             insert_at += doc_m.end()\r\n"]
[812.654571, "o", "\u001b[?2004l\r\n"]
[812.713429, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+1000]:\r\n"]
[812.772286, "o", "\u001b[?2004l\r\n"]
[812.831143, "o", "\u001b[?2004h>             inject = (\r\n"]
[812.89, "o", "\u001b[?2004l\r\n"]
[812.948857, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[813.007714, "o", "\u001b[?2004l\r\n"]
[813.066571, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[813.125429, "o", "\u001b[?2004l\r\n"]
[813.184286, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[813.243143, "o", "\u001b[?2004l\r\n"]
[813.302, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[813.360857, "o", "\u001b[?2004l\r\n"]
[813.419714, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[813.478571, "o", "\u001b[?2004l\r\n"]
[813.537429, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[813.596286, "o", "\u001b[?2004l\r\n"]
[813.655143, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[813.714, "o", "\u001b[?2004l\r\n"]
[813.772857, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[813.831714, "o", "\u001b[?2004l\r\n"]
[813.890571, "o", "\u001b[?2004h>             )\r\n"]
[813.949429, "o", "\u001b[?2004l\r\n"]
[814.008286, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[814.067143, "o", "\u001b[?2004l\r\n"]
[814.126, "o", "\u001b[?2004h>             changed = True\r\n"]
[814.184857, "o", "\u001b[?2004l\r\n"]
[814.243714, "o", "\u001b[?2004h> if changed:\r\n"]
[814.302571, "o", "\u001b[?2004l\r\n"]
[814.361429, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[814.420286, "o", "\u001b[?2004l\r\n"]
[814.479143, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[814.538, "o", "\u001b[?2004l\r\n"]
[814.596857, "o", "\u001b[?2004h> else:\r\n"]
[814.655714, "o", "\u001b[?2004l\r\n"]
[814.714571, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[814.773429, "o", "\u001b[?2004l\r\n"]
[814.832286, "o", "\u001b[?2004h> PY\r\n"]
[814.891143, "o", "\u001b[?2004l\r\n"]
[815.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[815.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[815.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[815.006, "o", "\u001b[?2004l\r\n"]
[820.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[820.002, "i", "git add pandas/core/computation/expressions.py\r"]
[820.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[820.006, "o", "\u001b[?2004l\r\n"]
[825.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[825.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[825.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[825.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[826.242, "o", "\u001b[?2004l\r\n"]
[826.86, "o", "On branch main\r\n"]
[827.478, "o", "Untracked files:\r\n"]
[828.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[828.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[829.332, "o", "\r\n"]
[830.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[830.002, "i", "cd asv_bench\r"]
[830.004, "o", "cd asv_bench\r\n"]
[830.006, "o", "\u001b[?2004l\r\n"]
[835.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[835.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[835.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[835.097556, "o", "\u001b[?2004l\r\n"]
[835.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[835.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[835.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[835.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[835.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[835.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[835.738444, "o", "             --                      threads          \r\n"]
[835.83, "o", "             ------------- ---------------------------\r\n"]
[835.921556, "o", "              use_numexpr     default          1      \r\n"]
[836.013111, "o", "             ============= ============= =============\r\n"]
[836.104667, "o", "                  True      2.10\u00b10.03ms   2.13\u00b10.04ms \r\n"]
[836.196222, "o", "                 False      2.12\u00b10.04ms   2.13\u00b10.04ms \r\n"]
[836.287778, "o", "             ============= ============= =============\r\n"]
[836.379333, "o", "\r\n"]
[836.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[836.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[836.654, "o", "             --                      threads          \r\n"]
[836.745556, "o", "             ------------- ---------------------------\r\n"]
[836.837111, "o", "              use_numexpr     default          1      \r\n"]
[836.928667, "o", "             ============= ============= =============\r\n"]
[837.020222, "o", "                  True      1.68\u00b10.05ms   1.66\u00b10.03ms \r\n"]
[837.111778, "o", "                 False      1.67\u00b10.04ms   1.69\u00b10.06ms \r\n"]
[837.203333, "o", "             ============= ============= =============\r\n"]
[837.294889, "o", "\r\n"]
[837.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[837.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[837.569556, "o", "             --                      threads          \r\n"]
[837.661111, "o", "             ------------- ---------------------------\r\n"]
[837.752667, "o", "              use_numexpr     default          1      \r\n"]
[837.844222, "o", "             ============= ============= =============\r\n"]
[837.935778, "o", "                  True      2.12\u00b10.03ms   2.18\u00b10.02ms \r\n"]
[838.027333, "o", "                 False      2.20\u00b10.06ms   2.07\u00b10.03ms \r\n"]
[838.118889, "o", "             ============= ============= =============\r\n"]
[838.210444, "o", "\r\n"]
[838.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[838.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============== =============\u001b[0m\r\n"]
[838.485111, "o", "             --                      threads           \r\n"]
[838.576667, "o", "             ------------- ----------------------------\r\n"]
[838.668222, "o", "              use_numexpr     default           1      \r\n"]
[838.759778, "o", "             ============= ============== =============\r\n"]
[838.851333, "o", "                  True       9.97\u00b10.1ms    9.99\u00b10.05ms \r\n"]
[838.942889, "o", "                 False      10.00\u00b10.08ms   10.0\u00b10.09ms \r\n"]
[839.034444, "o", "             ============= ============== =============\r\n"]
[839.126, "o", "\r\n"]
[839.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.6\u00b10.2ms\r\n"]
[839.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.6\u00b10.08ms\r\n"]
[839.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              768\u00b170\u03bcs\r\n"]
[839.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                         19.5\u00b10.07ms\r\n"]
[839.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    24.8\u00b10.2ms\r\n"]
[839.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.49\u00b10.01ms\r\n"]
[839.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.5\u00b10.05ms\r\n"]
[839.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     446\u00b120\u03bcs\r\n"]
[840.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[840.002, "i", "cd ..\r"]
[840.004, "o", "cd ..\r\n"]
[840.006, "o", "\u001b[?2004l\r\n"]
[845.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[845.002, "i", "git status -sb\r"]
[845.004, "o", "git status -sb\r\n"]
[846.654, "o", "\u001b[?2004l\r\n"]
[848.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[850.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[850.002, "i", "ls -la pandas/core/computation\r"]
[850.004, "o", "ls -la pandas/core/computation\r\n"]
[850.296824, "o", "\u001b[?2004l\r\n"]
[850.587647, "o", "total 152\r\n"]
[850.878471, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[0m\u001b[01;34m.\u001b[0m\r\n"]
[851.169294, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34m..\u001b[0m\r\n"]
[851.460118, "o", "-rw-r--r-- 1 root root     0 Sep 12 21:42 __init__.py\r\n"]
[851.750941, "o", "-rw-r--r-- 1 root root  6735 Sep 12 21:42 align.py\r\n"]
[852.041765, "o", "-rw-r--r-- 1 root root    65 Sep 12 21:42 api.py\r\n"]
[852.332588, "o", "-rw-r--r-- 1 root root   226 Sep 12 21:42 check.py\r\n"]
[852.623412, "o", "-rw-r--r-- 1 root root  1442 Sep 12 21:42 common.py\r\n"]
[852.914235, "o", "-rw-r--r-- 1 root root  3462 Sep 12 21:42 engines.py\r\n"]
[853.205059, "o", "-rw-r--r-- 1 root root 15281 Sep 12 21:42 eval.py\r\n"]
[853.495882, "o", "-rw-r--r-- 1 root root 25337 Sep 12 21:44 expr.py\r\n"]
[853.786706, "o", "-rw-r--r-- 1 root root  7966 Oct  1 17:44 expressions.py\r\n"]
[854.077529, "o", "-rw-r--r-- 1 root root 14435 Sep 12 21:42 ops.py\r\n"]
[854.368353, "o", "-rw-r--r-- 1 root root  7711 Sep 12 21:42 parsing.py\r\n"]
[854.659176, "o", "-rw-r--r-- 1 root root 21077 Sep 12 21:44 pytables.py\r\n"]
[855.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[855.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[855.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[856.654, "o", "\u001b[?2004l\r\n"]
[858.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[860.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[860.002, "i", "sed -n '1,200p' pandas/core/computation/expressions.py\r"]
[860.004, "o", "sed -n '1,200p' pandas/core/computation/expressions.py\r\n"]
[860.030597, "o", "\u001b[?2004l\r\n"]
[860.055194, "o", "\"\"\"\r\n"]
[860.079791, "o", "Expressions\r\n"]
[860.104388, "o", "-----------\r\n"]
[860.128985, "o", "\r\n"]
[860.153582, "o", "Offer fast expression evaluation through numexpr\r\n"]
[860.178179, "o", "\r\n"]
[860.202776, "o", "\"\"\"\r\n"]
[860.227373, "o", "\r\n"]
[860.25197, "o", "from __future__ import annotations\r\n"]
[860.276567, "o", "\r\n"]
[860.301164, "o", "import operator\r\n"]
[860.325761, "o", "from typing import TYPE_CHECKING\r\n"]
[860.350358, "o", "import warnings\r\n"]
[860.374955, "o", "\r\n"]
[860.399552, "o", "import numpy as np\r\n"]
[860.424149, "o", "\r\n"]
[860.448746, "o", "from pandas._config import get_option\r\n"]
[860.473343, "o", "\r\n"]
[860.49794, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[860.522537, "o", "\r\n"]
[860.547134, "o", "from pandas.core import roperator\r\n"]
[860.571731, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[860.596328, "o", "\r\n"]
[860.620925, "o", "if NUMEXPR_INSTALLED:\r\n"]
[860.645522, "o", "    import numexpr as ne\r\n"]
[860.670119, "o", "\r\n"]
[860.694716, "o", "if TYPE_CHECKING:\r\n"]
[860.719313, "o", "    from pandas._typing import FuncType\r\n"]
[860.74391, "o", "\r\n"]
[860.768507, "o", "_TEST_MODE: bool | None = None\r\n"]
[860.793104, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[860.817701, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[860.842299, "o", "_evaluate: FuncType | None = None\r\n"]
[860.866896, "o", "_where: FuncType | None = None\r\n"]
[860.891493, "o", "\r\n"]
[860.91609, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[860.940687, "o", "_ALLOWED_DTYPES = {\r\n"]
[860.965284, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[860.989881, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[861.014478, "o", "}\r\n"]
[861.039075, "o", "\r\n"]
[861.063672, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[861.088269, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[861.112866, "o", "\r\n"]
[861.137463, "o", "\r\n"]
[861.16206, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[861.186657, "o", "    # set/unset to use numexpr\r\n"]
[861.211254, "o", "    global USE_NUMEXPR\r\n"]
[861.235851, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[861.260448, "o", "        USE_NUMEXPR = v\r\n"]
[861.285045, "o", "\r\n"]
[861.309642, "o", "    # choose what we are going to do\r\n"]
[861.334239, "o", "    global _evaluate, _where\r\n"]
[861.358836, "o", "\r\n"]
[861.383433, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[861.40803, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[861.432627, "o", "\r\n"]
[861.457224, "o", "\r\n"]
[861.481821, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[861.506418, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[861.531015, "o", "    # otherwise reset\r\n"]
[861.555612, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[861.580209, "o", "        if n is None:\r\n"]
[861.604806, "o", "            n = ne.detect_number_of_cores()\r\n"]
[861.629403, "o", "        ne.set_num_threads(n)\r\n"]
[861.654, "o", "\r\n"]
[861.678597, "o", "\r\n"]
[861.703194, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[861.727791, "o", "    \"\"\"\r\n"]
[861.752388, "o", "    Standard evaluation.\r\n"]
[861.776985, "o", "    \"\"\"\r\n"]
[861.801582, "o", "    if _TEST_MODE:\r\n"]
[861.826179, "o", "        _store_test_result(False)\r\n"]
[861.850776, "o", "    return op(left_op, right_op)\r\n"]
[861.875373, "o", "\r\n"]
[861.89997, "o", "\r\n"]
[861.924567, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[861.949164, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[861.973761, "o", "    if op_str is not None:\r\n"]
[861.998358, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[862.022955, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[862.047552, "o", "            # check for dtype compatibility\r\n"]
[862.072149, "o", "            dtypes: set[str] = set()\r\n"]
[862.096746, "o", "            for o in [left_op, right_op]:\r\n"]
[862.121343, "o", "                # ndarray and Series Case\r\n"]
[862.14594, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[862.170537, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[862.195134, "o", "\r\n"]
[862.219731, "o", "            # allowed are a superset\r\n"]
[862.244328, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[862.268925, "o", "                return True\r\n"]
[862.293522, "o", "\r\n"]
[862.318119, "o", "    return False\r\n"]
[862.342716, "o", "\r\n"]
[862.367313, "o", "\r\n"]
[862.39191, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[862.416507, "o", "    result = None\r\n"]
[862.441104, "o", "\r\n"]
[862.465701, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[862.490299, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[862.514896, "o", "        if is_reversed:\r\n"]
[862.539493, "o", "            # we were originally called by a reversed op method\r\n"]
[862.56409, "o", "            left_op, right_op = right_op, left_op\r\n"]
[862.588687, "o", "\r\n"]
[862.613284, "o", "        left_value = left_op\r\n"]
[862.637881, "o", "        right_value = right_op\r\n"]
[862.662478, "o", "\r\n"]
[862.687075, "o", "        try:\r\n"]
[862.711672, "o", "            result = ne.evaluate(\r\n"]
[862.736269, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[862.760866, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[862.785463, "o", "                casting=\"safe\",\r\n"]
[862.81006, "o", "            )\r\n"]
[862.834657, "o", "        except TypeError:\r\n"]
[862.859254, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[862.883851, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[862.908448, "o", "            pass\r\n"]
[862.933045, "o", "        except NotImplementedError:\r\n"]
[862.957642, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[862.982239, "o", "                pass\r\n"]
[863.006836, "o", "            else:\r\n"]
[863.031433, "o", "                raise\r\n"]
[863.05603, "o", "\r\n"]
[863.080627, "o", "        if is_reversed:\r\n"]
[863.105224, "o", "            # reverse order to original for fallback\r\n"]
[863.129821, "o", "            left_op, right_op = right_op, left_op\r\n"]
[863.154418, "o", "\r\n"]
[863.179015, "o", "    if _TEST_MODE:\r\n"]
[863.203612, "o", "        _store_test_result(result is not None)\r\n"]
[863.228209, "o", "\r\n"]
[863.252806, "o", "    if result is None:\r\n"]
[863.277403, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[863.302, "o", "\r\n"]
[863.326597, "o", "    return result\r\n"]
[863.351194, "o", "\r\n"]
[863.375791, "o", "\r\n"]
[863.400388, "o", "_op_str_mapping = {\r\n"]
[863.424985, "o", "    operator.add: \"+\",\r\n"]
[863.449582, "o", "    roperator.radd: \"+\",\r\n"]
[863.474179, "o", "    operator.mul: \"*\",\r\n"]
[863.498776, "o", "    roperator.rmul: \"*\",\r\n"]
[863.523373, "o", "    operator.sub: \"-\",\r\n"]
[863.54797, "o", "    roperator.rsub: \"-\",\r\n"]
[863.572567, "o", "    operator.truediv: \"/\",\r\n"]
[863.597164, "o", "    roperator.rtruediv: \"/\",\r\n"]
[863.621761, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[863.646358, "o", "    operator.floordiv: None,\r\n"]
[863.670955, "o", "    roperator.rfloordiv: None,\r\n"]
[863.695552, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[863.720149, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[863.744746, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[863.769343, "o", "    operator.mod: None,\r\n"]
[863.79394, "o", "    roperator.rmod: None,\r\n"]
[863.818537, "o", "    operator.pow: \"**\",\r\n"]
[863.843134, "o", "    roperator.rpow: \"**\",\r\n"]
[863.867731, "o", "    operator.eq: \"==\",\r\n"]
[863.892328, "o", "    operator.ne: \"!=\",\r\n"]
[863.916925, "o", "    operator.le: \"<=\",\r\n"]
[863.941522, "o", "    operator.lt: \"<\",\r\n"]
[863.966119, "o", "    operator.ge: \">=\",\r\n"]
[863.990716, "o", "    operator.gt: \">\",\r\n"]
[864.015313, "o", "    operator.and_: \"&\",\r\n"]
[864.03991, "o", "    roperator.rand_: \"&\",\r\n"]
[864.064507, "o", "    operator.or_: \"|\",\r\n"]
[864.089104, "o", "    roperator.ror_: \"|\",\r\n"]
[864.113701, "o", "    operator.xor: \"^\",\r\n"]
[864.138299, "o", "    roperator.rxor: \"^\",\r\n"]
[864.162896, "o", "    divmod: None,\r\n"]
[864.187493, "o", "    roperator.rdivmod: None,\r\n"]
[864.21209, "o", "}\r\n"]
[864.236687, "o", "\r\n"]
[864.261284, "o", "\r\n"]
[864.285881, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[864.310478, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[864.335075, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[864.359672, "o", "\r\n"]
[864.384269, "o", "\r\n"]
[864.408866, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[864.433463, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[864.45806, "o", "    result = None\r\n"]
[864.482657, "o", "\r\n"]
[864.507254, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[864.531851, "o", "        result = ne.evaluate(\r\n"]
[864.556448, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[864.581045, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[864.605642, "o", "            casting=\"safe\",\r\n"]
[864.630239, "o", "        )\r\n"]
[864.654836, "o", "\r\n"]
[864.679433, "o", "    if result is None:\r\n"]
[864.70403, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[864.728627, "o", "\r\n"]
[864.753224, "o", "    return result\r\n"]
[864.777821, "o", "\r\n"]
[864.802418, "o", "\r\n"]
[864.827015, "o", "# turn myself on\r\n"]
[864.851612, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[864.876209, "o", "\r\n"]
[864.900806, "o", "\r\n"]
[864.925403, "o", "def _has_bool_dtype(x):\r\n"]
[865.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[865.002, "i", "sed -n '200,500p' pandas/core/computation/expressions.py\r"]
[865.004, "o", "sed -n '200,500p' pandas/core/computation/expressions.py\r\n"]
[865.059739, "o", "\u001b[?2004l\r\n"]
[865.113478, "o", "    try:\r\n"]
[865.167217, "o", "        return x.dtype == bool\r\n"]
[865.220957, "o", "    except AttributeError:\r\n"]
[865.274696, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[865.328435, "o", "\r\n"]
[865.382174, "o", "\r\n"]
[865.435913, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[865.489652, "o", "\r\n"]
[865.543391, "o", "\r\n"]
[865.59713, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[865.65087, "o", "    \"\"\"\r\n"]
[865.704609, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[865.758348, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[865.812087, "o", "    boolean ops.\r\n"]
[865.865826, "o", "    \"\"\"\r\n"]
[865.919565, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[865.973304, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[866.027043, "o", "            warnings.warn(\r\n"]
[866.080783, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[866.134522, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[866.188261, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[866.242, "o", "                stacklevel=find_stack_level(),\r\n"]
[866.295739, "o", "            )\r\n"]
[866.349478, "o", "            return True\r\n"]
[866.403217, "o", "    return False\r\n"]
[866.456957, "o", "\r\n"]
[866.510696, "o", "\r\n"]
[866.564435, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[866.618174, "o", "    \"\"\"\r\n"]
[866.671913, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[866.725652, "o", "\r\n"]
[866.779391, "o", "    Parameters\r\n"]
[866.83313, "o", "    ----------\r\n"]
[866.88687, "o", "    op : the actual operand\r\n"]
[866.940609, "o", "    left_op : left operand\r\n"]
[866.994348, "o", "    right_op : right operand\r\n"]
[867.048087, "o", "    use_numexpr : bool, default True\r\n"]
[867.101826, "o", "        Whether to try to use numexpr.\r\n"]
[867.155565, "o", "    \"\"\"\r\n"]
[867.209304, "o", "    op_str = _op_str_mapping[op]\r\n"]
[867.263043, "o", "    if op_str is not None:\r\n"]
[867.316783, "o", "        if use_numexpr:\r\n"]
[867.370522, "o", "            # error: \"None\" not callable\r\n"]
[867.424261, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[867.478, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[867.531739, "o", "\r\n"]
[867.585478, "o", "\r\n"]
[867.639217, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[867.692957, "o", "    \"\"\"\r\n"]
[867.746696, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[867.800435, "o", "\r\n"]
[867.854174, "o", "    Parameters\r\n"]
[867.907913, "o", "    ----------\r\n"]
[867.961652, "o", "    cond : np.ndarray[bool]\r\n"]
[868.015391, "o", "    left_op : return if cond is True\r\n"]
[868.06913, "o", "    right_op : return if cond is False\r\n"]
[868.12287, "o", "    use_numexpr : bool, default True\r\n"]
[868.176609, "o", "        Whether to try to use numexpr.\r\n"]
[868.230348, "o", "    \"\"\"\r\n"]
[868.284087, "o", "    assert _where is not None\r\n"]
[868.337826, "o", "    if use_numexpr:\r\n"]
[868.391565, "o", "        return _where(cond, left_op, right_op)\r\n"]
[868.445304, "o", "    else:\r\n"]
[868.499043, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[868.552783, "o", "\r\n"]
[868.606522, "o", "\r\n"]
[868.660261, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[868.714, "o", "    \"\"\"\r\n"]
[868.767739, "o", "    Keeps track of whether numexpr was used.\r\n"]
[868.821478, "o", "\r\n"]
[868.875217, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[868.928957, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[868.982696, "o", "    \"\"\"\r\n"]
[869.036435, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[869.090174, "o", "    _TEST_MODE = v\r\n"]
[869.143913, "o", "    _TEST_RESULT = []\r\n"]
[869.197652, "o", "\r\n"]
[869.251391, "o", "\r\n"]
[869.30513, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[869.35887, "o", "    if used_numexpr:\r\n"]
[869.412609, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[869.466348, "o", "\r\n"]
[869.520087, "o", "\r\n"]
[869.573826, "o", "def get_test_result() -> list[bool]:\r\n"]
[869.627565, "o", "    \"\"\"\r\n"]
[869.681304, "o", "    Get test result and reset test_results.\r\n"]
[869.735043, "o", "    \"\"\"\r\n"]
[869.788783, "o", "    global _TEST_RESULT\r\n"]
[869.842522, "o", "    res = _TEST_RESULT\r\n"]
[869.896261, "o", "    _TEST_RESULT = []\r\n"]
[870.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[870.002, "i", "python - << 'PY'\r"]
[870.004, "o", "python - << 'PY'\r\n"]
[870.066293, "o", "\u001b[?2004l\r\n"]
[870.126585, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[870.186878, "o", "\u001b[?2004l\r\n"]
[870.247171, "o", "\u001b[?2004h> import re\r\n"]
[870.307463, "o", "\u001b[?2004l\r\n"]
[870.367756, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[870.428049, "o", "\u001b[?2004l\r\n"]
[870.488341, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[870.548634, "o", "\u001b[?2004l\r\n"]
[870.608927, "o", "\u001b[?2004h> changed = False\r\n"]
[870.66922, "o", "\u001b[?2004l\r\n"]
[870.729512, "o", "\u001b[?2004h> # Try to bump an existing threshold constant if present\r\n"]
[870.789805, "o", "\u001b[?2004l\r\n"]
[870.850098, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[870.91039, "o", "\u001b[?2004l\r\n"]
[870.970683, "o", "\u001b[?2004h> if n == 0:\r\n"]
[871.030976, "o", "\u001b[?2004l\r\n"]
[871.091268, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[871.151561, "o", "\u001b[?2004l\r\n"]
[871.211854, "o", "\u001b[?2004h> if n > 0:\r\n"]
[871.272146, "o", "\u001b[?2004l\r\n"]
[871.332439, "o", "\u001b[?2004h>     src = new_src\r\n"]
[871.392732, "o", "\u001b[?2004l\r\n"]
[871.453024, "o", "\u001b[?2004h>     changed = True\r\n"]
[871.513317, "o", "\u001b[?2004l\r\n"]
[871.57361, "o", "\u001b[?2004h> else:\r\n"]
[871.633902, "o", "\u001b[?2004l\r\n"]
[871.694195, "o", "\u001b[?2004h>     # Inject early bypass into should_use_numexpr for moderate sizes\r\n"]
[871.754488, "o", "\u001b[?2004l\r\n"]
[871.81478, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[871.875073, "o", "\u001b[?2004l\r\n"]
[871.935366, "o", "\u001b[?2004h>     if m:\r\n"]
[871.995659, "o", "\u001b[?2004l\r\n"]
[872.055951, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[872.116244, "o", "\u001b[?2004l\r\n"]
[872.176537, "o", "\u001b[?2004h>         # If there is a docstring immediately after the def, skip it\r\n"]
[872.236829, "o", "\u001b[?2004l\r\n"]
[872.297122, "o", "\u001b[?2004h>         docm = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[872.357415, "o", "\u001b[?2004l\r\n"]
[872.417707, "o", "\u001b[?2004h>         if docm:\r\n"]
[872.478, "o", "\u001b[?2004l\r\n"]
[872.538293, "o", "\u001b[?2004h>             insert_at += docm.end()\r\n"]
[872.598585, "o", "\u001b[?2004l\r\n"]
[872.658878, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+1200]:\r\n"]
[872.719171, "o", "\u001b[?2004l\r\n"]
[872.779463, "o", "\u001b[?2004h>             inject = (\r\n"]
[872.839756, "o", "\u001b[?2004l\r\n"]
[872.900049, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[872.960341, "o", "\u001b[?2004l\r\n"]
[873.020634, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[873.080927, "o", "\u001b[?2004l\r\n"]
[873.14122, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[873.201512, "o", "\u001b[?2004l\r\n"]
[873.261805, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[873.322098, "o", "\u001b[?2004l\r\n"]
[873.38239, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[873.442683, "o", "\u001b[?2004l\r\n"]
[873.502976, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[873.563268, "o", "\u001b[?2004l\r\n"]
[873.623561, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[873.683854, "o", "\u001b[?2004l\r\n"]
[873.744146, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[873.804439, "o", "\u001b[?2004l\r\n"]
[873.864732, "o", "\u001b[?2004h>             )\r\n"]
[873.925024, "o", "\u001b[?2004l\r\n"]
[873.985317, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[874.04561, "o", "\u001b[?2004l\r\n"]
[874.105902, "o", "\u001b[?2004h>             changed = True\r\n"]
[874.166195, "o", "\u001b[?2004l\r\n"]
[874.226488, "o", "\u001b[?2004h> if changed:\r\n"]
[874.28678, "o", "\u001b[?2004l\r\n"]
[874.347073, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[874.407366, "o", "\u001b[?2004l\r\n"]
[874.467659, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[874.527951, "o", "\u001b[?2004l\r\n"]
[874.588244, "o", "\u001b[?2004h> else:\r\n"]
[874.648537, "o", "\u001b[?2004l\r\n"]
[874.708829, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[874.769122, "o", "\u001b[?2004l\r\n"]
[874.829415, "o", "\u001b[?2004h> PY\r\n"]
[874.889707, "o", "\u001b[?2004l\r\n"]
[875.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[875.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[875.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[875.006, "o", "\u001b[?2004l\r\n"]
[880.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[880.002, "i", "git add pandas/core/computation/expressions.py\r"]
[880.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[880.006, "o", "\u001b[?2004l\r\n"]
[885.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[885.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops with a size threshold to reduce overhead; i\r"]
[885.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops with a size threshold to reduce overhead; i\r\n"]
[885.624, "o", "improves arithmetic.Ops.*\"\r\n"]
[886.242, "o", "\u001b[?2004l\r\n"]
[886.86, "o", "On branch main\r\n"]
[887.478, "o", "Untracked files:\r\n"]
[888.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[888.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[889.332, "o", "\r\n"]
[890.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[890.002, "i", "cd asv_bench\r"]
[890.004, "o", "cd asv_bench\r\n"]
[890.006, "o", "\u001b[?2004l\r\n"]
[895.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[895.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[895.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[895.097556, "o", "\u001b[?2004l\r\n"]
[895.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[895.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[895.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[895.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[895.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[895.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[895.738444, "o", "             --                      threads          \r\n"]
[895.83, "o", "             ------------- ---------------------------\r\n"]
[895.921556, "o", "              use_numexpr     default          1      \r\n"]
[896.013111, "o", "             ============= ============= =============\r\n"]
[896.104667, "o", "                  True      2.17\u00b10.07ms   2.17\u00b10.09ms \r\n"]
[896.196222, "o", "                 False      2.15\u00b10.04ms   2.09\u00b10.02ms \r\n"]
[896.287778, "o", "             ============= ============= =============\r\n"]
[896.379333, "o", "\r\n"]
[896.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[896.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[896.654, "o", "             --                      threads          \r\n"]
[896.745556, "o", "             ------------- ---------------------------\r\n"]
[896.837111, "o", "              use_numexpr     default          1      \r\n"]
[896.928667, "o", "             ============= ============= =============\r\n"]
[897.020222, "o", "                  True      1.66\u00b10.02ms   1.65\u00b10.06ms \r\n"]
[897.111778, "o", "                 False      1.66\u00b10.01ms   1.66\u00b10.01ms \r\n"]
[897.203333, "o", "             ============= ============= =============\r\n"]
[897.294889, "o", "\r\n"]
[897.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[897.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[897.569556, "o", "             --                      threads          \r\n"]
[897.661111, "o", "             ------------- ---------------------------\r\n"]
[897.752667, "o", "              use_numexpr     default          1      \r\n"]
[897.844222, "o", "             ============= ============= =============\r\n"]
[897.935778, "o", "                  True      2.16\u00b10.09ms   2.18\u00b10.04ms \r\n"]
[898.027333, "o", "                 False      2.16\u00b10.03ms   2.18\u00b10.03ms \r\n"]
[898.118889, "o", "             ============= ============= =============\r\n"]
[898.210444, "o", "\r\n"]
[898.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[898.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[898.485111, "o", "             --                      threads          \r\n"]
[898.576667, "o", "             ------------- ---------------------------\r\n"]
[898.668222, "o", "              use_numexpr     default          1      \r\n"]
[898.759778, "o", "             ============= ============= =============\r\n"]
[898.851333, "o", "                  True      10.2\u00b10.09ms   10.1\u00b10.06ms \r\n"]
[898.942889, "o", "                 False      10.1\u00b10.09ms    10.2\u00b10.1ms \r\n"]
[899.034444, "o", "             ============= ============= =============\r\n"]
[899.126, "o", "\r\n"]
[899.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.3\u00b10.2ms\r\n"]
[899.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.7\u00b10.07ms\r\n"]
[899.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              822\u00b120\u03bcs\r\n"]
[899.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.5\u00b10.1ms\r\n"]
[899.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    25.0\u00b10.1ms\r\n"]
[899.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.51\u00b10.01ms\r\n"]
[899.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      10.6\u00b10.2ms\r\n"]
[899.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      451\u00b17\u03bcs\r\n"]
[900.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[900.002, "i", "cd ..\r"]
[900.004, "o", "cd ..\r\n"]
[900.006, "o", "\u001b[?2004l\r\n"]
[905.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[905.002, "i", "git status -sb\r"]
[905.004, "o", "git status -sb\r\n"]
[906.654, "o", "\u001b[?2004l\r\n"]
[908.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[910.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[910.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[910.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[911.654, "o", "\u001b[?2004l\r\n"]
[913.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[915.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[915.002, "i", "sed -n '1,240p' pandas/core/computation/expressions.py\r"]
[915.004, "o", "sed -n '1,240p' pandas/core/computation/expressions.py\r\n"]
[915.026515, "o", "\u001b[?2004l\r\n"]
[915.047029, "o", "\"\"\"\r\n"]
[915.067544, "o", "Expressions\r\n"]
[915.088058, "o", "-----------\r\n"]
[915.108573, "o", "\r\n"]
[915.129087, "o", "Offer fast expression evaluation through numexpr\r\n"]
[915.149602, "o", "\r\n"]
[915.170116, "o", "\"\"\"\r\n"]
[915.190631, "o", "\r\n"]
[915.211145, "o", "from __future__ import annotations\r\n"]
[915.23166, "o", "\r\n"]
[915.252174, "o", "import operator\r\n"]
[915.272689, "o", "from typing import TYPE_CHECKING\r\n"]
[915.293203, "o", "import warnings\r\n"]
[915.313718, "o", "\r\n"]
[915.334232, "o", "import numpy as np\r\n"]
[915.354747, "o", "\r\n"]
[915.375261, "o", "from pandas._config import get_option\r\n"]
[915.395776, "o", "\r\n"]
[915.41629, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[915.436805, "o", "\r\n"]
[915.45732, "o", "from pandas.core import roperator\r\n"]
[915.477834, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[915.498349, "o", "\r\n"]
[915.518863, "o", "if NUMEXPR_INSTALLED:\r\n"]
[915.539378, "o", "    import numexpr as ne\r\n"]
[915.559892, "o", "\r\n"]
[915.580407, "o", "if TYPE_CHECKING:\r\n"]
[915.600921, "o", "    from pandas._typing import FuncType\r\n"]
[915.621436, "o", "\r\n"]
[915.64195, "o", "_TEST_MODE: bool | None = None\r\n"]
[915.662465, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[915.682979, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[915.703494, "o", "_evaluate: FuncType | None = None\r\n"]
[915.724008, "o", "_where: FuncType | None = None\r\n"]
[915.744523, "o", "\r\n"]
[915.765037, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[915.785552, "o", "_ALLOWED_DTYPES = {\r\n"]
[915.806066, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[915.826581, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[915.847095, "o", "}\r\n"]
[915.86761, "o", "\r\n"]
[915.888124, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[915.908639, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[915.929154, "o", "\r\n"]
[915.949668, "o", "\r\n"]
[915.970183, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[915.990697, "o", "    # set/unset to use numexpr\r\n"]
[916.011212, "o", "    global USE_NUMEXPR\r\n"]
[916.031726, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[916.052241, "o", "        USE_NUMEXPR = v\r\n"]
[916.072755, "o", "\r\n"]
[916.09327, "o", "    # choose what we are going to do\r\n"]
[916.113784, "o", "    global _evaluate, _where\r\n"]
[916.134299, "o", "\r\n"]
[916.154813, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[916.175328, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[916.195842, "o", "\r\n"]
[916.216357, "o", "\r\n"]
[916.236871, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[916.257386, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[916.2779, "o", "    # otherwise reset\r\n"]
[916.298415, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[916.318929, "o", "        if n is None:\r\n"]
[916.339444, "o", "            n = ne.detect_number_of_cores()\r\n"]
[916.359959, "o", "        ne.set_num_threads(n)\r\n"]
[916.380473, "o", "\r\n"]
[916.400988, "o", "\r\n"]
[916.421502, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[916.442017, "o", "    \"\"\"\r\n"]
[916.462531, "o", "    Standard evaluation.\r\n"]
[916.483046, "o", "    \"\"\"\r\n"]
[916.50356, "o", "    if _TEST_MODE:\r\n"]
[916.524075, "o", "        _store_test_result(False)\r\n"]
[916.544589, "o", "    return op(left_op, right_op)\r\n"]
[916.565104, "o", "\r\n"]
[916.585618, "o", "\r\n"]
[916.606133, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[916.626647, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[916.647162, "o", "    if op_str is not None:\r\n"]
[916.667676, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[916.688191, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[916.708705, "o", "            # check for dtype compatibility\r\n"]
[916.72922, "o", "            dtypes: set[str] = set()\r\n"]
[916.749734, "o", "            for o in [left_op, right_op]:\r\n"]
[916.770249, "o", "                # ndarray and Series Case\r\n"]
[916.790763, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[916.811278, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[916.831793, "o", "\r\n"]
[916.852307, "o", "            # allowed are a superset\r\n"]
[916.872822, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[916.893336, "o", "                return True\r\n"]
[916.913851, "o", "\r\n"]
[916.934365, "o", "    return False\r\n"]
[916.95488, "o", "\r\n"]
[916.975394, "o", "\r\n"]
[916.995909, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[917.016423, "o", "    result = None\r\n"]
[917.036938, "o", "\r\n"]
[917.057452, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[917.077967, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[917.098481, "o", "        if is_reversed:\r\n"]
[917.118996, "o", "            # we were originally called by a reversed op method\r\n"]
[917.13951, "o", "            left_op, right_op = right_op, left_op\r\n"]
[917.160025, "o", "\r\n"]
[917.180539, "o", "        left_value = left_op\r\n"]
[917.201054, "o", "        right_value = right_op\r\n"]
[917.221568, "o", "\r\n"]
[917.242083, "o", "        try:\r\n"]
[917.262598, "o", "            result = ne.evaluate(\r\n"]
[917.283112, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[917.303627, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[917.324141, "o", "                casting=\"safe\",\r\n"]
[917.344656, "o", "            )\r\n"]
[917.36517, "o", "        except TypeError:\r\n"]
[917.385685, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[917.406199, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[917.426714, "o", "            pass\r\n"]
[917.447228, "o", "        except NotImplementedError:\r\n"]
[917.467743, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[917.488257, "o", "                pass\r\n"]
[917.508772, "o", "            else:\r\n"]
[917.529286, "o", "                raise\r\n"]
[917.549801, "o", "\r\n"]
[917.570315, "o", "        if is_reversed:\r\n"]
[917.59083, "o", "            # reverse order to original for fallback\r\n"]
[917.611344, "o", "            left_op, right_op = right_op, left_op\r\n"]
[917.631859, "o", "\r\n"]
[917.652373, "o", "    if _TEST_MODE:\r\n"]
[917.672888, "o", "        _store_test_result(result is not None)\r\n"]
[917.693402, "o", "\r\n"]
[917.713917, "o", "    if result is None:\r\n"]
[917.734432, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[917.754946, "o", "\r\n"]
[917.775461, "o", "    return result\r\n"]
[917.795975, "o", "\r\n"]
[917.81649, "o", "\r\n"]
[917.837004, "o", "_op_str_mapping = {\r\n"]
[917.857519, "o", "    operator.add: \"+\",\r\n"]
[917.878033, "o", "    roperator.radd: \"+\",\r\n"]
[917.898548, "o", "    operator.mul: \"*\",\r\n"]
[917.919062, "o", "    roperator.rmul: \"*\",\r\n"]
[917.939577, "o", "    operator.sub: \"-\",\r\n"]
[917.960091, "o", "    roperator.rsub: \"-\",\r\n"]
[917.980606, "o", "    operator.truediv: \"/\",\r\n"]
[918.00112, "o", "    roperator.rtruediv: \"/\",\r\n"]
[918.021635, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[918.042149, "o", "    operator.floordiv: None,\r\n"]
[918.062664, "o", "    roperator.rfloordiv: None,\r\n"]
[918.083178, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[918.103693, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[918.124207, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[918.144722, "o", "    operator.mod: None,\r\n"]
[918.165237, "o", "    roperator.rmod: None,\r\n"]
[918.185751, "o", "    operator.pow: \"**\",\r\n"]
[918.206266, "o", "    roperator.rpow: \"**\",\r\n"]
[918.22678, "o", "    operator.eq: \"==\",\r\n"]
[918.247295, "o", "    operator.ne: \"!=\",\r\n"]
[918.267809, "o", "    operator.le: \"<=\",\r\n"]
[918.288324, "o", "    operator.lt: \"<\",\r\n"]
[918.308838, "o", "    operator.ge: \">=\",\r\n"]
[918.329353, "o", "    operator.gt: \">\",\r\n"]
[918.349867, "o", "    operator.and_: \"&\",\r\n"]
[918.370382, "o", "    roperator.rand_: \"&\",\r\n"]
[918.390896, "o", "    operator.or_: \"|\",\r\n"]
[918.411411, "o", "    roperator.ror_: \"|\",\r\n"]
[918.431925, "o", "    operator.xor: \"^\",\r\n"]
[918.45244, "o", "    roperator.rxor: \"^\",\r\n"]
[918.472954, "o", "    divmod: None,\r\n"]
[918.493469, "o", "    roperator.rdivmod: None,\r\n"]
[918.513983, "o", "}\r\n"]
[918.534498, "o", "\r\n"]
[918.555012, "o", "\r\n"]
[918.575527, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[918.596041, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[918.616556, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[918.637071, "o", "\r\n"]
[918.657585, "o", "\r\n"]
[918.6781, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[918.698614, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[918.719129, "o", "    result = None\r\n"]
[918.739643, "o", "\r\n"]
[918.760158, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[918.780672, "o", "        result = ne.evaluate(\r\n"]
[918.801187, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[918.821701, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[918.842216, "o", "            casting=\"safe\",\r\n"]
[918.86273, "o", "        )\r\n"]
[918.883245, "o", "\r\n"]
[918.903759, "o", "    if result is None:\r\n"]
[918.924274, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[918.944788, "o", "\r\n"]
[918.965303, "o", "    return result\r\n"]
[918.985817, "o", "\r\n"]
[919.006332, "o", "\r\n"]
[919.026846, "o", "# turn myself on\r\n"]
[919.047361, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[919.067876, "o", "\r\n"]
[919.08839, "o", "\r\n"]
[919.108905, "o", "def _has_bool_dtype(x):\r\n"]
[919.129419, "o", "    try:\r\n"]
[919.149934, "o", "        return x.dtype == bool\r\n"]
[919.170448, "o", "    except AttributeError:\r\n"]
[919.190963, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[919.211477, "o", "\r\n"]
[919.231992, "o", "\r\n"]
[919.252506, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[919.273021, "o", "\r\n"]
[919.293535, "o", "\r\n"]
[919.31405, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[919.334564, "o", "    \"\"\"\r\n"]
[919.355079, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[919.375593, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[919.396108, "o", "    boolean ops.\r\n"]
[919.416622, "o", "    \"\"\"\r\n"]
[919.437137, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[919.457651, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[919.478166, "o", "            warnings.warn(\r\n"]
[919.49868, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[919.519195, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[919.53971, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[919.560224, "o", "                stacklevel=find_stack_level(),\r\n"]
[919.580739, "o", "            )\r\n"]
[919.601253, "o", "            return True\r\n"]
[919.621768, "o", "    return False\r\n"]
[919.642282, "o", "\r\n"]
[919.662797, "o", "\r\n"]
[919.683311, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[919.703826, "o", "    \"\"\"\r\n"]
[919.72434, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[919.744855, "o", "\r\n"]
[919.765369, "o", "    Parameters\r\n"]
[919.785884, "o", "    ----------\r\n"]
[919.806398, "o", "    op : the actual operand\r\n"]
[919.826913, "o", "    left_op : left operand\r\n"]
[919.847427, "o", "    right_op : right operand\r\n"]
[919.867942, "o", "    use_numexpr : bool, default True\r\n"]
[919.888456, "o", "        Whether to try to use numexpr.\r\n"]
[919.908971, "o", "    \"\"\"\r\n"]
[919.929485, "o", "    op_str = _op_str_mapping[op]\r\n"]
[920.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[920.002, "i", "python - << 'PY'\r"]
[920.004, "o", "python - << 'PY'\r\n"]
[920.0678, "o", "\u001b[?2004l\r\n"]
[920.1296, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[920.1914, "o", "\u001b[?2004l\r\n"]
[920.2532, "o", "\u001b[?2004h> import re\r\n"]
[920.315, "o", "\u001b[?2004l\r\n"]
[920.3768, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[920.4386, "o", "\u001b[?2004l\r\n"]
[920.5004, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[920.5622, "o", "\u001b[?2004l\r\n"]
[920.624, "o", "\u001b[?2004h> changed = False\r\n"]
[920.6858, "o", "\u001b[?2004l\r\n"]
[920.7476, "o", "\u001b[?2004h> # Prefer bumping an existing threshold; otherwise inject an early bypass in should_use_numexpr\r\n"]
[920.8094, "o", "\u001b[?2004l\r\n"]
[920.8712, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[920.933, "o", "\u001b[?2004l\r\n"]
[920.9948, "o", "\u001b[?2004h> if n == 0:\r\n"]
[921.0566, "o", "\u001b[?2004l\r\n"]
[921.1184, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[921.1802, "o", "\u001b[?2004l\r\n"]
[921.242, "o", "\u001b[?2004h> if n > 0:\r\n"]
[921.3038, "o", "\u001b[?2004l\r\n"]
[921.3656, "o", "\u001b[?2004h>     src = new_src\r\n"]
[921.4274, "o", "\u001b[?2004l\r\n"]
[921.4892, "o", "\u001b[?2004h>     changed = True\r\n"]
[921.551, "o", "\u001b[?2004l\r\n"]
[921.6128, "o", "\u001b[?2004h> else:\r\n"]
[921.6746, "o", "\u001b[?2004l\r\n"]
[921.7364, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[921.7982, "o", "\u001b[?2004l\r\n"]
[921.86, "o", "\u001b[?2004h>     if m:\r\n"]
[921.9218, "o", "\u001b[?2004l\r\n"]
[921.9836, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[922.0454, "o", "\u001b[?2004l\r\n"]
[922.1072, "o", "\u001b[?2004h>         # If a docstring is immediately after def, skip it\r\n"]
[922.169, "o", "\u001b[?2004l\r\n"]
[922.2308, "o", "\u001b[?2004h>         docm = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[922.2926, "o", "\u001b[?2004l\r\n"]
[922.3544, "o", "\u001b[?2004h>         if docm:\r\n"]
[922.4162, "o", "\u001b[?2004l\r\n"]
[922.478, "o", "\u001b[?2004h>             insert_at += docm.end()\r\n"]
[922.5398, "o", "\u001b[?2004l\r\n"]
[922.6016, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+1500]:\r\n"]
[922.6634, "o", "\u001b[?2004l\r\n"]
[922.7252, "o", "\u001b[?2004h>             inject = (\r\n"]
[922.787, "o", "\u001b[?2004l\r\n"]
[922.8488, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[922.9106, "o", "\u001b[?2004l\r\n"]
[922.9724, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[923.0342, "o", "\u001b[?2004l\r\n"]
[923.096, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[923.1578, "o", "\u001b[?2004l\r\n"]
[923.2196, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[923.2814, "o", "\u001b[?2004l\r\n"]
[923.3432, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[923.405, "o", "\u001b[?2004l\r\n"]
[923.4668, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[923.5286, "o", "\u001b[?2004l\r\n"]
[923.5904, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[923.6522, "o", "\u001b[?2004l\r\n"]
[923.714, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[923.7758, "o", "\u001b[?2004l\r\n"]
[923.8376, "o", "\u001b[?2004h>             )\r\n"]
[923.8994, "o", "\u001b[?2004l\r\n"]
[923.9612, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[924.023, "o", "\u001b[?2004l\r\n"]
[924.0848, "o", "\u001b[?2004h>             changed = True\r\n"]
[924.1466, "o", "\u001b[?2004l\r\n"]
[924.2084, "o", "\u001b[?2004h> if changed:\r\n"]
[924.2702, "o", "\u001b[?2004l\r\n"]
[924.332, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[924.3938, "o", "\u001b[?2004l\r\n"]
[924.4556, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[924.5174, "o", "\u001b[?2004l\r\n"]
[924.5792, "o", "\u001b[?2004h> else:\r\n"]
[924.641, "o", "\u001b[?2004l\r\n"]
[924.7028, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[924.7646, "o", "\u001b[?2004l\r\n"]
[924.8264, "o", "\u001b[?2004h> PY\r\n"]
[924.8882, "o", "\u001b[?2004l\r\n"]
[925.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[925.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[925.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[925.006, "o", "\u001b[?2004l\r\n"]
[930.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[930.002, "i", "git add pandas/core/computation/expressions.py\r"]
[930.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[930.006, "o", "\u001b[?2004l\r\n"]
[935.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[935.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[935.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[935.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[936.242, "o", "\u001b[?2004l\r\n"]
[936.86, "o", "On branch main\r\n"]
[937.478, "o", "Untracked files:\r\n"]
[938.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[938.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[939.332, "o", "\r\n"]
[940.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[940.002, "i", "cd asv_bench\r"]
[940.004, "o", "cd asv_bench\r\n"]
[940.006, "o", "\u001b[?2004l\r\n"]
[945.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[945.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[945.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[945.097556, "o", "\u001b[?2004l\r\n"]
[945.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[945.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[945.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[945.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[945.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[945.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[945.738444, "o", "             --                      threads          \r\n"]
[945.83, "o", "             ------------- ---------------------------\r\n"]
[945.921556, "o", "              use_numexpr     default          1      \r\n"]
[946.013111, "o", "             ============= ============= =============\r\n"]
[946.104667, "o", "                  True      2.15\u00b10.04ms   2.12\u00b10.04ms \r\n"]
[946.196222, "o", "                 False      2.11\u00b10.05ms   2.14\u00b10.02ms \r\n"]
[946.287778, "o", "             ============= ============= =============\r\n"]
[946.379333, "o", "\r\n"]
[946.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[946.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[946.654, "o", "             --                      threads          \r\n"]
[946.745556, "o", "             ------------- ---------------------------\r\n"]
[946.837111, "o", "              use_numexpr     default          1      \r\n"]
[946.928667, "o", "             ============= ============= =============\r\n"]
[947.020222, "o", "                  True      1.65\u00b10.04ms   1.69\u00b10.05ms \r\n"]
[947.111778, "o", "                 False      1.71\u00b10.06ms   1.74\u00b10.07ms \r\n"]
[947.203333, "o", "             ============= ============= =============\r\n"]
[947.294889, "o", "\r\n"]
[947.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[947.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[947.569556, "o", "             --                      threads          \r\n"]
[947.661111, "o", "             ------------- ---------------------------\r\n"]
[947.752667, "o", "              use_numexpr     default          1      \r\n"]
[947.844222, "o", "             ============= ============= =============\r\n"]
[947.935778, "o", "                  True      2.16\u00b10.05ms   2.17\u00b10.03ms \r\n"]
[948.027333, "o", "                 False      2.20\u00b10.04ms   2.13\u00b10.02ms \r\n"]
[948.118889, "o", "             ============= ============= =============\r\n"]
[948.210444, "o", "\r\n"]
[948.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[948.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ =============\u001b[0m\r\n"]
[948.485111, "o", "             --                     threads          \r\n"]
[948.576667, "o", "             ------------- --------------------------\r\n"]
[948.668222, "o", "              use_numexpr    default          1      \r\n"]
[948.759778, "o", "             ============= ============ =============\r\n"]
[948.851333, "o", "                  True      9.94\u00b10.1ms   9.95\u00b10.08ms \r\n"]
[948.942889, "o", "                 False      10.0\u00b10.2ms    10.1\u00b10.2ms \r\n"]
[949.034444, "o", "             ============= ============ =============\r\n"]
[949.126, "o", "\r\n"]
[949.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.7\u00b10.5ms\r\n"]
[949.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                    28.8\u00b10.1ms\r\n"]
[949.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              804\u00b140\u03bcs\r\n"]
[949.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.5\u00b10.2ms\r\n"]
[949.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.8\u00b10.05ms\r\n"]
[949.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                              1.50\u00b10.1ms\r\n"]
[949.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     11.2\u00b10.09ms\r\n"]
[949.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      433\u00b18\u03bcs\r\n"]
[950.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[950.002, "i", "cd ..\r"]
[950.004, "o", "cd ..\r\n"]
[950.006, "o", "\u001b[?2004l\r\n"]
[955.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[955.002, "i", "git status -sb\r"]
[955.004, "o", "git status -sb\r\n"]
[956.654, "o", "\u001b[?2004l\r\n"]
[958.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[960.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[960.002, "i", "ls -la pandas/core/computation\r"]
[960.004, "o", "ls -la pandas/core/computation\r\n"]
[960.296824, "o", "\u001b[?2004l\r\n"]
[960.587647, "o", "total 152\r\n"]
[960.878471, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[0m\u001b[01;34m.\u001b[0m\r\n"]
[961.169294, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34m..\u001b[0m\r\n"]
[961.460118, "o", "-rw-r--r-- 1 root root     0 Sep 12 21:42 __init__.py\r\n"]
[961.750941, "o", "-rw-r--r-- 1 root root  6735 Sep 12 21:42 align.py\r\n"]
[962.041765, "o", "-rw-r--r-- 1 root root    65 Sep 12 21:42 api.py\r\n"]
[962.332588, "o", "-rw-r--r-- 1 root root   226 Sep 12 21:42 check.py\r\n"]
[962.623412, "o", "-rw-r--r-- 1 root root  1442 Sep 12 21:42 common.py\r\n"]
[962.914235, "o", "-rw-r--r-- 1 root root  3462 Sep 12 21:42 engines.py\r\n"]
[963.205059, "o", "-rw-r--r-- 1 root root 15281 Sep 12 21:42 eval.py\r\n"]
[963.495882, "o", "-rw-r--r-- 1 root root 25337 Sep 12 21:44 expr.py\r\n"]
[963.786706, "o", "-rw-r--r-- 1 root root  7966 Oct  1 17:48 expressions.py\r\n"]
[964.077529, "o", "-rw-r--r-- 1 root root 14435 Sep 12 21:42 ops.py\r\n"]
[964.368353, "o", "-rw-r--r-- 1 root root  7711 Sep 12 21:42 parsing.py\r\n"]
[964.659176, "o", "-rw-r--r-- 1 root root 21077 Sep 12 21:44 pytables.py\r\n"]
[965.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[965.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[965.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[966.654, "o", "\u001b[?2004l\r\n"]
[968.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[970.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[970.002, "i", "sed -n '1,220p' pandas/core/computation/expressions.py\r"]
[970.004, "o", "sed -n '1,220p' pandas/core/computation/expressions.py\r\n"]
[970.028371, "o", "\u001b[?2004l\r\n"]
[970.050742, "o", "\"\"\"\r\n"]
[970.073113, "o", "Expressions\r\n"]
[970.095484, "o", "-----------\r\n"]
[970.117855, "o", "\r\n"]
[970.140226, "o", "Offer fast expression evaluation through numexpr\r\n"]
[970.162597, "o", "\r\n"]
[970.184968, "o", "\"\"\"\r\n"]
[970.207339, "o", "\r\n"]
[970.22971, "o", "from __future__ import annotations\r\n"]
[970.252081, "o", "\r\n"]
[970.274452, "o", "import operator\r\n"]
[970.296824, "o", "from typing import TYPE_CHECKING\r\n"]
[970.319195, "o", "import warnings\r\n"]
[970.341566, "o", "\r\n"]
[970.363937, "o", "import numpy as np\r\n"]
[970.386308, "o", "\r\n"]
[970.408679, "o", "from pandas._config import get_option\r\n"]
[970.43105, "o", "\r\n"]
[970.453421, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[970.475792, "o", "\r\n"]
[970.498163, "o", "from pandas.core import roperator\r\n"]
[970.520534, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[970.542905, "o", "\r\n"]
[970.565276, "o", "if NUMEXPR_INSTALLED:\r\n"]
[970.587647, "o", "    import numexpr as ne\r\n"]
[970.610018, "o", "\r\n"]
[970.632389, "o", "if TYPE_CHECKING:\r\n"]
[970.65476, "o", "    from pandas._typing import FuncType\r\n"]
[970.677131, "o", "\r\n"]
[970.699502, "o", "_TEST_MODE: bool | None = None\r\n"]
[970.721873, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[970.744244, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[970.766615, "o", "_evaluate: FuncType | None = None\r\n"]
[970.788986, "o", "_where: FuncType | None = None\r\n"]
[970.811357, "o", "\r\n"]
[970.833729, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[970.8561, "o", "_ALLOWED_DTYPES = {\r\n"]
[970.878471, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[970.900842, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[970.923213, "o", "}\r\n"]
[970.945584, "o", "\r\n"]
[970.967955, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[970.990326, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[971.012697, "o", "\r\n"]
[971.035068, "o", "\r\n"]
[971.057439, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[971.07981, "o", "    # set/unset to use numexpr\r\n"]
[971.102181, "o", "    global USE_NUMEXPR\r\n"]
[971.124552, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[971.146923, "o", "        USE_NUMEXPR = v\r\n"]
[971.169294, "o", "\r\n"]
[971.191665, "o", "    # choose what we are going to do\r\n"]
[971.214036, "o", "    global _evaluate, _where\r\n"]
[971.236407, "o", "\r\n"]
[971.258778, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[971.281149, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[971.30352, "o", "\r\n"]
[971.325891, "o", "\r\n"]
[971.348262, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[971.370633, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[971.393005, "o", "    # otherwise reset\r\n"]
[971.415376, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[971.437747, "o", "        if n is None:\r\n"]
[971.460118, "o", "            n = ne.detect_number_of_cores()\r\n"]
[971.482489, "o", "        ne.set_num_threads(n)\r\n"]
[971.50486, "o", "\r\n"]
[971.527231, "o", "\r\n"]
[971.549602, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[971.571973, "o", "    \"\"\"\r\n"]
[971.594344, "o", "    Standard evaluation.\r\n"]
[971.616715, "o", "    \"\"\"\r\n"]
[971.639086, "o", "    if _TEST_MODE:\r\n"]
[971.661457, "o", "        _store_test_result(False)\r\n"]
[971.683828, "o", "    return op(left_op, right_op)\r\n"]
[971.706199, "o", "\r\n"]
[971.72857, "o", "\r\n"]
[971.750941, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[971.773312, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[971.795683, "o", "    if op_str is not None:\r\n"]
[971.818054, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[971.840425, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[971.862796, "o", "            # check for dtype compatibility\r\n"]
[971.885167, "o", "            dtypes: set[str] = set()\r\n"]
[971.907538, "o", "            for o in [left_op, right_op]:\r\n"]
[971.92991, "o", "                # ndarray and Series Case\r\n"]
[971.952281, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[971.974652, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[971.997023, "o", "\r\n"]
[972.019394, "o", "            # allowed are a superset\r\n"]
[972.041765, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[972.064136, "o", "                return True\r\n"]
[972.086507, "o", "\r\n"]
[972.108878, "o", "    return False\r\n"]
[972.131249, "o", "\r\n"]
[972.15362, "o", "\r\n"]
[972.175991, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[972.198362, "o", "    result = None\r\n"]
[972.220733, "o", "\r\n"]
[972.243104, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[972.265475, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[972.287846, "o", "        if is_reversed:\r\n"]
[972.310217, "o", "            # we were originally called by a reversed op method\r\n"]
[972.332588, "o", "            left_op, right_op = right_op, left_op\r\n"]
[972.354959, "o", "\r\n"]
[972.37733, "o", "        left_value = left_op\r\n"]
[972.399701, "o", "        right_value = right_op\r\n"]
[972.422072, "o", "\r\n"]
[972.444443, "o", "        try:\r\n"]
[972.466814, "o", "            result = ne.evaluate(\r\n"]
[972.489186, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[972.511557, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[972.533928, "o", "                casting=\"safe\",\r\n"]
[972.556299, "o", "            )\r\n"]
[972.57867, "o", "        except TypeError:\r\n"]
[972.601041, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[972.623412, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[972.645783, "o", "            pass\r\n"]
[972.668154, "o", "        except NotImplementedError:\r\n"]
[972.690525, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[972.712896, "o", "                pass\r\n"]
[972.735267, "o", "            else:\r\n"]
[972.757638, "o", "                raise\r\n"]
[972.780009, "o", "\r\n"]
[972.80238, "o", "        if is_reversed:\r\n"]
[972.824751, "o", "            # reverse order to original for fallback\r\n"]
[972.847122, "o", "            left_op, right_op = right_op, left_op\r\n"]
[972.869493, "o", "\r\n"]
[972.891864, "o", "    if _TEST_MODE:\r\n"]
[972.914235, "o", "        _store_test_result(result is not None)\r\n"]
[972.936606, "o", "\r\n"]
[972.958977, "o", "    if result is None:\r\n"]
[972.981348, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[973.003719, "o", "\r\n"]
[973.02609, "o", "    return result\r\n"]
[973.048462, "o", "\r\n"]
[973.070833, "o", "\r\n"]
[973.093204, "o", "_op_str_mapping = {\r\n"]
[973.115575, "o", "    operator.add: \"+\",\r\n"]
[973.137946, "o", "    roperator.radd: \"+\",\r\n"]
[973.160317, "o", "    operator.mul: \"*\",\r\n"]
[973.182688, "o", "    roperator.rmul: \"*\",\r\n"]
[973.205059, "o", "    operator.sub: \"-\",\r\n"]
[973.22743, "o", "    roperator.rsub: \"-\",\r\n"]
[973.249801, "o", "    operator.truediv: \"/\",\r\n"]
[973.272172, "o", "    roperator.rtruediv: \"/\",\r\n"]
[973.294543, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[973.316914, "o", "    operator.floordiv: None,\r\n"]
[973.339285, "o", "    roperator.rfloordiv: None,\r\n"]
[973.361656, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[973.384027, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[973.406398, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[973.428769, "o", "    operator.mod: None,\r\n"]
[973.45114, "o", "    roperator.rmod: None,\r\n"]
[973.473511, "o", "    operator.pow: \"**\",\r\n"]
[973.495882, "o", "    roperator.rpow: \"**\",\r\n"]
[973.518253, "o", "    operator.eq: \"==\",\r\n"]
[973.540624, "o", "    operator.ne: \"!=\",\r\n"]
[973.562995, "o", "    operator.le: \"<=\",\r\n"]
[973.585367, "o", "    operator.lt: \"<\",\r\n"]
[973.607738, "o", "    operator.ge: \">=\",\r\n"]
[973.630109, "o", "    operator.gt: \">\",\r\n"]
[973.65248, "o", "    operator.and_: \"&\",\r\n"]
[973.674851, "o", "    roperator.rand_: \"&\",\r\n"]
[973.697222, "o", "    operator.or_: \"|\",\r\n"]
[973.719593, "o", "    roperator.ror_: \"|\",\r\n"]
[973.741964, "o", "    operator.xor: \"^\",\r\n"]
[973.764335, "o", "    roperator.rxor: \"^\",\r\n"]
[973.786706, "o", "    divmod: None,\r\n"]
[973.809077, "o", "    roperator.rdivmod: None,\r\n"]
[973.831448, "o", "}\r\n"]
[973.853819, "o", "\r\n"]
[973.87619, "o", "\r\n"]
[973.898561, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[973.920932, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[973.943303, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[973.965674, "o", "\r\n"]
[973.988045, "o", "\r\n"]
[974.010416, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[974.032787, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[974.055158, "o", "    result = None\r\n"]
[974.077529, "o", "\r\n"]
[974.0999, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[974.122271, "o", "        result = ne.evaluate(\r\n"]
[974.144643, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[974.167014, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[974.189385, "o", "            casting=\"safe\",\r\n"]
[974.211756, "o", "        )\r\n"]
[974.234127, "o", "\r\n"]
[974.256498, "o", "    if result is None:\r\n"]
[974.278869, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[974.30124, "o", "\r\n"]
[974.323611, "o", "    return result\r\n"]
[974.345982, "o", "\r\n"]
[974.368353, "o", "\r\n"]
[974.390724, "o", "# turn myself on\r\n"]
[974.413095, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[974.435466, "o", "\r\n"]
[974.457837, "o", "\r\n"]
[974.480208, "o", "def _has_bool_dtype(x):\r\n"]
[974.502579, "o", "    try:\r\n"]
[974.52495, "o", "        return x.dtype == bool\r\n"]
[974.547321, "o", "    except AttributeError:\r\n"]
[974.569692, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[974.592063, "o", "\r\n"]
[974.614434, "o", "\r\n"]
[974.636805, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[974.659176, "o", "\r\n"]
[974.681548, "o", "\r\n"]
[974.703919, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[974.72629, "o", "    \"\"\"\r\n"]
[974.748661, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[974.771032, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[974.793403, "o", "    boolean ops.\r\n"]
[974.815774, "o", "    \"\"\"\r\n"]
[974.838145, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[974.860516, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[974.882887, "o", "            warnings.warn(\r\n"]
[974.905258, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[974.927629, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[975.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[975.002, "i", "sed -n '220,500p' pandas/core/computation/expressions.py\r"]
[975.004, "o", "sed -n '220,500p' pandas/core/computation/expressions.py\r\n"]
[975.074667, "o", "\u001b[?2004l\r\n"]
[975.143333, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[975.212, "o", "                stacklevel=find_stack_level(),\r\n"]
[975.280667, "o", "            )\r\n"]
[975.349333, "o", "            return True\r\n"]
[975.418, "o", "    return False\r\n"]
[975.486667, "o", "\r\n"]
[975.555333, "o", "\r\n"]
[975.624, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[975.692667, "o", "    \"\"\"\r\n"]
[975.761333, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[975.83, "o", "\r\n"]
[975.898667, "o", "    Parameters\r\n"]
[975.967333, "o", "    ----------\r\n"]
[976.036, "o", "    op : the actual operand\r\n"]
[976.104667, "o", "    left_op : left operand\r\n"]
[976.173333, "o", "    right_op : right operand\r\n"]
[976.242, "o", "    use_numexpr : bool, default True\r\n"]
[976.310667, "o", "        Whether to try to use numexpr.\r\n"]
[976.379333, "o", "    \"\"\"\r\n"]
[976.448, "o", "    op_str = _op_str_mapping[op]\r\n"]
[976.516667, "o", "    if op_str is not None:\r\n"]
[976.585333, "o", "        if use_numexpr:\r\n"]
[976.654, "o", "            # error: \"None\" not callable\r\n"]
[976.722667, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[976.791333, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[976.86, "o", "\r\n"]
[976.928667, "o", "\r\n"]
[976.997333, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[977.066, "o", "    \"\"\"\r\n"]
[977.134667, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[977.203333, "o", "\r\n"]
[977.272, "o", "    Parameters\r\n"]
[977.340667, "o", "    ----------\r\n"]
[977.409333, "o", "    cond : np.ndarray[bool]\r\n"]
[977.478, "o", "    left_op : return if cond is True\r\n"]
[977.546667, "o", "    right_op : return if cond is False\r\n"]
[977.615333, "o", "    use_numexpr : bool, default True\r\n"]
[977.684, "o", "        Whether to try to use numexpr.\r\n"]
[977.752667, "o", "    \"\"\"\r\n"]
[977.821333, "o", "    assert _where is not None\r\n"]
[977.89, "o", "    if use_numexpr:\r\n"]
[977.958667, "o", "        return _where(cond, left_op, right_op)\r\n"]
[978.027333, "o", "    else:\r\n"]
[978.096, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[978.164667, "o", "\r\n"]
[978.233333, "o", "\r\n"]
[978.302, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[978.370667, "o", "    \"\"\"\r\n"]
[978.439333, "o", "    Keeps track of whether numexpr was used.\r\n"]
[978.508, "o", "\r\n"]
[978.576667, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[978.645333, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[978.714, "o", "    \"\"\"\r\n"]
[978.782667, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[978.851333, "o", "    _TEST_MODE = v\r\n"]
[978.92, "o", "    _TEST_RESULT = []\r\n"]
[978.988667, "o", "\r\n"]
[979.057333, "o", "\r\n"]
[979.126, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[979.194667, "o", "    if used_numexpr:\r\n"]
[979.263333, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[979.332, "o", "\r\n"]
[979.400667, "o", "\r\n"]
[979.469333, "o", "def get_test_result() -> list[bool]:\r\n"]
[979.538, "o", "    \"\"\"\r\n"]
[979.606667, "o", "    Get test result and reset test_results.\r\n"]
[979.675333, "o", "    \"\"\"\r\n"]
[979.744, "o", "    global _TEST_RESULT\r\n"]
[979.812667, "o", "    res = _TEST_RESULT\r\n"]
[979.881333, "o", "    _TEST_RESULT = []\r\n"]
[980.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[980.002, "i", "python - << 'PY'\r"]
[980.004, "o", "python - << 'PY'\r\n"]
[980.066293, "o", "\u001b[?2004l\r\n"]
[980.126585, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[980.186878, "o", "\u001b[?2004l\r\n"]
[980.247171, "o", "\u001b[?2004h> import re\r\n"]
[980.307463, "o", "\u001b[?2004l\r\n"]
[980.367756, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[980.428049, "o", "\u001b[?2004l\r\n"]
[980.488341, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[980.548634, "o", "\u001b[?2004l\r\n"]
[980.608927, "o", "\u001b[?2004h> changed = False\r\n"]
[980.66922, "o", "\u001b[?2004l\r\n"]
[980.729512, "o", "\u001b[?2004h> # Try bumping an existing threshold constant first\r\n"]
[980.789805, "o", "\u001b[?2004l\r\n"]
[980.850098, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[980.91039, "o", "\u001b[?2004l\r\n"]
[980.970683, "o", "\u001b[?2004h> if n == 0:\r\n"]
[981.030976, "o", "\u001b[?2004l\r\n"]
[981.091268, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[981.151561, "o", "\u001b[?2004l\r\n"]
[981.211854, "o", "\u001b[?2004h> if n > 0:\r\n"]
[981.272146, "o", "\u001b[?2004l\r\n"]
[981.332439, "o", "\u001b[?2004h>     src = new_src\r\n"]
[981.392732, "o", "\u001b[?2004l\r\n"]
[981.453024, "o", "\u001b[?2004h>     changed = True\r\n"]
[981.513317, "o", "\u001b[?2004l\r\n"]
[981.57361, "o", "\u001b[?2004h> else:\r\n"]
[981.633902, "o", "\u001b[?2004l\r\n"]
[981.694195, "o", "\u001b[?2004h>     # Inject early size-based bypass near the top of should_use_numexpr\r\n"]
[981.754488, "o", "\u001b[?2004l\r\n"]
[981.81478, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[981.875073, "o", "\u001b[?2004l\r\n"]
[981.935366, "o", "\u001b[?2004h>     if m:\r\n"]
[981.995659, "o", "\u001b[?2004l\r\n"]
[982.055951, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[982.116244, "o", "\u001b[?2004l\r\n"]
[982.176537, "o", "\u001b[?2004h>         # If a docstring follows immediately, skip it to keep code valid\r\n"]
[982.236829, "o", "\u001b[?2004l\r\n"]
[982.297122, "o", "\u001b[?2004h>         docm = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[982.357415, "o", "\u001b[?2004l\r\n"]
[982.417707, "o", "\u001b[?2004h>         if docm:\r\n"]
[982.478, "o", "\u001b[?2004l\r\n"]
[982.538293, "o", "\u001b[?2004h>             insert_at += docm.end()\r\n"]
[982.598585, "o", "\u001b[?2004l\r\n"]
[982.658878, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+1500]:\r\n"]
[982.719171, "o", "\u001b[?2004l\r\n"]
[982.779463, "o", "\u001b[?2004h>             inject = (\r\n"]
[982.839756, "o", "\u001b[?2004l\r\n"]
[982.900049, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[982.960341, "o", "\u001b[?2004l\r\n"]
[983.020634, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[983.080927, "o", "\u001b[?2004l\r\n"]
[983.14122, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[983.201512, "o", "\u001b[?2004l\r\n"]
[983.261805, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[983.322098, "o", "\u001b[?2004l\r\n"]
[983.38239, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[983.442683, "o", "\u001b[?2004l\r\n"]
[983.502976, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[983.563268, "o", "\u001b[?2004l\r\n"]
[983.623561, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[983.683854, "o", "\u001b[?2004l\r\n"]
[983.744146, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[983.804439, "o", "\u001b[?2004l\r\n"]
[983.864732, "o", "\u001b[?2004h>             )\r\n"]
[983.925024, "o", "\u001b[?2004l\r\n"]
[983.985317, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[984.04561, "o", "\u001b[?2004l\r\n"]
[984.105902, "o", "\u001b[?2004h>             changed = True\r\n"]
[984.166195, "o", "\u001b[?2004l\r\n"]
[984.226488, "o", "\u001b[?2004h> if changed:\r\n"]
[984.28678, "o", "\u001b[?2004l\r\n"]
[984.347073, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[984.407366, "o", "\u001b[?2004l\r\n"]
[984.467659, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[984.527951, "o", "\u001b[?2004l\r\n"]
[984.588244, "o", "\u001b[?2004h> else:\r\n"]
[984.648537, "o", "\u001b[?2004l\r\n"]
[984.708829, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[984.769122, "o", "\u001b[?2004l\r\n"]
[984.829415, "o", "\u001b[?2004h> PY\r\n"]
[984.889707, "o", "\u001b[?2004l\r\n"]
[985.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[985.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[985.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[985.006, "o", "\u001b[?2004l\r\n"]
[990.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[990.002, "i", "git add pandas/core/computation/expressions.py\r"]
[990.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[990.006, "o", "\u001b[?2004l\r\n"]
[995.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[995.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[995.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[995.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[996.242, "o", "\u001b[?2004l\r\n"]
[996.86, "o", "On branch main\r\n"]
[997.478, "o", "Untracked files:\r\n"]
[998.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[998.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[999.332, "o", "\r\n"]
[1000.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1000.002, "i", "cd asv_bench\r"]
[1000.004, "o", "cd asv_bench\r\n"]
[1000.006, "o", "\u001b[?2004l\r\n"]
[1005.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1005.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1005.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1005.097556, "o", "\u001b[?2004l\r\n"]
[1005.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1005.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1005.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1005.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1005.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1005.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1005.738444, "o", "             --                      threads          \r\n"]
[1005.83, "o", "             ------------- ---------------------------\r\n"]
[1005.921556, "o", "              use_numexpr     default          1      \r\n"]
[1006.013111, "o", "             ============= ============= =============\r\n"]
[1006.104667, "o", "                  True      2.33\u00b10.04ms   2.28\u00b10.02ms \r\n"]
[1006.196222, "o", "                 False      2.22\u00b10.02ms   2.22\u00b10.04ms \r\n"]
[1006.287778, "o", "             ============= ============= =============\r\n"]
[1006.379333, "o", "\r\n"]
[1006.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1006.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1006.654, "o", "             --                      threads          \r\n"]
[1006.745556, "o", "             ------------- ---------------------------\r\n"]
[1006.837111, "o", "              use_numexpr     default          1      \r\n"]
[1006.928667, "o", "             ============= ============= =============\r\n"]
[1007.020222, "o", "                  True      1.68\u00b10.02ms   1.73\u00b10.05ms \r\n"]
[1007.111778, "o", "                 False      1.71\u00b10.03ms    1.73\u00b10.1ms \r\n"]
[1007.203333, "o", "             ============= ============= =============\r\n"]
[1007.294889, "o", "\r\n"]
[1007.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1007.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1007.569556, "o", "             --                      threads          \r\n"]
[1007.661111, "o", "             ------------- ---------------------------\r\n"]
[1007.752667, "o", "              use_numexpr     default          1      \r\n"]
[1007.844222, "o", "             ============= ============= =============\r\n"]
[1007.935778, "o", "                  True      2.23\u00b10.04ms   2.26\u00b10.03ms \r\n"]
[1008.027333, "o", "                 False      2.26\u00b10.04ms   2.27\u00b10.06ms \r\n"]
[1008.118889, "o", "             ============= ============= =============\r\n"]
[1008.210444, "o", "\r\n"]
[1008.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1008.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1008.485111, "o", "             --                      threads          \r\n"]
[1008.576667, "o", "             ------------- ---------------------------\r\n"]
[1008.668222, "o", "              use_numexpr     default          1      \r\n"]
[1008.759778, "o", "             ============= ============= =============\r\n"]
[1008.851333, "o", "                  True       10.3\u00b10.1ms    10.2\u00b10.1ms \r\n"]
[1008.942889, "o", "                 False      10.3\u00b10.05ms   10.2\u00b10.07ms \r\n"]
[1009.034444, "o", "             ============= ============= =============\r\n"]
[1009.126, "o", "\r\n"]
[1009.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.8\u00b10.2ms\r\n"]
[1009.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.8\u00b10.08ms\r\n"]
[1009.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              844\u00b150\u03bcs\r\n"]
[1009.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.4\u00b10.1ms\r\n"]
[1009.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.8\u00b10.07ms\r\n"]
[1009.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.57\u00b10.03ms\r\n"]
[1009.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      11.0\u00b10.1ms\r\n"]
[1009.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     489\u00b160\u03bcs\r\n"]
[1010.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1010.002, "i", "cd ..\r"]
[1010.004, "o", "cd ..\r\n"]
[1010.006, "o", "\u001b[?2004l\r\n"]
[1015.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1015.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[1015.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[1016.654, "o", "\u001b[?2004l\r\n"]
[1018.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[1020.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1020.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py\r"]
[1020.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py\r\n"]
[1020.024943, "o", "\u001b[?2004l\r\n"]
[1020.043885, "o", "\"\"\"\r\n"]
[1020.062828, "o", "Expressions\r\n"]
[1020.08177, "o", "-----------\r\n"]
[1020.100713, "o", "\r\n"]
[1020.119655, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1020.138598, "o", "\r\n"]
[1020.15754, "o", "\"\"\"\r\n"]
[1020.176483, "o", "\r\n"]
[1020.195425, "o", "from __future__ import annotations\r\n"]
[1020.214368, "o", "\r\n"]
[1020.23331, "o", "import operator\r\n"]
[1020.252253, "o", "from typing import TYPE_CHECKING\r\n"]
[1020.271195, "o", "import warnings\r\n"]
[1020.290138, "o", "\r\n"]
[1020.30908, "o", "import numpy as np\r\n"]
[1020.328023, "o", "\r\n"]
[1020.346966, "o", "from pandas._config import get_option\r\n"]
[1020.365908, "o", "\r\n"]
[1020.384851, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1020.403793, "o", "\r\n"]
[1020.422736, "o", "from pandas.core import roperator\r\n"]
[1020.441678, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1020.460621, "o", "\r\n"]
[1020.479563, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1020.498506, "o", "    import numexpr as ne\r\n"]
[1020.517448, "o", "\r\n"]
[1020.536391, "o", "if TYPE_CHECKING:\r\n"]
[1020.555333, "o", "    from pandas._typing import FuncType\r\n"]
[1020.574276, "o", "\r\n"]
[1020.593218, "o", "_TEST_MODE: bool | None = None\r\n"]
[1020.612161, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1020.631103, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1020.650046, "o", "_evaluate: FuncType | None = None\r\n"]
[1020.668989, "o", "_where: FuncType | None = None\r\n"]
[1020.687931, "o", "\r\n"]
[1020.706874, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1020.725816, "o", "_ALLOWED_DTYPES = {\r\n"]
[1020.744759, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1020.763701, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1020.782644, "o", "}\r\n"]
[1020.801586, "o", "\r\n"]
[1020.820529, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1020.839471, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1020.858414, "o", "\r\n"]
[1020.877356, "o", "\r\n"]
[1020.896299, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1020.915241, "o", "    # set/unset to use numexpr\r\n"]
[1020.934184, "o", "    global USE_NUMEXPR\r\n"]
[1020.953126, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1020.972069, "o", "        USE_NUMEXPR = v\r\n"]
[1020.991011, "o", "\r\n"]
[1021.009954, "o", "    # choose what we are going to do\r\n"]
[1021.028897, "o", "    global _evaluate, _where\r\n"]
[1021.047839, "o", "\r\n"]
[1021.066782, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1021.085724, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1021.104667, "o", "\r\n"]
[1021.123609, "o", "\r\n"]
[1021.142552, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1021.161494, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1021.180437, "o", "    # otherwise reset\r\n"]
[1021.199379, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1021.218322, "o", "        if n is None:\r\n"]
[1021.237264, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1021.256207, "o", "        ne.set_num_threads(n)\r\n"]
[1021.275149, "o", "\r\n"]
[1021.294092, "o", "\r\n"]
[1021.313034, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1021.331977, "o", "    \"\"\"\r\n"]
[1021.35092, "o", "    Standard evaluation.\r\n"]
[1021.369862, "o", "    \"\"\"\r\n"]
[1021.388805, "o", "    if _TEST_MODE:\r\n"]
[1021.407747, "o", "        _store_test_result(False)\r\n"]
[1021.42669, "o", "    return op(left_op, right_op)\r\n"]
[1021.445632, "o", "\r\n"]
[1021.464575, "o", "\r\n"]
[1021.483517, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1021.50246, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1021.521402, "o", "    if op_str is not None:\r\n"]
[1021.540345, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1021.559287, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1021.57823, "o", "            # check for dtype compatibility\r\n"]
[1021.597172, "o", "            dtypes: set[str] = set()\r\n"]
[1021.616115, "o", "            for o in [left_op, right_op]:\r\n"]
[1021.635057, "o", "                # ndarray and Series Case\r\n"]
[1021.654, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1021.672943, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1021.691885, "o", "\r\n"]
[1021.710828, "o", "            # allowed are a superset\r\n"]
[1021.72977, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1021.748713, "o", "                return True\r\n"]
[1021.767655, "o", "\r\n"]
[1021.786598, "o", "    return False\r\n"]
[1021.80554, "o", "\r\n"]
[1021.824483, "o", "\r\n"]
[1021.843425, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1021.862368, "o", "    result = None\r\n"]
[1021.88131, "o", "\r\n"]
[1021.900253, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1021.919195, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1021.938138, "o", "        if is_reversed:\r\n"]
[1021.95708, "o", "            # we were originally called by a reversed op method\r\n"]
[1021.976023, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1021.994966, "o", "\r\n"]
[1022.013908, "o", "        left_value = left_op\r\n"]
[1022.032851, "o", "        right_value = right_op\r\n"]
[1022.051793, "o", "\r\n"]
[1022.070736, "o", "        try:\r\n"]
[1022.089678, "o", "            result = ne.evaluate(\r\n"]
[1022.108621, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1022.127563, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1022.146506, "o", "                casting=\"safe\",\r\n"]
[1022.165448, "o", "            )\r\n"]
[1022.184391, "o", "        except TypeError:\r\n"]
[1022.203333, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1022.222276, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1022.241218, "o", "            pass\r\n"]
[1022.260161, "o", "        except NotImplementedError:\r\n"]
[1022.279103, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1022.298046, "o", "                pass\r\n"]
[1022.316989, "o", "            else:\r\n"]
[1022.335931, "o", "                raise\r\n"]
[1022.354874, "o", "\r\n"]
[1022.373816, "o", "        if is_reversed:\r\n"]
[1022.392759, "o", "            # reverse order to original for fallback\r\n"]
[1022.411701, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1022.430644, "o", "\r\n"]
[1022.449586, "o", "    if _TEST_MODE:\r\n"]
[1022.468529, "o", "        _store_test_result(result is not None)\r\n"]
[1022.487471, "o", "\r\n"]
[1022.506414, "o", "    if result is None:\r\n"]
[1022.525356, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1022.544299, "o", "\r\n"]
[1022.563241, "o", "    return result\r\n"]
[1022.582184, "o", "\r\n"]
[1022.601126, "o", "\r\n"]
[1022.620069, "o", "_op_str_mapping = {\r\n"]
[1022.639011, "o", "    operator.add: \"+\",\r\n"]
[1022.657954, "o", "    roperator.radd: \"+\",\r\n"]
[1022.676897, "o", "    operator.mul: \"*\",\r\n"]
[1022.695839, "o", "    roperator.rmul: \"*\",\r\n"]
[1022.714782, "o", "    operator.sub: \"-\",\r\n"]
[1022.733724, "o", "    roperator.rsub: \"-\",\r\n"]
[1022.752667, "o", "    operator.truediv: \"/\",\r\n"]
[1022.771609, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1022.790552, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1022.809494, "o", "    operator.floordiv: None,\r\n"]
[1022.828437, "o", "    roperator.rfloordiv: None,\r\n"]
[1022.847379, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1022.866322, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1022.885264, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1022.904207, "o", "    operator.mod: None,\r\n"]
[1022.923149, "o", "    roperator.rmod: None,\r\n"]
[1022.942092, "o", "    operator.pow: \"**\",\r\n"]
[1022.961034, "o", "    roperator.rpow: \"**\",\r\n"]
[1022.979977, "o", "    operator.eq: \"==\",\r\n"]
[1022.99892, "o", "    operator.ne: \"!=\",\r\n"]
[1023.017862, "o", "    operator.le: \"<=\",\r\n"]
[1023.036805, "o", "    operator.lt: \"<\",\r\n"]
[1023.055747, "o", "    operator.ge: \">=\",\r\n"]
[1023.07469, "o", "    operator.gt: \">\",\r\n"]
[1023.093632, "o", "    operator.and_: \"&\",\r\n"]
[1023.112575, "o", "    roperator.rand_: \"&\",\r\n"]
[1023.131517, "o", "    operator.or_: \"|\",\r\n"]
[1023.15046, "o", "    roperator.ror_: \"|\",\r\n"]
[1023.169402, "o", "    operator.xor: \"^\",\r\n"]
[1023.188345, "o", "    roperator.rxor: \"^\",\r\n"]
[1023.207287, "o", "    divmod: None,\r\n"]
[1023.22623, "o", "    roperator.rdivmod: None,\r\n"]
[1023.245172, "o", "}\r\n"]
[1023.264115, "o", "\r\n"]
[1023.283057, "o", "\r\n"]
[1023.302, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1023.320943, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1023.339885, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1023.358828, "o", "\r\n"]
[1023.37777, "o", "\r\n"]
[1023.396713, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1023.415655, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1023.434598, "o", "    result = None\r\n"]
[1023.45354, "o", "\r\n"]
[1023.472483, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1023.491425, "o", "        result = ne.evaluate(\r\n"]
[1023.510368, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1023.52931, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1023.548253, "o", "            casting=\"safe\",\r\n"]
[1023.567195, "o", "        )\r\n"]
[1023.586138, "o", "\r\n"]
[1023.60508, "o", "    if result is None:\r\n"]
[1023.624023, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1023.642966, "o", "\r\n"]
[1023.661908, "o", "    return result\r\n"]
[1023.680851, "o", "\r\n"]
[1023.699793, "o", "\r\n"]
[1023.718736, "o", "# turn myself on\r\n"]
[1023.737678, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1023.756621, "o", "\r\n"]
[1023.775563, "o", "\r\n"]
[1023.794506, "o", "def _has_bool_dtype(x):\r\n"]
[1023.813448, "o", "    try:\r\n"]
[1023.832391, "o", "        return x.dtype == bool\r\n"]
[1023.851333, "o", "    except AttributeError:\r\n"]
[1023.870276, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1023.889218, "o", "\r\n"]
[1023.908161, "o", "\r\n"]
[1023.927103, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1023.946046, "o", "\r\n"]
[1023.964989, "o", "\r\n"]
[1023.983931, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1024.002874, "o", "    \"\"\"\r\n"]
[1024.021816, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1024.040759, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1024.059701, "o", "    boolean ops.\r\n"]
[1024.078644, "o", "    \"\"\"\r\n"]
[1024.097586, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1024.116529, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1024.135471, "o", "            warnings.warn(\r\n"]
[1024.154414, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1024.173356, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1024.192299, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1024.211241, "o", "                stacklevel=find_stack_level(),\r\n"]
[1024.230184, "o", "            )\r\n"]
[1024.249126, "o", "            return True\r\n"]
[1024.268069, "o", "    return False\r\n"]
[1024.287011, "o", "\r\n"]
[1024.305954, "o", "\r\n"]
[1024.324897, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1024.343839, "o", "    \"\"\"\r\n"]
[1024.362782, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1024.381724, "o", "\r\n"]
[1024.400667, "o", "    Parameters\r\n"]
[1024.419609, "o", "    ----------\r\n"]
[1024.438552, "o", "    op : the actual operand\r\n"]
[1024.457494, "o", "    left_op : left operand\r\n"]
[1024.476437, "o", "    right_op : right operand\r\n"]
[1024.495379, "o", "    use_numexpr : bool, default True\r\n"]
[1024.514322, "o", "        Whether to try to use numexpr.\r\n"]
[1024.533264, "o", "    \"\"\"\r\n"]
[1024.552207, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1024.571149, "o", "    if op_str is not None:\r\n"]
[1024.590092, "o", "        if use_numexpr:\r\n"]
[1024.609034, "o", "            # error: \"None\" not callable\r\n"]
[1024.627977, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1024.64692, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1024.665862, "o", "\r\n"]
[1024.684805, "o", "\r\n"]
[1024.703747, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1024.72269, "o", "    \"\"\"\r\n"]
[1024.741632, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1024.760575, "o", "\r\n"]
[1024.779517, "o", "    Parameters\r\n"]
[1024.79846, "o", "    ----------\r\n"]
[1024.817402, "o", "    cond : np.ndarray[bool]\r\n"]
[1024.836345, "o", "    left_op : return if cond is True\r\n"]
[1024.855287, "o", "    right_op : return if cond is False\r\n"]
[1024.87423, "o", "    use_numexpr : bool, default True\r\n"]
[1024.893172, "o", "        Whether to try to use numexpr.\r\n"]
[1024.912115, "o", "    \"\"\"\r\n"]
[1024.931057, "o", "    assert _where is not None\r\n"]
[1025.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1025.002, "i", "python - << 'PY'\r"]
[1025.004, "o", "python - << 'PY'\r\n"]
[1025.066293, "o", "\u001b[?2004l\r\n"]
[1025.126585, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1025.186878, "o", "\u001b[?2004l\r\n"]
[1025.247171, "o", "\u001b[?2004h> import re\r\n"]
[1025.307463, "o", "\u001b[?2004l\r\n"]
[1025.367756, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1025.428049, "o", "\u001b[?2004l\r\n"]
[1025.488341, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1025.548634, "o", "\u001b[?2004l\r\n"]
[1025.608927, "o", "\u001b[?2004h> changed = False\r\n"]
[1025.66922, "o", "\u001b[?2004l\r\n"]
[1025.729512, "o", "\u001b[?2004h> # Prefer adjusting an existing threshold constant if present\r\n"]
[1025.789805, "o", "\u001b[?2004l\r\n"]
[1025.850098, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1025.91039, "o", "\u001b[?2004l\r\n"]
[1025.970683, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1026.030976, "o", "\u001b[?2004l\r\n"]
[1026.091268, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1026.151561, "o", "\u001b[?2004l\r\n"]
[1026.211854, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1026.272146, "o", "\u001b[?2004l\r\n"]
[1026.332439, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1026.392732, "o", "\u001b[?2004l\r\n"]
[1026.453024, "o", "\u001b[?2004h>     changed = True\r\n"]
[1026.513317, "o", "\u001b[?2004l\r\n"]
[1026.57361, "o", "\u001b[?2004h> else:\r\n"]
[1026.633902, "o", "\u001b[?2004l\r\n"]
[1026.694195, "o", "\u001b[?2004h>     # Inject early size-based bypass near the start of should_use_numexpr\r\n"]
[1026.754488, "o", "\u001b[?2004l\r\n"]
[1026.81478, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1026.875073, "o", "\u001b[?2004l\r\n"]
[1026.935366, "o", "\u001b[?2004h>     if m:\r\n"]
[1026.995659, "o", "\u001b[?2004l\r\n"]
[1027.055951, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[1027.116244, "o", "\u001b[?2004l\r\n"]
[1027.176537, "o", "\u001b[?2004h>         # If a docstring immediately follows, skip it to keep code structure intact\r\n"]
[1027.236829, "o", "\u001b[?2004l\r\n"]
[1027.297122, "o", "\u001b[?2004h>         docm = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1027.357415, "o", "\u001b[?2004l\r\n"]
[1027.417707, "o", "\u001b[?2004h>         if docm:\r\n"]
[1027.478, "o", "\u001b[?2004l\r\n"]
[1027.538293, "o", "\u001b[?2004h>             insert_at += docm.end()\r\n"]
[1027.598585, "o", "\u001b[?2004l\r\n"]
[1027.658878, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+2000]:\r\n"]
[1027.719171, "o", "\u001b[?2004l\r\n"]
[1027.779463, "o", "\u001b[?2004h>             inject = (\r\n"]
[1027.839756, "o", "\u001b[?2004l\r\n"]
[1027.900049, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1027.960341, "o", "\u001b[?2004l\r\n"]
[1028.020634, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[1028.080927, "o", "\u001b[?2004l\r\n"]
[1028.14122, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1028.201512, "o", "\u001b[?2004l\r\n"]
[1028.261805, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1028.322098, "o", "\u001b[?2004l\r\n"]
[1028.38239, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[1028.442683, "o", "\u001b[?2004l\r\n"]
[1028.502976, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[1028.563268, "o", "\u001b[?2004l\r\n"]
[1028.623561, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1028.683854, "o", "\u001b[?2004l\r\n"]
[1028.744146, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[1028.804439, "o", "\u001b[?2004l\r\n"]
[1028.864732, "o", "\u001b[?2004h>             )\r\n"]
[1028.925024, "o", "\u001b[?2004l\r\n"]
[1028.985317, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1029.04561, "o", "\u001b[?2004l\r\n"]
[1029.105902, "o", "\u001b[?2004h>             changed = True\r\n"]
[1029.166195, "o", "\u001b[?2004l\r\n"]
[1029.226488, "o", "\u001b[?2004h> if changed:\r\n"]
[1029.28678, "o", "\u001b[?2004l\r\n"]
[1029.347073, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1029.407366, "o", "\u001b[?2004l\r\n"]
[1029.467659, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1029.527951, "o", "\u001b[?2004l\r\n"]
[1029.588244, "o", "\u001b[?2004h> else:\r\n"]
[1029.648537, "o", "\u001b[?2004l\r\n"]
[1029.708829, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1029.769122, "o", "\u001b[?2004l\r\n"]
[1029.829415, "o", "\u001b[?2004h> PY\r\n"]
[1029.889707, "o", "\u001b[?2004l\r\n"]
[1030.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1030.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1030.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1030.006, "o", "\u001b[?2004l\r\n"]
[1035.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1035.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1035.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1035.006, "o", "\u001b[?2004l\r\n"]
[1040.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1040.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[1040.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[1040.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[1041.242, "o", "\u001b[?2004l\r\n"]
[1041.86, "o", "On branch main\r\n"]
[1042.478, "o", "Untracked files:\r\n"]
[1043.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1043.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1044.332, "o", "\r\n"]
[1045.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1045.002, "i", "cd asv_bench\r"]
[1045.004, "o", "cd asv_bench\r\n"]
[1045.006, "o", "\u001b[?2004l\r\n"]
[1050.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1050.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1050.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1050.097556, "o", "\u001b[?2004l\r\n"]
[1050.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1050.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1050.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1050.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1050.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1050.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1050.738444, "o", "             --                      threads          \r\n"]
[1050.83, "o", "             ------------- ---------------------------\r\n"]
[1050.921556, "o", "              use_numexpr     default          1      \r\n"]
[1051.013111, "o", "             ============= ============= =============\r\n"]
[1051.104667, "o", "                  True      2.19\u00b10.06ms   2.26\u00b10.06ms \r\n"]
[1051.196222, "o", "                 False      2.22\u00b10.06ms   2.22\u00b10.03ms \r\n"]
[1051.287778, "o", "             ============= ============= =============\r\n"]
[1051.379333, "o", "\r\n"]
[1051.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1051.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1051.654, "o", "             --                      threads          \r\n"]
[1051.745556, "o", "             ------------- ---------------------------\r\n"]
[1051.837111, "o", "              use_numexpr     default          1      \r\n"]
[1051.928667, "o", "             ============= ============= =============\r\n"]
[1052.020222, "o", "                  True      1.69\u00b10.06ms   1.70\u00b10.02ms \r\n"]
[1052.111778, "o", "                 False      1.70\u00b10.04ms   1.67\u00b10.07ms \r\n"]
[1052.203333, "o", "             ============= ============= =============\r\n"]
[1052.294889, "o", "\r\n"]
[1052.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1052.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1052.569556, "o", "             --                      threads          \r\n"]
[1052.661111, "o", "             ------------- ---------------------------\r\n"]
[1052.752667, "o", "              use_numexpr     default          1      \r\n"]
[1052.844222, "o", "             ============= ============= =============\r\n"]
[1052.935778, "o", "                  True      2.22\u00b10.02ms   2.25\u00b10.07ms \r\n"]
[1053.027333, "o", "                 False      2.21\u00b10.07ms   2.24\u00b10.05ms \r\n"]
[1053.118889, "o", "             ============= ============= =============\r\n"]
[1053.210444, "o", "\r\n"]
[1053.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1053.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ =============\u001b[0m\r\n"]
[1053.485111, "o", "             --                     threads          \r\n"]
[1053.576667, "o", "             ------------- --------------------------\r\n"]
[1053.668222, "o", "              use_numexpr    default          1      \r\n"]
[1053.759778, "o", "             ============= ============ =============\r\n"]
[1053.851333, "o", "                  True      10.3\u00b10.1ms   10.4\u00b10.06ms \r\n"]
[1053.942889, "o", "                 False      10.5\u00b10.2ms    10.4\u00b10.2ms \r\n"]
[1054.034444, "o", "             ============= ============ =============\r\n"]
[1054.126, "o", "\r\n"]
[1054.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.8\u00b10.2ms\r\n"]
[1054.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.8\u00b10.07ms\r\n"]
[1054.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              909\u00b130\u03bcs\r\n"]
[1054.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.5\u00b10.2ms\r\n"]
[1054.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   25.0\u00b10.03ms\r\n"]
[1054.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.63\u00b10.03ms\r\n"]
[1054.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      11.0\u00b10.1ms\r\n"]
[1054.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     469\u00b110\u03bcs\r\n"]
[1055.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1055.002, "i", "cd ..\r"]
[1055.004, "o", "cd ..\r\n"]
[1055.006, "o", "\u001b[?2004l\r\n"]
[1060.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1060.002, "i", "git status -sb\r"]
[1060.004, "o", "git status -sb\r\n"]
[1061.654, "o", "\u001b[?2004l\r\n"]
[1063.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[1065.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1065.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[1065.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[1066.654, "o", "\u001b[?2004l\r\n"]
[1068.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[1070.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1070.002, "i", "sed -n '1,220p' pandas/core/computation/expressions.py\r"]
[1070.004, "o", "sed -n '1,220p' pandas/core/computation/expressions.py\r\n"]
[1070.028371, "o", "\u001b[?2004l\r\n"]
[1070.050742, "o", "\"\"\"\r\n"]
[1070.073113, "o", "Expressions\r\n"]
[1070.095484, "o", "-----------\r\n"]
[1070.117855, "o", "\r\n"]
[1070.140226, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1070.162597, "o", "\r\n"]
[1070.184968, "o", "\"\"\"\r\n"]
[1070.207339, "o", "\r\n"]
[1070.22971, "o", "from __future__ import annotations\r\n"]
[1070.252081, "o", "\r\n"]
[1070.274452, "o", "import operator\r\n"]
[1070.296824, "o", "from typing import TYPE_CHECKING\r\n"]
[1070.319195, "o", "import warnings\r\n"]
[1070.341566, "o", "\r\n"]
[1070.363937, "o", "import numpy as np\r\n"]
[1070.386308, "o", "\r\n"]
[1070.408679, "o", "from pandas._config import get_option\r\n"]
[1070.43105, "o", "\r\n"]
[1070.453421, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1070.475792, "o", "\r\n"]
[1070.498163, "o", "from pandas.core import roperator\r\n"]
[1070.520534, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1070.542905, "o", "\r\n"]
[1070.565276, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1070.587647, "o", "    import numexpr as ne\r\n"]
[1070.610018, "o", "\r\n"]
[1070.632389, "o", "if TYPE_CHECKING:\r\n"]
[1070.65476, "o", "    from pandas._typing import FuncType\r\n"]
[1070.677131, "o", "\r\n"]
[1070.699502, "o", "_TEST_MODE: bool | None = None\r\n"]
[1070.721873, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1070.744244, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1070.766615, "o", "_evaluate: FuncType | None = None\r\n"]
[1070.788986, "o", "_where: FuncType | None = None\r\n"]
[1070.811357, "o", "\r\n"]
[1070.833729, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1070.8561, "o", "_ALLOWED_DTYPES = {\r\n"]
[1070.878471, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1070.900842, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1070.923213, "o", "}\r\n"]
[1070.945584, "o", "\r\n"]
[1070.967955, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1070.990326, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1071.012697, "o", "\r\n"]
[1071.035068, "o", "\r\n"]
[1071.057439, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1071.07981, "o", "    # set/unset to use numexpr\r\n"]
[1071.102181, "o", "    global USE_NUMEXPR\r\n"]
[1071.124552, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1071.146923, "o", "        USE_NUMEXPR = v\r\n"]
[1071.169294, "o", "\r\n"]
[1071.191665, "o", "    # choose what we are going to do\r\n"]
[1071.214036, "o", "    global _evaluate, _where\r\n"]
[1071.236407, "o", "\r\n"]
[1071.258778, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1071.281149, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1071.30352, "o", "\r\n"]
[1071.325891, "o", "\r\n"]
[1071.348262, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1071.370633, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1071.393005, "o", "    # otherwise reset\r\n"]
[1071.415376, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1071.437747, "o", "        if n is None:\r\n"]
[1071.460118, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1071.482489, "o", "        ne.set_num_threads(n)\r\n"]
[1071.50486, "o", "\r\n"]
[1071.527231, "o", "\r\n"]
[1071.549602, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1071.571973, "o", "    \"\"\"\r\n"]
[1071.594344, "o", "    Standard evaluation.\r\n"]
[1071.616715, "o", "    \"\"\"\r\n"]
[1071.639086, "o", "    if _TEST_MODE:\r\n"]
[1071.661457, "o", "        _store_test_result(False)\r\n"]
[1071.683828, "o", "    return op(left_op, right_op)\r\n"]
[1071.706199, "o", "\r\n"]
[1071.72857, "o", "\r\n"]
[1071.750941, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1071.773312, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1071.795683, "o", "    if op_str is not None:\r\n"]
[1071.818054, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1071.840425, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1071.862796, "o", "            # check for dtype compatibility\r\n"]
[1071.885167, "o", "            dtypes: set[str] = set()\r\n"]
[1071.907538, "o", "            for o in [left_op, right_op]:\r\n"]
[1071.92991, "o", "                # ndarray and Series Case\r\n"]
[1071.952281, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1071.974652, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1071.997023, "o", "\r\n"]
[1072.019394, "o", "            # allowed are a superset\r\n"]
[1072.041765, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1072.064136, "o", "                return True\r\n"]
[1072.086507, "o", "\r\n"]
[1072.108878, "o", "    return False\r\n"]
[1072.131249, "o", "\r\n"]
[1072.15362, "o", "\r\n"]
[1072.175991, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1072.198362, "o", "    result = None\r\n"]
[1072.220733, "o", "\r\n"]
[1072.243104, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1072.265475, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1072.287846, "o", "        if is_reversed:\r\n"]
[1072.310217, "o", "            # we were originally called by a reversed op method\r\n"]
[1072.332588, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1072.354959, "o", "\r\n"]
[1072.37733, "o", "        left_value = left_op\r\n"]
[1072.399701, "o", "        right_value = right_op\r\n"]
[1072.422072, "o", "\r\n"]
[1072.444443, "o", "        try:\r\n"]
[1072.466814, "o", "            result = ne.evaluate(\r\n"]
[1072.489186, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1072.511557, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1072.533928, "o", "                casting=\"safe\",\r\n"]
[1072.556299, "o", "            )\r\n"]
[1072.57867, "o", "        except TypeError:\r\n"]
[1072.601041, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1072.623412, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1072.645783, "o", "            pass\r\n"]
[1072.668154, "o", "        except NotImplementedError:\r\n"]
[1072.690525, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1072.712896, "o", "                pass\r\n"]
[1072.735267, "o", "            else:\r\n"]
[1072.757638, "o", "                raise\r\n"]
[1072.780009, "o", "\r\n"]
[1072.80238, "o", "        if is_reversed:\r\n"]
[1072.824751, "o", "            # reverse order to original for fallback\r\n"]
[1072.847122, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1072.869493, "o", "\r\n"]
[1072.891864, "o", "    if _TEST_MODE:\r\n"]
[1072.914235, "o", "        _store_test_result(result is not None)\r\n"]
[1072.936606, "o", "\r\n"]
[1072.958977, "o", "    if result is None:\r\n"]
[1072.981348, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1073.003719, "o", "\r\n"]
[1073.02609, "o", "    return result\r\n"]
[1073.048462, "o", "\r\n"]
[1073.070833, "o", "\r\n"]
[1073.093204, "o", "_op_str_mapping = {\r\n"]
[1073.115575, "o", "    operator.add: \"+\",\r\n"]
[1073.137946, "o", "    roperator.radd: \"+\",\r\n"]
[1073.160317, "o", "    operator.mul: \"*\",\r\n"]
[1073.182688, "o", "    roperator.rmul: \"*\",\r\n"]
[1073.205059, "o", "    operator.sub: \"-\",\r\n"]
[1073.22743, "o", "    roperator.rsub: \"-\",\r\n"]
[1073.249801, "o", "    operator.truediv: \"/\",\r\n"]
[1073.272172, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1073.294543, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1073.316914, "o", "    operator.floordiv: None,\r\n"]
[1073.339285, "o", "    roperator.rfloordiv: None,\r\n"]
[1073.361656, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1073.384027, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1073.406398, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1073.428769, "o", "    operator.mod: None,\r\n"]
[1073.45114, "o", "    roperator.rmod: None,\r\n"]
[1073.473511, "o", "    operator.pow: \"**\",\r\n"]
[1073.495882, "o", "    roperator.rpow: \"**\",\r\n"]
[1073.518253, "o", "    operator.eq: \"==\",\r\n"]
[1073.540624, "o", "    operator.ne: \"!=\",\r\n"]
[1073.562995, "o", "    operator.le: \"<=\",\r\n"]
[1073.585367, "o", "    operator.lt: \"<\",\r\n"]
[1073.607738, "o", "    operator.ge: \">=\",\r\n"]
[1073.630109, "o", "    operator.gt: \">\",\r\n"]
[1073.65248, "o", "    operator.and_: \"&\",\r\n"]
[1073.674851, "o", "    roperator.rand_: \"&\",\r\n"]
[1073.697222, "o", "    operator.or_: \"|\",\r\n"]
[1073.719593, "o", "    roperator.ror_: \"|\",\r\n"]
[1073.741964, "o", "    operator.xor: \"^\",\r\n"]
[1073.764335, "o", "    roperator.rxor: \"^\",\r\n"]
[1073.786706, "o", "    divmod: None,\r\n"]
[1073.809077, "o", "    roperator.rdivmod: None,\r\n"]
[1073.831448, "o", "}\r\n"]
[1073.853819, "o", "\r\n"]
[1073.87619, "o", "\r\n"]
[1073.898561, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1073.920932, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1073.943303, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1073.965674, "o", "\r\n"]
[1073.988045, "o", "\r\n"]
[1074.010416, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1074.032787, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1074.055158, "o", "    result = None\r\n"]
[1074.077529, "o", "\r\n"]
[1074.0999, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1074.122271, "o", "        result = ne.evaluate(\r\n"]
[1074.144643, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1074.167014, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1074.189385, "o", "            casting=\"safe\",\r\n"]
[1074.211756, "o", "        )\r\n"]
[1074.234127, "o", "\r\n"]
[1074.256498, "o", "    if result is None:\r\n"]
[1074.278869, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1074.30124, "o", "\r\n"]
[1074.323611, "o", "    return result\r\n"]
[1074.345982, "o", "\r\n"]
[1074.368353, "o", "\r\n"]
[1074.390724, "o", "# turn myself on\r\n"]
[1074.413095, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1074.435466, "o", "\r\n"]
[1074.457837, "o", "\r\n"]
[1074.480208, "o", "def _has_bool_dtype(x):\r\n"]
[1074.502579, "o", "    try:\r\n"]
[1074.52495, "o", "        return x.dtype == bool\r\n"]
[1074.547321, "o", "    except AttributeError:\r\n"]
[1074.569692, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1074.592063, "o", "\r\n"]
[1074.614434, "o", "\r\n"]
[1074.636805, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1074.659176, "o", "\r\n"]
[1074.681548, "o", "\r\n"]
[1074.703919, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1074.72629, "o", "    \"\"\"\r\n"]
[1074.748661, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1074.771032, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1074.793403, "o", "    boolean ops.\r\n"]
[1074.815774, "o", "    \"\"\"\r\n"]
[1074.838145, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1074.860516, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1074.882887, "o", "            warnings.warn(\r\n"]
[1074.905258, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1074.927629, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1075.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1075.002, "i", "sed -n '220,480p' pandas/core/computation/expressions.py\r"]
[1075.004, "o", "sed -n '220,480p' pandas/core/computation/expressions.py\r\n"]
[1075.074667, "o", "\u001b[?2004l\r\n"]
[1075.143333, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1075.212, "o", "                stacklevel=find_stack_level(),\r\n"]
[1075.280667, "o", "            )\r\n"]
[1075.349333, "o", "            return True\r\n"]
[1075.418, "o", "    return False\r\n"]
[1075.486667, "o", "\r\n"]
[1075.555333, "o", "\r\n"]
[1075.624, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1075.692667, "o", "    \"\"\"\r\n"]
[1075.761333, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1075.83, "o", "\r\n"]
[1075.898667, "o", "    Parameters\r\n"]
[1075.967333, "o", "    ----------\r\n"]
[1076.036, "o", "    op : the actual operand\r\n"]
[1076.104667, "o", "    left_op : left operand\r\n"]
[1076.173333, "o", "    right_op : right operand\r\n"]
[1076.242, "o", "    use_numexpr : bool, default True\r\n"]
[1076.310667, "o", "        Whether to try to use numexpr.\r\n"]
[1076.379333, "o", "    \"\"\"\r\n"]
[1076.448, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1076.516667, "o", "    if op_str is not None:\r\n"]
[1076.585333, "o", "        if use_numexpr:\r\n"]
[1076.654, "o", "            # error: \"None\" not callable\r\n"]
[1076.722667, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1076.791333, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1076.86, "o", "\r\n"]
[1076.928667, "o", "\r\n"]
[1076.997333, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1077.066, "o", "    \"\"\"\r\n"]
[1077.134667, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1077.203333, "o", "\r\n"]
[1077.272, "o", "    Parameters\r\n"]
[1077.340667, "o", "    ----------\r\n"]
[1077.409333, "o", "    cond : np.ndarray[bool]\r\n"]
[1077.478, "o", "    left_op : return if cond is True\r\n"]
[1077.546667, "o", "    right_op : return if cond is False\r\n"]
[1077.615333, "o", "    use_numexpr : bool, default True\r\n"]
[1077.684, "o", "        Whether to try to use numexpr.\r\n"]
[1077.752667, "o", "    \"\"\"\r\n"]
[1077.821333, "o", "    assert _where is not None\r\n"]
[1077.89, "o", "    if use_numexpr:\r\n"]
[1077.958667, "o", "        return _where(cond, left_op, right_op)\r\n"]
[1078.027333, "o", "    else:\r\n"]
[1078.096, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[1078.164667, "o", "\r\n"]
[1078.233333, "o", "\r\n"]
[1078.302, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[1078.370667, "o", "    \"\"\"\r\n"]
[1078.439333, "o", "    Keeps track of whether numexpr was used.\r\n"]
[1078.508, "o", "\r\n"]
[1078.576667, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[1078.645333, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[1078.714, "o", "    \"\"\"\r\n"]
[1078.782667, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[1078.851333, "o", "    _TEST_MODE = v\r\n"]
[1078.92, "o", "    _TEST_RESULT = []\r\n"]
[1078.988667, "o", "\r\n"]
[1079.057333, "o", "\r\n"]
[1079.126, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[1079.194667, "o", "    if used_numexpr:\r\n"]
[1079.263333, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[1079.332, "o", "\r\n"]
[1079.400667, "o", "\r\n"]
[1079.469333, "o", "def get_test_result() -> list[bool]:\r\n"]
[1079.538, "o", "    \"\"\"\r\n"]
[1079.606667, "o", "    Get test result and reset test_results.\r\n"]
[1079.675333, "o", "    \"\"\"\r\n"]
[1079.744, "o", "    global _TEST_RESULT\r\n"]
[1079.812667, "o", "    res = _TEST_RESULT\r\n"]
[1079.881333, "o", "    _TEST_RESULT = []\r\n"]
[1080.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1080.002, "i", "python - << 'PY'\r"]
[1080.004, "o", "python - << 'PY'\r\n"]
[1080.066293, "o", "\u001b[?2004l\r\n"]
[1080.126585, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1080.186878, "o", "\u001b[?2004l\r\n"]
[1080.247171, "o", "\u001b[?2004h> import re\r\n"]
[1080.307463, "o", "\u001b[?2004l\r\n"]
[1080.367756, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1080.428049, "o", "\u001b[?2004l\r\n"]
[1080.488341, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1080.548634, "o", "\u001b[?2004l\r\n"]
[1080.608927, "o", "\u001b[?2004h> changed = False\r\n"]
[1080.66922, "o", "\u001b[?2004l\r\n"]
[1080.729512, "o", "\u001b[?2004h> # Try bumping an existing threshold constant first\r\n"]
[1080.789805, "o", "\u001b[?2004l\r\n"]
[1080.850098, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1080.91039, "o", "\u001b[?2004l\r\n"]
[1080.970683, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1081.030976, "o", "\u001b[?2004l\r\n"]
[1081.091268, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1081.151561, "o", "\u001b[?2004l\r\n"]
[1081.211854, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1081.272146, "o", "\u001b[?2004l\r\n"]
[1081.332439, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1081.392732, "o", "\u001b[?2004l\r\n"]
[1081.453024, "o", "\u001b[?2004h>     changed = True\r\n"]
[1081.513317, "o", "\u001b[?2004l\r\n"]
[1081.57361, "o", "\u001b[?2004h> else:\r\n"]
[1081.633902, "o", "\u001b[?2004l\r\n"]
[1081.694195, "o", "\u001b[?2004h>     # Inject an early bypass inside should_use_numexpr (after def/docstring)\r\n"]
[1081.754488, "o", "\u001b[?2004l\r\n"]
[1081.81478, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1081.875073, "o", "\u001b[?2004l\r\n"]
[1081.935366, "o", "\u001b[?2004h>     if m:\r\n"]
[1081.995659, "o", "\u001b[?2004l\r\n"]
[1082.055951, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[1082.116244, "o", "\u001b[?2004l\r\n"]
[1082.176537, "o", "\u001b[?2004h>         # Skip docstring if present immediately after def\r\n"]
[1082.236829, "o", "\u001b[?2004l\r\n"]
[1082.297122, "o", "\u001b[?2004h>         ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1082.357415, "o", "\u001b[?2004l\r\n"]
[1082.417707, "o", "\u001b[?2004h>         if ds:\r\n"]
[1082.478, "o", "\u001b[?2004l\r\n"]
[1082.538293, "o", "\u001b[?2004h>             insert_at += ds.end()\r\n"]
[1082.598585, "o", "\u001b[?2004l\r\n"]
[1082.658878, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+2000]:\r\n"]
[1082.719171, "o", "\u001b[?2004l\r\n"]
[1082.779463, "o", "\u001b[?2004h>             inject = (\r\n"]
[1082.839756, "o", "\u001b[?2004l\r\n"]
[1082.900049, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1082.960341, "o", "\u001b[?2004l\r\n"]
[1083.020634, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[1083.080927, "o", "\u001b[?2004l\r\n"]
[1083.14122, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1083.201512, "o", "\u001b[?2004l\r\n"]
[1083.261805, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1083.322098, "o", "\u001b[?2004l\r\n"]
[1083.38239, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[1083.442683, "o", "\u001b[?2004l\r\n"]
[1083.502976, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[1083.563268, "o", "\u001b[?2004l\r\n"]
[1083.623561, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1083.683854, "o", "\u001b[?2004l\r\n"]
[1083.744146, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[1083.804439, "o", "\u001b[?2004l\r\n"]
[1083.864732, "o", "\u001b[?2004h>             )\r\n"]
[1083.925024, "o", "\u001b[?2004l\r\n"]
[1083.985317, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1084.04561, "o", "\u001b[?2004l\r\n"]
[1084.105902, "o", "\u001b[?2004h>             changed = True\r\n"]
[1084.166195, "o", "\u001b[?2004l\r\n"]
[1084.226488, "o", "\u001b[?2004h> if changed:\r\n"]
[1084.28678, "o", "\u001b[?2004l\r\n"]
[1084.347073, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1084.407366, "o", "\u001b[?2004l\r\n"]
[1084.467659, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1084.527951, "o", "\u001b[?2004l\r\n"]
[1084.588244, "o", "\u001b[?2004h> else:\r\n"]
[1084.648537, "o", "\u001b[?2004l\r\n"]
[1084.708829, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1084.769122, "o", "\u001b[?2004l\r\n"]
[1084.829415, "o", "\u001b[?2004h> PY\r\n"]
[1084.889707, "o", "\u001b[?2004l\r\n"]
[1085.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1085.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1085.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1085.006, "o", "\u001b[?2004l\r\n"]
[1090.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1090.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1090.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1090.006, "o", "\u001b[?2004l\r\n"]
[1095.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1095.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops with size threshold to reduce overhead; imp\r"]
[1095.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops with size threshold to reduce overhead; imp\r\n"]
[1095.624, "o", "proves arithmetic.Ops.*\"\r\n"]
[1096.242, "o", "\u001b[?2004l\r\n"]
[1096.86, "o", "On branch main\r\n"]
[1097.478, "o", "Untracked files:\r\n"]
[1098.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1098.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1099.332, "o", "\r\n"]
[1100.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1100.002, "i", "cd asv_bench\r"]
[1100.004, "o", "cd asv_bench\r\n"]
[1100.006, "o", "\u001b[?2004l\r\n"]
[1105.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1105.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1105.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1105.097556, "o", "\u001b[?2004l\r\n"]
[1105.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1105.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1105.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1105.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1105.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1105.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1105.738444, "o", "             --                      threads          \r\n"]
[1105.83, "o", "             ------------- ---------------------------\r\n"]
[1105.921556, "o", "              use_numexpr     default          1      \r\n"]
[1106.013111, "o", "             ============= ============= =============\r\n"]
[1106.104667, "o", "                  True      2.26\u00b10.07ms   2.28\u00b10.02ms \r\n"]
[1106.196222, "o", "                 False      2.25\u00b10.04ms   2.26\u00b10.07ms \r\n"]
[1106.287778, "o", "             ============= ============= =============\r\n"]
[1106.379333, "o", "\r\n"]
[1106.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1106.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1106.654, "o", "             --                      threads          \r\n"]
[1106.745556, "o", "             ------------- ---------------------------\r\n"]
[1106.837111, "o", "              use_numexpr     default          1      \r\n"]
[1106.928667, "o", "             ============= ============= =============\r\n"]
[1107.020222, "o", "                  True      1.77\u00b10.04ms   1.77\u00b10.02ms \r\n"]
[1107.111778, "o", "                 False      1.75\u00b10.03ms   1.79\u00b10.04ms \r\n"]
[1107.203333, "o", "             ============= ============= =============\r\n"]
[1107.294889, "o", "\r\n"]
[1107.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1107.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1107.569556, "o", "             --                      threads          \r\n"]
[1107.661111, "o", "             ------------- ---------------------------\r\n"]
[1107.752667, "o", "              use_numexpr     default          1      \r\n"]
[1107.844222, "o", "             ============= ============= =============\r\n"]
[1107.935778, "o", "                  True      2.28\u00b10.04ms   2.30\u00b10.02ms \r\n"]
[1108.027333, "o", "                 False      2.28\u00b10.03ms   2.24\u00b10.02ms \r\n"]
[1108.118889, "o", "             ============= ============= =============\r\n"]
[1108.210444, "o", "\r\n"]
[1108.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1108.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ =============\u001b[0m\r\n"]
[1108.485111, "o", "             --                     threads          \r\n"]
[1108.576667, "o", "             ------------- --------------------------\r\n"]
[1108.668222, "o", "              use_numexpr    default          1      \r\n"]
[1108.759778, "o", "             ============= ============ =============\r\n"]
[1108.851333, "o", "                  True      10.5\u00b10.2ms    10.3\u00b10.1ms \r\n"]
[1108.942889, "o", "                 False      10.5\u00b10.1ms   10.5\u00b10.09ms \r\n"]
[1109.034444, "o", "             ============= ============ =============\r\n"]
[1109.126, "o", "\r\n"]
[1109.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.7\u00b10.2ms\r\n"]
[1109.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.7\u00b10.03ms\r\n"]
[1109.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              837\u00b130\u03bcs\r\n"]
[1109.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.7\u00b10.2ms\r\n"]
[1109.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.7\u00b10.06ms\r\n"]
[1109.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.56\u00b10.03ms\r\n"]
[1109.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     11.1\u00b10.09ms\r\n"]
[1109.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     477\u00b110\u03bcs\r\n"]
[1110.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1110.002, "i", "cd /workspace/repo\r"]
[1110.004, "o", "cd /workspace/repo\r\n"]
[1110.006, "o", "\u001b[?2004l\r\n"]
[1115.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1115.002, "i", "git status -sb\r"]
[1115.004, "o", "git status -sb\r\n"]
[1116.654, "o", "\u001b[?2004l\r\n"]
[1118.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[1120.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1120.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[1120.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[1121.654, "o", "\u001b[?2004l\r\n"]
[1123.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[1125.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1125.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py\r"]
[1125.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py\r\n"]
[1125.024943, "o", "\u001b[?2004l\r\n"]
[1125.043885, "o", "\"\"\"\r\n"]
[1125.062828, "o", "Expressions\r\n"]
[1125.08177, "o", "-----------\r\n"]
[1125.100713, "o", "\r\n"]
[1125.119655, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1125.138598, "o", "\r\n"]
[1125.15754, "o", "\"\"\"\r\n"]
[1125.176483, "o", "\r\n"]
[1125.195425, "o", "from __future__ import annotations\r\n"]
[1125.214368, "o", "\r\n"]
[1125.23331, "o", "import operator\r\n"]
[1125.252253, "o", "from typing import TYPE_CHECKING\r\n"]
[1125.271195, "o", "import warnings\r\n"]
[1125.290138, "o", "\r\n"]
[1125.30908, "o", "import numpy as np\r\n"]
[1125.328023, "o", "\r\n"]
[1125.346966, "o", "from pandas._config import get_option\r\n"]
[1125.365908, "o", "\r\n"]
[1125.384851, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1125.403793, "o", "\r\n"]
[1125.422736, "o", "from pandas.core import roperator\r\n"]
[1125.441678, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1125.460621, "o", "\r\n"]
[1125.479563, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1125.498506, "o", "    import numexpr as ne\r\n"]
[1125.517448, "o", "\r\n"]
[1125.536391, "o", "if TYPE_CHECKING:\r\n"]
[1125.555333, "o", "    from pandas._typing import FuncType\r\n"]
[1125.574276, "o", "\r\n"]
[1125.593218, "o", "_TEST_MODE: bool | None = None\r\n"]
[1125.612161, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1125.631103, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1125.650046, "o", "_evaluate: FuncType | None = None\r\n"]
[1125.668989, "o", "_where: FuncType | None = None\r\n"]
[1125.687931, "o", "\r\n"]
[1125.706874, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1125.725816, "o", "_ALLOWED_DTYPES = {\r\n"]
[1125.744759, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1125.763701, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1125.782644, "o", "}\r\n"]
[1125.801586, "o", "\r\n"]
[1125.820529, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1125.839471, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1125.858414, "o", "\r\n"]
[1125.877356, "o", "\r\n"]
[1125.896299, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1125.915241, "o", "    # set/unset to use numexpr\r\n"]
[1125.934184, "o", "    global USE_NUMEXPR\r\n"]
[1125.953126, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1125.972069, "o", "        USE_NUMEXPR = v\r\n"]
[1125.991011, "o", "\r\n"]
[1126.009954, "o", "    # choose what we are going to do\r\n"]
[1126.028897, "o", "    global _evaluate, _where\r\n"]
[1126.047839, "o", "\r\n"]
[1126.066782, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1126.085724, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1126.104667, "o", "\r\n"]
[1126.123609, "o", "\r\n"]
[1126.142552, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1126.161494, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1126.180437, "o", "    # otherwise reset\r\n"]
[1126.199379, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1126.218322, "o", "        if n is None:\r\n"]
[1126.237264, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1126.256207, "o", "        ne.set_num_threads(n)\r\n"]
[1126.275149, "o", "\r\n"]
[1126.294092, "o", "\r\n"]
[1126.313034, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1126.331977, "o", "    \"\"\"\r\n"]
[1126.35092, "o", "    Standard evaluation.\r\n"]
[1126.369862, "o", "    \"\"\"\r\n"]
[1126.388805, "o", "    if _TEST_MODE:\r\n"]
[1126.407747, "o", "        _store_test_result(False)\r\n"]
[1126.42669, "o", "    return op(left_op, right_op)\r\n"]
[1126.445632, "o", "\r\n"]
[1126.464575, "o", "\r\n"]
[1126.483517, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1126.50246, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1126.521402, "o", "    if op_str is not None:\r\n"]
[1126.540345, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1126.559287, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1126.57823, "o", "            # check for dtype compatibility\r\n"]
[1126.597172, "o", "            dtypes: set[str] = set()\r\n"]
[1126.616115, "o", "            for o in [left_op, right_op]:\r\n"]
[1126.635057, "o", "                # ndarray and Series Case\r\n"]
[1126.654, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1126.672943, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1126.691885, "o", "\r\n"]
[1126.710828, "o", "            # allowed are a superset\r\n"]
[1126.72977, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1126.748713, "o", "                return True\r\n"]
[1126.767655, "o", "\r\n"]
[1126.786598, "o", "    return False\r\n"]
[1126.80554, "o", "\r\n"]
[1126.824483, "o", "\r\n"]
[1126.843425, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1126.862368, "o", "    result = None\r\n"]
[1126.88131, "o", "\r\n"]
[1126.900253, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1126.919195, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1126.938138, "o", "        if is_reversed:\r\n"]
[1126.95708, "o", "            # we were originally called by a reversed op method\r\n"]
[1126.976023, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1126.994966, "o", "\r\n"]
[1127.013908, "o", "        left_value = left_op\r\n"]
[1127.032851, "o", "        right_value = right_op\r\n"]
[1127.051793, "o", "\r\n"]
[1127.070736, "o", "        try:\r\n"]
[1127.089678, "o", "            result = ne.evaluate(\r\n"]
[1127.108621, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1127.127563, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1127.146506, "o", "                casting=\"safe\",\r\n"]
[1127.165448, "o", "            )\r\n"]
[1127.184391, "o", "        except TypeError:\r\n"]
[1127.203333, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1127.222276, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1127.241218, "o", "            pass\r\n"]
[1127.260161, "o", "        except NotImplementedError:\r\n"]
[1127.279103, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1127.298046, "o", "                pass\r\n"]
[1127.316989, "o", "            else:\r\n"]
[1127.335931, "o", "                raise\r\n"]
[1127.354874, "o", "\r\n"]
[1127.373816, "o", "        if is_reversed:\r\n"]
[1127.392759, "o", "            # reverse order to original for fallback\r\n"]
[1127.411701, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1127.430644, "o", "\r\n"]
[1127.449586, "o", "    if _TEST_MODE:\r\n"]
[1127.468529, "o", "        _store_test_result(result is not None)\r\n"]
[1127.487471, "o", "\r\n"]
[1127.506414, "o", "    if result is None:\r\n"]
[1127.525356, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1127.544299, "o", "\r\n"]
[1127.563241, "o", "    return result\r\n"]
[1127.582184, "o", "\r\n"]
[1127.601126, "o", "\r\n"]
[1127.620069, "o", "_op_str_mapping = {\r\n"]
[1127.639011, "o", "    operator.add: \"+\",\r\n"]
[1127.657954, "o", "    roperator.radd: \"+\",\r\n"]
[1127.676897, "o", "    operator.mul: \"*\",\r\n"]
[1127.695839, "o", "    roperator.rmul: \"*\",\r\n"]
[1127.714782, "o", "    operator.sub: \"-\",\r\n"]
[1127.733724, "o", "    roperator.rsub: \"-\",\r\n"]
[1127.752667, "o", "    operator.truediv: \"/\",\r\n"]
[1127.771609, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1127.790552, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1127.809494, "o", "    operator.floordiv: None,\r\n"]
[1127.828437, "o", "    roperator.rfloordiv: None,\r\n"]
[1127.847379, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1127.866322, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1127.885264, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1127.904207, "o", "    operator.mod: None,\r\n"]
[1127.923149, "o", "    roperator.rmod: None,\r\n"]
[1127.942092, "o", "    operator.pow: \"**\",\r\n"]
[1127.961034, "o", "    roperator.rpow: \"**\",\r\n"]
[1127.979977, "o", "    operator.eq: \"==\",\r\n"]
[1127.99892, "o", "    operator.ne: \"!=\",\r\n"]
[1128.017862, "o", "    operator.le: \"<=\",\r\n"]
[1128.036805, "o", "    operator.lt: \"<\",\r\n"]
[1128.055747, "o", "    operator.ge: \">=\",\r\n"]
[1128.07469, "o", "    operator.gt: \">\",\r\n"]
[1128.093632, "o", "    operator.and_: \"&\",\r\n"]
[1128.112575, "o", "    roperator.rand_: \"&\",\r\n"]
[1128.131517, "o", "    operator.or_: \"|\",\r\n"]
[1128.15046, "o", "    roperator.ror_: \"|\",\r\n"]
[1128.169402, "o", "    operator.xor: \"^\",\r\n"]
[1128.188345, "o", "    roperator.rxor: \"^\",\r\n"]
[1128.207287, "o", "    divmod: None,\r\n"]
[1128.22623, "o", "    roperator.rdivmod: None,\r\n"]
[1128.245172, "o", "}\r\n"]
[1128.264115, "o", "\r\n"]
[1128.283057, "o", "\r\n"]
[1128.302, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1128.320943, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1128.339885, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1128.358828, "o", "\r\n"]
[1128.37777, "o", "\r\n"]
[1128.396713, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1128.415655, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1128.434598, "o", "    result = None\r\n"]
[1128.45354, "o", "\r\n"]
[1128.472483, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1128.491425, "o", "        result = ne.evaluate(\r\n"]
[1128.510368, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1128.52931, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1128.548253, "o", "            casting=\"safe\",\r\n"]
[1128.567195, "o", "        )\r\n"]
[1128.586138, "o", "\r\n"]
[1128.60508, "o", "    if result is None:\r\n"]
[1128.624023, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1128.642966, "o", "\r\n"]
[1128.661908, "o", "    return result\r\n"]
[1128.680851, "o", "\r\n"]
[1128.699793, "o", "\r\n"]
[1128.718736, "o", "# turn myself on\r\n"]
[1128.737678, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1128.756621, "o", "\r\n"]
[1128.775563, "o", "\r\n"]
[1128.794506, "o", "def _has_bool_dtype(x):\r\n"]
[1128.813448, "o", "    try:\r\n"]
[1128.832391, "o", "        return x.dtype == bool\r\n"]
[1128.851333, "o", "    except AttributeError:\r\n"]
[1128.870276, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1128.889218, "o", "\r\n"]
[1128.908161, "o", "\r\n"]
[1128.927103, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1128.946046, "o", "\r\n"]
[1128.964989, "o", "\r\n"]
[1128.983931, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1129.002874, "o", "    \"\"\"\r\n"]
[1129.021816, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1129.040759, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1129.059701, "o", "    boolean ops.\r\n"]
[1129.078644, "o", "    \"\"\"\r\n"]
[1129.097586, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1129.116529, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1129.135471, "o", "            warnings.warn(\r\n"]
[1129.154414, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1129.173356, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1129.192299, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1129.211241, "o", "                stacklevel=find_stack_level(),\r\n"]
[1129.230184, "o", "            )\r\n"]
[1129.249126, "o", "            return True\r\n"]
[1129.268069, "o", "    return False\r\n"]
[1129.287011, "o", "\r\n"]
[1129.305954, "o", "\r\n"]
[1129.324897, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1129.343839, "o", "    \"\"\"\r\n"]
[1129.362782, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1129.381724, "o", "\r\n"]
[1129.400667, "o", "    Parameters\r\n"]
[1129.419609, "o", "    ----------\r\n"]
[1129.438552, "o", "    op : the actual operand\r\n"]
[1129.457494, "o", "    left_op : left operand\r\n"]
[1129.476437, "o", "    right_op : right operand\r\n"]
[1129.495379, "o", "    use_numexpr : bool, default True\r\n"]
[1129.514322, "o", "        Whether to try to use numexpr.\r\n"]
[1129.533264, "o", "    \"\"\"\r\n"]
[1129.552207, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1129.571149, "o", "    if op_str is not None:\r\n"]
[1129.590092, "o", "        if use_numexpr:\r\n"]
[1129.609034, "o", "            # error: \"None\" not callable\r\n"]
[1129.627977, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1129.64692, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1129.665862, "o", "\r\n"]
[1129.684805, "o", "\r\n"]
[1129.703747, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1129.72269, "o", "    \"\"\"\r\n"]
[1129.741632, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1129.760575, "o", "\r\n"]
[1129.779517, "o", "    Parameters\r\n"]
[1129.79846, "o", "    ----------\r\n"]
[1129.817402, "o", "    cond : np.ndarray[bool]\r\n"]
[1129.836345, "o", "    left_op : return if cond is True\r\n"]
[1129.855287, "o", "    right_op : return if cond is False\r\n"]
[1129.87423, "o", "    use_numexpr : bool, default True\r\n"]
[1129.893172, "o", "        Whether to try to use numexpr.\r\n"]
[1129.912115, "o", "    \"\"\"\r\n"]
[1129.931057, "o", "    assert _where is not None\r\n"]
[1130.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1130.002, "i", "sed -n '260,520p' pandas/core/computation/expressions.py\r"]
[1130.004, "o", "sed -n '260,520p' pandas/core/computation/expressions.py\r\n"]
[1130.1605, "o", "\u001b[?2004l\r\n"]
[1130.315, "o", "    if use_numexpr:\r\n"]
[1130.4695, "o", "        return _where(cond, left_op, right_op)\r\n"]
[1130.624, "o", "    else:\r\n"]
[1130.7785, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[1130.933, "o", "\r\n"]
[1131.0875, "o", "\r\n"]
[1131.242, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[1131.3965, "o", "    \"\"\"\r\n"]
[1131.551, "o", "    Keeps track of whether numexpr was used.\r\n"]
[1131.7055, "o", "\r\n"]
[1131.86, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[1132.0145, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[1132.169, "o", "    \"\"\"\r\n"]
[1132.3235, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[1132.478, "o", "    _TEST_MODE = v\r\n"]
[1132.6325, "o", "    _TEST_RESULT = []\r\n"]
[1132.787, "o", "\r\n"]
[1132.9415, "o", "\r\n"]
[1133.096, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[1133.2505, "o", "    if used_numexpr:\r\n"]
[1133.405, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[1133.5595, "o", "\r\n"]
[1133.714, "o", "\r\n"]
[1133.8685, "o", "def get_test_result() -> list[bool]:\r\n"]
[1134.023, "o", "    \"\"\"\r\n"]
[1134.1775, "o", "    Get test result and reset test_results.\r\n"]
[1134.332, "o", "    \"\"\"\r\n"]
[1134.4865, "o", "    global _TEST_RESULT\r\n"]
[1134.641, "o", "    res = _TEST_RESULT\r\n"]
[1134.7955, "o", "    _TEST_RESULT = []\r\n"]
[1135.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1135.002, "i", "python - << 'PY'\r"]
[1135.004, "o", "python - << 'PY'\r\n"]
[1135.066293, "o", "\u001b[?2004l\r\n"]
[1135.126585, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1135.186878, "o", "\u001b[?2004l\r\n"]
[1135.247171, "o", "\u001b[?2004h> import re\r\n"]
[1135.307463, "o", "\u001b[?2004l\r\n"]
[1135.367756, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1135.428049, "o", "\u001b[?2004l\r\n"]
[1135.488341, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1135.548634, "o", "\u001b[?2004l\r\n"]
[1135.608927, "o", "\u001b[?2004h> changed = False\r\n"]
[1135.66922, "o", "\u001b[?2004l\r\n"]
[1135.729512, "o", "\u001b[?2004h> # Try to bump an existing threshold constant first\r\n"]
[1135.789805, "o", "\u001b[?2004l\r\n"]
[1135.850098, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1135.91039, "o", "\u001b[?2004l\r\n"]
[1135.970683, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1136.030976, "o", "\u001b[?2004l\r\n"]
[1136.091268, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1136.151561, "o", "\u001b[?2004l\r\n"]
[1136.211854, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1136.272146, "o", "\u001b[?2004l\r\n"]
[1136.332439, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1136.392732, "o", "\u001b[?2004l\r\n"]
[1136.453024, "o", "\u001b[?2004h>     changed = True\r\n"]
[1136.513317, "o", "\u001b[?2004l\r\n"]
[1136.57361, "o", "\u001b[?2004h> else:\r\n"]
[1136.633902, "o", "\u001b[?2004l\r\n"]
[1136.694195, "o", "\u001b[?2004h>     # Inject early bypass into should_use_numexpr for moderate sizes\r\n"]
[1136.754488, "o", "\u001b[?2004l\r\n"]
[1136.81478, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1136.875073, "o", "\u001b[?2004l\r\n"]
[1136.935366, "o", "\u001b[?2004h>     if m:\r\n"]
[1136.995659, "o", "\u001b[?2004l\r\n"]
[1137.055951, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[1137.116244, "o", "\u001b[?2004l\r\n"]
[1137.176537, "o", "\u001b[?2004h>         # If a docstring immediately follows, skip it\r\n"]
[1137.236829, "o", "\u001b[?2004l\r\n"]
[1137.297122, "o", "\u001b[?2004h>         docm = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1137.357415, "o", "\u001b[?2004l\r\n"]
[1137.417707, "o", "\u001b[?2004h>         if docm:\r\n"]
[1137.478, "o", "\u001b[?2004l\r\n"]
[1137.538293, "o", "\u001b[?2004h>             insert_at += docm.end()\r\n"]
[1137.598585, "o", "\u001b[?2004l\r\n"]
[1137.658878, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+2000]:\r\n"]
[1137.719171, "o", "\u001b[?2004l\r\n"]
[1137.779463, "o", "\u001b[?2004h>             inject = (\r\n"]
[1137.839756, "o", "\u001b[?2004l\r\n"]
[1137.900049, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1137.960341, "o", "\u001b[?2004l\r\n"]
[1138.020634, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[1138.080927, "o", "\u001b[?2004l\r\n"]
[1138.14122, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1138.201512, "o", "\u001b[?2004l\r\n"]
[1138.261805, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1138.322098, "o", "\u001b[?2004l\r\n"]
[1138.38239, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[1138.442683, "o", "\u001b[?2004l\r\n"]
[1138.502976, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[1138.563268, "o", "\u001b[?2004l\r\n"]
[1138.623561, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1138.683854, "o", "\u001b[?2004l\r\n"]
[1138.744146, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[1138.804439, "o", "\u001b[?2004l\r\n"]
[1138.864732, "o", "\u001b[?2004h>             )\r\n"]
[1138.925024, "o", "\u001b[?2004l\r\n"]
[1138.985317, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1139.04561, "o", "\u001b[?2004l\r\n"]
[1139.105902, "o", "\u001b[?2004h>             changed = True\r\n"]
[1139.166195, "o", "\u001b[?2004l\r\n"]
[1139.226488, "o", "\u001b[?2004h> if changed:\r\n"]
[1139.28678, "o", "\u001b[?2004l\r\n"]
[1139.347073, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1139.407366, "o", "\u001b[?2004l\r\n"]
[1139.467659, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1139.527951, "o", "\u001b[?2004l\r\n"]
[1139.588244, "o", "\u001b[?2004h> else:\r\n"]
[1139.648537, "o", "\u001b[?2004l\r\n"]
[1139.708829, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1139.769122, "o", "\u001b[?2004l\r\n"]
[1139.829415, "o", "\u001b[?2004h> PY\r\n"]
[1139.889707, "o", "\u001b[?2004l\r\n"]
[1140.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1140.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1140.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1140.006, "o", "\u001b[?2004l\r\n"]
[1145.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1145.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1145.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1145.006, "o", "\u001b[?2004l\r\n"]
[1150.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1150.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[1150.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[1150.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[1151.242, "o", "\u001b[?2004l\r\n"]
[1151.86, "o", "On branch main\r\n"]
[1152.478, "o", "Untracked files:\r\n"]
[1153.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1153.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1154.332, "o", "\r\n"]
[1155.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1155.002, "i", "cd asv_bench\r"]
[1155.004, "o", "cd asv_bench\r\n"]
[1155.006, "o", "\u001b[?2004l\r\n"]
[1160.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1160.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1160.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1160.097556, "o", "\u001b[?2004l\r\n"]
[1160.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1160.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1160.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1160.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1160.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1160.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1160.738444, "o", "             --                      threads          \r\n"]
[1160.83, "o", "             ------------- ---------------------------\r\n"]
[1160.921556, "o", "              use_numexpr     default          1      \r\n"]
[1161.013111, "o", "             ============= ============= =============\r\n"]
[1161.104667, "o", "                  True      2.18\u00b10.03ms   2.22\u00b10.05ms \r\n"]
[1161.196222, "o", "                 False      2.22\u00b10.03ms   2.21\u00b10.07ms \r\n"]
[1161.287778, "o", "             ============= ============= =============\r\n"]
[1161.379333, "o", "\r\n"]
[1161.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1161.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1161.654, "o", "             --                      threads          \r\n"]
[1161.745556, "o", "             ------------- ---------------------------\r\n"]
[1161.837111, "o", "              use_numexpr     default          1      \r\n"]
[1161.928667, "o", "             ============= ============= =============\r\n"]
[1162.020222, "o", "                  True      1.72\u00b10.02ms   1.70\u00b10.03ms \r\n"]
[1162.111778, "o", "                 False      1.73\u00b10.04ms    1.77\u00b10.1ms \r\n"]
[1162.203333, "o", "             ============= ============= =============\r\n"]
[1162.294889, "o", "\r\n"]
[1162.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1162.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1162.569556, "o", "             --                      threads          \r\n"]
[1162.661111, "o", "             ------------- ---------------------------\r\n"]
[1162.752667, "o", "              use_numexpr     default          1      \r\n"]
[1162.844222, "o", "             ============= ============= =============\r\n"]
[1162.935778, "o", "                  True      2.29\u00b10.04ms   2.23\u00b10.05ms \r\n"]
[1163.027333, "o", "                 False      2.19\u00b10.03ms   2.20\u00b10.07ms \r\n"]
[1163.118889, "o", "             ============= ============= =============\r\n"]
[1163.210444, "o", "\r\n"]
[1163.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1163.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ =============\u001b[0m\r\n"]
[1163.485111, "o", "             --                     threads          \r\n"]
[1163.576667, "o", "             ------------- --------------------------\r\n"]
[1163.668222, "o", "              use_numexpr    default          1      \r\n"]
[1163.759778, "o", "             ============= ============ =============\r\n"]
[1163.851333, "o", "                  True      10.3\u00b10.1ms   10.4\u00b10.04ms \r\n"]
[1163.942889, "o", "                 False      10.7\u00b10.1ms    10.5\u00b10.1ms \r\n"]
[1164.034444, "o", "             ============= ============ =============\r\n"]
[1164.126, "o", "\r\n"]
[1164.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.5\u00b10.2ms\r\n"]
[1164.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                    28.6\u00b10.2ms\r\n"]
[1164.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              846\u00b130\u03bcs\r\n"]
[1164.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.4\u00b10.3ms\r\n"]
[1164.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    24.7\u00b10.2ms\r\n"]
[1164.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.59\u00b10.04ms\r\n"]
[1164.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      10.2\u00b10.1ms\r\n"]
[1164.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     501\u00b120\u03bcs\r\n"]
[1165.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1165.002, "i", "cd ..\r"]
[1165.004, "o", "cd ..\r\n"]
[1165.006, "o", "\u001b[?2004l\r\n"]
[1170.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1170.002, "i", "git status -sb\r"]
[1170.004, "o", "git status -sb\r\n"]
[1171.654, "o", "\u001b[?2004l\r\n"]
[1173.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[1175.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1175.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[1175.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[1176.654, "o", "\u001b[?2004l\r\n"]
[1178.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[1180.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1180.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py\r"]
[1180.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py\r\n"]
[1180.024943, "o", "\u001b[?2004l\r\n"]
[1180.043885, "o", "\"\"\"\r\n"]
[1180.062828, "o", "Expressions\r\n"]
[1180.08177, "o", "-----------\r\n"]
[1180.100713, "o", "\r\n"]
[1180.119655, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1180.138598, "o", "\r\n"]
[1180.15754, "o", "\"\"\"\r\n"]
[1180.176483, "o", "\r\n"]
[1180.195425, "o", "from __future__ import annotations\r\n"]
[1180.214368, "o", "\r\n"]
[1180.23331, "o", "import operator\r\n"]
[1180.252253, "o", "from typing import TYPE_CHECKING\r\n"]
[1180.271195, "o", "import warnings\r\n"]
[1180.290138, "o", "\r\n"]
[1180.30908, "o", "import numpy as np\r\n"]
[1180.328023, "o", "\r\n"]
[1180.346966, "o", "from pandas._config import get_option\r\n"]
[1180.365908, "o", "\r\n"]
[1180.384851, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1180.403793, "o", "\r\n"]
[1180.422736, "o", "from pandas.core import roperator\r\n"]
[1180.441678, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1180.460621, "o", "\r\n"]
[1180.479563, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1180.498506, "o", "    import numexpr as ne\r\n"]
[1180.517448, "o", "\r\n"]
[1180.536391, "o", "if TYPE_CHECKING:\r\n"]
[1180.555333, "o", "    from pandas._typing import FuncType\r\n"]
[1180.574276, "o", "\r\n"]
[1180.593218, "o", "_TEST_MODE: bool | None = None\r\n"]
[1180.612161, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1180.631103, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1180.650046, "o", "_evaluate: FuncType | None = None\r\n"]
[1180.668989, "o", "_where: FuncType | None = None\r\n"]
[1180.687931, "o", "\r\n"]
[1180.706874, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1180.725816, "o", "_ALLOWED_DTYPES = {\r\n"]
[1180.744759, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1180.763701, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1180.782644, "o", "}\r\n"]
[1180.801586, "o", "\r\n"]
[1180.820529, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1180.839471, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1180.858414, "o", "\r\n"]
[1180.877356, "o", "\r\n"]
[1180.896299, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1180.915241, "o", "    # set/unset to use numexpr\r\n"]
[1180.934184, "o", "    global USE_NUMEXPR\r\n"]
[1180.953126, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1180.972069, "o", "        USE_NUMEXPR = v\r\n"]
[1180.991011, "o", "\r\n"]
[1181.009954, "o", "    # choose what we are going to do\r\n"]
[1181.028897, "o", "    global _evaluate, _where\r\n"]
[1181.047839, "o", "\r\n"]
[1181.066782, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1181.085724, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1181.104667, "o", "\r\n"]
[1181.123609, "o", "\r\n"]
[1181.142552, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1181.161494, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1181.180437, "o", "    # otherwise reset\r\n"]
[1181.199379, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1181.218322, "o", "        if n is None:\r\n"]
[1181.237264, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1181.256207, "o", "        ne.set_num_threads(n)\r\n"]
[1181.275149, "o", "\r\n"]
[1181.294092, "o", "\r\n"]
[1181.313034, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1181.331977, "o", "    \"\"\"\r\n"]
[1181.35092, "o", "    Standard evaluation.\r\n"]
[1181.369862, "o", "    \"\"\"\r\n"]
[1181.388805, "o", "    if _TEST_MODE:\r\n"]
[1181.407747, "o", "        _store_test_result(False)\r\n"]
[1181.42669, "o", "    return op(left_op, right_op)\r\n"]
[1181.445632, "o", "\r\n"]
[1181.464575, "o", "\r\n"]
[1181.483517, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1181.50246, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1181.521402, "o", "    if op_str is not None:\r\n"]
[1181.540345, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1181.559287, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1181.57823, "o", "            # check for dtype compatibility\r\n"]
[1181.597172, "o", "            dtypes: set[str] = set()\r\n"]
[1181.616115, "o", "            for o in [left_op, right_op]:\r\n"]
[1181.635057, "o", "                # ndarray and Series Case\r\n"]
[1181.654, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1181.672943, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1181.691885, "o", "\r\n"]
[1181.710828, "o", "            # allowed are a superset\r\n"]
[1181.72977, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1181.748713, "o", "                return True\r\n"]
[1181.767655, "o", "\r\n"]
[1181.786598, "o", "    return False\r\n"]
[1181.80554, "o", "\r\n"]
[1181.824483, "o", "\r\n"]
[1181.843425, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1181.862368, "o", "    result = None\r\n"]
[1181.88131, "o", "\r\n"]
[1181.900253, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1181.919195, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1181.938138, "o", "        if is_reversed:\r\n"]
[1181.95708, "o", "            # we were originally called by a reversed op method\r\n"]
[1181.976023, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1181.994966, "o", "\r\n"]
[1182.013908, "o", "        left_value = left_op\r\n"]
[1182.032851, "o", "        right_value = right_op\r\n"]
[1182.051793, "o", "\r\n"]
[1182.070736, "o", "        try:\r\n"]
[1182.089678, "o", "            result = ne.evaluate(\r\n"]
[1182.108621, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1182.127563, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1182.146506, "o", "                casting=\"safe\",\r\n"]
[1182.165448, "o", "            )\r\n"]
[1182.184391, "o", "        except TypeError:\r\n"]
[1182.203333, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1182.222276, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1182.241218, "o", "            pass\r\n"]
[1182.260161, "o", "        except NotImplementedError:\r\n"]
[1182.279103, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1182.298046, "o", "                pass\r\n"]
[1182.316989, "o", "            else:\r\n"]
[1182.335931, "o", "                raise\r\n"]
[1182.354874, "o", "\r\n"]
[1182.373816, "o", "        if is_reversed:\r\n"]
[1182.392759, "o", "            # reverse order to original for fallback\r\n"]
[1182.411701, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1182.430644, "o", "\r\n"]
[1182.449586, "o", "    if _TEST_MODE:\r\n"]
[1182.468529, "o", "        _store_test_result(result is not None)\r\n"]
[1182.487471, "o", "\r\n"]
[1182.506414, "o", "    if result is None:\r\n"]
[1182.525356, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1182.544299, "o", "\r\n"]
[1182.563241, "o", "    return result\r\n"]
[1182.582184, "o", "\r\n"]
[1182.601126, "o", "\r\n"]
[1182.620069, "o", "_op_str_mapping = {\r\n"]
[1182.639011, "o", "    operator.add: \"+\",\r\n"]
[1182.657954, "o", "    roperator.radd: \"+\",\r\n"]
[1182.676897, "o", "    operator.mul: \"*\",\r\n"]
[1182.695839, "o", "    roperator.rmul: \"*\",\r\n"]
[1182.714782, "o", "    operator.sub: \"-\",\r\n"]
[1182.733724, "o", "    roperator.rsub: \"-\",\r\n"]
[1182.752667, "o", "    operator.truediv: \"/\",\r\n"]
[1182.771609, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1182.790552, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1182.809494, "o", "    operator.floordiv: None,\r\n"]
[1182.828437, "o", "    roperator.rfloordiv: None,\r\n"]
[1182.847379, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1182.866322, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1182.885264, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1182.904207, "o", "    operator.mod: None,\r\n"]
[1182.923149, "o", "    roperator.rmod: None,\r\n"]
[1182.942092, "o", "    operator.pow: \"**\",\r\n"]
[1182.961034, "o", "    roperator.rpow: \"**\",\r\n"]
[1182.979977, "o", "    operator.eq: \"==\",\r\n"]
[1182.99892, "o", "    operator.ne: \"!=\",\r\n"]
[1183.017862, "o", "    operator.le: \"<=\",\r\n"]
[1183.036805, "o", "    operator.lt: \"<\",\r\n"]
[1183.055747, "o", "    operator.ge: \">=\",\r\n"]
[1183.07469, "o", "    operator.gt: \">\",\r\n"]
[1183.093632, "o", "    operator.and_: \"&\",\r\n"]
[1183.112575, "o", "    roperator.rand_: \"&\",\r\n"]
[1183.131517, "o", "    operator.or_: \"|\",\r\n"]
[1183.15046, "o", "    roperator.ror_: \"|\",\r\n"]
[1183.169402, "o", "    operator.xor: \"^\",\r\n"]
[1183.188345, "o", "    roperator.rxor: \"^\",\r\n"]
[1183.207287, "o", "    divmod: None,\r\n"]
[1183.22623, "o", "    roperator.rdivmod: None,\r\n"]
[1183.245172, "o", "}\r\n"]
[1183.264115, "o", "\r\n"]
[1183.283057, "o", "\r\n"]
[1183.302, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1183.320943, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1183.339885, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1183.358828, "o", "\r\n"]
[1183.37777, "o", "\r\n"]
[1183.396713, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1183.415655, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1183.434598, "o", "    result = None\r\n"]
[1183.45354, "o", "\r\n"]
[1183.472483, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1183.491425, "o", "        result = ne.evaluate(\r\n"]
[1183.510368, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1183.52931, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1183.548253, "o", "            casting=\"safe\",\r\n"]
[1183.567195, "o", "        )\r\n"]
[1183.586138, "o", "\r\n"]
[1183.60508, "o", "    if result is None:\r\n"]
[1183.624023, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1183.642966, "o", "\r\n"]
[1183.661908, "o", "    return result\r\n"]
[1183.680851, "o", "\r\n"]
[1183.699793, "o", "\r\n"]
[1183.718736, "o", "# turn myself on\r\n"]
[1183.737678, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1183.756621, "o", "\r\n"]
[1183.775563, "o", "\r\n"]
[1183.794506, "o", "def _has_bool_dtype(x):\r\n"]
[1183.813448, "o", "    try:\r\n"]
[1183.832391, "o", "        return x.dtype == bool\r\n"]
[1183.851333, "o", "    except AttributeError:\r\n"]
[1183.870276, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1183.889218, "o", "\r\n"]
[1183.908161, "o", "\r\n"]
[1183.927103, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1183.946046, "o", "\r\n"]
[1183.964989, "o", "\r\n"]
[1183.983931, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1184.002874, "o", "    \"\"\"\r\n"]
[1184.021816, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1184.040759, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1184.059701, "o", "    boolean ops.\r\n"]
[1184.078644, "o", "    \"\"\"\r\n"]
[1184.097586, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1184.116529, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1184.135471, "o", "            warnings.warn(\r\n"]
[1184.154414, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1184.173356, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1184.192299, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1184.211241, "o", "                stacklevel=find_stack_level(),\r\n"]
[1184.230184, "o", "            )\r\n"]
[1184.249126, "o", "            return True\r\n"]
[1184.268069, "o", "    return False\r\n"]
[1184.287011, "o", "\r\n"]
[1184.305954, "o", "\r\n"]
[1184.324897, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1184.343839, "o", "    \"\"\"\r\n"]
[1184.362782, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1184.381724, "o", "\r\n"]
[1184.400667, "o", "    Parameters\r\n"]
[1184.419609, "o", "    ----------\r\n"]
[1184.438552, "o", "    op : the actual operand\r\n"]
[1184.457494, "o", "    left_op : left operand\r\n"]
[1184.476437, "o", "    right_op : right operand\r\n"]
[1184.495379, "o", "    use_numexpr : bool, default True\r\n"]
[1184.514322, "o", "        Whether to try to use numexpr.\r\n"]
[1184.533264, "o", "    \"\"\"\r\n"]
[1184.552207, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1184.571149, "o", "    if op_str is not None:\r\n"]
[1184.590092, "o", "        if use_numexpr:\r\n"]
[1184.609034, "o", "            # error: \"None\" not callable\r\n"]
[1184.627977, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1184.64692, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1184.665862, "o", "\r\n"]
[1184.684805, "o", "\r\n"]
[1184.703747, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1184.72269, "o", "    \"\"\"\r\n"]
[1184.741632, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1184.760575, "o", "\r\n"]
[1184.779517, "o", "    Parameters\r\n"]
[1184.79846, "o", "    ----------\r\n"]
[1184.817402, "o", "    cond : np.ndarray[bool]\r\n"]
[1184.836345, "o", "    left_op : return if cond is True\r\n"]
[1184.855287, "o", "    right_op : return if cond is False\r\n"]
[1184.87423, "o", "    use_numexpr : bool, default True\r\n"]
[1184.893172, "o", "        Whether to try to use numexpr.\r\n"]
[1184.912115, "o", "    \"\"\"\r\n"]
[1184.931057, "o", "    assert _where is not None\r\n"]
[1185.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1185.002, "i", "sed -n '260,520p' pandas/core/computation/expressions.py\r"]
[1185.004, "o", "sed -n '260,520p' pandas/core/computation/expressions.py\r\n"]
[1185.1605, "o", "\u001b[?2004l\r\n"]
[1185.315, "o", "    if use_numexpr:\r\n"]
[1185.4695, "o", "        return _where(cond, left_op, right_op)\r\n"]
[1185.624, "o", "    else:\r\n"]
[1185.7785, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[1185.933, "o", "\r\n"]
[1186.0875, "o", "\r\n"]
[1186.242, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[1186.3965, "o", "    \"\"\"\r\n"]
[1186.551, "o", "    Keeps track of whether numexpr was used.\r\n"]
[1186.7055, "o", "\r\n"]
[1186.86, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[1187.0145, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[1187.169, "o", "    \"\"\"\r\n"]
[1187.3235, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[1187.478, "o", "    _TEST_MODE = v\r\n"]
[1187.6325, "o", "    _TEST_RESULT = []\r\n"]
[1187.787, "o", "\r\n"]
[1187.9415, "o", "\r\n"]
[1188.096, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[1188.2505, "o", "    if used_numexpr:\r\n"]
[1188.405, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[1188.5595, "o", "\r\n"]
[1188.714, "o", "\r\n"]
[1188.8685, "o", "def get_test_result() -> list[bool]:\r\n"]
[1189.023, "o", "    \"\"\"\r\n"]
[1189.1775, "o", "    Get test result and reset test_results.\r\n"]
[1189.332, "o", "    \"\"\"\r\n"]
[1189.4865, "o", "    global _TEST_RESULT\r\n"]
[1189.641, "o", "    res = _TEST_RESULT\r\n"]
[1189.7955, "o", "    _TEST_RESULT = []\r\n"]
[1190.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1190.002, "i", "python - << 'PY'\r"]
[1190.004, "o", "python - << 'PY'\r\n"]
[1190.066293, "o", "\u001b[?2004l\r\n"]
[1190.126585, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1190.186878, "o", "\u001b[?2004l\r\n"]
[1190.247171, "o", "\u001b[?2004h> import re\r\n"]
[1190.307463, "o", "\u001b[?2004l\r\n"]
[1190.367756, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1190.428049, "o", "\u001b[?2004l\r\n"]
[1190.488341, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1190.548634, "o", "\u001b[?2004l\r\n"]
[1190.608927, "o", "\u001b[?2004h> changed = False\r\n"]
[1190.66922, "o", "\u001b[?2004l\r\n"]
[1190.729512, "o", "\u001b[?2004h> # Try to bump an existing threshold constant if present\r\n"]
[1190.789805, "o", "\u001b[?2004l\r\n"]
[1190.850098, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1190.91039, "o", "\u001b[?2004l\r\n"]
[1190.970683, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1191.030976, "o", "\u001b[?2004l\r\n"]
[1191.091268, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1191.151561, "o", "\u001b[?2004l\r\n"]
[1191.211854, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1191.272146, "o", "\u001b[?2004l\r\n"]
[1191.332439, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1191.392732, "o", "\u001b[?2004l\r\n"]
[1191.453024, "o", "\u001b[?2004h>     changed = True\r\n"]
[1191.513317, "o", "\u001b[?2004l\r\n"]
[1191.57361, "o", "\u001b[?2004h> else:\r\n"]
[1191.633902, "o", "\u001b[?2004l\r\n"]
[1191.694195, "o", "\u001b[?2004h>     # Inject early bypass inside should_use_numexpr (after def and optional docstring)\r\n"]
[1191.754488, "o", "\u001b[?2004l\r\n"]
[1191.81478, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1191.875073, "o", "\u001b[?2004l\r\n"]
[1191.935366, "o", "\u001b[?2004h>     if m:\r\n"]
[1191.995659, "o", "\u001b[?2004l\r\n"]
[1192.055951, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[1192.116244, "o", "\u001b[?2004l\r\n"]
[1192.176537, "o", "\u001b[?2004h>         # Skip any immediate docstring\r\n"]
[1192.236829, "o", "\u001b[?2004l\r\n"]
[1192.297122, "o", "\u001b[?2004h>         ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1192.357415, "o", "\u001b[?2004l\r\n"]
[1192.417707, "o", "\u001b[?2004h>         if ds:\r\n"]
[1192.478, "o", "\u001b[?2004l\r\n"]
[1192.538293, "o", "\u001b[?2004h>             insert_at += ds.end()\r\n"]
[1192.598585, "o", "\u001b[?2004l\r\n"]
[1192.658878, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+3000]:\r\n"]
[1192.719171, "o", "\u001b[?2004l\r\n"]
[1192.779463, "o", "\u001b[?2004h>             inject = (\r\n"]
[1192.839756, "o", "\u001b[?2004l\r\n"]
[1192.900049, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1192.960341, "o", "\u001b[?2004l\r\n"]
[1193.020634, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[1193.080927, "o", "\u001b[?2004l\r\n"]
[1193.14122, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1193.201512, "o", "\u001b[?2004l\r\n"]
[1193.261805, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1193.322098, "o", "\u001b[?2004l\r\n"]
[1193.38239, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[1193.442683, "o", "\u001b[?2004l\r\n"]
[1193.502976, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[1193.563268, "o", "\u001b[?2004l\r\n"]
[1193.623561, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1193.683854, "o", "\u001b[?2004l\r\n"]
[1193.744146, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[1193.804439, "o", "\u001b[?2004l\r\n"]
[1193.864732, "o", "\u001b[?2004h>             )\r\n"]
[1193.925024, "o", "\u001b[?2004l\r\n"]
[1193.985317, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1194.04561, "o", "\u001b[?2004l\r\n"]
[1194.105902, "o", "\u001b[?2004h>             changed = True\r\n"]
[1194.166195, "o", "\u001b[?2004l\r\n"]
[1194.226488, "o", "\u001b[?2004h> if changed:\r\n"]
[1194.28678, "o", "\u001b[?2004l\r\n"]
[1194.347073, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1194.407366, "o", "\u001b[?2004l\r\n"]
[1194.467659, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1194.527951, "o", "\u001b[?2004l\r\n"]
[1194.588244, "o", "\u001b[?2004h> else:\r\n"]
[1194.648537, "o", "\u001b[?2004l\r\n"]
[1194.708829, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1194.769122, "o", "\u001b[?2004l\r\n"]
[1194.829415, "o", "\u001b[?2004h> PY\r\n"]
[1194.889707, "o", "\u001b[?2004l\r\n"]
[1195.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1195.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1195.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1195.006, "o", "\u001b[?2004l\r\n"]
[1200.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1200.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1200.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1200.006, "o", "\u001b[?2004l\r\n"]
[1205.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1205.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[1205.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[1205.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[1206.242, "o", "\u001b[?2004l\r\n"]
[1206.86, "o", "On branch main\r\n"]
[1207.478, "o", "Untracked files:\r\n"]
[1208.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1208.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1209.332, "o", "\r\n"]
[1210.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1210.002, "i", "cd asv_bench\r"]
[1210.004, "o", "cd asv_bench\r\n"]
[1210.006, "o", "\u001b[?2004l\r\n"]
[1215.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1215.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1215.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1215.097556, "o", "\u001b[?2004l\r\n"]
[1215.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1215.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1215.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1215.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1215.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1215.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1215.738444, "o", "             --                      threads          \r\n"]
[1215.83, "o", "             ------------- ---------------------------\r\n"]
[1215.921556, "o", "              use_numexpr     default          1      \r\n"]
[1216.013111, "o", "             ============= ============= =============\r\n"]
[1216.104667, "o", "                  True      2.19\u00b10.04ms   2.21\u00b10.02ms \r\n"]
[1216.196222, "o", "                 False       2.25\u00b10.1ms   2.21\u00b10.04ms \r\n"]
[1216.287778, "o", "             ============= ============= =============\r\n"]
[1216.379333, "o", "\r\n"]
[1216.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1216.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1216.654, "o", "             --                      threads          \r\n"]
[1216.745556, "o", "             ------------- ---------------------------\r\n"]
[1216.837111, "o", "              use_numexpr     default          1      \r\n"]
[1216.928667, "o", "             ============= ============= =============\r\n"]
[1217.020222, "o", "                  True      1.68\u00b10.02ms   1.69\u00b10.02ms \r\n"]
[1217.111778, "o", "                 False      1.68\u00b10.02ms   1.71\u00b10.03ms \r\n"]
[1217.203333, "o", "             ============= ============= =============\r\n"]
[1217.294889, "o", "\r\n"]
[1217.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1217.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1217.569556, "o", "             --                      threads          \r\n"]
[1217.661111, "o", "             ------------- ---------------------------\r\n"]
[1217.752667, "o", "              use_numexpr     default          1      \r\n"]
[1217.844222, "o", "             ============= ============= =============\r\n"]
[1217.935778, "o", "                  True      2.24\u00b10.06ms   2.20\u00b10.03ms \r\n"]
[1218.027333, "o", "                 False      2.15\u00b10.02ms   2.20\u00b10.04ms \r\n"]
[1218.118889, "o", "             ============= ============= =============\r\n"]
[1218.210444, "o", "\r\n"]
[1218.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1218.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1218.485111, "o", "             --                      threads          \r\n"]
[1218.576667, "o", "             ------------- ---------------------------\r\n"]
[1218.668222, "o", "              use_numexpr     default          1      \r\n"]
[1218.759778, "o", "             ============= ============= =============\r\n"]
[1218.851333, "o", "                  True      10.2\u00b10.06ms   10.3\u00b10.08ms \r\n"]
[1218.942889, "o", "                 False      10.2\u00b10.07ms    10.4\u00b10.1ms \r\n"]
[1219.034444, "o", "             ============= ============= =============\r\n"]
[1219.126, "o", "\r\n"]
[1219.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.4\u00b10.2ms\r\n"]
[1219.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.5\u00b10.04ms\r\n"]
[1219.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              825\u00b130\u03bcs\r\n"]
[1219.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.3\u00b10.1ms\r\n"]
[1219.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.8\u00b10.03ms\r\n"]
[1219.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.52\u00b10.03ms\r\n"]
[1219.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.9\u00b10.08ms\r\n"]
[1219.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     475\u00b120\u03bcs\r\n"]
[1220.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1220.002, "i", "cd ..\r"]
[1220.004, "o", "cd ..\r\n"]
[1220.006, "o", "\u001b[?2004l\r\n"]
[1225.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1225.002, "i", "ls -la pandas/core/computation\r"]
[1225.004, "o", "ls -la pandas/core/computation\r\n"]
[1225.296824, "o", "\u001b[?2004l\r\n"]
[1225.587647, "o", "total 152\r\n"]
[1225.878471, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[0m\u001b[01;34m.\u001b[0m\r\n"]
[1226.169294, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34m..\u001b[0m\r\n"]
[1226.460118, "o", "-rw-r--r-- 1 root root     0 Sep 12 21:42 __init__.py\r\n"]
[1226.750941, "o", "-rw-r--r-- 1 root root  6735 Sep 12 21:42 align.py\r\n"]
[1227.041765, "o", "-rw-r--r-- 1 root root    65 Sep 12 21:42 api.py\r\n"]
[1227.332588, "o", "-rw-r--r-- 1 root root   226 Sep 12 21:42 check.py\r\n"]
[1227.623412, "o", "-rw-r--r-- 1 root root  1442 Sep 12 21:42 common.py\r\n"]
[1227.914235, "o", "-rw-r--r-- 1 root root  3462 Sep 12 21:42 engines.py\r\n"]
[1228.205059, "o", "-rw-r--r-- 1 root root 15281 Sep 12 21:42 eval.py\r\n"]
[1228.495882, "o", "-rw-r--r-- 1 root root 25337 Sep 12 21:44 expr.py\r\n"]
[1228.786706, "o", "-rw-r--r-- 1 root root  7966 Oct  1 18:00 expressions.py\r\n"]
[1229.077529, "o", "-rw-r--r-- 1 root root 14435 Sep 12 21:42 ops.py\r\n"]
[1229.368353, "o", "-rw-r--r-- 1 root root  7711 Sep 12 21:42 parsing.py\r\n"]
[1229.659176, "o", "-rw-r--r-- 1 root root 21077 Sep 12 21:44 pytables.py\r\n"]
[1230.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1230.002, "i", "grep -n \"def should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[1230.004, "o", "grep -n \"def should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[1231.654, "o", "\u001b[?2004l\r\n"]
[1233.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[1235.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1235.002, "i", "sed -n '1,240p' pandas/core/computation/expressions.py\r"]
[1235.004, "o", "sed -n '1,240p' pandas/core/computation/expressions.py\r\n"]
[1235.026515, "o", "\u001b[?2004l\r\n"]
[1235.047029, "o", "\"\"\"\r\n"]
[1235.067544, "o", "Expressions\r\n"]
[1235.088058, "o", "-----------\r\n"]
[1235.108573, "o", "\r\n"]
[1235.129087, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1235.149602, "o", "\r\n"]
[1235.170116, "o", "\"\"\"\r\n"]
[1235.190631, "o", "\r\n"]
[1235.211145, "o", "from __future__ import annotations\r\n"]
[1235.23166, "o", "\r\n"]
[1235.252174, "o", "import operator\r\n"]
[1235.272689, "o", "from typing import TYPE_CHECKING\r\n"]
[1235.293203, "o", "import warnings\r\n"]
[1235.313718, "o", "\r\n"]
[1235.334232, "o", "import numpy as np\r\n"]
[1235.354747, "o", "\r\n"]
[1235.375261, "o", "from pandas._config import get_option\r\n"]
[1235.395776, "o", "\r\n"]
[1235.41629, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1235.436805, "o", "\r\n"]
[1235.45732, "o", "from pandas.core import roperator\r\n"]
[1235.477834, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1235.498349, "o", "\r\n"]
[1235.518863, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1235.539378, "o", "    import numexpr as ne\r\n"]
[1235.559892, "o", "\r\n"]
[1235.580407, "o", "if TYPE_CHECKING:\r\n"]
[1235.600921, "o", "    from pandas._typing import FuncType\r\n"]
[1235.621436, "o", "\r\n"]
[1235.64195, "o", "_TEST_MODE: bool | None = None\r\n"]
[1235.662465, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1235.682979, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1235.703494, "o", "_evaluate: FuncType | None = None\r\n"]
[1235.724008, "o", "_where: FuncType | None = None\r\n"]
[1235.744523, "o", "\r\n"]
[1235.765037, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1235.785552, "o", "_ALLOWED_DTYPES = {\r\n"]
[1235.806066, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1235.826581, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1235.847095, "o", "}\r\n"]
[1235.86761, "o", "\r\n"]
[1235.888124, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1235.908639, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1235.929154, "o", "\r\n"]
[1235.949668, "o", "\r\n"]
[1235.970183, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1235.990697, "o", "    # set/unset to use numexpr\r\n"]
[1236.011212, "o", "    global USE_NUMEXPR\r\n"]
[1236.031726, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1236.052241, "o", "        USE_NUMEXPR = v\r\n"]
[1236.072755, "o", "\r\n"]
[1236.09327, "o", "    # choose what we are going to do\r\n"]
[1236.113784, "o", "    global _evaluate, _where\r\n"]
[1236.134299, "o", "\r\n"]
[1236.154813, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1236.175328, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1236.195842, "o", "\r\n"]
[1236.216357, "o", "\r\n"]
[1236.236871, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1236.257386, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1236.2779, "o", "    # otherwise reset\r\n"]
[1236.298415, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1236.318929, "o", "        if n is None:\r\n"]
[1236.339444, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1236.359959, "o", "        ne.set_num_threads(n)\r\n"]
[1236.380473, "o", "\r\n"]
[1236.400988, "o", "\r\n"]
[1236.421502, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1236.442017, "o", "    \"\"\"\r\n"]
[1236.462531, "o", "    Standard evaluation.\r\n"]
[1236.483046, "o", "    \"\"\"\r\n"]
[1236.50356, "o", "    if _TEST_MODE:\r\n"]
[1236.524075, "o", "        _store_test_result(False)\r\n"]
[1236.544589, "o", "    return op(left_op, right_op)\r\n"]
[1236.565104, "o", "\r\n"]
[1236.585618, "o", "\r\n"]
[1236.606133, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1236.626647, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1236.647162, "o", "    if op_str is not None:\r\n"]
[1236.667676, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1236.688191, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1236.708705, "o", "            # check for dtype compatibility\r\n"]
[1236.72922, "o", "            dtypes: set[str] = set()\r\n"]
[1236.749734, "o", "            for o in [left_op, right_op]:\r\n"]
[1236.770249, "o", "                # ndarray and Series Case\r\n"]
[1236.790763, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1236.811278, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1236.831793, "o", "\r\n"]
[1236.852307, "o", "            # allowed are a superset\r\n"]
[1236.872822, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1236.893336, "o", "                return True\r\n"]
[1236.913851, "o", "\r\n"]
[1236.934365, "o", "    return False\r\n"]
[1236.95488, "o", "\r\n"]
[1236.975394, "o", "\r\n"]
[1236.995909, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1237.016423, "o", "    result = None\r\n"]
[1237.036938, "o", "\r\n"]
[1237.057452, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1237.077967, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1237.098481, "o", "        if is_reversed:\r\n"]
[1237.118996, "o", "            # we were originally called by a reversed op method\r\n"]
[1237.13951, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1237.160025, "o", "\r\n"]
[1237.180539, "o", "        left_value = left_op\r\n"]
[1237.201054, "o", "        right_value = right_op\r\n"]
[1237.221568, "o", "\r\n"]
[1237.242083, "o", "        try:\r\n"]
[1237.262598, "o", "            result = ne.evaluate(\r\n"]
[1237.283112, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1237.303627, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1237.324141, "o", "                casting=\"safe\",\r\n"]
[1237.344656, "o", "            )\r\n"]
[1237.36517, "o", "        except TypeError:\r\n"]
[1237.385685, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1237.406199, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1237.426714, "o", "            pass\r\n"]
[1237.447228, "o", "        except NotImplementedError:\r\n"]
[1237.467743, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1237.488257, "o", "                pass\r\n"]
[1237.508772, "o", "            else:\r\n"]
[1237.529286, "o", "                raise\r\n"]
[1237.549801, "o", "\r\n"]
[1237.570315, "o", "        if is_reversed:\r\n"]
[1237.59083, "o", "            # reverse order to original for fallback\r\n"]
[1237.611344, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1237.631859, "o", "\r\n"]
[1237.652373, "o", "    if _TEST_MODE:\r\n"]
[1237.672888, "o", "        _store_test_result(result is not None)\r\n"]
[1237.693402, "o", "\r\n"]
[1237.713917, "o", "    if result is None:\r\n"]
[1237.734432, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1237.754946, "o", "\r\n"]
[1237.775461, "o", "    return result\r\n"]
[1237.795975, "o", "\r\n"]
[1237.81649, "o", "\r\n"]
[1237.837004, "o", "_op_str_mapping = {\r\n"]
[1237.857519, "o", "    operator.add: \"+\",\r\n"]
[1237.878033, "o", "    roperator.radd: \"+\",\r\n"]
[1237.898548, "o", "    operator.mul: \"*\",\r\n"]
[1237.919062, "o", "    roperator.rmul: \"*\",\r\n"]
[1237.939577, "o", "    operator.sub: \"-\",\r\n"]
[1237.960091, "o", "    roperator.rsub: \"-\",\r\n"]
[1237.980606, "o", "    operator.truediv: \"/\",\r\n"]
[1238.00112, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1238.021635, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1238.042149, "o", "    operator.floordiv: None,\r\n"]
[1238.062664, "o", "    roperator.rfloordiv: None,\r\n"]
[1238.083178, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1238.103693, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1238.124207, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1238.144722, "o", "    operator.mod: None,\r\n"]
[1238.165237, "o", "    roperator.rmod: None,\r\n"]
[1238.185751, "o", "    operator.pow: \"**\",\r\n"]
[1238.206266, "o", "    roperator.rpow: \"**\",\r\n"]
[1238.22678, "o", "    operator.eq: \"==\",\r\n"]
[1238.247295, "o", "    operator.ne: \"!=\",\r\n"]
[1238.267809, "o", "    operator.le: \"<=\",\r\n"]
[1238.288324, "o", "    operator.lt: \"<\",\r\n"]
[1238.308838, "o", "    operator.ge: \">=\",\r\n"]
[1238.329353, "o", "    operator.gt: \">\",\r\n"]
[1238.349867, "o", "    operator.and_: \"&\",\r\n"]
[1238.370382, "o", "    roperator.rand_: \"&\",\r\n"]
[1238.390896, "o", "    operator.or_: \"|\",\r\n"]
[1238.411411, "o", "    roperator.ror_: \"|\",\r\n"]
[1238.431925, "o", "    operator.xor: \"^\",\r\n"]
[1238.45244, "o", "    roperator.rxor: \"^\",\r\n"]
[1238.472954, "o", "    divmod: None,\r\n"]
[1238.493469, "o", "    roperator.rdivmod: None,\r\n"]
[1238.513983, "o", "}\r\n"]
[1238.534498, "o", "\r\n"]
[1238.555012, "o", "\r\n"]
[1238.575527, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1238.596041, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1238.616556, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1238.637071, "o", "\r\n"]
[1238.657585, "o", "\r\n"]
[1238.6781, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1238.698614, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1238.719129, "o", "    result = None\r\n"]
[1238.739643, "o", "\r\n"]
[1238.760158, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1238.780672, "o", "        result = ne.evaluate(\r\n"]
[1238.801187, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1238.821701, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1238.842216, "o", "            casting=\"safe\",\r\n"]
[1238.86273, "o", "        )\r\n"]
[1238.883245, "o", "\r\n"]
[1238.903759, "o", "    if result is None:\r\n"]
[1238.924274, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1238.944788, "o", "\r\n"]
[1238.965303, "o", "    return result\r\n"]
[1238.985817, "o", "\r\n"]
[1239.006332, "o", "\r\n"]
[1239.026846, "o", "# turn myself on\r\n"]
[1239.047361, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1239.067876, "o", "\r\n"]
[1239.08839, "o", "\r\n"]
[1239.108905, "o", "def _has_bool_dtype(x):\r\n"]
[1239.129419, "o", "    try:\r\n"]
[1239.149934, "o", "        return x.dtype == bool\r\n"]
[1239.170448, "o", "    except AttributeError:\r\n"]
[1239.190963, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1239.211477, "o", "\r\n"]
[1239.231992, "o", "\r\n"]
[1239.252506, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1239.273021, "o", "\r\n"]
[1239.293535, "o", "\r\n"]
[1239.31405, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1239.334564, "o", "    \"\"\"\r\n"]
[1239.355079, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1239.375593, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1239.396108, "o", "    boolean ops.\r\n"]
[1239.416622, "o", "    \"\"\"\r\n"]
[1239.437137, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1239.457651, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1239.478166, "o", "            warnings.warn(\r\n"]
[1239.49868, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1239.519195, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1239.53971, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1239.560224, "o", "                stacklevel=find_stack_level(),\r\n"]
[1239.580739, "o", "            )\r\n"]
[1239.601253, "o", "            return True\r\n"]
[1239.621768, "o", "    return False\r\n"]
[1239.642282, "o", "\r\n"]
[1239.662797, "o", "\r\n"]
[1239.683311, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1239.703826, "o", "    \"\"\"\r\n"]
[1239.72434, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1239.744855, "o", "\r\n"]
[1239.765369, "o", "    Parameters\r\n"]
[1239.785884, "o", "    ----------\r\n"]
[1239.806398, "o", "    op : the actual operand\r\n"]
[1239.826913, "o", "    left_op : left operand\r\n"]
[1239.847427, "o", "    right_op : right operand\r\n"]
[1239.867942, "o", "    use_numexpr : bool, default True\r\n"]
[1239.888456, "o", "        Whether to try to use numexpr.\r\n"]
[1239.908971, "o", "    \"\"\"\r\n"]
[1239.929485, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1240.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1240.002, "i", "sed -n '240,520p' pandas/core/computation/expressions.py\r"]
[1240.004, "o", "sed -n '240,520p' pandas/core/computation/expressions.py\r\n"]
[1240.101077, "o", "\u001b[?2004l\r\n"]
[1240.196154, "o", "    if op_str is not None:\r\n"]
[1240.291231, "o", "        if use_numexpr:\r\n"]
[1240.386308, "o", "            # error: \"None\" not callable\r\n"]
[1240.481385, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1240.576462, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1240.671538, "o", "\r\n"]
[1240.766615, "o", "\r\n"]
[1240.861692, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1240.956769, "o", "    \"\"\"\r\n"]
[1241.051846, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1241.146923, "o", "\r\n"]
[1241.242, "o", "    Parameters\r\n"]
[1241.337077, "o", "    ----------\r\n"]
[1241.432154, "o", "    cond : np.ndarray[bool]\r\n"]
[1241.527231, "o", "    left_op : return if cond is True\r\n"]
[1241.622308, "o", "    right_op : return if cond is False\r\n"]
[1241.717385, "o", "    use_numexpr : bool, default True\r\n"]
[1241.812462, "o", "        Whether to try to use numexpr.\r\n"]
[1241.907538, "o", "    \"\"\"\r\n"]
[1242.002615, "o", "    assert _where is not None\r\n"]
[1242.097692, "o", "    if use_numexpr:\r\n"]
[1242.192769, "o", "        return _where(cond, left_op, right_op)\r\n"]
[1242.287846, "o", "    else:\r\n"]
[1242.382923, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[1242.478, "o", "\r\n"]
[1242.573077, "o", "\r\n"]
[1242.668154, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[1242.763231, "o", "    \"\"\"\r\n"]
[1242.858308, "o", "    Keeps track of whether numexpr was used.\r\n"]
[1242.953385, "o", "\r\n"]
[1243.048462, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[1243.143538, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[1243.238615, "o", "    \"\"\"\r\n"]
[1243.333692, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[1243.428769, "o", "    _TEST_MODE = v\r\n"]
[1243.523846, "o", "    _TEST_RESULT = []\r\n"]
[1243.618923, "o", "\r\n"]
[1243.714, "o", "\r\n"]
[1243.809077, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[1243.904154, "o", "    if used_numexpr:\r\n"]
[1243.999231, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[1244.094308, "o", "\r\n"]
[1244.189385, "o", "\r\n"]
[1244.284462, "o", "def get_test_result() -> list[bool]:\r\n"]
[1244.379538, "o", "    \"\"\"\r\n"]
[1244.474615, "o", "    Get test result and reset test_results.\r\n"]
[1244.569692, "o", "    \"\"\"\r\n"]
[1244.664769, "o", "    global _TEST_RESULT\r\n"]
[1244.759846, "o", "    res = _TEST_RESULT\r\n"]
[1244.854923, "o", "    _TEST_RESULT = []\r\n"]
[1245.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1245.002, "i", "python - << 'PY'\r"]
[1245.004, "o", "python - << 'PY'\r\n"]
[1245.066293, "o", "\u001b[?2004l\r\n"]
[1245.126585, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1245.186878, "o", "\u001b[?2004l\r\n"]
[1245.247171, "o", "\u001b[?2004h> import re\r\n"]
[1245.307463, "o", "\u001b[?2004l\r\n"]
[1245.367756, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1245.428049, "o", "\u001b[?2004l\r\n"]
[1245.488341, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1245.548634, "o", "\u001b[?2004l\r\n"]
[1245.608927, "o", "\u001b[?2004h> changed = False\r\n"]
[1245.66922, "o", "\u001b[?2004l\r\n"]
[1245.729512, "o", "\u001b[?2004h> # Try to bump an existing threshold constant first\r\n"]
[1245.789805, "o", "\u001b[?2004l\r\n"]
[1245.850098, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1245.91039, "o", "\u001b[?2004l\r\n"]
[1245.970683, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1246.030976, "o", "\u001b[?2004l\r\n"]
[1246.091268, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1246.151561, "o", "\u001b[?2004l\r\n"]
[1246.211854, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1246.272146, "o", "\u001b[?2004l\r\n"]
[1246.332439, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1246.392732, "o", "\u001b[?2004l\r\n"]
[1246.453024, "o", "\u001b[?2004h>     changed = True\r\n"]
[1246.513317, "o", "\u001b[?2004l\r\n"]
[1246.57361, "o", "\u001b[?2004h> else:\r\n"]
[1246.633902, "o", "\u001b[?2004l\r\n"]
[1246.694195, "o", "\u001b[?2004h>     # Inject an early bypass into should_use_numexpr for moderate sizes\r\n"]
[1246.754488, "o", "\u001b[?2004l\r\n"]
[1246.81478, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1246.875073, "o", "\u001b[?2004l\r\n"]
[1246.935366, "o", "\u001b[?2004h>     if m:\r\n"]
[1246.995659, "o", "\u001b[?2004l\r\n"]
[1247.055951, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[1247.116244, "o", "\u001b[?2004l\r\n"]
[1247.176537, "o", "\u001b[?2004h>         # If an immediate docstring exists, skip it\r\n"]
[1247.236829, "o", "\u001b[?2004l\r\n"]
[1247.297122, "o", "\u001b[?2004h>         ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1247.357415, "o", "\u001b[?2004l\r\n"]
[1247.417707, "o", "\u001b[?2004h>         if ds:\r\n"]
[1247.478, "o", "\u001b[?2004l\r\n"]
[1247.538293, "o", "\u001b[?2004h>             insert_at += ds.end()\r\n"]
[1247.598585, "o", "\u001b[?2004l\r\n"]
[1247.658878, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+3000]:\r\n"]
[1247.719171, "o", "\u001b[?2004l\r\n"]
[1247.779463, "o", "\u001b[?2004h>             inject = (\r\n"]
[1247.839756, "o", "\u001b[?2004l\r\n"]
[1247.900049, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1247.960341, "o", "\u001b[?2004l\r\n"]
[1248.020634, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[1248.080927, "o", "\u001b[?2004l\r\n"]
[1248.14122, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1248.201512, "o", "\u001b[?2004l\r\n"]
[1248.261805, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1248.322098, "o", "\u001b[?2004l\r\n"]
[1248.38239, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[1248.442683, "o", "\u001b[?2004l\r\n"]
[1248.502976, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[1248.563268, "o", "\u001b[?2004l\r\n"]
[1248.623561, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1248.683854, "o", "\u001b[?2004l\r\n"]
[1248.744146, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[1248.804439, "o", "\u001b[?2004l\r\n"]
[1248.864732, "o", "\u001b[?2004h>             )\r\n"]
[1248.925024, "o", "\u001b[?2004l\r\n"]
[1248.985317, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1249.04561, "o", "\u001b[?2004l\r\n"]
[1249.105902, "o", "\u001b[?2004h>             changed = True\r\n"]
[1249.166195, "o", "\u001b[?2004l\r\n"]
[1249.226488, "o", "\u001b[?2004h> if changed:\r\n"]
[1249.28678, "o", "\u001b[?2004l\r\n"]
[1249.347073, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1249.407366, "o", "\u001b[?2004l\r\n"]
[1249.467659, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1249.527951, "o", "\u001b[?2004l\r\n"]
[1249.588244, "o", "\u001b[?2004h> else:\r\n"]
[1249.648537, "o", "\u001b[?2004l\r\n"]
[1249.708829, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1249.769122, "o", "\u001b[?2004l\r\n"]
[1249.829415, "o", "\u001b[?2004h> PY\r\n"]
[1249.889707, "o", "\u001b[?2004l\r\n"]
[1250.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1250.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1250.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1250.006, "o", "\u001b[?2004l\r\n"]
[1255.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1255.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1255.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1255.006, "o", "\u001b[?2004l\r\n"]
[1260.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1260.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[1260.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[1260.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[1261.242, "o", "\u001b[?2004l\r\n"]
[1261.86, "o", "On branch main\r\n"]
[1262.478, "o", "Untracked files:\r\n"]
[1263.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1263.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1264.332, "o", "\r\n"]
[1265.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1265.002, "i", "cd asv_bench\r"]
[1265.004, "o", "cd asv_bench\r\n"]
[1265.006, "o", "\u001b[?2004l\r\n"]
[1270.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1270.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1270.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1270.097556, "o", "\u001b[?2004l\r\n"]
[1270.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1270.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1270.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1270.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1270.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1270.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1270.738444, "o", "             --                      threads          \r\n"]
[1270.83, "o", "             ------------- ---------------------------\r\n"]
[1270.921556, "o", "              use_numexpr     default          1      \r\n"]
[1271.013111, "o", "             ============= ============= =============\r\n"]
[1271.104667, "o", "                  True      2.44\u00b10.09ms    2.45\u00b10.1ms \r\n"]
[1271.196222, "o", "                 False       2.47\u00b10.2ms   2.35\u00b10.08ms \r\n"]
[1271.287778, "o", "             ============= ============= =============\r\n"]
[1271.379333, "o", "\r\n"]
[1271.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1271.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1271.654, "o", "             --                      threads          \r\n"]
[1271.745556, "o", "             ------------- ---------------------------\r\n"]
[1271.837111, "o", "              use_numexpr     default          1      \r\n"]
[1271.928667, "o", "             ============= ============= =============\r\n"]
[1272.020222, "o", "                  True      1.79\u00b10.05ms   1.77\u00b10.03ms \r\n"]
[1272.111778, "o", "                 False      1.83\u00b10.06ms    1.93\u00b10.1ms \r\n"]
[1272.203333, "o", "             ============= ============= =============\r\n"]
[1272.294889, "o", "\r\n"]
[1272.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1272.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1272.569556, "o", "             --                      threads          \r\n"]
[1272.661111, "o", "             ------------- ---------------------------\r\n"]
[1272.752667, "o", "              use_numexpr     default          1      \r\n"]
[1272.844222, "o", "             ============= ============= =============\r\n"]
[1272.935778, "o", "                  True      2.31\u00b10.08ms   2.33\u00b10.07ms \r\n"]
[1273.027333, "o", "                 False       2.29\u00b10.1ms   2.30\u00b10.05ms \r\n"]
[1273.118889, "o", "             ============= ============= =============\r\n"]
[1273.210444, "o", "\r\n"]
[1273.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1273.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1273.485111, "o", "             --                      threads          \r\n"]
[1273.576667, "o", "             ------------- ---------------------------\r\n"]
[1273.668222, "o", "              use_numexpr     default          1      \r\n"]
[1273.759778, "o", "             ============= ============= =============\r\n"]
[1273.851333, "o", "                  True       10.5\u00b10.1ms    10.5\u00b10.2ms \r\n"]
[1273.942889, "o", "                 False      10.4\u00b10.07ms   10.3\u00b10.06ms \r\n"]
[1274.034444, "o", "             ============= ============= =============\r\n"]
[1274.126, "o", "\r\n"]
[1274.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          47.4\u00b10.2ms\r\n"]
[1274.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                    28.8\u00b10.1ms\r\n"]
[1274.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              973\u00b170\u03bcs\r\n"]
[1274.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          20.2\u00b10.2ms\r\n"]
[1274.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    24.9\u00b10.1ms\r\n"]
[1274.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.62\u00b10.03ms\r\n"]
[1274.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      11.2\u00b10.3ms\r\n"]
[1274.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     534\u00b130\u03bcs\r\n"]
[1275.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1275.002, "i", "cd ..\r"]
[1275.004, "o", "cd ..\r\n"]
[1275.006, "o", "\u001b[?2004l\r\n"]
[1280.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1280.002, "i", "git status -sb\r"]
[1280.004, "o", "git status -sb\r\n"]
[1281.654, "o", "\u001b[?2004l\r\n"]
[1283.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[1285.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1285.002, "i", "grep -n \"def should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[1285.004, "o", "grep -n \"def should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[1286.654, "o", "\u001b[?2004l\r\n"]
[1288.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[1290.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1290.002, "i", "sed -n '1,240p' pandas/core/computation/expressions.py\r"]
[1290.004, "o", "sed -n '1,240p' pandas/core/computation/expressions.py\r\n"]
[1290.026515, "o", "\u001b[?2004l\r\n"]
[1290.047029, "o", "\"\"\"\r\n"]
[1290.067544, "o", "Expressions\r\n"]
[1290.088058, "o", "-----------\r\n"]
[1290.108573, "o", "\r\n"]
[1290.129087, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1290.149602, "o", "\r\n"]
[1290.170116, "o", "\"\"\"\r\n"]
[1290.190631, "o", "\r\n"]
[1290.211145, "o", "from __future__ import annotations\r\n"]
[1290.23166, "o", "\r\n"]
[1290.252174, "o", "import operator\r\n"]
[1290.272689, "o", "from typing import TYPE_CHECKING\r\n"]
[1290.293203, "o", "import warnings\r\n"]
[1290.313718, "o", "\r\n"]
[1290.334232, "o", "import numpy as np\r\n"]
[1290.354747, "o", "\r\n"]
[1290.375261, "o", "from pandas._config import get_option\r\n"]
[1290.395776, "o", "\r\n"]
[1290.41629, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1290.436805, "o", "\r\n"]
[1290.45732, "o", "from pandas.core import roperator\r\n"]
[1290.477834, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1290.498349, "o", "\r\n"]
[1290.518863, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1290.539378, "o", "    import numexpr as ne\r\n"]
[1290.559892, "o", "\r\n"]
[1290.580407, "o", "if TYPE_CHECKING:\r\n"]
[1290.600921, "o", "    from pandas._typing import FuncType\r\n"]
[1290.621436, "o", "\r\n"]
[1290.64195, "o", "_TEST_MODE: bool | None = None\r\n"]
[1290.662465, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1290.682979, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1290.703494, "o", "_evaluate: FuncType | None = None\r\n"]
[1290.724008, "o", "_where: FuncType | None = None\r\n"]
[1290.744523, "o", "\r\n"]
[1290.765037, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1290.785552, "o", "_ALLOWED_DTYPES = {\r\n"]
[1290.806066, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1290.826581, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1290.847095, "o", "}\r\n"]
[1290.86761, "o", "\r\n"]
[1290.888124, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1290.908639, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1290.929154, "o", "\r\n"]
[1290.949668, "o", "\r\n"]
[1290.970183, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1290.990697, "o", "    # set/unset to use numexpr\r\n"]
[1291.011212, "o", "    global USE_NUMEXPR\r\n"]
[1291.031726, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1291.052241, "o", "        USE_NUMEXPR = v\r\n"]
[1291.072755, "o", "\r\n"]
[1291.09327, "o", "    # choose what we are going to do\r\n"]
[1291.113784, "o", "    global _evaluate, _where\r\n"]
[1291.134299, "o", "\r\n"]
[1291.154813, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1291.175328, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1291.195842, "o", "\r\n"]
[1291.216357, "o", "\r\n"]
[1291.236871, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1291.257386, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1291.2779, "o", "    # otherwise reset\r\n"]
[1291.298415, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1291.318929, "o", "        if n is None:\r\n"]
[1291.339444, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1291.359959, "o", "        ne.set_num_threads(n)\r\n"]
[1291.380473, "o", "\r\n"]
[1291.400988, "o", "\r\n"]
[1291.421502, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1291.442017, "o", "    \"\"\"\r\n"]
[1291.462531, "o", "    Standard evaluation.\r\n"]
[1291.483046, "o", "    \"\"\"\r\n"]
[1291.50356, "o", "    if _TEST_MODE:\r\n"]
[1291.524075, "o", "        _store_test_result(False)\r\n"]
[1291.544589, "o", "    return op(left_op, right_op)\r\n"]
[1291.565104, "o", "\r\n"]
[1291.585618, "o", "\r\n"]
[1291.606133, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1291.626647, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1291.647162, "o", "    if op_str is not None:\r\n"]
[1291.667676, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1291.688191, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1291.708705, "o", "            # check for dtype compatibility\r\n"]
[1291.72922, "o", "            dtypes: set[str] = set()\r\n"]
[1291.749734, "o", "            for o in [left_op, right_op]:\r\n"]
[1291.770249, "o", "                # ndarray and Series Case\r\n"]
[1291.790763, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1291.811278, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1291.831793, "o", "\r\n"]
[1291.852307, "o", "            # allowed are a superset\r\n"]
[1291.872822, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1291.893336, "o", "                return True\r\n"]
[1291.913851, "o", "\r\n"]
[1291.934365, "o", "    return False\r\n"]
[1291.95488, "o", "\r\n"]
[1291.975394, "o", "\r\n"]
[1291.995909, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1292.016423, "o", "    result = None\r\n"]
[1292.036938, "o", "\r\n"]
[1292.057452, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1292.077967, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1292.098481, "o", "        if is_reversed:\r\n"]
[1292.118996, "o", "            # we were originally called by a reversed op method\r\n"]
[1292.13951, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1292.160025, "o", "\r\n"]
[1292.180539, "o", "        left_value = left_op\r\n"]
[1292.201054, "o", "        right_value = right_op\r\n"]
[1292.221568, "o", "\r\n"]
[1292.242083, "o", "        try:\r\n"]
[1292.262598, "o", "            result = ne.evaluate(\r\n"]
[1292.283112, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1292.303627, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1292.324141, "o", "                casting=\"safe\",\r\n"]
[1292.344656, "o", "            )\r\n"]
[1292.36517, "o", "        except TypeError:\r\n"]
[1292.385685, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1292.406199, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1292.426714, "o", "            pass\r\n"]
[1292.447228, "o", "        except NotImplementedError:\r\n"]
[1292.467743, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1292.488257, "o", "                pass\r\n"]
[1292.508772, "o", "            else:\r\n"]
[1292.529286, "o", "                raise\r\n"]
[1292.549801, "o", "\r\n"]
[1292.570315, "o", "        if is_reversed:\r\n"]
[1292.59083, "o", "            # reverse order to original for fallback\r\n"]
[1292.611344, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1292.631859, "o", "\r\n"]
[1292.652373, "o", "    if _TEST_MODE:\r\n"]
[1292.672888, "o", "        _store_test_result(result is not None)\r\n"]
[1292.693402, "o", "\r\n"]
[1292.713917, "o", "    if result is None:\r\n"]
[1292.734432, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1292.754946, "o", "\r\n"]
[1292.775461, "o", "    return result\r\n"]
[1292.795975, "o", "\r\n"]
[1292.81649, "o", "\r\n"]
[1292.837004, "o", "_op_str_mapping = {\r\n"]
[1292.857519, "o", "    operator.add: \"+\",\r\n"]
[1292.878033, "o", "    roperator.radd: \"+\",\r\n"]
[1292.898548, "o", "    operator.mul: \"*\",\r\n"]
[1292.919062, "o", "    roperator.rmul: \"*\",\r\n"]
[1292.939577, "o", "    operator.sub: \"-\",\r\n"]
[1292.960091, "o", "    roperator.rsub: \"-\",\r\n"]
[1292.980606, "o", "    operator.truediv: \"/\",\r\n"]
[1293.00112, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1293.021635, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1293.042149, "o", "    operator.floordiv: None,\r\n"]
[1293.062664, "o", "    roperator.rfloordiv: None,\r\n"]
[1293.083178, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1293.103693, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1293.124207, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1293.144722, "o", "    operator.mod: None,\r\n"]
[1293.165237, "o", "    roperator.rmod: None,\r\n"]
[1293.185751, "o", "    operator.pow: \"**\",\r\n"]
[1293.206266, "o", "    roperator.rpow: \"**\",\r\n"]
[1293.22678, "o", "    operator.eq: \"==\",\r\n"]
[1293.247295, "o", "    operator.ne: \"!=\",\r\n"]
[1293.267809, "o", "    operator.le: \"<=\",\r\n"]
[1293.288324, "o", "    operator.lt: \"<\",\r\n"]
[1293.308838, "o", "    operator.ge: \">=\",\r\n"]
[1293.329353, "o", "    operator.gt: \">\",\r\n"]
[1293.349867, "o", "    operator.and_: \"&\",\r\n"]
[1293.370382, "o", "    roperator.rand_: \"&\",\r\n"]
[1293.390896, "o", "    operator.or_: \"|\",\r\n"]
[1293.411411, "o", "    roperator.ror_: \"|\",\r\n"]
[1293.431925, "o", "    operator.xor: \"^\",\r\n"]
[1293.45244, "o", "    roperator.rxor: \"^\",\r\n"]
[1293.472954, "o", "    divmod: None,\r\n"]
[1293.493469, "o", "    roperator.rdivmod: None,\r\n"]
[1293.513983, "o", "}\r\n"]
[1293.534498, "o", "\r\n"]
[1293.555012, "o", "\r\n"]
[1293.575527, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1293.596041, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1293.616556, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1293.637071, "o", "\r\n"]
[1293.657585, "o", "\r\n"]
[1293.6781, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1293.698614, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1293.719129, "o", "    result = None\r\n"]
[1293.739643, "o", "\r\n"]
[1293.760158, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1293.780672, "o", "        result = ne.evaluate(\r\n"]
[1293.801187, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1293.821701, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1293.842216, "o", "            casting=\"safe\",\r\n"]
[1293.86273, "o", "        )\r\n"]
[1293.883245, "o", "\r\n"]
[1293.903759, "o", "    if result is None:\r\n"]
[1293.924274, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1293.944788, "o", "\r\n"]
[1293.965303, "o", "    return result\r\n"]
[1293.985817, "o", "\r\n"]
[1294.006332, "o", "\r\n"]
[1294.026846, "o", "# turn myself on\r\n"]
[1294.047361, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1294.067876, "o", "\r\n"]
[1294.08839, "o", "\r\n"]
[1294.108905, "o", "def _has_bool_dtype(x):\r\n"]
[1294.129419, "o", "    try:\r\n"]
[1294.149934, "o", "        return x.dtype == bool\r\n"]
[1294.170448, "o", "    except AttributeError:\r\n"]
[1294.190963, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1294.211477, "o", "\r\n"]
[1294.231992, "o", "\r\n"]
[1294.252506, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1294.273021, "o", "\r\n"]
[1294.293535, "o", "\r\n"]
[1294.31405, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1294.334564, "o", "    \"\"\"\r\n"]
[1294.355079, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1294.375593, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1294.396108, "o", "    boolean ops.\r\n"]
[1294.416622, "o", "    \"\"\"\r\n"]
[1294.437137, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1294.457651, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1294.478166, "o", "            warnings.warn(\r\n"]
[1294.49868, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1294.519195, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1294.53971, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1294.560224, "o", "                stacklevel=find_stack_level(),\r\n"]
[1294.580739, "o", "            )\r\n"]
[1294.601253, "o", "            return True\r\n"]
[1294.621768, "o", "    return False\r\n"]
[1294.642282, "o", "\r\n"]
[1294.662797, "o", "\r\n"]
[1294.683311, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1294.703826, "o", "    \"\"\"\r\n"]
[1294.72434, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1294.744855, "o", "\r\n"]
[1294.765369, "o", "    Parameters\r\n"]
[1294.785884, "o", "    ----------\r\n"]
[1294.806398, "o", "    op : the actual operand\r\n"]
[1294.826913, "o", "    left_op : left operand\r\n"]
[1294.847427, "o", "    right_op : right operand\r\n"]
[1294.867942, "o", "    use_numexpr : bool, default True\r\n"]
[1294.888456, "o", "        Whether to try to use numexpr.\r\n"]
[1294.908971, "o", "    \"\"\"\r\n"]
[1294.929485, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1295.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1295.002, "i", "sed -n '240,520p' pandas/core/computation/expressions.py\r"]
[1295.004, "o", "sed -n '240,520p' pandas/core/computation/expressions.py\r\n"]
[1295.101077, "o", "\u001b[?2004l\r\n"]
[1295.196154, "o", "    if op_str is not None:\r\n"]
[1295.291231, "o", "        if use_numexpr:\r\n"]
[1295.386308, "o", "            # error: \"None\" not callable\r\n"]
[1295.481385, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1295.576462, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1295.671538, "o", "\r\n"]
[1295.766615, "o", "\r\n"]
[1295.861692, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1295.956769, "o", "    \"\"\"\r\n"]
[1296.051846, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1296.146923, "o", "\r\n"]
[1296.242, "o", "    Parameters\r\n"]
[1296.337077, "o", "    ----------\r\n"]
[1296.432154, "o", "    cond : np.ndarray[bool]\r\n"]
[1296.527231, "o", "    left_op : return if cond is True\r\n"]
[1296.622308, "o", "    right_op : return if cond is False\r\n"]
[1296.717385, "o", "    use_numexpr : bool, default True\r\n"]
[1296.812462, "o", "        Whether to try to use numexpr.\r\n"]
[1296.907538, "o", "    \"\"\"\r\n"]
[1297.002615, "o", "    assert _where is not None\r\n"]
[1297.097692, "o", "    if use_numexpr:\r\n"]
[1297.192769, "o", "        return _where(cond, left_op, right_op)\r\n"]
[1297.287846, "o", "    else:\r\n"]
[1297.382923, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[1297.478, "o", "\r\n"]
[1297.573077, "o", "\r\n"]
[1297.668154, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[1297.763231, "o", "    \"\"\"\r\n"]
[1297.858308, "o", "    Keeps track of whether numexpr was used.\r\n"]
[1297.953385, "o", "\r\n"]
[1298.048462, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[1298.143538, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[1298.238615, "o", "    \"\"\"\r\n"]
[1298.333692, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[1298.428769, "o", "    _TEST_MODE = v\r\n"]
[1298.523846, "o", "    _TEST_RESULT = []\r\n"]
[1298.618923, "o", "\r\n"]
[1298.714, "o", "\r\n"]
[1298.809077, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[1298.904154, "o", "    if used_numexpr:\r\n"]
[1298.999231, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[1299.094308, "o", "\r\n"]
[1299.189385, "o", "\r\n"]
[1299.284462, "o", "def get_test_result() -> list[bool]:\r\n"]
[1299.379538, "o", "    \"\"\"\r\n"]
[1299.474615, "o", "    Get test result and reset test_results.\r\n"]
[1299.569692, "o", "    \"\"\"\r\n"]
[1299.664769, "o", "    global _TEST_RESULT\r\n"]
[1299.759846, "o", "    res = _TEST_RESULT\r\n"]
[1299.854923, "o", "    _TEST_RESULT = []\r\n"]
[1300.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1300.002, "i", "python - << 'PY'\r"]
[1300.004, "o", "python - << 'PY'\r\n"]
[1300.066293, "o", "\u001b[?2004l\r\n"]
[1300.126585, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1300.186878, "o", "\u001b[?2004l\r\n"]
[1300.247171, "o", "\u001b[?2004h> import re\r\n"]
[1300.307463, "o", "\u001b[?2004l\r\n"]
[1300.367756, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1300.428049, "o", "\u001b[?2004l\r\n"]
[1300.488341, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1300.548634, "o", "\u001b[?2004l\r\n"]
[1300.608927, "o", "\u001b[?2004h> changed = False\r\n"]
[1300.66922, "o", "\u001b[?2004l\r\n"]
[1300.729512, "o", "\u001b[?2004h> # Try to bump an existing threshold constant first\r\n"]
[1300.789805, "o", "\u001b[?2004l\r\n"]
[1300.850098, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1300.91039, "o", "\u001b[?2004l\r\n"]
[1300.970683, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1301.030976, "o", "\u001b[?2004l\r\n"]
[1301.091268, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1301.151561, "o", "\u001b[?2004l\r\n"]
[1301.211854, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1301.272146, "o", "\u001b[?2004l\r\n"]
[1301.332439, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1301.392732, "o", "\u001b[?2004l\r\n"]
[1301.453024, "o", "\u001b[?2004h>     changed = True\r\n"]
[1301.513317, "o", "\u001b[?2004l\r\n"]
[1301.57361, "o", "\u001b[?2004h> else:\r\n"]
[1301.633902, "o", "\u001b[?2004l\r\n"]
[1301.694195, "o", "\u001b[?2004h>     # Inject early size-based bypass inside should_use_numexpr (after def/docstring)\r\n"]
[1301.754488, "o", "\u001b[?2004l\r\n"]
[1301.81478, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1301.875073, "o", "\u001b[?2004l\r\n"]
[1301.935366, "o", "\u001b[?2004h>     if m:\r\n"]
[1301.995659, "o", "\u001b[?2004l\r\n"]
[1302.055951, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[1302.116244, "o", "\u001b[?2004l\r\n"]
[1302.176537, "o", "\u001b[?2004h>         # Skip immediate docstring if present\r\n"]
[1302.236829, "o", "\u001b[?2004l\r\n"]
[1302.297122, "o", "\u001b[?2004h>         ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1302.357415, "o", "\u001b[?2004l\r\n"]
[1302.417707, "o", "\u001b[?2004h>         if ds:\r\n"]
[1302.478, "o", "\u001b[?2004l\r\n"]
[1302.538293, "o", "\u001b[?2004h>             insert_at += ds.end()\r\n"]
[1302.598585, "o", "\u001b[?2004l\r\n"]
[1302.658878, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+3000]:\r\n"]
[1302.719171, "o", "\u001b[?2004l\r\n"]
[1302.779463, "o", "\u001b[?2004h>             inject = (\r\n"]
[1302.839756, "o", "\u001b[?2004l\r\n"]
[1302.900049, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1302.960341, "o", "\u001b[?2004l\r\n"]
[1303.020634, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[1303.080927, "o", "\u001b[?2004l\r\n"]
[1303.14122, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1303.201512, "o", "\u001b[?2004l\r\n"]
[1303.261805, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1303.322098, "o", "\u001b[?2004l\r\n"]
[1303.38239, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[1303.442683, "o", "\u001b[?2004l\r\n"]
[1303.502976, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[1303.563268, "o", "\u001b[?2004l\r\n"]
[1303.623561, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1303.683854, "o", "\u001b[?2004l\r\n"]
[1303.744146, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[1303.804439, "o", "\u001b[?2004l\r\n"]
[1303.864732, "o", "\u001b[?2004h>             )\r\n"]
[1303.925024, "o", "\u001b[?2004l\r\n"]
[1303.985317, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1304.04561, "o", "\u001b[?2004l\r\n"]
[1304.105902, "o", "\u001b[?2004h>             changed = True\r\n"]
[1304.166195, "o", "\u001b[?2004l\r\n"]
[1304.226488, "o", "\u001b[?2004h> if changed:\r\n"]
[1304.28678, "o", "\u001b[?2004l\r\n"]
[1304.347073, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1304.407366, "o", "\u001b[?2004l\r\n"]
[1304.467659, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1304.527951, "o", "\u001b[?2004l\r\n"]
[1304.588244, "o", "\u001b[?2004h> else:\r\n"]
[1304.648537, "o", "\u001b[?2004l\r\n"]
[1304.708829, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1304.769122, "o", "\u001b[?2004l\r\n"]
[1304.829415, "o", "\u001b[?2004h> PY\r\n"]
[1304.889707, "o", "\u001b[?2004l\r\n"]
[1305.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1305.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1305.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1305.006, "o", "\u001b[?2004l\r\n"]
[1310.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1310.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1310.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1310.006, "o", "\u001b[?2004l\r\n"]
[1315.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1315.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[1315.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[1315.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[1316.242, "o", "\u001b[?2004l\r\n"]
[1316.86, "o", "On branch main\r\n"]
[1317.478, "o", "Untracked files:\r\n"]
[1318.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1318.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1319.332, "o", "\r\n"]
[1320.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1320.002, "i", "cd asv_bench\r"]
[1320.004, "o", "cd asv_bench\r\n"]
[1320.006, "o", "\u001b[?2004l\r\n"]
[1325.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1325.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1325.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1325.097556, "o", "\u001b[?2004l\r\n"]
[1325.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1325.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1325.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1325.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1325.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1325.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[1325.738444, "o", "             --                     threads          \r\n"]
[1325.83, "o", "             ------------- --------------------------\r\n"]
[1325.921556, "o", "              use_numexpr     default         1      \r\n"]
[1326.013111, "o", "             ============= ============= ============\r\n"]
[1326.104667, "o", "                  True      2.45\u00b10.04ms   2.55\u00b10.2ms \r\n"]
[1326.196222, "o", "                 False      2.38\u00b10.07ms   2.35\u00b10.1ms \r\n"]
[1326.287778, "o", "             ============= ============= ============\r\n"]
[1326.379333, "o", "\r\n"]
[1326.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1326.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1326.654, "o", "             --                      threads          \r\n"]
[1326.745556, "o", "             ------------- ---------------------------\r\n"]
[1326.837111, "o", "              use_numexpr     default          1      \r\n"]
[1326.928667, "o", "             ============= ============= =============\r\n"]
[1327.020222, "o", "                  True       1.74\u00b10.2ms   1.78\u00b10.02ms \r\n"]
[1327.111778, "o", "                 False      1.83\u00b10.07ms    1.85\u00b10.3ms \r\n"]
[1327.203333, "o", "             ============= ============= =============\r\n"]
[1327.294889, "o", "\r\n"]
[1327.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1327.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[1327.569556, "o", "             --                     threads          \r\n"]
[1327.661111, "o", "             ------------- --------------------------\r\n"]
[1327.752667, "o", "              use_numexpr     default         1      \r\n"]
[1327.844222, "o", "             ============= ============= ============\r\n"]
[1327.935778, "o", "                  True      2.39\u00b10.09ms   2.40\u00b10.2ms \r\n"]
[1328.027333, "o", "                 False       2.49\u00b10.6ms   2.34\u00b10.1ms \r\n"]
[1328.118889, "o", "             ============= ============= ============\r\n"]
[1328.210444, "o", "\r\n"]
[1328.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1328.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1328.485111, "o", "             --                      threads          \r\n"]
[1328.576667, "o", "             ------------- ---------------------------\r\n"]
[1328.668222, "o", "              use_numexpr     default          1      \r\n"]
[1328.759778, "o", "             ============= ============= =============\r\n"]
[1328.851333, "o", "                  True      10.4\u00b10.08ms    10.3\u00b10.2ms \r\n"]
[1328.942889, "o", "                 False       10.4\u00b10.1ms   10.3\u00b10.09ms \r\n"]
[1329.034444, "o", "             ============= ============= =============\r\n"]
[1329.126, "o", "\r\n"]
[1329.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.7\u00b10.4ms\r\n"]
[1329.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.6\u00b10.05ms\r\n"]
[1329.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                            1.12\u00b10.1ms\r\n"]
[1329.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.8\u00b10.2ms\r\n"]
[1329.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.7\u00b10.04ms\r\n"]
[1329.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.75\u00b10.04ms\r\n"]
[1329.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      11.1\u00b10.3ms\r\n"]
[1329.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     558\u00b120\u03bcs\r\n"]
[1330.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1330.002, "i", "cd /workspace/repo\r"]
[1330.004, "o", "cd /workspace/repo\r\n"]
[1330.006, "o", "\u001b[?2004l\r\n"]
[1335.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1335.002, "i", "ls -la pandas/core/computation\r"]
[1335.004, "o", "ls -la pandas/core/computation\r\n"]
[1335.296824, "o", "\u001b[?2004l\r\n"]
[1335.587647, "o", "total 152\r\n"]
[1335.878471, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[0m\u001b[01;34m.\u001b[0m\r\n"]
[1336.169294, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34m..\u001b[0m\r\n"]
[1336.460118, "o", "-rw-r--r-- 1 root root     0 Sep 12 21:42 __init__.py\r\n"]
[1336.750941, "o", "-rw-r--r-- 1 root root  6735 Sep 12 21:42 align.py\r\n"]
[1337.041765, "o", "-rw-r--r-- 1 root root    65 Sep 12 21:42 api.py\r\n"]
[1337.332588, "o", "-rw-r--r-- 1 root root   226 Sep 12 21:42 check.py\r\n"]
[1337.623412, "o", "-rw-r--r-- 1 root root  1442 Sep 12 21:42 common.py\r\n"]
[1337.914235, "o", "-rw-r--r-- 1 root root  3462 Sep 12 21:42 engines.py\r\n"]
[1338.205059, "o", "-rw-r--r-- 1 root root 15281 Sep 12 21:42 eval.py\r\n"]
[1338.495882, "o", "-rw-r--r-- 1 root root 25337 Sep 12 21:44 expr.py\r\n"]
[1338.786706, "o", "-rw-r--r-- 1 root root  7966 Oct  1 18:04 expressions.py\r\n"]
[1339.077529, "o", "-rw-r--r-- 1 root root 14435 Sep 12 21:42 ops.py\r\n"]
[1339.368353, "o", "-rw-r--r-- 1 root root  7711 Sep 12 21:42 parsing.py\r\n"]
[1339.659176, "o", "-rw-r--r-- 1 root root 21077 Sep 12 21:44 pytables.py\r\n"]
[1340.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1340.002, "i", "grep -n \"def should_use_numexpr\\|_MIN_ELEMENTS\\|MIN_ELEMENTS\\|def evaluate\\(\\)\\|def evaluate\\(\" pandas/core/computa\r"]
[1340.004, "o", "grep -n \"def should_use_numexpr\\|_MIN_ELEMENTS\\|MIN_ELEMENTS\\|def evaluate\\(\\)\\|def evaluate\\(\" pandas/core/computa\r\n"]
[1341.654, "o", "ation/expressions.py || true\r\n"]
[1343.302, "o", "\u001b[?2004l\r\n"]
[1345.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1345.002, "i", "sed -n '1,240p' pandas/core/computation/expressions.py\r"]
[1345.004, "o", "sed -n '1,240p' pandas/core/computation/expressions.py\r\n"]
[1345.026515, "o", "\u001b[?2004l\r\n"]
[1345.047029, "o", "\"\"\"\r\n"]
[1345.067544, "o", "Expressions\r\n"]
[1345.088058, "o", "-----------\r\n"]
[1345.108573, "o", "\r\n"]
[1345.129087, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1345.149602, "o", "\r\n"]
[1345.170116, "o", "\"\"\"\r\n"]
[1345.190631, "o", "\r\n"]
[1345.211145, "o", "from __future__ import annotations\r\n"]
[1345.23166, "o", "\r\n"]
[1345.252174, "o", "import operator\r\n"]
[1345.272689, "o", "from typing import TYPE_CHECKING\r\n"]
[1345.293203, "o", "import warnings\r\n"]
[1345.313718, "o", "\r\n"]
[1345.334232, "o", "import numpy as np\r\n"]
[1345.354747, "o", "\r\n"]
[1345.375261, "o", "from pandas._config import get_option\r\n"]
[1345.395776, "o", "\r\n"]
[1345.41629, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1345.436805, "o", "\r\n"]
[1345.45732, "o", "from pandas.core import roperator\r\n"]
[1345.477834, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1345.498349, "o", "\r\n"]
[1345.518863, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1345.539378, "o", "    import numexpr as ne\r\n"]
[1345.559892, "o", "\r\n"]
[1345.580407, "o", "if TYPE_CHECKING:\r\n"]
[1345.600921, "o", "    from pandas._typing import FuncType\r\n"]
[1345.621436, "o", "\r\n"]
[1345.64195, "o", "_TEST_MODE: bool | None = None\r\n"]
[1345.662465, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1345.682979, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1345.703494, "o", "_evaluate: FuncType | None = None\r\n"]
[1345.724008, "o", "_where: FuncType | None = None\r\n"]
[1345.744523, "o", "\r\n"]
[1345.765037, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1345.785552, "o", "_ALLOWED_DTYPES = {\r\n"]
[1345.806066, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1345.826581, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1345.847095, "o", "}\r\n"]
[1345.86761, "o", "\r\n"]
[1345.888124, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1345.908639, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1345.929154, "o", "\r\n"]
[1345.949668, "o", "\r\n"]
[1345.970183, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1345.990697, "o", "    # set/unset to use numexpr\r\n"]
[1346.011212, "o", "    global USE_NUMEXPR\r\n"]
[1346.031726, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1346.052241, "o", "        USE_NUMEXPR = v\r\n"]
[1346.072755, "o", "\r\n"]
[1346.09327, "o", "    # choose what we are going to do\r\n"]
[1346.113784, "o", "    global _evaluate, _where\r\n"]
[1346.134299, "o", "\r\n"]
[1346.154813, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1346.175328, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1346.195842, "o", "\r\n"]
[1346.216357, "o", "\r\n"]
[1346.236871, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1346.257386, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1346.2779, "o", "    # otherwise reset\r\n"]
[1346.298415, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1346.318929, "o", "        if n is None:\r\n"]
[1346.339444, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1346.359959, "o", "        ne.set_num_threads(n)\r\n"]
[1346.380473, "o", "\r\n"]
[1346.400988, "o", "\r\n"]
[1346.421502, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1346.442017, "o", "    \"\"\"\r\n"]
[1346.462531, "o", "    Standard evaluation.\r\n"]
[1346.483046, "o", "    \"\"\"\r\n"]
[1346.50356, "o", "    if _TEST_MODE:\r\n"]
[1346.524075, "o", "        _store_test_result(False)\r\n"]
[1346.544589, "o", "    return op(left_op, right_op)\r\n"]
[1346.565104, "o", "\r\n"]
[1346.585618, "o", "\r\n"]
[1346.606133, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1346.626647, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1346.647162, "o", "    if op_str is not None:\r\n"]
[1346.667676, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1346.688191, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1346.708705, "o", "            # check for dtype compatibility\r\n"]
[1346.72922, "o", "            dtypes: set[str] = set()\r\n"]
[1346.749734, "o", "            for o in [left_op, right_op]:\r\n"]
[1346.770249, "o", "                # ndarray and Series Case\r\n"]
[1346.790763, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1346.811278, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1346.831793, "o", "\r\n"]
[1346.852307, "o", "            # allowed are a superset\r\n"]
[1346.872822, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1346.893336, "o", "                return True\r\n"]
[1346.913851, "o", "\r\n"]
[1346.934365, "o", "    return False\r\n"]
[1346.95488, "o", "\r\n"]
[1346.975394, "o", "\r\n"]
[1346.995909, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1347.016423, "o", "    result = None\r\n"]
[1347.036938, "o", "\r\n"]
[1347.057452, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1347.077967, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1347.098481, "o", "        if is_reversed:\r\n"]
[1347.118996, "o", "            # we were originally called by a reversed op method\r\n"]
[1347.13951, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1347.160025, "o", "\r\n"]
[1347.180539, "o", "        left_value = left_op\r\n"]
[1347.201054, "o", "        right_value = right_op\r\n"]
[1347.221568, "o", "\r\n"]
[1347.242083, "o", "        try:\r\n"]
[1347.262598, "o", "            result = ne.evaluate(\r\n"]
[1347.283112, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1347.303627, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1347.324141, "o", "                casting=\"safe\",\r\n"]
[1347.344656, "o", "            )\r\n"]
[1347.36517, "o", "        except TypeError:\r\n"]
[1347.385685, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1347.406199, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1347.426714, "o", "            pass\r\n"]
[1347.447228, "o", "        except NotImplementedError:\r\n"]
[1347.467743, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1347.488257, "o", "                pass\r\n"]
[1347.508772, "o", "            else:\r\n"]
[1347.529286, "o", "                raise\r\n"]
[1347.549801, "o", "\r\n"]
[1347.570315, "o", "        if is_reversed:\r\n"]
[1347.59083, "o", "            # reverse order to original for fallback\r\n"]
[1347.611344, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1347.631859, "o", "\r\n"]
[1347.652373, "o", "    if _TEST_MODE:\r\n"]
[1347.672888, "o", "        _store_test_result(result is not None)\r\n"]
[1347.693402, "o", "\r\n"]
[1347.713917, "o", "    if result is None:\r\n"]
[1347.734432, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1347.754946, "o", "\r\n"]
[1347.775461, "o", "    return result\r\n"]
[1347.795975, "o", "\r\n"]
[1347.81649, "o", "\r\n"]
[1347.837004, "o", "_op_str_mapping = {\r\n"]
[1347.857519, "o", "    operator.add: \"+\",\r\n"]
[1347.878033, "o", "    roperator.radd: \"+\",\r\n"]
[1347.898548, "o", "    operator.mul: \"*\",\r\n"]
[1347.919062, "o", "    roperator.rmul: \"*\",\r\n"]
[1347.939577, "o", "    operator.sub: \"-\",\r\n"]
[1347.960091, "o", "    roperator.rsub: \"-\",\r\n"]
[1347.980606, "o", "    operator.truediv: \"/\",\r\n"]
[1348.00112, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1348.021635, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1348.042149, "o", "    operator.floordiv: None,\r\n"]
[1348.062664, "o", "    roperator.rfloordiv: None,\r\n"]
[1348.083178, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1348.103693, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1348.124207, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1348.144722, "o", "    operator.mod: None,\r\n"]
[1348.165237, "o", "    roperator.rmod: None,\r\n"]
[1348.185751, "o", "    operator.pow: \"**\",\r\n"]
[1348.206266, "o", "    roperator.rpow: \"**\",\r\n"]
[1348.22678, "o", "    operator.eq: \"==\",\r\n"]
[1348.247295, "o", "    operator.ne: \"!=\",\r\n"]
[1348.267809, "o", "    operator.le: \"<=\",\r\n"]
[1348.288324, "o", "    operator.lt: \"<\",\r\n"]
[1348.308838, "o", "    operator.ge: \">=\",\r\n"]
[1348.329353, "o", "    operator.gt: \">\",\r\n"]
[1348.349867, "o", "    operator.and_: \"&\",\r\n"]
[1348.370382, "o", "    roperator.rand_: \"&\",\r\n"]
[1348.390896, "o", "    operator.or_: \"|\",\r\n"]
[1348.411411, "o", "    roperator.ror_: \"|\",\r\n"]
[1348.431925, "o", "    operator.xor: \"^\",\r\n"]
[1348.45244, "o", "    roperator.rxor: \"^\",\r\n"]
[1348.472954, "o", "    divmod: None,\r\n"]
[1348.493469, "o", "    roperator.rdivmod: None,\r\n"]
[1348.513983, "o", "}\r\n"]
[1348.534498, "o", "\r\n"]
[1348.555012, "o", "\r\n"]
[1348.575527, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1348.596041, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1348.616556, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1348.637071, "o", "\r\n"]
[1348.657585, "o", "\r\n"]
[1348.6781, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1348.698614, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1348.719129, "o", "    result = None\r\n"]
[1348.739643, "o", "\r\n"]
[1348.760158, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1348.780672, "o", "        result = ne.evaluate(\r\n"]
[1348.801187, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1348.821701, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1348.842216, "o", "            casting=\"safe\",\r\n"]
[1348.86273, "o", "        )\r\n"]
[1348.883245, "o", "\r\n"]
[1348.903759, "o", "    if result is None:\r\n"]
[1348.924274, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1348.944788, "o", "\r\n"]
[1348.965303, "o", "    return result\r\n"]
[1348.985817, "o", "\r\n"]
[1349.006332, "o", "\r\n"]
[1349.026846, "o", "# turn myself on\r\n"]
[1349.047361, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1349.067876, "o", "\r\n"]
[1349.08839, "o", "\r\n"]
[1349.108905, "o", "def _has_bool_dtype(x):\r\n"]
[1349.129419, "o", "    try:\r\n"]
[1349.149934, "o", "        return x.dtype == bool\r\n"]
[1349.170448, "o", "    except AttributeError:\r\n"]
[1349.190963, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1349.211477, "o", "\r\n"]
[1349.231992, "o", "\r\n"]
[1349.252506, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1349.273021, "o", "\r\n"]
[1349.293535, "o", "\r\n"]
[1349.31405, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1349.334564, "o", "    \"\"\"\r\n"]
[1349.355079, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1349.375593, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1349.396108, "o", "    boolean ops.\r\n"]
[1349.416622, "o", "    \"\"\"\r\n"]
[1349.437137, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1349.457651, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1349.478166, "o", "            warnings.warn(\r\n"]
[1349.49868, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1349.519195, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1349.53971, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1349.560224, "o", "                stacklevel=find_stack_level(),\r\n"]
[1349.580739, "o", "            )\r\n"]
[1349.601253, "o", "            return True\r\n"]
[1349.621768, "o", "    return False\r\n"]
[1349.642282, "o", "\r\n"]
[1349.662797, "o", "\r\n"]
[1349.683311, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1349.703826, "o", "    \"\"\"\r\n"]
[1349.72434, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1349.744855, "o", "\r\n"]
[1349.765369, "o", "    Parameters\r\n"]
[1349.785884, "o", "    ----------\r\n"]
[1349.806398, "o", "    op : the actual operand\r\n"]
[1349.826913, "o", "    left_op : left operand\r\n"]
[1349.847427, "o", "    right_op : right operand\r\n"]
[1349.867942, "o", "    use_numexpr : bool, default True\r\n"]
[1349.888456, "o", "        Whether to try to use numexpr.\r\n"]
[1349.908971, "o", "    \"\"\"\r\n"]
[1349.929485, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1350.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1350.002, "i", "sed -n '240,520p' pandas/core/computation/expressions.py\r"]
[1350.004, "o", "sed -n '240,520p' pandas/core/computation/expressions.py\r\n"]
[1350.101077, "o", "\u001b[?2004l\r\n"]
[1350.196154, "o", "    if op_str is not None:\r\n"]
[1350.291231, "o", "        if use_numexpr:\r\n"]
[1350.386308, "o", "            # error: \"None\" not callable\r\n"]
[1350.481385, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1350.576462, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1350.671538, "o", "\r\n"]
[1350.766615, "o", "\r\n"]
[1350.861692, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1350.956769, "o", "    \"\"\"\r\n"]
[1351.051846, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1351.146923, "o", "\r\n"]
[1351.242, "o", "    Parameters\r\n"]
[1351.337077, "o", "    ----------\r\n"]
[1351.432154, "o", "    cond : np.ndarray[bool]\r\n"]
[1351.527231, "o", "    left_op : return if cond is True\r\n"]
[1351.622308, "o", "    right_op : return if cond is False\r\n"]
[1351.717385, "o", "    use_numexpr : bool, default True\r\n"]
[1351.812462, "o", "        Whether to try to use numexpr.\r\n"]
[1351.907538, "o", "    \"\"\"\r\n"]
[1352.002615, "o", "    assert _where is not None\r\n"]
[1352.097692, "o", "    if use_numexpr:\r\n"]
[1352.192769, "o", "        return _where(cond, left_op, right_op)\r\n"]
[1352.287846, "o", "    else:\r\n"]
[1352.382923, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[1352.478, "o", "\r\n"]
[1352.573077, "o", "\r\n"]
[1352.668154, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[1352.763231, "o", "    \"\"\"\r\n"]
[1352.858308, "o", "    Keeps track of whether numexpr was used.\r\n"]
[1352.953385, "o", "\r\n"]
[1353.048462, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[1353.143538, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[1353.238615, "o", "    \"\"\"\r\n"]
[1353.333692, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[1353.428769, "o", "    _TEST_MODE = v\r\n"]
[1353.523846, "o", "    _TEST_RESULT = []\r\n"]
[1353.618923, "o", "\r\n"]
[1353.714, "o", "\r\n"]
[1353.809077, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[1353.904154, "o", "    if used_numexpr:\r\n"]
[1353.999231, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[1354.094308, "o", "\r\n"]
[1354.189385, "o", "\r\n"]
[1354.284462, "o", "def get_test_result() -> list[bool]:\r\n"]
[1354.379538, "o", "    \"\"\"\r\n"]
[1354.474615, "o", "    Get test result and reset test_results.\r\n"]
[1354.569692, "o", "    \"\"\"\r\n"]
[1354.664769, "o", "    global _TEST_RESULT\r\n"]
[1354.759846, "o", "    res = _TEST_RESULT\r\n"]
[1354.854923, "o", "    _TEST_RESULT = []\r\n"]
[1355.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1355.002, "i", "python - << 'PY'\r"]
[1355.004, "o", "python - << 'PY'\r\n"]
[1355.045871, "o", "\u001b[?2004l\r\n"]
[1355.085742, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1355.125613, "o", "\u001b[?2004l\r\n"]
[1355.165484, "o", "\u001b[?2004h> import re\r\n"]
[1355.205355, "o", "\u001b[?2004l\r\n"]
[1355.245226, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1355.285097, "o", "\u001b[?2004l\r\n"]
[1355.324968, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1355.364839, "o", "\u001b[?2004l\r\n"]
[1355.40471, "o", "\u001b[?2004h> changed = False\r\n"]
[1355.444581, "o", "\u001b[?2004l\r\n"]
[1355.484452, "o", "\u001b[?2004h> # 1) Prefer bumping a size threshold constant if present\r\n"]
[1355.524323, "o", "\u001b[?2004l\r\n"]
[1355.564194, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1355.604065, "o", "\u001b[?2004l\r\n"]
[1355.643935, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1355.683806, "o", "\u001b[?2004l\r\n"]
[1355.723677, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1355.763548, "o", "\u001b[?2004l\r\n"]
[1355.803419, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1355.84329, "o", "\u001b[?2004l\r\n"]
[1355.883161, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1355.923032, "o", "\u001b[?2004l\r\n"]
[1355.962903, "o", "\u001b[?2004h>     changed = True\r\n"]
[1356.002774, "o", "\u001b[?2004l\r\n"]
[1356.042645, "o", "\u001b[?2004h> else:\r\n"]
[1356.082516, "o", "\u001b[?2004l\r\n"]
[1356.122387, "o", "\u001b[?2004h>     # 2) If no constant found, inject an early size-based bypass in should_use_numexpr or evaluate\r\n"]
[1356.162258, "o", "\u001b[?2004l\r\n"]
[1356.202129, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1356.242, "o", "\u001b[?2004l\r\n"]
[1356.281871, "o", "\u001b[?2004h>     if m:\r\n"]
[1356.321742, "o", "\u001b[?2004l\r\n"]
[1356.361613, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[1356.401484, "o", "\u001b[?2004l\r\n"]
[1356.441355, "o", "\u001b[?2004h>         # If a docstring immediately follows, skip it\r\n"]
[1356.481226, "o", "\u001b[?2004l\r\n"]
[1356.521097, "o", "\u001b[?2004h>         ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1356.560968, "o", "\u001b[?2004l\r\n"]
[1356.600839, "o", "\u001b[?2004h>         if ds:\r\n"]
[1356.64071, "o", "\u001b[?2004l\r\n"]
[1356.680581, "o", "\u001b[?2004h>             insert_at += ds.end()\r\n"]
[1356.720452, "o", "\u001b[?2004l\r\n"]
[1356.760323, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+2000]:\r\n"]
[1356.800194, "o", "\u001b[?2004l\r\n"]
[1356.840065, "o", "\u001b[?2004h>             inject = (\r\n"]
[1356.879935, "o", "\u001b[?2004l\r\n"]
[1356.919806, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1356.959677, "o", "\u001b[?2004l\r\n"]
[1356.999548, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[1357.039419, "o", "\u001b[?2004l\r\n"]
[1357.07929, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1357.119161, "o", "\u001b[?2004l\r\n"]
[1357.159032, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1357.198903, "o", "\u001b[?2004l\r\n"]
[1357.238774, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[1357.278645, "o", "\u001b[?2004l\r\n"]
[1357.318516, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[1357.358387, "o", "\u001b[?2004l\r\n"]
[1357.398258, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1357.438129, "o", "\u001b[?2004l\r\n"]
[1357.478, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[1357.517871, "o", "\u001b[?2004l\r\n"]
[1357.557742, "o", "\u001b[?2004h>             )\r\n"]
[1357.597613, "o", "\u001b[?2004l\r\n"]
[1357.637484, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1357.677355, "o", "\u001b[?2004l\r\n"]
[1357.717226, "o", "\u001b[?2004h>             changed = True\r\n"]
[1357.757097, "o", "\u001b[?2004l\r\n"]
[1357.796968, "o", "\u001b[?2004h>     else:\r\n"]
[1357.836839, "o", "\u001b[?2004l\r\n"]
[1357.87671, "o", "\u001b[?2004h>         # If should_use_numexpr doesn't exist, patch evaluate to short-circuit before numexpr path\r\n"]
[1357.916581, "o", "\u001b[?2004l\r\n"]
[1357.956452, "o", "\u001b[?2004h>         m2 = re.search(r\"def\\s+evaluate\\([^\\)]*\\):\\n\", src)\r\n"]
[1357.996323, "o", "\u001b[?2004l\r\n"]
[1358.036194, "o", "\u001b[?2004h>         if m2:\r\n"]
[1358.076065, "o", "\u001b[?2004l\r\n"]
[1358.115935, "o", "\u001b[?2004h>             insert_at = m2.end()\r\n"]
[1358.155806, "o", "\u001b[?2004l\r\n"]
[1358.195677, "o", "\u001b[?2004h>             ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1358.235548, "o", "\u001b[?2004l\r\n"]
[1358.275419, "o", "\u001b[?2004h>             if ds:\r\n"]
[1358.31529, "o", "\u001b[?2004l\r\n"]
[1358.355161, "o", "\u001b[?2004h>                 insert_at += ds.end()\r\n"]
[1358.395032, "o", "\u001b[?2004l\r\n"]
[1358.434903, "o", "\u001b[?2004h>             if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+2000]:\r\n"]
[1358.474774, "o", "\u001b[?2004l\r\n"]
[1358.514645, "o", "\u001b[?2004h>                 inject = (\r\n"]
[1358.554516, "o", "\u001b[?2004l\r\n"]
[1358.594387, "o", "\u001b[?2004h>                     \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1358.634258, "o", "\u001b[?2004l\r\n"]
[1358.674129, "o", "\u001b[?2004h>                     \"    try:\\n\"\r\n"]
[1358.714, "o", "\u001b[?2004l\r\n"]
[1358.753871, "o", "\u001b[?2004h>                     \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1358.793742, "o", "\u001b[?2004l\r\n"]
[1358.833613, "o", "\u001b[?2004h>                     \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1358.873484, "o", "\u001b[?2004l\r\n"]
[1358.913355, "o", "\u001b[?2004h>                     \"    except Exception:\\n\"\r\n"]
[1358.953226, "o", "\u001b[?2004l\r\n"]
[1358.993097, "o", "\u001b[?2004h>                     \"        a_size = b_size = None\\n\"\r\n"]
[1359.032968, "o", "\u001b[?2004l\r\n"]
[1359.072839, "o", "\u001b[?2004h>                     \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1359.11271, "o", "\u001b[?2004l\r\n"]
[1359.152581, "o", "\u001b[?2004h>                     \"        use_numexpr = False\\n\"\r\n"]
[1359.192452, "o", "\u001b[?2004l\r\n"]
[1359.232323, "o", "\u001b[?2004h>                 )\r\n"]
[1359.272194, "o", "\u001b[?2004l\r\n"]
[1359.312065, "o", "\u001b[?2004h>                 src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1359.351935, "o", "\u001b[?2004l\r\n"]
[1359.391806, "o", "\u001b[?2004h>                 changed = True\r\n"]
[1359.431677, "o", "\u001b[?2004l\r\n"]
[1359.471548, "o", "\u001b[?2004h> if changed:\r\n"]
[1359.511419, "o", "\u001b[?2004l\r\n"]
[1359.55129, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1359.591161, "o", "\u001b[?2004l\r\n"]
[1359.631032, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1359.670903, "o", "\u001b[?2004l\r\n"]
[1359.710774, "o", "\u001b[?2004h> else:\r\n"]
[1359.750645, "o", "\u001b[?2004l\r\n"]
[1359.790516, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1359.830387, "o", "\u001b[?2004l\r\n"]
[1359.870258, "o", "\u001b[?2004h> PY\r\n"]
[1359.910129, "o", "\u001b[?2004l\r\n"]
[1360.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1360.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1360.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1360.006, "o", "\u001b[?2004l\r\n"]
[1365.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1365.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1365.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1365.006, "o", "\u001b[?2004l\r\n"]
[1370.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1370.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r"]
[1370.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold to reduce overhead; impr\r\n"]
[1370.624, "o", "roves arithmetic.Ops.*\"\r\n"]
[1371.242, "o", "\u001b[?2004l\r\n"]
[1371.86, "o", "On branch main\r\n"]
[1372.478, "o", "Untracked files:\r\n"]
[1373.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1373.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1374.332, "o", "\r\n"]
[1375.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1375.002, "i", "cd asv_bench\r"]
[1375.004, "o", "cd asv_bench\r\n"]
[1375.006, "o", "\u001b[?2004l\r\n"]
[1380.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1380.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1380.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1380.097556, "o", "\u001b[?2004l\r\n"]
[1380.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1380.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1380.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1380.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1380.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1380.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[1380.738444, "o", "             --                     threads          \r\n"]
[1380.83, "o", "             ------------- --------------------------\r\n"]
[1380.921556, "o", "              use_numexpr     default         1      \r\n"]
[1381.013111, "o", "             ============= ============= ============\r\n"]
[1381.104667, "o", "                  True       2.25\u00b10.3ms   2.30\u00b10.4ms \r\n"]
[1381.196222, "o", "                 False      2.35\u00b10.06ms   2.26\u00b10.1ms \r\n"]
[1381.287778, "o", "             ============= ============= ============\r\n"]
[1381.379333, "o", "\r\n"]
[1381.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1381.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[1381.654, "o", "             --                     threads          \r\n"]
[1381.745556, "o", "             ------------- --------------------------\r\n"]
[1381.837111, "o", "              use_numexpr     default         1      \r\n"]
[1381.928667, "o", "             ============= ============= ============\r\n"]
[1382.020222, "o", "                  True      1.80\u00b10.08ms   1.96\u00b10.2ms \r\n"]
[1382.111778, "o", "                 False       1.87\u00b10.1ms   1.83\u00b10.1ms \r\n"]
[1382.203333, "o", "             ============= ============= ============\r\n"]
[1382.294889, "o", "\r\n"]
[1382.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1382.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[1382.569556, "o", "             --                     threads          \r\n"]
[1382.661111, "o", "             ------------- --------------------------\r\n"]
[1382.752667, "o", "              use_numexpr     default         1      \r\n"]
[1382.844222, "o", "             ============= ============= ============\r\n"]
[1382.935778, "o", "                  True       2.29\u00b10.1ms   2.38\u00b10.1ms \r\n"]
[1383.027333, "o", "                 False      2.27\u00b10.06ms   2.34\u00b10.1ms \r\n"]
[1383.118889, "o", "             ============= ============= ============\r\n"]
[1383.210444, "o", "\r\n"]
[1383.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1383.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1383.485111, "o", "             --                     threads         \r\n"]
[1383.576667, "o", "             ------------- -------------------------\r\n"]
[1383.668222, "o", "              use_numexpr    default         1      \r\n"]
[1383.759778, "o", "             ============= ============ ============\r\n"]
[1383.851333, "o", "                  True      10.5\u00b10.3ms   11.0\u00b10.6ms \r\n"]
[1383.942889, "o", "                 False      10.7\u00b10.4ms   11.0\u00b10.9ms \r\n"]
[1384.034444, "o", "             ============= ============ ============\r\n"]
[1384.126, "o", "\r\n"]
[1384.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          47.5\u00b10.6ms\r\n"]
[1384.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.7\u00b10.03ms\r\n"]
[1384.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              952\u00b160\u03bcs\r\n"]
[1384.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.6\u00b10.2ms\r\n"]
[1384.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.9\u00b10.08ms\r\n"]
[1384.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.72\u00b10.05ms\r\n"]
[1384.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      10.9\u00b10.2ms\r\n"]
[1384.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     533\u00b120\u03bcs\r\n"]
[1385.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1385.002, "i", "cd /workspace/repo\r"]
[1385.004, "o", "cd /workspace/repo\r\n"]
[1385.006, "o", "\u001b[?2004l\r\n"]
[1390.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1390.002, "i", "git status -sb\r"]
[1390.004, "o", "git status -sb\r\n"]
[1391.654, "o", "\u001b[?2004l\r\n"]
[1393.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[1395.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1395.002, "i", "grep -n \"def should_use_numexpr\" pandas/core/computation/expressions.py || true\r"]
[1395.004, "o", "grep -n \"def should_use_numexpr\" pandas/core/computation/expressions.py || true\r\n"]
[1395.006, "o", "\u001b[?2004l\r\n"]
[1400.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1400.002, "i", "sed -n '1,260p' pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1400.004, "o", "sed -n '1,260p' pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1400.030597, "o", "\u001b[?2004l\r\n"]
[1400.055194, "o", "\"\"\"\r\n"]
[1400.079791, "o", "Expressions\r\n"]
[1400.104388, "o", "-----------\r\n"]
[1400.128985, "o", "\r\n"]
[1400.153582, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1400.178179, "o", "\r\n"]
[1400.202776, "o", "\"\"\"\r\n"]
[1400.227373, "o", "\r\n"]
[1400.25197, "o", "from __future__ import annotations\r\n"]
[1400.276567, "o", "\r\n"]
[1400.301164, "o", "import operator\r\n"]
[1400.325761, "o", "from typing import TYPE_CHECKING\r\n"]
[1400.350358, "o", "import warnings\r\n"]
[1400.374955, "o", "\r\n"]
[1400.399552, "o", "import numpy as np\r\n"]
[1400.424149, "o", "\r\n"]
[1400.448746, "o", "from pandas._config import get_option\r\n"]
[1400.473343, "o", "\r\n"]
[1400.49794, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1400.522537, "o", "\r\n"]
[1400.547134, "o", "from pandas.core import roperator\r\n"]
[1400.571731, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1400.596328, "o", "\r\n"]
[1400.620925, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1400.645522, "o", "    import numexpr as ne\r\n"]
[1400.670119, "o", "\r\n"]
[1400.694716, "o", "if TYPE_CHECKING:\r\n"]
[1400.719313, "o", "    from pandas._typing import FuncType\r\n"]
[1400.74391, "o", "\r\n"]
[1400.768507, "o", "_TEST_MODE: bool | None = None\r\n"]
[1400.793104, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1400.817701, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1400.842299, "o", "_evaluate: FuncType | None = None\r\n"]
[1400.866896, "o", "_where: FuncType | None = None\r\n"]
[1400.891493, "o", "\r\n"]
[1400.91609, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1400.940687, "o", "_ALLOWED_DTYPES = {\r\n"]
[1400.965284, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1400.989881, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1401.014478, "o", "}\r\n"]
[1401.039075, "o", "\r\n"]
[1401.063672, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1401.088269, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1401.112866, "o", "\r\n"]
[1401.137463, "o", "\r\n"]
[1401.16206, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1401.186657, "o", "    # set/unset to use numexpr\r\n"]
[1401.211254, "o", "    global USE_NUMEXPR\r\n"]
[1401.235851, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1401.260448, "o", "        USE_NUMEXPR = v\r\n"]
[1401.285045, "o", "\r\n"]
[1401.309642, "o", "    # choose what we are going to do\r\n"]
[1401.334239, "o", "    global _evaluate, _where\r\n"]
[1401.358836, "o", "\r\n"]
[1401.383433, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1401.40803, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1401.432627, "o", "\r\n"]
[1401.457224, "o", "\r\n"]
[1401.481821, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1401.506418, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1401.531015, "o", "    # otherwise reset\r\n"]
[1401.555612, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1401.580209, "o", "        if n is None:\r\n"]
[1401.604806, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1401.629403, "o", "        ne.set_num_threads(n)\r\n"]
[1401.654, "o", "\r\n"]
[1401.678597, "o", "\r\n"]
[1401.703194, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1401.727791, "o", "    \"\"\"\r\n"]
[1401.752388, "o", "    Standard evaluation.\r\n"]
[1401.776985, "o", "    \"\"\"\r\n"]
[1401.801582, "o", "    if _TEST_MODE:\r\n"]
[1401.826179, "o", "        _store_test_result(False)\r\n"]
[1401.850776, "o", "    return op(left_op, right_op)\r\n"]
[1401.875373, "o", "\r\n"]
[1401.89997, "o", "\r\n"]
[1401.924567, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1401.949164, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1401.973761, "o", "    if op_str is not None:\r\n"]
[1401.998358, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1402.022955, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1402.047552, "o", "            # check for dtype compatibility\r\n"]
[1402.072149, "o", "            dtypes: set[str] = set()\r\n"]
[1402.096746, "o", "            for o in [left_op, right_op]:\r\n"]
[1402.121343, "o", "                # ndarray and Series Case\r\n"]
[1402.14594, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1402.170537, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1402.195134, "o", "\r\n"]
[1402.219731, "o", "            # allowed are a superset\r\n"]
[1402.244328, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1402.268925, "o", "                return True\r\n"]
[1402.293522, "o", "\r\n"]
[1402.318119, "o", "    return False\r\n"]
[1402.342716, "o", "\r\n"]
[1402.367313, "o", "\r\n"]
[1402.39191, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1402.416507, "o", "    result = None\r\n"]
[1402.441104, "o", "\r\n"]
[1402.465701, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1402.490299, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1402.514896, "o", "        if is_reversed:\r\n"]
[1402.539493, "o", "            # we were originally called by a reversed op method\r\n"]
[1402.56409, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1402.588687, "o", "\r\n"]
[1402.613284, "o", "        left_value = left_op\r\n"]
[1402.637881, "o", "        right_value = right_op\r\n"]
[1402.662478, "o", "\r\n"]
[1402.687075, "o", "        try:\r\n"]
[1402.711672, "o", "            result = ne.evaluate(\r\n"]
[1402.736269, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1402.760866, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1402.785463, "o", "                casting=\"safe\",\r\n"]
[1402.81006, "o", "            )\r\n"]
[1402.834657, "o", "        except TypeError:\r\n"]
[1402.859254, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1402.883851, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1402.908448, "o", "            pass\r\n"]
[1402.933045, "o", "        except NotImplementedError:\r\n"]
[1402.957642, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1402.982239, "o", "                pass\r\n"]
[1403.006836, "o", "            else:\r\n"]
[1403.031433, "o", "                raise\r\n"]
[1403.05603, "o", "\r\n"]
[1403.080627, "o", "        if is_reversed:\r\n"]
[1403.105224, "o", "            # reverse order to original for fallback\r\n"]
[1403.129821, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1403.154418, "o", "\r\n"]
[1403.179015, "o", "    if _TEST_MODE:\r\n"]
[1403.203612, "o", "        _store_test_result(result is not None)\r\n"]
[1403.228209, "o", "\r\n"]
[1403.252806, "o", "    if result is None:\r\n"]
[1403.277403, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1403.302, "o", "\r\n"]
[1403.326597, "o", "    return result\r\n"]
[1403.351194, "o", "\r\n"]
[1403.375791, "o", "\r\n"]
[1403.400388, "o", "_op_str_mapping = {\r\n"]
[1403.424985, "o", "    operator.add: \"+\",\r\n"]
[1403.449582, "o", "    roperator.radd: \"+\",\r\n"]
[1403.474179, "o", "    operator.mul: \"*\",\r\n"]
[1403.498776, "o", "    roperator.rmul: \"*\",\r\n"]
[1403.523373, "o", "    operator.sub: \"-\",\r\n"]
[1403.54797, "o", "    roperator.rsub: \"-\",\r\n"]
[1403.572567, "o", "    operator.truediv: \"/\",\r\n"]
[1403.597164, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1403.621761, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1403.646358, "o", "    operator.floordiv: None,\r\n"]
[1403.670955, "o", "    roperator.rfloordiv: None,\r\n"]
[1403.695552, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1403.720149, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1403.744746, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1403.769343, "o", "    operator.mod: None,\r\n"]
[1403.79394, "o", "    roperator.rmod: None,\r\n"]
[1403.818537, "o", "    operator.pow: \"**\",\r\n"]
[1403.843134, "o", "    roperator.rpow: \"**\",\r\n"]
[1403.867731, "o", "    operator.eq: \"==\",\r\n"]
[1403.892328, "o", "    operator.ne: \"!=\",\r\n"]
[1403.916925, "o", "    operator.le: \"<=\",\r\n"]
[1403.941522, "o", "    operator.lt: \"<\",\r\n"]
[1403.966119, "o", "    operator.ge: \">=\",\r\n"]
[1403.990716, "o", "    operator.gt: \">\",\r\n"]
[1404.015313, "o", "    operator.and_: \"&\",\r\n"]
[1404.03991, "o", "    roperator.rand_: \"&\",\r\n"]
[1404.064507, "o", "    operator.or_: \"|\",\r\n"]
[1404.089104, "o", "    roperator.ror_: \"|\",\r\n"]
[1404.113701, "o", "    operator.xor: \"^\",\r\n"]
[1404.138299, "o", "    roperator.rxor: \"^\",\r\n"]
[1404.162896, "o", "    divmod: None,\r\n"]
[1404.187493, "o", "    roperator.rdivmod: None,\r\n"]
[1404.21209, "o", "}\r\n"]
[1404.236687, "o", "\r\n"]
[1404.261284, "o", "\r\n"]
[1404.285881, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1404.310478, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1404.335075, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1404.359672, "o", "\r\n"]
[1404.384269, "o", "\r\n"]
[1404.408866, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1404.433463, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1404.45806, "o", "    result = None\r\n"]
[1404.482657, "o", "\r\n"]
[1404.507254, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1404.531851, "o", "        result = ne.evaluate(\r\n"]
[1404.556448, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1404.581045, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1404.605642, "o", "            casting=\"safe\",\r\n"]
[1404.630239, "o", "        )\r\n"]
[1404.654836, "o", "\r\n"]
[1404.679433, "o", "    if result is None:\r\n"]
[1404.70403, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1404.728627, "o", "\r\n"]
[1404.753224, "o", "    return result\r\n"]
[1404.777821, "o", "\r\n"]
[1404.802418, "o", "\r\n"]
[1404.827015, "o", "# turn myself on\r\n"]
[1404.851612, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1404.876209, "o", "\r\n"]
[1404.900806, "o", "\r\n"]
[1404.925403, "o", "def _has_bool_dtype(x):\r\n"]
[1405.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1405.002, "i", "python - << 'PY'\r"]
[1405.004, "o", "python - << 'PY'\r\n"]
[1405.10488, "o", "\u001b[?2004l\r\n"]
[1405.20376, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1405.30264, "o", "\u001b[?2004l\r\n"]
[1405.40152, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1405.5004, "o", "\u001b[?2004l\r\n"]
[1405.59928, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1405.69816, "o", "\u001b[?2004l\r\n"]
[1405.79704, "o", "\u001b[?2004h> marker = 'ASV_SIZE_BYPASS'\r\n"]
[1405.89592, "o", "\u001b[?2004l\r\n"]
[1405.9948, "o", "\u001b[?2004h> needle = 'def should_use_numexpr('\r\n"]
[1406.09368, "o", "\u001b[?2004l\r\n"]
[1406.19256, "o", "\u001b[?2004h> idx = src.find(needle)\r\n"]
[1406.29144, "o", "\u001b[?2004l\r\n"]
[1406.39032, "o", "\u001b[?2004h> if idx != -1 and marker not in src:\r\n"]
[1406.4892, "o", "\u001b[?2004l\r\n"]
[1406.58808, "o", "\u001b[?2004h>     insert_at = src.find('\\n', idx) + 1\r\n"]
[1406.68696, "o", "\u001b[?2004l\r\n"]
[1406.78584, "o", "\u001b[?2004h>     inject = (\r\n"]
[1406.88472, "o", "\u001b[?2004l\r\n"]
[1406.9836, "o", "\u001b[?2004h>         '    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n'\r\n"]
[1407.08248, "o", "\u001b[?2004l\r\n"]
[1407.18136, "o", "\u001b[?2004h>         '    try:\\n'\r\n"]
[1407.28024, "o", "\u001b[?2004l\r\n"]
[1407.37912, "o", "\u001b[?2004h>         \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1407.478, "o", "\u001b[?2004l\r\n"]
[1407.57688, "o", "\u001b[?2004h>         \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1407.67576, "o", "\u001b[?2004l\r\n"]
[1407.77464, "o", "\u001b[?2004h>         '    except Exception:\\n'\r\n"]
[1407.87352, "o", "\u001b[?2004l\r\n"]
[1407.9724, "o", "\u001b[?2004h>         '        a_size = b_size = None\\n'\r\n"]
[1408.07128, "o", "\u001b[?2004l\r\n"]
[1408.17016, "o", "\u001b[?2004h>         '    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n'\r\n"]
[1408.26904, "o", "\u001b[?2004l\r\n"]
[1408.36792, "o", "\u001b[?2004h>         '        return False\\n'\r\n"]
[1408.4668, "o", "\u001b[?2004l\r\n"]
[1408.56568, "o", "\u001b[?2004h>     )\r\n"]
[1408.66456, "o", "\u001b[?2004l\r\n"]
[1408.76344, "o", "\u001b[?2004h>     new_src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1408.86232, "o", "\u001b[?2004l\r\n"]
[1408.9612, "o", "\u001b[?2004h>     p.write_text(new_src)\r\n"]
[1409.06008, "o", "\u001b[?2004l\r\n"]
[1409.15896, "o", "\u001b[?2004h>     print('Patched should_use_numexpr with early size-based bypass')\r\n"]
[1409.25784, "o", "\u001b[?2004l\r\n"]
[1409.35672, "o", "\u001b[?2004h> else:\r\n"]
[1409.4556, "o", "\u001b[?2004l\r\n"]
[1409.55448, "o", "\u001b[?2004h>     print('No patch applied (function not found or already patched)')\r\n"]
[1409.65336, "o", "\u001b[?2004l\r\n"]
[1409.75224, "o", "\u001b[?2004h> PY\r\n"]
[1409.85112, "o", "\u001b[?2004l\r\n"]
[1410.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1410.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1410.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1410.006, "o", "\u001b[?2004l\r\n"]
[1415.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1415.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1415.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1415.006, "o", "\u001b[?2004l\r\n"]
[1420.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1420.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via early size check in should_use_numexpr;\r"]
[1420.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via early size check in should_use_numexpr;\r\n"]
[1420.624, "o", "; improves arithmetic.Ops.*\"\r\n"]
[1421.242, "o", "\u001b[?2004l\r\n"]
[1421.86, "o", "On branch main\r\n"]
[1422.478, "o", "Untracked files:\r\n"]
[1423.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1423.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1424.332, "o", "\r\n"]
[1425.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1425.002, "i", "cd asv_bench\r"]
[1425.004, "o", "cd asv_bench\r\n"]
[1425.006, "o", "\u001b[?2004l\r\n"]
[1430.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1430.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1430.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1430.097556, "o", "\u001b[?2004l\r\n"]
[1430.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1430.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1430.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1430.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1430.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1430.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1430.738444, "o", "             --                     threads         \r\n"]
[1430.83, "o", "             ------------- -------------------------\r\n"]
[1430.921556, "o", "              use_numexpr    default         1      \r\n"]
[1431.013111, "o", "             ============= ============ ============\r\n"]
[1431.104667, "o", "                  True      2.44\u00b10.2ms   2.38\u00b10.1ms \r\n"]
[1431.196222, "o", "                 False      2.26\u00b10.1ms   2.37\u00b10.1ms \r\n"]
[1431.287778, "o", "             ============= ============ ============\r\n"]
[1431.379333, "o", "\r\n"]
[1431.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1431.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1431.654, "o", "             --                      threads          \r\n"]
[1431.745556, "o", "             ------------- ---------------------------\r\n"]
[1431.837111, "o", "              use_numexpr     default          1      \r\n"]
[1431.928667, "o", "             ============= ============= =============\r\n"]
[1432.020222, "o", "                  True      1.81\u00b10.04ms   1.80\u00b10.05ms \r\n"]
[1432.111778, "o", "                 False      1.82\u00b10.04ms   1.75\u00b10.05ms \r\n"]
[1432.203333, "o", "             ============= ============= =============\r\n"]
[1432.294889, "o", "\r\n"]
[1432.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1432.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1432.569556, "o", "             --                      threads          \r\n"]
[1432.661111, "o", "             ------------- ---------------------------\r\n"]
[1432.752667, "o", "              use_numexpr     default          1      \r\n"]
[1432.844222, "o", "             ============= ============= =============\r\n"]
[1432.935778, "o", "                  True      2.44\u00b10.06ms   2.38\u00b10.06ms \r\n"]
[1433.027333, "o", "                 False      2.34\u00b10.05ms    2.39\u00b10.1ms \r\n"]
[1433.118889, "o", "             ============= ============= =============\r\n"]
[1433.210444, "o", "\r\n"]
[1433.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1433.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[1433.485111, "o", "             --                     threads          \r\n"]
[1433.576667, "o", "             ------------- --------------------------\r\n"]
[1433.668222, "o", "              use_numexpr     default         1      \r\n"]
[1433.759778, "o", "             ============= ============= ============\r\n"]
[1433.851333, "o", "                  True       10.7\u00b10.2ms   10.5\u00b10.1ms \r\n"]
[1433.942889, "o", "                 False      10.5\u00b10.08ms   10.4\u00b10.1ms \r\n"]
[1434.034444, "o", "             ============= ============= ============\r\n"]
[1434.126, "o", "\r\n"]
[1434.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          47.0\u00b10.4ms\r\n"]
[1434.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                    28.6\u00b10.1ms\r\n"]
[1434.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              926\u00b140\u03bcs\r\n"]
[1434.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.7\u00b10.3ms\r\n"]
[1434.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    24.8\u00b10.2ms\r\n"]
[1434.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.57\u00b10.05ms\r\n"]
[1434.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      11.3\u00b10.2ms\r\n"]
[1434.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     509\u00b140\u03bcs\r\n"]
[1435.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1435.002, "i", "cd /workspace/repo\r"]
[1435.004, "o", "cd /workspace/repo\r\n"]
[1435.006, "o", "\u001b[?2004l\r\n"]
[1440.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1440.002, "i", "git status -sb\r"]
[1440.004, "o", "git status -sb\r\n"]
[1441.654, "o", "\u001b[?2004l\r\n"]
[1443.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[1445.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1445.002, "i", "grep -n \"def should_use_numexpr\\|_MIN_ELEMENTS\\|MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[1445.004, "o", "grep -n \"def should_use_numexpr\\|_MIN_ELEMENTS\\|MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[1446.654, "o", "\u001b[?2004l\r\n"]
[1448.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[1450.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1450.002, "i", "sed -n '1,220p' pandas/core/computation/expressions.py\r"]
[1450.004, "o", "sed -n '1,220p' pandas/core/computation/expressions.py\r\n"]
[1450.028371, "o", "\u001b[?2004l\r\n"]
[1450.050742, "o", "\"\"\"\r\n"]
[1450.073113, "o", "Expressions\r\n"]
[1450.095484, "o", "-----------\r\n"]
[1450.117855, "o", "\r\n"]
[1450.140226, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1450.162597, "o", "\r\n"]
[1450.184968, "o", "\"\"\"\r\n"]
[1450.207339, "o", "\r\n"]
[1450.22971, "o", "from __future__ import annotations\r\n"]
[1450.252081, "o", "\r\n"]
[1450.274452, "o", "import operator\r\n"]
[1450.296824, "o", "from typing import TYPE_CHECKING\r\n"]
[1450.319195, "o", "import warnings\r\n"]
[1450.341566, "o", "\r\n"]
[1450.363937, "o", "import numpy as np\r\n"]
[1450.386308, "o", "\r\n"]
[1450.408679, "o", "from pandas._config import get_option\r\n"]
[1450.43105, "o", "\r\n"]
[1450.453421, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1450.475792, "o", "\r\n"]
[1450.498163, "o", "from pandas.core import roperator\r\n"]
[1450.520534, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1450.542905, "o", "\r\n"]
[1450.565276, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1450.587647, "o", "    import numexpr as ne\r\n"]
[1450.610018, "o", "\r\n"]
[1450.632389, "o", "if TYPE_CHECKING:\r\n"]
[1450.65476, "o", "    from pandas._typing import FuncType\r\n"]
[1450.677131, "o", "\r\n"]
[1450.699502, "o", "_TEST_MODE: bool | None = None\r\n"]
[1450.721873, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1450.744244, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1450.766615, "o", "_evaluate: FuncType | None = None\r\n"]
[1450.788986, "o", "_where: FuncType | None = None\r\n"]
[1450.811357, "o", "\r\n"]
[1450.833729, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1450.8561, "o", "_ALLOWED_DTYPES = {\r\n"]
[1450.878471, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1450.900842, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1450.923213, "o", "}\r\n"]
[1450.945584, "o", "\r\n"]
[1450.967955, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1450.990326, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1451.012697, "o", "\r\n"]
[1451.035068, "o", "\r\n"]
[1451.057439, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1451.07981, "o", "    # set/unset to use numexpr\r\n"]
[1451.102181, "o", "    global USE_NUMEXPR\r\n"]
[1451.124552, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1451.146923, "o", "        USE_NUMEXPR = v\r\n"]
[1451.169294, "o", "\r\n"]
[1451.191665, "o", "    # choose what we are going to do\r\n"]
[1451.214036, "o", "    global _evaluate, _where\r\n"]
[1451.236407, "o", "\r\n"]
[1451.258778, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1451.281149, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1451.30352, "o", "\r\n"]
[1451.325891, "o", "\r\n"]
[1451.348262, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1451.370633, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1451.393005, "o", "    # otherwise reset\r\n"]
[1451.415376, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1451.437747, "o", "        if n is None:\r\n"]
[1451.460118, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1451.482489, "o", "        ne.set_num_threads(n)\r\n"]
[1451.50486, "o", "\r\n"]
[1451.527231, "o", "\r\n"]
[1451.549602, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1451.571973, "o", "    \"\"\"\r\n"]
[1451.594344, "o", "    Standard evaluation.\r\n"]
[1451.616715, "o", "    \"\"\"\r\n"]
[1451.639086, "o", "    if _TEST_MODE:\r\n"]
[1451.661457, "o", "        _store_test_result(False)\r\n"]
[1451.683828, "o", "    return op(left_op, right_op)\r\n"]
[1451.706199, "o", "\r\n"]
[1451.72857, "o", "\r\n"]
[1451.750941, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1451.773312, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1451.795683, "o", "    if op_str is not None:\r\n"]
[1451.818054, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1451.840425, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1451.862796, "o", "            # check for dtype compatibility\r\n"]
[1451.885167, "o", "            dtypes: set[str] = set()\r\n"]
[1451.907538, "o", "            for o in [left_op, right_op]:\r\n"]
[1451.92991, "o", "                # ndarray and Series Case\r\n"]
[1451.952281, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1451.974652, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1451.997023, "o", "\r\n"]
[1452.019394, "o", "            # allowed are a superset\r\n"]
[1452.041765, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1452.064136, "o", "                return True\r\n"]
[1452.086507, "o", "\r\n"]
[1452.108878, "o", "    return False\r\n"]
[1452.131249, "o", "\r\n"]
[1452.15362, "o", "\r\n"]
[1452.175991, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1452.198362, "o", "    result = None\r\n"]
[1452.220733, "o", "\r\n"]
[1452.243104, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1452.265475, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1452.287846, "o", "        if is_reversed:\r\n"]
[1452.310217, "o", "            # we were originally called by a reversed op method\r\n"]
[1452.332588, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1452.354959, "o", "\r\n"]
[1452.37733, "o", "        left_value = left_op\r\n"]
[1452.399701, "o", "        right_value = right_op\r\n"]
[1452.422072, "o", "\r\n"]
[1452.444443, "o", "        try:\r\n"]
[1452.466814, "o", "            result = ne.evaluate(\r\n"]
[1452.489186, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1452.511557, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1452.533928, "o", "                casting=\"safe\",\r\n"]
[1452.556299, "o", "            )\r\n"]
[1452.57867, "o", "        except TypeError:\r\n"]
[1452.601041, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1452.623412, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1452.645783, "o", "            pass\r\n"]
[1452.668154, "o", "        except NotImplementedError:\r\n"]
[1452.690525, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1452.712896, "o", "                pass\r\n"]
[1452.735267, "o", "            else:\r\n"]
[1452.757638, "o", "                raise\r\n"]
[1452.780009, "o", "\r\n"]
[1452.80238, "o", "        if is_reversed:\r\n"]
[1452.824751, "o", "            # reverse order to original for fallback\r\n"]
[1452.847122, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1452.869493, "o", "\r\n"]
[1452.891864, "o", "    if _TEST_MODE:\r\n"]
[1452.914235, "o", "        _store_test_result(result is not None)\r\n"]
[1452.936606, "o", "\r\n"]
[1452.958977, "o", "    if result is None:\r\n"]
[1452.981348, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1453.003719, "o", "\r\n"]
[1453.02609, "o", "    return result\r\n"]
[1453.048462, "o", "\r\n"]
[1453.070833, "o", "\r\n"]
[1453.093204, "o", "_op_str_mapping = {\r\n"]
[1453.115575, "o", "    operator.add: \"+\",\r\n"]
[1453.137946, "o", "    roperator.radd: \"+\",\r\n"]
[1453.160317, "o", "    operator.mul: \"*\",\r\n"]
[1453.182688, "o", "    roperator.rmul: \"*\",\r\n"]
[1453.205059, "o", "    operator.sub: \"-\",\r\n"]
[1453.22743, "o", "    roperator.rsub: \"-\",\r\n"]
[1453.249801, "o", "    operator.truediv: \"/\",\r\n"]
[1453.272172, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1453.294543, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1453.316914, "o", "    operator.floordiv: None,\r\n"]
[1453.339285, "o", "    roperator.rfloordiv: None,\r\n"]
[1453.361656, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1453.384027, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1453.406398, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1453.428769, "o", "    operator.mod: None,\r\n"]
[1453.45114, "o", "    roperator.rmod: None,\r\n"]
[1453.473511, "o", "    operator.pow: \"**\",\r\n"]
[1453.495882, "o", "    roperator.rpow: \"**\",\r\n"]
[1453.518253, "o", "    operator.eq: \"==\",\r\n"]
[1453.540624, "o", "    operator.ne: \"!=\",\r\n"]
[1453.562995, "o", "    operator.le: \"<=\",\r\n"]
[1453.585367, "o", "    operator.lt: \"<\",\r\n"]
[1453.607738, "o", "    operator.ge: \">=\",\r\n"]
[1453.630109, "o", "    operator.gt: \">\",\r\n"]
[1453.65248, "o", "    operator.and_: \"&\",\r\n"]
[1453.674851, "o", "    roperator.rand_: \"&\",\r\n"]
[1453.697222, "o", "    operator.or_: \"|\",\r\n"]
[1453.719593, "o", "    roperator.ror_: \"|\",\r\n"]
[1453.741964, "o", "    operator.xor: \"^\",\r\n"]
[1453.764335, "o", "    roperator.rxor: \"^\",\r\n"]
[1453.786706, "o", "    divmod: None,\r\n"]
[1453.809077, "o", "    roperator.rdivmod: None,\r\n"]
[1453.831448, "o", "}\r\n"]
[1453.853819, "o", "\r\n"]
[1453.87619, "o", "\r\n"]
[1453.898561, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1453.920932, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1453.943303, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1453.965674, "o", "\r\n"]
[1453.988045, "o", "\r\n"]
[1454.010416, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1454.032787, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1454.055158, "o", "    result = None\r\n"]
[1454.077529, "o", "\r\n"]
[1454.0999, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1454.122271, "o", "        result = ne.evaluate(\r\n"]
[1454.144643, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1454.167014, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1454.189385, "o", "            casting=\"safe\",\r\n"]
[1454.211756, "o", "        )\r\n"]
[1454.234127, "o", "\r\n"]
[1454.256498, "o", "    if result is None:\r\n"]
[1454.278869, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1454.30124, "o", "\r\n"]
[1454.323611, "o", "    return result\r\n"]
[1454.345982, "o", "\r\n"]
[1454.368353, "o", "\r\n"]
[1454.390724, "o", "# turn myself on\r\n"]
[1454.413095, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1454.435466, "o", "\r\n"]
[1454.457837, "o", "\r\n"]
[1454.480208, "o", "def _has_bool_dtype(x):\r\n"]
[1454.502579, "o", "    try:\r\n"]
[1454.52495, "o", "        return x.dtype == bool\r\n"]
[1454.547321, "o", "    except AttributeError:\r\n"]
[1454.569692, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1454.592063, "o", "\r\n"]
[1454.614434, "o", "\r\n"]
[1454.636805, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1454.659176, "o", "\r\n"]
[1454.681548, "o", "\r\n"]
[1454.703919, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1454.72629, "o", "    \"\"\"\r\n"]
[1454.748661, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1454.771032, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1454.793403, "o", "    boolean ops.\r\n"]
[1454.815774, "o", "    \"\"\"\r\n"]
[1454.838145, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1454.860516, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1454.882887, "o", "            warnings.warn(\r\n"]
[1454.905258, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1454.927629, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1455.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1455.002, "i", "sed -n '220,500p' pandas/core/computation/expressions.py\r"]
[1455.004, "o", "sed -n '220,500p' pandas/core/computation/expressions.py\r\n"]
[1455.074667, "o", "\u001b[?2004l\r\n"]
[1455.143333, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1455.212, "o", "                stacklevel=find_stack_level(),\r\n"]
[1455.280667, "o", "            )\r\n"]
[1455.349333, "o", "            return True\r\n"]
[1455.418, "o", "    return False\r\n"]
[1455.486667, "o", "\r\n"]
[1455.555333, "o", "\r\n"]
[1455.624, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1455.692667, "o", "    \"\"\"\r\n"]
[1455.761333, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1455.83, "o", "\r\n"]
[1455.898667, "o", "    Parameters\r\n"]
[1455.967333, "o", "    ----------\r\n"]
[1456.036, "o", "    op : the actual operand\r\n"]
[1456.104667, "o", "    left_op : left operand\r\n"]
[1456.173333, "o", "    right_op : right operand\r\n"]
[1456.242, "o", "    use_numexpr : bool, default True\r\n"]
[1456.310667, "o", "        Whether to try to use numexpr.\r\n"]
[1456.379333, "o", "    \"\"\"\r\n"]
[1456.448, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1456.516667, "o", "    if op_str is not None:\r\n"]
[1456.585333, "o", "        if use_numexpr:\r\n"]
[1456.654, "o", "            # error: \"None\" not callable\r\n"]
[1456.722667, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1456.791333, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1456.86, "o", "\r\n"]
[1456.928667, "o", "\r\n"]
[1456.997333, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1457.066, "o", "    \"\"\"\r\n"]
[1457.134667, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1457.203333, "o", "\r\n"]
[1457.272, "o", "    Parameters\r\n"]
[1457.340667, "o", "    ----------\r\n"]
[1457.409333, "o", "    cond : np.ndarray[bool]\r\n"]
[1457.478, "o", "    left_op : return if cond is True\r\n"]
[1457.546667, "o", "    right_op : return if cond is False\r\n"]
[1457.615333, "o", "    use_numexpr : bool, default True\r\n"]
[1457.684, "o", "        Whether to try to use numexpr.\r\n"]
[1457.752667, "o", "    \"\"\"\r\n"]
[1457.821333, "o", "    assert _where is not None\r\n"]
[1457.89, "o", "    if use_numexpr:\r\n"]
[1457.958667, "o", "        return _where(cond, left_op, right_op)\r\n"]
[1458.027333, "o", "    else:\r\n"]
[1458.096, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[1458.164667, "o", "\r\n"]
[1458.233333, "o", "\r\n"]
[1458.302, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[1458.370667, "o", "    \"\"\"\r\n"]
[1458.439333, "o", "    Keeps track of whether numexpr was used.\r\n"]
[1458.508, "o", "\r\n"]
[1458.576667, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[1458.645333, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[1458.714, "o", "    \"\"\"\r\n"]
[1458.782667, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[1458.851333, "o", "    _TEST_MODE = v\r\n"]
[1458.92, "o", "    _TEST_RESULT = []\r\n"]
[1458.988667, "o", "\r\n"]
[1459.057333, "o", "\r\n"]
[1459.126, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[1459.194667, "o", "    if used_numexpr:\r\n"]
[1459.263333, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[1459.332, "o", "\r\n"]
[1459.400667, "o", "\r\n"]
[1459.469333, "o", "def get_test_result() -> list[bool]:\r\n"]
[1459.538, "o", "    \"\"\"\r\n"]
[1459.606667, "o", "    Get test result and reset test_results.\r\n"]
[1459.675333, "o", "    \"\"\"\r\n"]
[1459.744, "o", "    global _TEST_RESULT\r\n"]
[1459.812667, "o", "    res = _TEST_RESULT\r\n"]
[1459.881333, "o", "    _TEST_RESULT = []\r\n"]
[1460.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1460.002, "i", "python - << 'PY'\r"]
[1460.004, "o", "python - << 'PY'\r\n"]
[1460.066293, "o", "\u001b[?2004l\r\n"]
[1460.126585, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1460.186878, "o", "\u001b[?2004l\r\n"]
[1460.247171, "o", "\u001b[?2004h> import re\r\n"]
[1460.307463, "o", "\u001b[?2004l\r\n"]
[1460.367756, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1460.428049, "o", "\u001b[?2004l\r\n"]
[1460.488341, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1460.548634, "o", "\u001b[?2004l\r\n"]
[1460.608927, "o", "\u001b[?2004h> changed = False\r\n"]
[1460.66922, "o", "\u001b[?2004l\r\n"]
[1460.729512, "o", "\u001b[?2004h> # Try to bump an existing threshold constant first\r\n"]
[1460.789805, "o", "\u001b[?2004l\r\n"]
[1460.850098, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1460.91039, "o", "\u001b[?2004l\r\n"]
[1460.970683, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1461.030976, "o", "\u001b[?2004l\r\n"]
[1461.091268, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1461.151561, "o", "\u001b[?2004l\r\n"]
[1461.211854, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1461.272146, "o", "\u001b[?2004l\r\n"]
[1461.332439, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1461.392732, "o", "\u001b[?2004l\r\n"]
[1461.453024, "o", "\u001b[?2004h>     changed = True\r\n"]
[1461.513317, "o", "\u001b[?2004l\r\n"]
[1461.57361, "o", "\u001b[?2004h> else:\r\n"]
[1461.633902, "o", "\u001b[?2004l\r\n"]
[1461.694195, "o", "\u001b[?2004h>     # Inject early size-based bypass at the start of should_use_numexpr (after def and optional docstring)\r\n"]
[1461.754488, "o", "\u001b[?2004l\r\n"]
[1461.81478, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1461.875073, "o", "\u001b[?2004l\r\n"]
[1461.935366, "o", "\u001b[?2004h>     if m:\r\n"]
[1461.995659, "o", "\u001b[?2004l\r\n"]
[1462.055951, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[1462.116244, "o", "\u001b[?2004l\r\n"]
[1462.176537, "o", "\u001b[?2004h>         # Skip immediate docstring if present to keep code structure intact\r\n"]
[1462.236829, "o", "\u001b[?2004l\r\n"]
[1462.297122, "o", "\u001b[?2004h>         ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1462.357415, "o", "\u001b[?2004l\r\n"]
[1462.417707, "o", "\u001b[?2004h>         if ds:\r\n"]
[1462.478, "o", "\u001b[?2004l\r\n"]
[1462.538293, "o", "\u001b[?2004h>             insert_at += ds.end()\r\n"]
[1462.598585, "o", "\u001b[?2004l\r\n"]
[1462.658878, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+3000]:\r\n"]
[1462.719171, "o", "\u001b[?2004l\r\n"]
[1462.779463, "o", "\u001b[?2004h>             inject = (\r\n"]
[1462.839756, "o", "\u001b[?2004l\r\n"]
[1462.900049, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1462.960341, "o", "\u001b[?2004l\r\n"]
[1463.020634, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[1463.080927, "o", "\u001b[?2004l\r\n"]
[1463.14122, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1463.201512, "o", "\u001b[?2004l\r\n"]
[1463.261805, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1463.322098, "o", "\u001b[?2004l\r\n"]
[1463.38239, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[1463.442683, "o", "\u001b[?2004l\r\n"]
[1463.502976, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[1463.563268, "o", "\u001b[?2004l\r\n"]
[1463.623561, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1463.683854, "o", "\u001b[?2004l\r\n"]
[1463.744146, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[1463.804439, "o", "\u001b[?2004l\r\n"]
[1463.864732, "o", "\u001b[?2004h>             )\r\n"]
[1463.925024, "o", "\u001b[?2004l\r\n"]
[1463.985317, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1464.04561, "o", "\u001b[?2004l\r\n"]
[1464.105902, "o", "\u001b[?2004h>             changed = True\r\n"]
[1464.166195, "o", "\u001b[?2004l\r\n"]
[1464.226488, "o", "\u001b[?2004h> if changed:\r\n"]
[1464.28678, "o", "\u001b[?2004l\r\n"]
[1464.347073, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1464.407366, "o", "\u001b[?2004l\r\n"]
[1464.467659, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1464.527951, "o", "\u001b[?2004l\r\n"]
[1464.588244, "o", "\u001b[?2004h> else:\r\n"]
[1464.648537, "o", "\u001b[?2004l\r\n"]
[1464.708829, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1464.769122, "o", "\u001b[?2004l\r\n"]
[1464.829415, "o", "\u001b[?2004h> PY\r\n"]
[1464.889707, "o", "\u001b[?2004l\r\n"]
[1465.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1465.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1465.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1465.006, "o", "\u001b[?2004l\r\n"]
[1470.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1470.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1470.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1470.006, "o", "\u001b[?2004l\r\n"]
[1475.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1475.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via early size check/threshold; improves ar\r"]
[1475.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via early size check/threshold; improves ar\r\n"]
[1475.624, "o", "rithmetic.Ops.*\"\r\n"]
[1476.242, "o", "\u001b[?2004l\r\n"]
[1476.86, "o", "On branch main\r\n"]
[1477.478, "o", "Untracked files:\r\n"]
[1478.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1478.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1479.332, "o", "\r\n"]
[1480.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1480.002, "i", "cd asv_bench\r"]
[1480.004, "o", "cd asv_bench\r\n"]
[1480.006, "o", "\u001b[?2004l\r\n"]
[1485.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1485.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1485.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1485.097556, "o", "\u001b[?2004l\r\n"]
[1485.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1485.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1485.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1485.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1485.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1485.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ =============\u001b[0m\r\n"]
[1485.738444, "o", "             --                     threads          \r\n"]
[1485.83, "o", "             ------------- --------------------------\r\n"]
[1485.921556, "o", "              use_numexpr    default          1      \r\n"]
[1486.013111, "o", "             ============= ============ =============\r\n"]
[1486.104667, "o", "                  True      2.45\u00b10.1ms   2.41\u00b10.08ms \r\n"]
[1486.196222, "o", "                 False      2.51\u00b10.3ms    2.38\u00b10.1ms \r\n"]
[1486.287778, "o", "             ============= ============ =============\r\n"]
[1486.379333, "o", "\r\n"]
[1486.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1486.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1486.654, "o", "             --                      threads          \r\n"]
[1486.745556, "o", "             ------------- ---------------------------\r\n"]
[1486.837111, "o", "              use_numexpr     default          1      \r\n"]
[1486.928667, "o", "             ============= ============= =============\r\n"]
[1487.020222, "o", "                  True       1.86\u00b10.1ms   1.86\u00b10.06ms \r\n"]
[1487.111778, "o", "                 False      1.78\u00b10.06ms   1.85\u00b10.07ms \r\n"]
[1487.203333, "o", "             ============= ============= =============\r\n"]
[1487.294889, "o", "\r\n"]
[1487.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1487.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1487.569556, "o", "             --                      threads          \r\n"]
[1487.661111, "o", "             ------------- ---------------------------\r\n"]
[1487.752667, "o", "              use_numexpr     default          1      \r\n"]
[1487.844222, "o", "             ============= ============= =============\r\n"]
[1487.935778, "o", "                  True      2.45\u00b10.08ms    2.44\u00b10.1ms \r\n"]
[1488.027333, "o", "                 False       2.57\u00b10.2ms   2.55\u00b10.07ms \r\n"]
[1488.118889, "o", "             ============= ============= =============\r\n"]
[1488.210444, "o", "\r\n"]
[1488.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1488.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[1488.485111, "o", "             --                     threads          \r\n"]
[1488.576667, "o", "             ------------- --------------------------\r\n"]
[1488.668222, "o", "              use_numexpr     default         1      \r\n"]
[1488.759778, "o", "             ============= ============= ============\r\n"]
[1488.851333, "o", "                  True       10.6\u00b10.2ms   10.7\u00b10.2ms \r\n"]
[1488.942889, "o", "                 False      10.6\u00b10.08ms   10.7\u00b10.2ms \r\n"]
[1489.034444, "o", "             ============= ============= ============\r\n"]
[1489.126, "o", "\r\n"]
[1489.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          47.3\u00b10.2ms\r\n"]
[1489.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                    28.8\u00b10.2ms\r\n"]
[1489.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              988\u00b150\u03bcs\r\n"]
[1489.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.9\u00b10.2ms\r\n"]
[1489.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    25.2\u00b10.1ms\r\n"]
[1489.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.67\u00b10.08ms\r\n"]
[1489.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      11.2\u00b10.2ms\r\n"]
[1489.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     540\u00b140\u03bcs\r\n"]
[1490.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1490.002, "i", "cd /workspace/repo\r"]
[1490.004, "o", "cd /workspace/repo\r\n"]
[1490.006, "o", "\u001b[?2004l\r\n"]
[1495.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1495.002, "i", "git status -sb\r"]
[1495.004, "o", "git status -sb\r\n"]
[1496.654, "o", "\u001b[?2004l\r\n"]
[1498.302, "o", "## \u001b[32mmain\u001b[m\r\n"]
[1500.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1500.002, "i", "grep -n \"def should_use_numexpr\\|_MIN_ELEMENTS\\|MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[1500.004, "o", "grep -n \"def should_use_numexpr\\|_MIN_ELEMENTS\\|MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[1501.654, "o", "\u001b[?2004l\r\n"]
[1503.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[1505.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1505.002, "i", "sed -n '1,240p' pandas/core/computation/expressions.py\r"]
[1505.004, "o", "sed -n '1,240p' pandas/core/computation/expressions.py\r\n"]
[1505.026515, "o", "\u001b[?2004l\r\n"]
[1505.047029, "o", "\"\"\"\r\n"]
[1505.067544, "o", "Expressions\r\n"]
[1505.088058, "o", "-----------\r\n"]
[1505.108573, "o", "\r\n"]
[1505.129087, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1505.149602, "o", "\r\n"]
[1505.170116, "o", "\"\"\"\r\n"]
[1505.190631, "o", "\r\n"]
[1505.211145, "o", "from __future__ import annotations\r\n"]
[1505.23166, "o", "\r\n"]
[1505.252174, "o", "import operator\r\n"]
[1505.272689, "o", "from typing import TYPE_CHECKING\r\n"]
[1505.293203, "o", "import warnings\r\n"]
[1505.313718, "o", "\r\n"]
[1505.334232, "o", "import numpy as np\r\n"]
[1505.354747, "o", "\r\n"]
[1505.375261, "o", "from pandas._config import get_option\r\n"]
[1505.395776, "o", "\r\n"]
[1505.41629, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1505.436805, "o", "\r\n"]
[1505.45732, "o", "from pandas.core import roperator\r\n"]
[1505.477834, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1505.498349, "o", "\r\n"]
[1505.518863, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1505.539378, "o", "    import numexpr as ne\r\n"]
[1505.559892, "o", "\r\n"]
[1505.580407, "o", "if TYPE_CHECKING:\r\n"]
[1505.600921, "o", "    from pandas._typing import FuncType\r\n"]
[1505.621436, "o", "\r\n"]
[1505.64195, "o", "_TEST_MODE: bool | None = None\r\n"]
[1505.662465, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1505.682979, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1505.703494, "o", "_evaluate: FuncType | None = None\r\n"]
[1505.724008, "o", "_where: FuncType | None = None\r\n"]
[1505.744523, "o", "\r\n"]
[1505.765037, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1505.785552, "o", "_ALLOWED_DTYPES = {\r\n"]
[1505.806066, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1505.826581, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1505.847095, "o", "}\r\n"]
[1505.86761, "o", "\r\n"]
[1505.888124, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1505.908639, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1505.929154, "o", "\r\n"]
[1505.949668, "o", "\r\n"]
[1505.970183, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1505.990697, "o", "    # set/unset to use numexpr\r\n"]
[1506.011212, "o", "    global USE_NUMEXPR\r\n"]
[1506.031726, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1506.052241, "o", "        USE_NUMEXPR = v\r\n"]
[1506.072755, "o", "\r\n"]
[1506.09327, "o", "    # choose what we are going to do\r\n"]
[1506.113784, "o", "    global _evaluate, _where\r\n"]
[1506.134299, "o", "\r\n"]
[1506.154813, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1506.175328, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1506.195842, "o", "\r\n"]
[1506.216357, "o", "\r\n"]
[1506.236871, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1506.257386, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1506.2779, "o", "    # otherwise reset\r\n"]
[1506.298415, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1506.318929, "o", "        if n is None:\r\n"]
[1506.339444, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1506.359959, "o", "        ne.set_num_threads(n)\r\n"]
[1506.380473, "o", "\r\n"]
[1506.400988, "o", "\r\n"]
[1506.421502, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1506.442017, "o", "    \"\"\"\r\n"]
[1506.462531, "o", "    Standard evaluation.\r\n"]
[1506.483046, "o", "    \"\"\"\r\n"]
[1506.50356, "o", "    if _TEST_MODE:\r\n"]
[1506.524075, "o", "        _store_test_result(False)\r\n"]
[1506.544589, "o", "    return op(left_op, right_op)\r\n"]
[1506.565104, "o", "\r\n"]
[1506.585618, "o", "\r\n"]
[1506.606133, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1506.626647, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1506.647162, "o", "    if op_str is not None:\r\n"]
[1506.667676, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1506.688191, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1506.708705, "o", "            # check for dtype compatibility\r\n"]
[1506.72922, "o", "            dtypes: set[str] = set()\r\n"]
[1506.749734, "o", "            for o in [left_op, right_op]:\r\n"]
[1506.770249, "o", "                # ndarray and Series Case\r\n"]
[1506.790763, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1506.811278, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1506.831793, "o", "\r\n"]
[1506.852307, "o", "            # allowed are a superset\r\n"]
[1506.872822, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1506.893336, "o", "                return True\r\n"]
[1506.913851, "o", "\r\n"]
[1506.934365, "o", "    return False\r\n"]
[1506.95488, "o", "\r\n"]
[1506.975394, "o", "\r\n"]
[1506.995909, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1507.016423, "o", "    result = None\r\n"]
[1507.036938, "o", "\r\n"]
[1507.057452, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1507.077967, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1507.098481, "o", "        if is_reversed:\r\n"]
[1507.118996, "o", "            # we were originally called by a reversed op method\r\n"]
[1507.13951, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1507.160025, "o", "\r\n"]
[1507.180539, "o", "        left_value = left_op\r\n"]
[1507.201054, "o", "        right_value = right_op\r\n"]
[1507.221568, "o", "\r\n"]
[1507.242083, "o", "        try:\r\n"]
[1507.262598, "o", "            result = ne.evaluate(\r\n"]
[1507.283112, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1507.303627, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1507.324141, "o", "                casting=\"safe\",\r\n"]
[1507.344656, "o", "            )\r\n"]
[1507.36517, "o", "        except TypeError:\r\n"]
[1507.385685, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1507.406199, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1507.426714, "o", "            pass\r\n"]
[1507.447228, "o", "        except NotImplementedError:\r\n"]
[1507.467743, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1507.488257, "o", "                pass\r\n"]
[1507.508772, "o", "            else:\r\n"]
[1507.529286, "o", "                raise\r\n"]
[1507.549801, "o", "\r\n"]
[1507.570315, "o", "        if is_reversed:\r\n"]
[1507.59083, "o", "            # reverse order to original for fallback\r\n"]
[1507.611344, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1507.631859, "o", "\r\n"]
[1507.652373, "o", "    if _TEST_MODE:\r\n"]
[1507.672888, "o", "        _store_test_result(result is not None)\r\n"]
[1507.693402, "o", "\r\n"]
[1507.713917, "o", "    if result is None:\r\n"]
[1507.734432, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1507.754946, "o", "\r\n"]
[1507.775461, "o", "    return result\r\n"]
[1507.795975, "o", "\r\n"]
[1507.81649, "o", "\r\n"]
[1507.837004, "o", "_op_str_mapping = {\r\n"]
[1507.857519, "o", "    operator.add: \"+\",\r\n"]
[1507.878033, "o", "    roperator.radd: \"+\",\r\n"]
[1507.898548, "o", "    operator.mul: \"*\",\r\n"]
[1507.919062, "o", "    roperator.rmul: \"*\",\r\n"]
[1507.939577, "o", "    operator.sub: \"-\",\r\n"]
[1507.960091, "o", "    roperator.rsub: \"-\",\r\n"]
[1507.980606, "o", "    operator.truediv: \"/\",\r\n"]
[1508.00112, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1508.021635, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1508.042149, "o", "    operator.floordiv: None,\r\n"]
[1508.062664, "o", "    roperator.rfloordiv: None,\r\n"]
[1508.083178, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1508.103693, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1508.124207, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1508.144722, "o", "    operator.mod: None,\r\n"]
[1508.165237, "o", "    roperator.rmod: None,\r\n"]
[1508.185751, "o", "    operator.pow: \"**\",\r\n"]
[1508.206266, "o", "    roperator.rpow: \"**\",\r\n"]
[1508.22678, "o", "    operator.eq: \"==\",\r\n"]
[1508.247295, "o", "    operator.ne: \"!=\",\r\n"]
[1508.267809, "o", "    operator.le: \"<=\",\r\n"]
[1508.288324, "o", "    operator.lt: \"<\",\r\n"]
[1508.308838, "o", "    operator.ge: \">=\",\r\n"]
[1508.329353, "o", "    operator.gt: \">\",\r\n"]
[1508.349867, "o", "    operator.and_: \"&\",\r\n"]
[1508.370382, "o", "    roperator.rand_: \"&\",\r\n"]
[1508.390896, "o", "    operator.or_: \"|\",\r\n"]
[1508.411411, "o", "    roperator.ror_: \"|\",\r\n"]
[1508.431925, "o", "    operator.xor: \"^\",\r\n"]
[1508.45244, "o", "    roperator.rxor: \"^\",\r\n"]
[1508.472954, "o", "    divmod: None,\r\n"]
[1508.493469, "o", "    roperator.rdivmod: None,\r\n"]
[1508.513983, "o", "}\r\n"]
[1508.534498, "o", "\r\n"]
[1508.555012, "o", "\r\n"]
[1508.575527, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1508.596041, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1508.616556, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1508.637071, "o", "\r\n"]
[1508.657585, "o", "\r\n"]
[1508.6781, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1508.698614, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1508.719129, "o", "    result = None\r\n"]
[1508.739643, "o", "\r\n"]
[1508.760158, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1508.780672, "o", "        result = ne.evaluate(\r\n"]
[1508.801187, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1508.821701, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1508.842216, "o", "            casting=\"safe\",\r\n"]
[1508.86273, "o", "        )\r\n"]
[1508.883245, "o", "\r\n"]
[1508.903759, "o", "    if result is None:\r\n"]
[1508.924274, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1508.944788, "o", "\r\n"]
[1508.965303, "o", "    return result\r\n"]
[1508.985817, "o", "\r\n"]
[1509.006332, "o", "\r\n"]
[1509.026846, "o", "# turn myself on\r\n"]
[1509.047361, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1509.067876, "o", "\r\n"]
[1509.08839, "o", "\r\n"]
[1509.108905, "o", "def _has_bool_dtype(x):\r\n"]
[1509.129419, "o", "    try:\r\n"]
[1509.149934, "o", "        return x.dtype == bool\r\n"]
[1509.170448, "o", "    except AttributeError:\r\n"]
[1509.190963, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1509.211477, "o", "\r\n"]
[1509.231992, "o", "\r\n"]
[1509.252506, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1509.273021, "o", "\r\n"]
[1509.293535, "o", "\r\n"]
[1509.31405, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1509.334564, "o", "    \"\"\"\r\n"]
[1509.355079, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1509.375593, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1509.396108, "o", "    boolean ops.\r\n"]
[1509.416622, "o", "    \"\"\"\r\n"]
[1509.437137, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1509.457651, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1509.478166, "o", "            warnings.warn(\r\n"]
[1509.49868, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1509.519195, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1509.53971, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1509.560224, "o", "                stacklevel=find_stack_level(),\r\n"]
[1509.580739, "o", "            )\r\n"]
[1509.601253, "o", "            return True\r\n"]
[1509.621768, "o", "    return False\r\n"]
[1509.642282, "o", "\r\n"]
[1509.662797, "o", "\r\n"]
[1509.683311, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1509.703826, "o", "    \"\"\"\r\n"]
[1509.72434, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1509.744855, "o", "\r\n"]
[1509.765369, "o", "    Parameters\r\n"]
[1509.785884, "o", "    ----------\r\n"]
[1509.806398, "o", "    op : the actual operand\r\n"]
[1509.826913, "o", "    left_op : left operand\r\n"]
[1509.847427, "o", "    right_op : right operand\r\n"]
[1509.867942, "o", "    use_numexpr : bool, default True\r\n"]
[1509.888456, "o", "        Whether to try to use numexpr.\r\n"]
[1509.908971, "o", "    \"\"\"\r\n"]
[1509.929485, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1510.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1510.002, "i", "sed -n '240,520p' pandas/core/computation/expressions.py\r"]
[1510.004, "o", "sed -n '240,520p' pandas/core/computation/expressions.py\r\n"]
[1510.101077, "o", "\u001b[?2004l\r\n"]
[1510.196154, "o", "    if op_str is not None:\r\n"]
[1510.291231, "o", "        if use_numexpr:\r\n"]
[1510.386308, "o", "            # error: \"None\" not callable\r\n"]
[1510.481385, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1510.576462, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1510.671538, "o", "\r\n"]
[1510.766615, "o", "\r\n"]
[1510.861692, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1510.956769, "o", "    \"\"\"\r\n"]
[1511.051846, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1511.146923, "o", "\r\n"]
[1511.242, "o", "    Parameters\r\n"]
[1511.337077, "o", "    ----------\r\n"]
[1511.432154, "o", "    cond : np.ndarray[bool]\r\n"]
[1511.527231, "o", "    left_op : return if cond is True\r\n"]
[1511.622308, "o", "    right_op : return if cond is False\r\n"]
[1511.717385, "o", "    use_numexpr : bool, default True\r\n"]
[1511.812462, "o", "        Whether to try to use numexpr.\r\n"]
[1511.907538, "o", "    \"\"\"\r\n"]
[1512.002615, "o", "    assert _where is not None\r\n"]
[1512.097692, "o", "    if use_numexpr:\r\n"]
[1512.192769, "o", "        return _where(cond, left_op, right_op)\r\n"]
[1512.287846, "o", "    else:\r\n"]
[1512.382923, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[1512.478, "o", "\r\n"]
[1512.573077, "o", "\r\n"]
[1512.668154, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[1512.763231, "o", "    \"\"\"\r\n"]
[1512.858308, "o", "    Keeps track of whether numexpr was used.\r\n"]
[1512.953385, "o", "\r\n"]
[1513.048462, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[1513.143538, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[1513.238615, "o", "    \"\"\"\r\n"]
[1513.333692, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[1513.428769, "o", "    _TEST_MODE = v\r\n"]
[1513.523846, "o", "    _TEST_RESULT = []\r\n"]
[1513.618923, "o", "\r\n"]
[1513.714, "o", "\r\n"]
[1513.809077, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[1513.904154, "o", "    if used_numexpr:\r\n"]
[1513.999231, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[1514.094308, "o", "\r\n"]
[1514.189385, "o", "\r\n"]
[1514.284462, "o", "def get_test_result() -> list[bool]:\r\n"]
[1514.379538, "o", "    \"\"\"\r\n"]
[1514.474615, "o", "    Get test result and reset test_results.\r\n"]
[1514.569692, "o", "    \"\"\"\r\n"]
[1514.664769, "o", "    global _TEST_RESULT\r\n"]
[1514.759846, "o", "    res = _TEST_RESULT\r\n"]
[1514.854923, "o", "    _TEST_RESULT = []\r\n"]
[1515.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1515.002, "i", "python - << 'PY'\r"]
[1515.004, "o", "python - << 'PY'\r\n"]
[1515.066293, "o", "\u001b[?2004l\r\n"]
[1515.126585, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1515.186878, "o", "\u001b[?2004l\r\n"]
[1515.247171, "o", "\u001b[?2004h> import re\r\n"]
[1515.307463, "o", "\u001b[?2004l\r\n"]
[1515.367756, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1515.428049, "o", "\u001b[?2004l\r\n"]
[1515.488341, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1515.548634, "o", "\u001b[?2004l\r\n"]
[1515.608927, "o", "\u001b[?2004h> changed = False\r\n"]
[1515.66922, "o", "\u001b[?2004l\r\n"]
[1515.729512, "o", "\u001b[?2004h> # Try to increase an existing threshold constant if present\r\n"]
[1515.789805, "o", "\u001b[?2004l\r\n"]
[1515.850098, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1515.91039, "o", "\u001b[?2004l\r\n"]
[1515.970683, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1516.030976, "o", "\u001b[?2004l\r\n"]
[1516.091268, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1516.151561, "o", "\u001b[?2004l\r\n"]
[1516.211854, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1516.272146, "o", "\u001b[?2004l\r\n"]
[1516.332439, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1516.392732, "o", "\u001b[?2004l\r\n"]
[1516.453024, "o", "\u001b[?2004h>     changed = True\r\n"]
[1516.513317, "o", "\u001b[?2004l\r\n"]
[1516.57361, "o", "\u001b[?2004h> else:\r\n"]
[1516.633902, "o", "\u001b[?2004l\r\n"]
[1516.694195, "o", "\u001b[?2004h>     # Inject early size-based bypass near top of should_use_numexpr\r\n"]
[1516.754488, "o", "\u001b[?2004l\r\n"]
[1516.81478, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1516.875073, "o", "\u001b[?2004l\r\n"]
[1516.935366, "o", "\u001b[?2004h>     if m:\r\n"]
[1516.995659, "o", "\u001b[?2004l\r\n"]
[1517.055951, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[1517.116244, "o", "\u001b[?2004l\r\n"]
[1517.176537, "o", "\u001b[?2004h>         # Skip immediate docstring if present\r\n"]
[1517.236829, "o", "\u001b[?2004l\r\n"]
[1517.297122, "o", "\u001b[?2004h>         ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1517.357415, "o", "\u001b[?2004l\r\n"]
[1517.417707, "o", "\u001b[?2004h>         if ds:\r\n"]
[1517.478, "o", "\u001b[?2004l\r\n"]
[1517.538293, "o", "\u001b[?2004h>             insert_at += ds.end()\r\n"]
[1517.598585, "o", "\u001b[?2004l\r\n"]
[1517.658878, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+3000]:\r\n"]
[1517.719171, "o", "\u001b[?2004l\r\n"]
[1517.779463, "o", "\u001b[?2004h>             inject = (\r\n"]
[1517.839756, "o", "\u001b[?2004l\r\n"]
[1517.900049, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1517.960341, "o", "\u001b[?2004l\r\n"]
[1518.020634, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[1518.080927, "o", "\u001b[?2004l\r\n"]
[1518.14122, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1518.201512, "o", "\u001b[?2004l\r\n"]
[1518.261805, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1518.322098, "o", "\u001b[?2004l\r\n"]
[1518.38239, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[1518.442683, "o", "\u001b[?2004l\r\n"]
[1518.502976, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[1518.563268, "o", "\u001b[?2004l\r\n"]
[1518.623561, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1518.683854, "o", "\u001b[?2004l\r\n"]
[1518.744146, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[1518.804439, "o", "\u001b[?2004l\r\n"]
[1518.864732, "o", "\u001b[?2004h>             )\r\n"]
[1518.925024, "o", "\u001b[?2004l\r\n"]
[1518.985317, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1519.04561, "o", "\u001b[?2004l\r\n"]
[1519.105902, "o", "\u001b[?2004h>             changed = True\r\n"]
[1519.166195, "o", "\u001b[?2004l\r\n"]
[1519.226488, "o", "\u001b[?2004h> if changed:\r\n"]
[1519.28678, "o", "\u001b[?2004l\r\n"]
[1519.347073, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1519.407366, "o", "\u001b[?2004l\r\n"]
[1519.467659, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1519.527951, "o", "\u001b[?2004l\r\n"]
[1519.588244, "o", "\u001b[?2004h> else:\r\n"]
[1519.648537, "o", "\u001b[?2004l\r\n"]
[1519.708829, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1519.769122, "o", "\u001b[?2004l\r\n"]
[1519.829415, "o", "\u001b[?2004h> PY\r\n"]
[1519.889707, "o", "\u001b[?2004l\r\n"]
[1520.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1520.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1520.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1520.006, "o", "\u001b[?2004l\r\n"]
[1525.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1525.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1525.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1525.006, "o", "\u001b[?2004l\r\n"]
[1530.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1530.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold/early check to reduce ov\r"]
[1530.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold/early check to reduce ov\r\n"]
[1530.624, "o", "verhead; improves arithmetic.Ops.*\"\r\n"]
[1531.242, "o", "\u001b[?2004l\r\n"]
[1531.86, "o", "On branch main\r\n"]
[1532.478, "o", "Untracked files:\r\n"]
[1533.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1533.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1534.332, "o", "\r\n"]
[1535.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1535.002, "i", "cd asv_bench\r"]
[1535.004, "o", "cd asv_bench\r\n"]
[1535.006, "o", "\u001b[?2004l\r\n"]
[1540.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1540.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1540.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1540.097556, "o", "\u001b[?2004l\r\n"]
[1540.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1540.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1540.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1540.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1540.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1540.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ =============\u001b[0m\r\n"]
[1540.738444, "o", "             --                     threads          \r\n"]
[1540.83, "o", "             ------------- --------------------------\r\n"]
[1540.921556, "o", "              use_numexpr    default          1      \r\n"]
[1541.013111, "o", "             ============= ============ =============\r\n"]
[1541.104667, "o", "                  True      2.67\u00b10.1ms    2.78\u00b10.2ms \r\n"]
[1541.196222, "o", "                 False      2.44\u00b10.2ms   2.49\u00b10.08ms \r\n"]
[1541.287778, "o", "             ============= ============ =============\r\n"]
[1541.379333, "o", "\r\n"]
[1541.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1541.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1541.654, "o", "             --                     threads         \r\n"]
[1541.745556, "o", "             ------------- -------------------------\r\n"]
[1541.837111, "o", "              use_numexpr    default         1      \r\n"]
[1541.928667, "o", "             ============= ============ ============\r\n"]
[1542.020222, "o", "                  True      1.93\u00b10.1ms   1.99\u00b10.2ms \r\n"]
[1542.111778, "o", "                 False      2.10\u00b10.2ms   2.07\u00b10.3ms \r\n"]
[1542.203333, "o", "             ============= ============ ============\r\n"]
[1542.294889, "o", "\r\n"]
[1542.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1542.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1542.569556, "o", "             --                     threads         \r\n"]
[1542.661111, "o", "             ------------- -------------------------\r\n"]
[1542.752667, "o", "              use_numexpr    default         1      \r\n"]
[1542.844222, "o", "             ============= ============ ============\r\n"]
[1542.935778, "o", "                  True      2.59\u00b10.4ms   2.89\u00b10.2ms \r\n"]
[1543.027333, "o", "                 False      2.63\u00b10.2ms   2.41\u00b10.2ms \r\n"]
[1543.118889, "o", "             ============= ============ ============\r\n"]
[1543.210444, "o", "\r\n"]
[1543.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1543.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[1543.485111, "o", "             --                     threads          \r\n"]
[1543.576667, "o", "             ------------- --------------------------\r\n"]
[1543.668222, "o", "              use_numexpr     default         1      \r\n"]
[1543.759778, "o", "             ============= ============= ============\r\n"]
[1543.851333, "o", "                  True       10.6\u00b10.2ms   10.5\u00b10.2ms \r\n"]
[1543.942889, "o", "                 False      10.6\u00b10.05ms   10.7\u00b10.2ms \r\n"]
[1544.034444, "o", "             ============= ============= ============\r\n"]
[1544.126, "o", "\r\n"]
[1544.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          47.3\u00b10.2ms\r\n"]
[1544.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.6\u00b10.06ms\r\n"]
[1544.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              991\u00b130\u03bcs\r\n"]
[1544.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          20.0\u00b10.2ms\r\n"]
[1544.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    25.1\u00b10.2ms\r\n"]
[1544.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.72\u00b10.06ms\r\n"]
[1544.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.5\u00b10.07ms\r\n"]
[1544.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     575\u00b170\u03bcs\r\n"]
[1545.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1545.002, "i", "pwd\r"]
[1545.004, "o", "pwd\r\n"]
[1547.478, "o", "\u001b[?2004l\r\n"]
[1550.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1550.002, "i", "ls -la pandas/core/computation\r"]
[1550.004, "o", "ls -la pandas/core/computation\r\n"]
[1552.478, "o", "\u001b[?2004l\r\n"]
[1555.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1555.002, "i", "grep -n \"def should_use_numexpr\\|_MIN_ELEMENTS\\|MIN_ELEMENTS\" pandas/core/computation/expressions.py || t\r"]
[1555.004, "o", "grep -n \"def should_use_numexpr\\|_MIN_ELEMENTS\\|MIN_ELEMENTS\" pandas/core/computation/expressions.py || t\r\n"]
[1556.654, "o", "true\r\n"]
[1558.302, "o", "\u001b[?2004l\r\n"]
[1560.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1560.002, "i", "sed -n '1,240p' pandas/core/computation/expressions.py\r"]
[1560.004, "o", "sed -n '1,240p' pandas/core/computation/expressions.py\r\n"]
[1562.478, "o", "\u001b[?2004l\r\n"]
[1565.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1565.002, "i", "sed -n '240,520p' pandas/core/computation/expressions.py\r"]
[1565.004, "o", "sed -n '240,520p' pandas/core/computation/expressions.py\r\n"]
[1567.478, "o", "\u001b[?2004l\r\n"]
[1570.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1570.002, "i", "python - << 'PY'\r"]
[1570.004, "o", "python - << 'PY'\r\n"]
[1570.062182, "o", "\u001b[?2004l\r\n"]
[1570.118364, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1570.174545, "o", "\u001b[?2004l\r\n"]
[1570.230727, "o", "\u001b[?2004h> import re\r\n"]
[1570.286909, "o", "\u001b[?2004l\r\n"]
[1570.343091, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1570.399273, "o", "\u001b[?2004l\r\n"]
[1570.455455, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1570.511636, "o", "\u001b[?2004l\r\n"]
[1570.567818, "o", "\u001b[?2004h> changed = False\r\n"]
[1570.624, "o", "\u001b[?2004l\r\n"]
[1570.680182, "o", "\u001b[?2004h> # First try to bump a threshold constant if present\r\n"]
[1570.736364, "o", "\u001b[?2004l\r\n"]
[1570.792545, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1570.848727, "o", "\u001b[?2004l\r\n"]
[1570.904909, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1570.961091, "o", "\u001b[?2004l\r\n"]
[1571.017273, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1571.073455, "o", "\u001b[?2004l\r\n"]
[1571.129636, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1571.185818, "o", "\u001b[?2004l\r\n"]
[1571.242, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1571.298182, "o", "\u001b[?2004l\r\n"]
[1571.354364, "o", "\u001b[?2004h>     changed = True\r\n"]
[1571.410545, "o", "\u001b[?2004l\r\n"]
[1571.466727, "o", "\u001b[?2004h> else:\r\n"]
[1571.522909, "o", "\u001b[?2004l\r\n"]
[1571.579091, "o", "\u001b[?2004h>     # Inject an early bypass inside should_use_numexpr (after def and any docstring)\r\n"]
[1571.635273, "o", "\u001b[?2004l\r\n"]
[1571.691455, "o", "\u001b[?2004h>     m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1571.747636, "o", "\u001b[?2004l\r\n"]
[1571.803818, "o", "\u001b[?2004h>     if m:\r\n"]
[1571.86, "o", "\u001b[?2004l\r\n"]
[1571.916182, "o", "\u001b[?2004h>         insert_at = m.end()\r\n"]
[1571.972364, "o", "\u001b[?2004l\r\n"]
[1572.028545, "o", "\u001b[?2004h>         # Skip immediate docstring if present\r\n"]
[1572.084727, "o", "\u001b[?2004l\r\n"]
[1572.140909, "o", "\u001b[?2004h>         ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1572.197091, "o", "\u001b[?2004l\r\n"]
[1572.253273, "o", "\u001b[?2004h>         if ds:\r\n"]
[1572.309455, "o", "\u001b[?2004l\r\n"]
[1572.365636, "o", "\u001b[?2004h>             insert_at += ds.end()\r\n"]
[1572.421818, "o", "\u001b[?2004l\r\n"]
[1572.478, "o", "\u001b[?2004h>         if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+4000]:\r\n"]
[1572.534182, "o", "\u001b[?2004l\r\n"]
[1572.590364, "o", "\u001b[?2004h>             inject = (\r\n"]
[1572.646545, "o", "\u001b[?2004l\r\n"]
[1572.702727, "o", "\u001b[?2004h>                 \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1572.758909, "o", "\u001b[?2004l\r\n"]
[1572.815091, "o", "\u001b[?2004h>                 \"    try:\\n\"\r\n"]
[1572.871273, "o", "\u001b[?2004l\r\n"]
[1572.927455, "o", "\u001b[?2004h>                 \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1572.983636, "o", "\u001b[?2004l\r\n"]
[1573.039818, "o", "\u001b[?2004h>                 \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1573.096, "o", "\u001b[?2004l\r\n"]
[1573.152182, "o", "\u001b[?2004h>                 \"    except Exception:\\n\"\r\n"]
[1573.208364, "o", "\u001b[?2004l\r\n"]
[1573.264545, "o", "\u001b[?2004h>                 \"        a_size = b_size = None\\n\"\r\n"]
[1573.320727, "o", "\u001b[?2004l\r\n"]
[1573.376909, "o", "\u001b[?2004h>                 \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1573.433091, "o", "\u001b[?2004l\r\n"]
[1573.489273, "o", "\u001b[?2004h>                 \"        return False\\n\"\r\n"]
[1573.545455, "o", "\u001b[?2004l\r\n"]
[1573.601636, "o", "\u001b[?2004h>             )\r\n"]
[1573.657818, "o", "\u001b[?2004l\r\n"]
[1573.714, "o", "\u001b[?2004h>             src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1573.770182, "o", "\u001b[?2004l\r\n"]
[1573.826364, "o", "\u001b[?2004h>             changed = True\r\n"]
[1573.882545, "o", "\u001b[?2004l\r\n"]
[1573.938727, "o", "\u001b[?2004h> if changed:\r\n"]
[1573.994909, "o", "\u001b[?2004l\r\n"]
[1574.051091, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1574.107273, "o", "\u001b[?2004l\r\n"]
[1574.163455, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1574.219636, "o", "\u001b[?2004l\r\n"]
[1574.275818, "o", "\u001b[?2004h> else:\r\n"]
[1574.332, "o", "\u001b[?2004l\r\n"]
[1574.388182, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1574.444364, "o", "\u001b[?2004l\r\n"]
[1574.500545, "o", "\u001b[?2004h> PY\r\n"]
[1574.556727, "o", "\u001b[?2004l\r\n"]
[1574.612909, "o", "Traceback (most recent call last):\r\n"]
[1574.669091, "o", "  File \"<stdin>\", line 4, in <module>\r\n"]
[1574.725273, "o", "  File \"/opt/conda/envs/asv_3.10/lib/python3.10/pathlib.py\", line 1134, in read_text\r\n"]
[1574.781455, "o", "    with self.open(mode='r', encoding=encoding, errors=errors) as f:\r\n"]
[1574.837636, "o", "  File \"/opt/conda/envs/asv_3.10/lib/python3.10/pathlib.py\", line 1119, in open\r\n"]
[1574.893818, "o", "    return self._accessor.open(self, mode, buffering, encoding, errors,\r\n"]
[1575.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1575.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1575.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1575.006, "o", "\u001b[?2004l\r\n"]
[1580.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1580.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1580.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1581.654, "o", "\u001b[?2004l\r\n"]
[1583.302, "o", "warning: could not open directory 'asv_bench/pandas/core/computation/': No such file or directory\r\n"]
[1585.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1585.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold/early check; i\r"]
[1585.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold/early check; i\r\n"]
[1585.624, "o", "improves arithmetic.Ops.*\"\r\n"]
[1586.242, "o", "\u001b[?2004l\r\n"]
[1586.86, "o", "On branch main\r\n"]
[1587.478, "o", "Untracked files:\r\n"]
[1588.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1588.714, "o", "\t\u001b[31m../_version_meson.py\u001b[m\r\n"]
[1589.332, "o", "\r\n"]
[1590.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1590.002, "i", "cd asv_bench\r"]
[1590.004, "o", "cd asv_bench\r\n"]
[1592.478, "o", "\u001b[?2004l\r\n"]
[1595.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1595.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1595.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1595.097556, "o", "\u001b[?2004l\r\n"]
[1595.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1595.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1595.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1595.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1595.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1595.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1595.738444, "o", "             --                     threads         \r\n"]
[1595.83, "o", "             ------------- -------------------------\r\n"]
[1595.921556, "o", "              use_numexpr    default         1      \r\n"]
[1596.013111, "o", "             ============= ============ ============\r\n"]
[1596.104667, "o", "                  True      2.59\u00b10.2ms   2.46\u00b10.4ms \r\n"]
[1596.196222, "o", "                 False      2.59\u00b10.3ms   2.79\u00b10.4ms \r\n"]
[1596.287778, "o", "             ============= ============ ============\r\n"]
[1596.379333, "o", "\r\n"]
[1596.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1596.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1596.654, "o", "             --                     threads         \r\n"]
[1596.745556, "o", "             ------------- -------------------------\r\n"]
[1596.837111, "o", "              use_numexpr    default         1      \r\n"]
[1596.928667, "o", "             ============= ============ ============\r\n"]
[1597.020222, "o", "                  True      1.97\u00b10.2ms   2.16\u00b10.5ms \r\n"]
[1597.111778, "o", "                 False      1.94\u00b10.3ms   1.93\u00b10.2ms \r\n"]
[1597.203333, "o", "             ============= ============ ============\r\n"]
[1597.294889, "o", "\r\n"]
[1597.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1597.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1597.569556, "o", "             --                     threads         \r\n"]
[1597.661111, "o", "             ------------- -------------------------\r\n"]
[1597.752667, "o", "              use_numexpr    default         1      \r\n"]
[1597.844222, "o", "             ============= ============ ============\r\n"]
[1597.935778, "o", "                  True      2.98\u00b10.4ms   2.51\u00b10.2ms \r\n"]
[1598.027333, "o", "                 False      2.72\u00b10.3ms   2.91\u00b10.3ms \r\n"]
[1598.118889, "o", "             ============= ============ ============\r\n"]
[1598.210444, "o", "\r\n"]
[1598.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1598.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1598.485111, "o", "             --                     threads         \r\n"]
[1598.576667, "o", "             ------------- -------------------------\r\n"]
[1598.668222, "o", "              use_numexpr    default         1      \r\n"]
[1598.759778, "o", "             ============= ============ ============\r\n"]
[1598.851333, "o", "                  True      10.6\u00b10.3ms   11.0\u00b10.5ms \r\n"]
[1598.942889, "o", "                 False      10.7\u00b10.3ms   10.6\u00b10.4ms \r\n"]
[1599.034444, "o", "             ============= ============ ============\r\n"]
[1599.126, "o", "\r\n"]
[1599.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          47.6\u00b10.2ms\r\n"]
[1599.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                    28.7\u00b10.1ms\r\n"]
[1599.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                           1.07\u00b10.09ms\r\n"]
[1599.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.9\u00b10.2ms\r\n"]
[1599.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    24.7\u00b10.1ms\r\n"]
[1599.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                              1.73\u00b10.1ms\r\n"]
[1599.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      10.4\u00b10.1ms\r\n"]
[1599.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     587\u00b170\u03bcs\r\n"]
[1600.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1600.002, "i", "cd /workspace/repo\r"]
[1600.004, "o", "cd /workspace/repo\r\n"]
[1600.006, "o", "\u001b[?2004l\r\n"]
[1605.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1605.002, "i", "ls -la pandas/core/computation/expressions.py\r"]
[1605.004, "o", "ls -la pandas/core/computation/expressions.py\r\n"]
[1607.478, "o", "\u001b[?2004l\r\n"]
[1610.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1610.002, "i", "grep -n \"def should_use_numexpr\" pandas/core/computation/expressions.py || true\r"]
[1610.004, "o", "grep -n \"def should_use_numexpr\" pandas/core/computation/expressions.py || true\r\n"]
[1610.006, "o", "\u001b[?2004l\r\n"]
[1615.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1615.002, "i", "sed -n '1,200p' pandas/core/computation/expressions.py\r"]
[1615.004, "o", "sed -n '1,200p' pandas/core/computation/expressions.py\r\n"]
[1615.030597, "o", "\u001b[?2004l\r\n"]
[1615.055194, "o", "\"\"\"\r\n"]
[1615.079791, "o", "Expressions\r\n"]
[1615.104388, "o", "-----------\r\n"]
[1615.128985, "o", "\r\n"]
[1615.153582, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1615.178179, "o", "\r\n"]
[1615.202776, "o", "\"\"\"\r\n"]
[1615.227373, "o", "\r\n"]
[1615.25197, "o", "from __future__ import annotations\r\n"]
[1615.276567, "o", "\r\n"]
[1615.301164, "o", "import operator\r\n"]
[1615.325761, "o", "from typing import TYPE_CHECKING\r\n"]
[1615.350358, "o", "import warnings\r\n"]
[1615.374955, "o", "\r\n"]
[1615.399552, "o", "import numpy as np\r\n"]
[1615.424149, "o", "\r\n"]
[1615.448746, "o", "from pandas._config import get_option\r\n"]
[1615.473343, "o", "\r\n"]
[1615.49794, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1615.522537, "o", "\r\n"]
[1615.547134, "o", "from pandas.core import roperator\r\n"]
[1615.571731, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1615.596328, "o", "\r\n"]
[1615.620925, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1615.645522, "o", "    import numexpr as ne\r\n"]
[1615.670119, "o", "\r\n"]
[1615.694716, "o", "if TYPE_CHECKING:\r\n"]
[1615.719313, "o", "    from pandas._typing import FuncType\r\n"]
[1615.74391, "o", "\r\n"]
[1615.768507, "o", "_TEST_MODE: bool | None = None\r\n"]
[1615.793104, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1615.817701, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1615.842299, "o", "_evaluate: FuncType | None = None\r\n"]
[1615.866896, "o", "_where: FuncType | None = None\r\n"]
[1615.891493, "o", "\r\n"]
[1615.91609, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1615.940687, "o", "_ALLOWED_DTYPES = {\r\n"]
[1615.965284, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1615.989881, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1616.014478, "o", "}\r\n"]
[1616.039075, "o", "\r\n"]
[1616.063672, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1616.088269, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1616.112866, "o", "\r\n"]
[1616.137463, "o", "\r\n"]
[1616.16206, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1616.186657, "o", "    # set/unset to use numexpr\r\n"]
[1616.211254, "o", "    global USE_NUMEXPR\r\n"]
[1616.235851, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1616.260448, "o", "        USE_NUMEXPR = v\r\n"]
[1616.285045, "o", "\r\n"]
[1616.309642, "o", "    # choose what we are going to do\r\n"]
[1616.334239, "o", "    global _evaluate, _where\r\n"]
[1616.358836, "o", "\r\n"]
[1616.383433, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1616.40803, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1616.432627, "o", "\r\n"]
[1616.457224, "o", "\r\n"]
[1616.481821, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1616.506418, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1616.531015, "o", "    # otherwise reset\r\n"]
[1616.555612, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1616.580209, "o", "        if n is None:\r\n"]
[1616.604806, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1616.629403, "o", "        ne.set_num_threads(n)\r\n"]
[1616.654, "o", "\r\n"]
[1616.678597, "o", "\r\n"]
[1616.703194, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1616.727791, "o", "    \"\"\"\r\n"]
[1616.752388, "o", "    Standard evaluation.\r\n"]
[1616.776985, "o", "    \"\"\"\r\n"]
[1616.801582, "o", "    if _TEST_MODE:\r\n"]
[1616.826179, "o", "        _store_test_result(False)\r\n"]
[1616.850776, "o", "    return op(left_op, right_op)\r\n"]
[1616.875373, "o", "\r\n"]
[1616.89997, "o", "\r\n"]
[1616.924567, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1616.949164, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1616.973761, "o", "    if op_str is not None:\r\n"]
[1616.998358, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1617.022955, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1617.047552, "o", "            # check for dtype compatibility\r\n"]
[1617.072149, "o", "            dtypes: set[str] = set()\r\n"]
[1617.096746, "o", "            for o in [left_op, right_op]:\r\n"]
[1617.121343, "o", "                # ndarray and Series Case\r\n"]
[1617.14594, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1617.170537, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1617.195134, "o", "\r\n"]
[1617.219731, "o", "            # allowed are a superset\r\n"]
[1617.244328, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1617.268925, "o", "                return True\r\n"]
[1617.293522, "o", "\r\n"]
[1617.318119, "o", "    return False\r\n"]
[1617.342716, "o", "\r\n"]
[1617.367313, "o", "\r\n"]
[1617.39191, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1617.416507, "o", "    result = None\r\n"]
[1617.441104, "o", "\r\n"]
[1617.465701, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1617.490299, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1617.514896, "o", "        if is_reversed:\r\n"]
[1617.539493, "o", "            # we were originally called by a reversed op method\r\n"]
[1617.56409, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1617.588687, "o", "\r\n"]
[1617.613284, "o", "        left_value = left_op\r\n"]
[1617.637881, "o", "        right_value = right_op\r\n"]
[1617.662478, "o", "\r\n"]
[1617.687075, "o", "        try:\r\n"]
[1617.711672, "o", "            result = ne.evaluate(\r\n"]
[1617.736269, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1617.760866, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1617.785463, "o", "                casting=\"safe\",\r\n"]
[1617.81006, "o", "            )\r\n"]
[1617.834657, "o", "        except TypeError:\r\n"]
[1617.859254, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1617.883851, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1617.908448, "o", "            pass\r\n"]
[1617.933045, "o", "        except NotImplementedError:\r\n"]
[1617.957642, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1617.982239, "o", "                pass\r\n"]
[1618.006836, "o", "            else:\r\n"]
[1618.031433, "o", "                raise\r\n"]
[1618.05603, "o", "\r\n"]
[1618.080627, "o", "        if is_reversed:\r\n"]
[1618.105224, "o", "            # reverse order to original for fallback\r\n"]
[1618.129821, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1618.154418, "o", "\r\n"]
[1618.179015, "o", "    if _TEST_MODE:\r\n"]
[1618.203612, "o", "        _store_test_result(result is not None)\r\n"]
[1618.228209, "o", "\r\n"]
[1618.252806, "o", "    if result is None:\r\n"]
[1618.277403, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1618.302, "o", "\r\n"]
[1618.326597, "o", "    return result\r\n"]
[1618.351194, "o", "\r\n"]
[1618.375791, "o", "\r\n"]
[1618.400388, "o", "_op_str_mapping = {\r\n"]
[1618.424985, "o", "    operator.add: \"+\",\r\n"]
[1618.449582, "o", "    roperator.radd: \"+\",\r\n"]
[1618.474179, "o", "    operator.mul: \"*\",\r\n"]
[1618.498776, "o", "    roperator.rmul: \"*\",\r\n"]
[1618.523373, "o", "    operator.sub: \"-\",\r\n"]
[1618.54797, "o", "    roperator.rsub: \"-\",\r\n"]
[1618.572567, "o", "    operator.truediv: \"/\",\r\n"]
[1618.597164, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1618.621761, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1618.646358, "o", "    operator.floordiv: None,\r\n"]
[1618.670955, "o", "    roperator.rfloordiv: None,\r\n"]
[1618.695552, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1618.720149, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1618.744746, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1618.769343, "o", "    operator.mod: None,\r\n"]
[1618.79394, "o", "    roperator.rmod: None,\r\n"]
[1618.818537, "o", "    operator.pow: \"**\",\r\n"]
[1618.843134, "o", "    roperator.rpow: \"**\",\r\n"]
[1618.867731, "o", "    operator.eq: \"==\",\r\n"]
[1618.892328, "o", "    operator.ne: \"!=\",\r\n"]
[1618.916925, "o", "    operator.le: \"<=\",\r\n"]
[1618.941522, "o", "    operator.lt: \"<\",\r\n"]
[1618.966119, "o", "    operator.ge: \">=\",\r\n"]
[1618.990716, "o", "    operator.gt: \">\",\r\n"]
[1619.015313, "o", "    operator.and_: \"&\",\r\n"]
[1619.03991, "o", "    roperator.rand_: \"&\",\r\n"]
[1619.064507, "o", "    operator.or_: \"|\",\r\n"]
[1619.089104, "o", "    roperator.ror_: \"|\",\r\n"]
[1619.113701, "o", "    operator.xor: \"^\",\r\n"]
[1619.138299, "o", "    roperator.rxor: \"^\",\r\n"]
[1619.162896, "o", "    divmod: None,\r\n"]
[1619.187493, "o", "    roperator.rdivmod: None,\r\n"]
[1619.21209, "o", "}\r\n"]
[1619.236687, "o", "\r\n"]
[1619.261284, "o", "\r\n"]
[1619.285881, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1619.310478, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1619.335075, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1619.359672, "o", "\r\n"]
[1619.384269, "o", "\r\n"]
[1619.408866, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1619.433463, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1619.45806, "o", "    result = None\r\n"]
[1619.482657, "o", "\r\n"]
[1619.507254, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1619.531851, "o", "        result = ne.evaluate(\r\n"]
[1619.556448, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1619.581045, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1619.605642, "o", "            casting=\"safe\",\r\n"]
[1619.630239, "o", "        )\r\n"]
[1619.654836, "o", "\r\n"]
[1619.679433, "o", "    if result is None:\r\n"]
[1619.70403, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1619.728627, "o", "\r\n"]
[1619.753224, "o", "    return result\r\n"]
[1619.777821, "o", "\r\n"]
[1619.802418, "o", "\r\n"]
[1619.827015, "o", "# turn myself on\r\n"]
[1619.851612, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1619.876209, "o", "\r\n"]
[1619.900806, "o", "\r\n"]
[1619.925403, "o", "def _has_bool_dtype(x):\r\n"]
[1620.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1620.002, "i", "python - << 'PY'\r"]
[1620.004, "o", "python - << 'PY'\r\n"]
[1620.0678, "o", "\u001b[?2004l\r\n"]
[1620.1296, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1620.1914, "o", "\u001b[?2004l\r\n"]
[1620.2532, "o", "\u001b[?2004h> import re\r\n"]
[1620.315, "o", "\u001b[?2004l\r\n"]
[1620.3768, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1620.4386, "o", "\u001b[?2004l\r\n"]
[1620.5004, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1620.5622, "o", "\u001b[?2004l\r\n"]
[1620.624, "o", "\u001b[?2004h> changed = False\r\n"]
[1620.6858, "o", "\u001b[?2004l\r\n"]
[1620.7476, "o", "\u001b[?2004h> # Try to bump an existing threshold constant first\r\n"]
[1620.8094, "o", "\u001b[?2004l\r\n"]
[1620.8712, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1620.933, "o", "\u001b[?2004l\r\n"]
[1620.9948, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1621.0566, "o", "\u001b[?2004l\r\n"]
[1621.1184, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1621.1802, "o", "\u001b[?2004l\r\n"]
[1621.242, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1621.3038, "o", "\u001b[?2004l\r\n"]
[1621.3656, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1621.4274, "o", "\u001b[?2004l\r\n"]
[1621.4892, "o", "\u001b[?2004h>     changed = True\r\n"]
[1621.551, "o", "\u001b[?2004l\r\n"]
[1621.6128, "o", "\u001b[?2004h> # Inject early size-based bypass near the start of should_use_numexpr\r\n"]
[1621.6746, "o", "\u001b[?2004l\r\n"]
[1621.7364, "o", "\u001b[?2004h> m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1621.7982, "o", "\u001b[?2004l\r\n"]
[1621.86, "o", "\u001b[?2004h> if m:\r\n"]
[1621.9218, "o", "\u001b[?2004l\r\n"]
[1621.9836, "o", "\u001b[?2004h>     insert_at = m.end()\r\n"]
[1622.0454, "o", "\u001b[?2004l\r\n"]
[1622.1072, "o", "\u001b[?2004h>     # Skip immediate docstring if present\r\n"]
[1622.169, "o", "\u001b[?2004l\r\n"]
[1622.2308, "o", "\u001b[?2004h>     ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1622.2926, "o", "\u001b[?2004l\r\n"]
[1622.3544, "o", "\u001b[?2004h>     if ds:\r\n"]
[1622.4162, "o", "\u001b[?2004l\r\n"]
[1622.478, "o", "\u001b[?2004h>         insert_at += ds.end()\r\n"]
[1622.5398, "o", "\u001b[?2004l\r\n"]
[1622.6016, "o", "\u001b[?2004h>     if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+4000]:\r\n"]
[1622.6634, "o", "\u001b[?2004l\r\n"]
[1622.7252, "o", "\u001b[?2004h>         inject = (\r\n"]
[1622.787, "o", "\u001b[?2004l\r\n"]
[1622.8488, "o", "\u001b[?2004h>             \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1622.9106, "o", "\u001b[?2004l\r\n"]
[1622.9724, "o", "\u001b[?2004h>             \"    try:\\n\"\r\n"]
[1623.0342, "o", "\u001b[?2004l\r\n"]
[1623.096, "o", "\u001b[?2004h>             \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1623.1578, "o", "\u001b[?2004l\r\n"]
[1623.2196, "o", "\u001b[?2004h>             \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1623.2814, "o", "\u001b[?2004l\r\n"]
[1623.3432, "o", "\u001b[?2004h>             \"    except Exception:\\n\"\r\n"]
[1623.405, "o", "\u001b[?2004l\r\n"]
[1623.4668, "o", "\u001b[?2004h>             \"        a_size = b_size = None\\n\"\r\n"]
[1623.5286, "o", "\u001b[?2004l\r\n"]
[1623.5904, "o", "\u001b[?2004h>             \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1623.6522, "o", "\u001b[?2004l\r\n"]
[1623.714, "o", "\u001b[?2004h>             \"        return False\\n\"\r\n"]
[1623.7758, "o", "\u001b[?2004l\r\n"]
[1623.8376, "o", "\u001b[?2004h>         )\r\n"]
[1623.8994, "o", "\u001b[?2004l\r\n"]
[1623.9612, "o", "\u001b[?2004h>         src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1624.023, "o", "\u001b[?2004l\r\n"]
[1624.0848, "o", "\u001b[?2004h>         changed = True\r\n"]
[1624.1466, "o", "\u001b[?2004l\r\n"]
[1624.2084, "o", "\u001b[?2004h> if changed:\r\n"]
[1624.2702, "o", "\u001b[?2004l\r\n"]
[1624.332, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1624.3938, "o", "\u001b[?2004l\r\n"]
[1624.4556, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold or early bypass)')\r\n"]
[1624.5174, "o", "\u001b[?2004l\r\n"]
[1624.5792, "o", "\u001b[?2004h> else:\r\n"]
[1624.641, "o", "\u001b[?2004l\r\n"]
[1624.7028, "o", "\u001b[?2004h>     print('No change applied; patterns not found or already patched')\r\n"]
[1624.7646, "o", "\u001b[?2004l\r\n"]
[1624.8264, "o", "\u001b[?2004h> PY\r\n"]
[1624.8882, "o", "\u001b[?2004l\r\n"]
[1625.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1625.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1625.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1625.006, "o", "\u001b[?2004l\r\n"]
[1630.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1630.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1630.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1630.006, "o", "\u001b[?2004l\r\n"]
[1635.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1635.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via early size check/threshold; improves ar\r"]
[1635.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via early size check/threshold; improves ar\r\n"]
[1635.624, "o", "rithmetic.Ops.*\"\r\n"]
[1636.242, "o", "\u001b[?2004l\r\n"]
[1636.86, "o", "On branch main\r\n"]
[1637.478, "o", "Untracked files:\r\n"]
[1638.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1638.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1639.332, "o", "\r\n"]
[1640.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1640.002, "i", "cd asv_bench\r"]
[1640.004, "o", "cd asv_bench\r\n"]
[1640.006, "o", "\u001b[?2004l\r\n"]
[1645.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1645.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1645.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1645.097556, "o", "\u001b[?2004l\r\n"]
[1645.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1645.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1645.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1645.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1645.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1645.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1645.738444, "o", "             --                     threads         \r\n"]
[1645.83, "o", "             ------------- -------------------------\r\n"]
[1645.921556, "o", "              use_numexpr    default         1      \r\n"]
[1646.013111, "o", "             ============= ============ ============\r\n"]
[1646.104667, "o", "                  True      2.59\u00b10.1ms   2.51\u00b10.1ms \r\n"]
[1646.196222, "o", "                 False      2.44\u00b10.1ms   2.56\u00b10.1ms \r\n"]
[1646.287778, "o", "             ============= ============ ============\r\n"]
[1646.379333, "o", "\r\n"]
[1646.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1646.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ =============\u001b[0m\r\n"]
[1646.654, "o", "             --                     threads          \r\n"]
[1646.745556, "o", "             ------------- --------------------------\r\n"]
[1646.837111, "o", "              use_numexpr    default          1      \r\n"]
[1646.928667, "o", "             ============= ============ =============\r\n"]
[1647.020222, "o", "                  True      1.98\u00b10.1ms    1.84\u00b10.1ms \r\n"]
[1647.111778, "o", "                 False      2.02\u00b10.3ms   1.95\u00b10.07ms \r\n"]
[1647.203333, "o", "             ============= ============ =============\r\n"]
[1647.294889, "o", "\r\n"]
[1647.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1647.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1647.569556, "o", "             --                     threads         \r\n"]
[1647.661111, "o", "             ------------- -------------------------\r\n"]
[1647.752667, "o", "              use_numexpr    default         1      \r\n"]
[1647.844222, "o", "             ============= ============ ============\r\n"]
[1647.935778, "o", "                  True      2.67\u00b10.2ms   2.51\u00b10.1ms \r\n"]
[1648.027333, "o", "                 False      2.55\u00b10.3ms   2.71\u00b10.2ms \r\n"]
[1648.118889, "o", "             ============= ============ ============\r\n"]
[1648.210444, "o", "\r\n"]
[1648.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1648.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1648.485111, "o", "             --                     threads         \r\n"]
[1648.576667, "o", "             ------------- -------------------------\r\n"]
[1648.668222, "o", "              use_numexpr    default         1      \r\n"]
[1648.759778, "o", "             ============= ============ ============\r\n"]
[1648.851333, "o", "                  True      11.0\u00b10.3ms   11.0\u00b10.1ms \r\n"]
[1648.942889, "o", "                 False      10.7\u00b10.2ms   10.5\u00b10.1ms \r\n"]
[1649.034444, "o", "             ============= ============ ============\r\n"]
[1649.126, "o", "\r\n"]
[1649.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          47.5\u00b10.3ms\r\n"]
[1649.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                    28.9\u00b10.1ms\r\n"]
[1649.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              986\u00b130\u03bcs\r\n"]
[1649.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.9\u00b10.1ms\r\n"]
[1649.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    24.9\u00b10.1ms\r\n"]
[1649.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.68\u00b10.06ms\r\n"]
[1649.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     11.1\u00b10.06ms\r\n"]
[1649.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                     522\u00b130\u03bcs\r\n"]
[1650.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1650.002, "i", "cd /workspace/repo\r"]
[1650.004, "o", "cd /workspace/repo\r\n"]
[1650.006, "o", "\u001b[?2004l\r\n"]
[1655.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1655.002, "i", "find pandas -type f -name \"expressions.py\" -print\r"]
[1655.004, "o", "find pandas -type f -name \"expressions.py\" -print\r\n"]
[1657.478, "o", "\u001b[?2004l\r\n"]
[1660.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1660.002, "i", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r"]
[1660.004, "o", "grep -n \"should_use_numexpr\\|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation/expressions.py || true\r\n"]
[1661.654, "o", "\u001b[?2004l\r\n"]
[1663.302, "o", "\u001b[32m\u001b[K43\u001b[m\u001b[K\u001b[36m\u001b[K:\u001b[m\u001b[K\u001b[01;31m\u001b[K_MIN_ELEMENTS\u001b[m\u001b[K = 4000000\r\n"]
[1665.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1665.002, "i", "sed -n '1,200p' pandas/core/computation/expressions.py\r"]
[1665.004, "o", "sed -n '1,200p' pandas/core/computation/expressions.py\r\n"]
[1665.030597, "o", "\u001b[?2004l\r\n"]
[1665.055194, "o", "\"\"\"\r\n"]
[1665.079791, "o", "Expressions\r\n"]
[1665.104388, "o", "-----------\r\n"]
[1665.128985, "o", "\r\n"]
[1665.153582, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1665.178179, "o", "\r\n"]
[1665.202776, "o", "\"\"\"\r\n"]
[1665.227373, "o", "\r\n"]
[1665.25197, "o", "from __future__ import annotations\r\n"]
[1665.276567, "o", "\r\n"]
[1665.301164, "o", "import operator\r\n"]
[1665.325761, "o", "from typing import TYPE_CHECKING\r\n"]
[1665.350358, "o", "import warnings\r\n"]
[1665.374955, "o", "\r\n"]
[1665.399552, "o", "import numpy as np\r\n"]
[1665.424149, "o", "\r\n"]
[1665.448746, "o", "from pandas._config import get_option\r\n"]
[1665.473343, "o", "\r\n"]
[1665.49794, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1665.522537, "o", "\r\n"]
[1665.547134, "o", "from pandas.core import roperator\r\n"]
[1665.571731, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1665.596328, "o", "\r\n"]
[1665.620925, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1665.645522, "o", "    import numexpr as ne\r\n"]
[1665.670119, "o", "\r\n"]
[1665.694716, "o", "if TYPE_CHECKING:\r\n"]
[1665.719313, "o", "    from pandas._typing import FuncType\r\n"]
[1665.74391, "o", "\r\n"]
[1665.768507, "o", "_TEST_MODE: bool | None = None\r\n"]
[1665.793104, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1665.817701, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1665.842299, "o", "_evaluate: FuncType | None = None\r\n"]
[1665.866896, "o", "_where: FuncType | None = None\r\n"]
[1665.891493, "o", "\r\n"]
[1665.91609, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1665.940687, "o", "_ALLOWED_DTYPES = {\r\n"]
[1665.965284, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1665.989881, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1666.014478, "o", "}\r\n"]
[1666.039075, "o", "\r\n"]
[1666.063672, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1666.088269, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1666.112866, "o", "\r\n"]
[1666.137463, "o", "\r\n"]
[1666.16206, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1666.186657, "o", "    # set/unset to use numexpr\r\n"]
[1666.211254, "o", "    global USE_NUMEXPR\r\n"]
[1666.235851, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1666.260448, "o", "        USE_NUMEXPR = v\r\n"]
[1666.285045, "o", "\r\n"]
[1666.309642, "o", "    # choose what we are going to do\r\n"]
[1666.334239, "o", "    global _evaluate, _where\r\n"]
[1666.358836, "o", "\r\n"]
[1666.383433, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1666.40803, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1666.432627, "o", "\r\n"]
[1666.457224, "o", "\r\n"]
[1666.481821, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1666.506418, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1666.531015, "o", "    # otherwise reset\r\n"]
[1666.555612, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1666.580209, "o", "        if n is None:\r\n"]
[1666.604806, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1666.629403, "o", "        ne.set_num_threads(n)\r\n"]
[1666.654, "o", "\r\n"]
[1666.678597, "o", "\r\n"]
[1666.703194, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1666.727791, "o", "    \"\"\"\r\n"]
[1666.752388, "o", "    Standard evaluation.\r\n"]
[1666.776985, "o", "    \"\"\"\r\n"]
[1666.801582, "o", "    if _TEST_MODE:\r\n"]
[1666.826179, "o", "        _store_test_result(False)\r\n"]
[1666.850776, "o", "    return op(left_op, right_op)\r\n"]
[1666.875373, "o", "\r\n"]
[1666.89997, "o", "\r\n"]
[1666.924567, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1666.949164, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1666.973761, "o", "    if op_str is not None:\r\n"]
[1666.998358, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1667.022955, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1667.047552, "o", "            # check for dtype compatibility\r\n"]
[1667.072149, "o", "            dtypes: set[str] = set()\r\n"]
[1667.096746, "o", "            for o in [left_op, right_op]:\r\n"]
[1667.121343, "o", "                # ndarray and Series Case\r\n"]
[1667.14594, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1667.170537, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1667.195134, "o", "\r\n"]
[1667.219731, "o", "            # allowed are a superset\r\n"]
[1667.244328, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1667.268925, "o", "                return True\r\n"]
[1667.293522, "o", "\r\n"]
[1667.318119, "o", "    return False\r\n"]
[1667.342716, "o", "\r\n"]
[1667.367313, "o", "\r\n"]
[1667.39191, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1667.416507, "o", "    result = None\r\n"]
[1667.441104, "o", "\r\n"]
[1667.465701, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1667.490299, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1667.514896, "o", "        if is_reversed:\r\n"]
[1667.539493, "o", "            # we were originally called by a reversed op method\r\n"]
[1667.56409, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1667.588687, "o", "\r\n"]
[1667.613284, "o", "        left_value = left_op\r\n"]
[1667.637881, "o", "        right_value = right_op\r\n"]
[1667.662478, "o", "\r\n"]
[1667.687075, "o", "        try:\r\n"]
[1667.711672, "o", "            result = ne.evaluate(\r\n"]
[1667.736269, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1667.760866, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1667.785463, "o", "                casting=\"safe\",\r\n"]
[1667.81006, "o", "            )\r\n"]
[1667.834657, "o", "        except TypeError:\r\n"]
[1667.859254, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1667.883851, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1667.908448, "o", "            pass\r\n"]
[1667.933045, "o", "        except NotImplementedError:\r\n"]
[1667.957642, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1667.982239, "o", "                pass\r\n"]
[1668.006836, "o", "            else:\r\n"]
[1668.031433, "o", "                raise\r\n"]
[1668.05603, "o", "\r\n"]
[1668.080627, "o", "        if is_reversed:\r\n"]
[1668.105224, "o", "            # reverse order to original for fallback\r\n"]
[1668.129821, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1668.154418, "o", "\r\n"]
[1668.179015, "o", "    if _TEST_MODE:\r\n"]
[1668.203612, "o", "        _store_test_result(result is not None)\r\n"]
[1668.228209, "o", "\r\n"]
[1668.252806, "o", "    if result is None:\r\n"]
[1668.277403, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1668.302, "o", "\r\n"]
[1668.326597, "o", "    return result\r\n"]
[1668.351194, "o", "\r\n"]
[1668.375791, "o", "\r\n"]
[1668.400388, "o", "_op_str_mapping = {\r\n"]
[1668.424985, "o", "    operator.add: \"+\",\r\n"]
[1668.449582, "o", "    roperator.radd: \"+\",\r\n"]
[1668.474179, "o", "    operator.mul: \"*\",\r\n"]
[1668.498776, "o", "    roperator.rmul: \"*\",\r\n"]
[1668.523373, "o", "    operator.sub: \"-\",\r\n"]
[1668.54797, "o", "    roperator.rsub: \"-\",\r\n"]
[1668.572567, "o", "    operator.truediv: \"/\",\r\n"]
[1668.597164, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1668.621761, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1668.646358, "o", "    operator.floordiv: None,\r\n"]
[1668.670955, "o", "    roperator.rfloordiv: None,\r\n"]
[1668.695552, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1668.720149, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1668.744746, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1668.769343, "o", "    operator.mod: None,\r\n"]
[1668.79394, "o", "    roperator.rmod: None,\r\n"]
[1668.818537, "o", "    operator.pow: \"**\",\r\n"]
[1668.843134, "o", "    roperator.rpow: \"**\",\r\n"]
[1668.867731, "o", "    operator.eq: \"==\",\r\n"]
[1668.892328, "o", "    operator.ne: \"!=\",\r\n"]
[1668.916925, "o", "    operator.le: \"<=\",\r\n"]
[1668.941522, "o", "    operator.lt: \"<\",\r\n"]
[1668.966119, "o", "    operator.ge: \">=\",\r\n"]
[1668.990716, "o", "    operator.gt: \">\",\r\n"]
[1669.015313, "o", "    operator.and_: \"&\",\r\n"]
[1669.03991, "o", "    roperator.rand_: \"&\",\r\n"]
[1669.064507, "o", "    operator.or_: \"|\",\r\n"]
[1669.089104, "o", "    roperator.ror_: \"|\",\r\n"]
[1669.113701, "o", "    operator.xor: \"^\",\r\n"]
[1669.138299, "o", "    roperator.rxor: \"^\",\r\n"]
[1669.162896, "o", "    divmod: None,\r\n"]
[1669.187493, "o", "    roperator.rdivmod: None,\r\n"]
[1669.21209, "o", "}\r\n"]
[1669.236687, "o", "\r\n"]
[1669.261284, "o", "\r\n"]
[1669.285881, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1669.310478, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1669.335075, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1669.359672, "o", "\r\n"]
[1669.384269, "o", "\r\n"]
[1669.408866, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1669.433463, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1669.45806, "o", "    result = None\r\n"]
[1669.482657, "o", "\r\n"]
[1669.507254, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1669.531851, "o", "        result = ne.evaluate(\r\n"]
[1669.556448, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1669.581045, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1669.605642, "o", "            casting=\"safe\",\r\n"]
[1669.630239, "o", "        )\r\n"]
[1669.654836, "o", "\r\n"]
[1669.679433, "o", "    if result is None:\r\n"]
[1669.70403, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1669.728627, "o", "\r\n"]
[1669.753224, "o", "    return result\r\n"]
[1669.777821, "o", "\r\n"]
[1669.802418, "o", "\r\n"]
[1669.827015, "o", "# turn myself on\r\n"]
[1669.851612, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1669.876209, "o", "\r\n"]
[1669.900806, "o", "\r\n"]
[1669.925403, "o", "def _has_bool_dtype(x):\r\n"]
[1670.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1670.002, "i", "sed -n '200,500p' pandas/core/computation/expressions.py\r"]
[1670.004, "o", "sed -n '200,500p' pandas/core/computation/expressions.py\r\n"]
[1670.059739, "o", "\u001b[?2004l\r\n"]
[1670.113478, "o", "    try:\r\n"]
[1670.167217, "o", "        return x.dtype == bool\r\n"]
[1670.220957, "o", "    except AttributeError:\r\n"]
[1670.274696, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1670.328435, "o", "\r\n"]
[1670.382174, "o", "\r\n"]
[1670.435913, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1670.489652, "o", "\r\n"]
[1670.543391, "o", "\r\n"]
[1670.59713, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1670.65087, "o", "    \"\"\"\r\n"]
[1670.704609, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1670.758348, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1670.812087, "o", "    boolean ops.\r\n"]
[1670.865826, "o", "    \"\"\"\r\n"]
[1670.919565, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1670.973304, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1671.027043, "o", "            warnings.warn(\r\n"]
[1671.080783, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1671.134522, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1671.188261, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1671.242, "o", "                stacklevel=find_stack_level(),\r\n"]
[1671.295739, "o", "            )\r\n"]
[1671.349478, "o", "            return True\r\n"]
[1671.403217, "o", "    return False\r\n"]
[1671.456957, "o", "\r\n"]
[1671.510696, "o", "\r\n"]
[1671.564435, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1671.618174, "o", "    \"\"\"\r\n"]
[1671.671913, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1671.725652, "o", "\r\n"]
[1671.779391, "o", "    Parameters\r\n"]
[1671.83313, "o", "    ----------\r\n"]
[1671.88687, "o", "    op : the actual operand\r\n"]
[1671.940609, "o", "    left_op : left operand\r\n"]
[1671.994348, "o", "    right_op : right operand\r\n"]
[1672.048087, "o", "    use_numexpr : bool, default True\r\n"]
[1672.101826, "o", "        Whether to try to use numexpr.\r\n"]
[1672.155565, "o", "    \"\"\"\r\n"]
[1672.209304, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1672.263043, "o", "    if op_str is not None:\r\n"]
[1672.316783, "o", "        if use_numexpr:\r\n"]
[1672.370522, "o", "            # error: \"None\" not callable\r\n"]
[1672.424261, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1672.478, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1672.531739, "o", "\r\n"]
[1672.585478, "o", "\r\n"]
[1672.639217, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1672.692957, "o", "    \"\"\"\r\n"]
[1672.746696, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1672.800435, "o", "\r\n"]
[1672.854174, "o", "    Parameters\r\n"]
[1672.907913, "o", "    ----------\r\n"]
[1672.961652, "o", "    cond : np.ndarray[bool]\r\n"]
[1673.015391, "o", "    left_op : return if cond is True\r\n"]
[1673.06913, "o", "    right_op : return if cond is False\r\n"]
[1673.12287, "o", "    use_numexpr : bool, default True\r\n"]
[1673.176609, "o", "        Whether to try to use numexpr.\r\n"]
[1673.230348, "o", "    \"\"\"\r\n"]
[1673.284087, "o", "    assert _where is not None\r\n"]
[1673.337826, "o", "    if use_numexpr:\r\n"]
[1673.391565, "o", "        return _where(cond, left_op, right_op)\r\n"]
[1673.445304, "o", "    else:\r\n"]
[1673.499043, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[1673.552783, "o", "\r\n"]
[1673.606522, "o", "\r\n"]
[1673.660261, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[1673.714, "o", "    \"\"\"\r\n"]
[1673.767739, "o", "    Keeps track of whether numexpr was used.\r\n"]
[1673.821478, "o", "\r\n"]
[1673.875217, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[1673.928957, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[1673.982696, "o", "    \"\"\"\r\n"]
[1674.036435, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[1674.090174, "o", "    _TEST_MODE = v\r\n"]
[1674.143913, "o", "    _TEST_RESULT = []\r\n"]
[1674.197652, "o", "\r\n"]
[1674.251391, "o", "\r\n"]
[1674.30513, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[1674.35887, "o", "    if used_numexpr:\r\n"]
[1674.412609, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[1674.466348, "o", "\r\n"]
[1674.520087, "o", "\r\n"]
[1674.573826, "o", "def get_test_result() -> list[bool]:\r\n"]
[1674.627565, "o", "    \"\"\"\r\n"]
[1674.681304, "o", "    Get test result and reset test_results.\r\n"]
[1674.735043, "o", "    \"\"\"\r\n"]
[1674.788783, "o", "    global _TEST_RESULT\r\n"]
[1674.842522, "o", "    res = _TEST_RESULT\r\n"]
[1674.896261, "o", "    _TEST_RESULT = []\r\n"]
[1675.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1675.002, "i", "python - << 'PY'\r"]
[1675.004, "o", "python - << 'PY'\r\n"]
[1675.0678, "o", "\u001b[?2004l\r\n"]
[1675.1296, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1675.1914, "o", "\u001b[?2004l\r\n"]
[1675.2532, "o", "\u001b[?2004h> import re\r\n"]
[1675.315, "o", "\u001b[?2004l\r\n"]
[1675.3768, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1675.4386, "o", "\u001b[?2004l\r\n"]
[1675.5004, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1675.5622, "o", "\u001b[?2004l\r\n"]
[1675.624, "o", "\u001b[?2004h> changed = False\r\n"]
[1675.6858, "o", "\u001b[?2004l\r\n"]
[1675.7476, "o", "\u001b[?2004h> # Try to bump an existing threshold constant if present\r\n"]
[1675.8094, "o", "\u001b[?2004l\r\n"]
[1675.8712, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1675.933, "o", "\u001b[?2004l\r\n"]
[1675.9948, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1676.0566, "o", "\u001b[?2004l\r\n"]
[1676.1184, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1676.1802, "o", "\u001b[?2004l\r\n"]
[1676.242, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1676.3038, "o", "\u001b[?2004l\r\n"]
[1676.3656, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1676.4274, "o", "\u001b[?2004l\r\n"]
[1676.4892, "o", "\u001b[?2004h>     changed = True\r\n"]
[1676.551, "o", "\u001b[?2004l\r\n"]
[1676.6128, "o", "\u001b[?2004h> # Inject early size-based bypass at the start of should_use_numexpr, after def and optional docstring\r\n"]
[1676.6746, "o", "\u001b[?2004l\r\n"]
[1676.7364, "o", "\u001b[?2004h> m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1676.7982, "o", "\u001b[?2004l\r\n"]
[1676.86, "o", "\u001b[?2004h> if m:\r\n"]
[1676.9218, "o", "\u001b[?2004l\r\n"]
[1676.9836, "o", "\u001b[?2004h>     insert_at = m.end()\r\n"]
[1677.0454, "o", "\u001b[?2004l\r\n"]
[1677.1072, "o", "\u001b[?2004h>     # If a docstring follows, skip it\r\n"]
[1677.169, "o", "\u001b[?2004l\r\n"]
[1677.2308, "o", "\u001b[?2004h>     ds = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1677.2926, "o", "\u001b[?2004l\r\n"]
[1677.3544, "o", "\u001b[?2004h>     if ds:\r\n"]
[1677.4162, "o", "\u001b[?2004l\r\n"]
[1677.478, "o", "\u001b[?2004h>         insert_at += ds.end()\r\n"]
[1677.5398, "o", "\u001b[?2004l\r\n"]
[1677.6016, "o", "\u001b[?2004h>     if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+5000]:\r\n"]
[1677.6634, "o", "\u001b[?2004l\r\n"]
[1677.7252, "o", "\u001b[?2004h>         inject = (\r\n"]
[1677.787, "o", "\u001b[?2004l\r\n"]
[1677.8488, "o", "\u001b[?2004h>             \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1677.9106, "o", "\u001b[?2004l\r\n"]
[1677.9724, "o", "\u001b[?2004h>             \"    try:\\n\"\r\n"]
[1678.0342, "o", "\u001b[?2004l\r\n"]
[1678.096, "o", "\u001b[?2004h>             \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1678.1578, "o", "\u001b[?2004l\r\n"]
[1678.2196, "o", "\u001b[?2004h>             \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1678.2814, "o", "\u001b[?2004l\r\n"]
[1678.3432, "o", "\u001b[?2004h>             \"    except Exception:\\n\"\r\n"]
[1678.405, "o", "\u001b[?2004l\r\n"]
[1678.4668, "o", "\u001b[?2004h>             \"        a_size = b_size = None\\n\"\r\n"]
[1678.5286, "o", "\u001b[?2004l\r\n"]
[1678.5904, "o", "\u001b[?2004h>             \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1678.6522, "o", "\u001b[?2004l\r\n"]
[1678.714, "o", "\u001b[?2004h>             \"        return False\\n\"\r\n"]
[1678.7758, "o", "\u001b[?2004l\r\n"]
[1678.8376, "o", "\u001b[?2004h>         )\r\n"]
[1678.8994, "o", "\u001b[?2004l\r\n"]
[1678.9612, "o", "\u001b[?2004h>         src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1679.023, "o", "\u001b[?2004l\r\n"]
[1679.0848, "o", "\u001b[?2004h>         changed = True\r\n"]
[1679.1466, "o", "\u001b[?2004l\r\n"]
[1679.2084, "o", "\u001b[?2004h> if changed:\r\n"]
[1679.2702, "o", "\u001b[?2004l\r\n"]
[1679.332, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1679.3938, "o", "\u001b[?2004l\r\n"]
[1679.4556, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold and/or early bypass)')\r\n"]
[1679.5174, "o", "\u001b[?2004l\r\n"]
[1679.5792, "o", "\u001b[?2004h> else:\r\n"]
[1679.641, "o", "\u001b[?2004l\r\n"]
[1679.7028, "o", "\u001b[?2004h>     print('No change applied; patterns not found or already patched')\r\n"]
[1679.7646, "o", "\u001b[?2004l\r\n"]
[1679.8264, "o", "\u001b[?2004h> PY\r\n"]
[1679.8882, "o", "\u001b[?2004l\r\n"]
[1680.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1680.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1680.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1680.006, "o", "\u001b[?2004l\r\n"]
[1685.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1685.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1685.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1685.006, "o", "\u001b[?2004l\r\n"]
[1690.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1690.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via early size check/threshold; improves ar\r"]
[1690.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via early size check/threshold; improves ar\r\n"]
[1690.624, "o", "rithmetic.Ops.*\"\r\n"]
[1691.242, "o", "\u001b[?2004l\r\n"]
[1691.86, "o", "On branch main\r\n"]
[1692.478, "o", "Untracked files:\r\n"]
[1693.096, "o", "  (use \"git add <file>...\" to include in what will be committed)\r\n"]
[1693.714, "o", "\t\u001b[31m_version_meson.py\u001b[m\r\n"]
[1694.332, "o", "\r\n"]
[1695.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1695.002, "i", "cd asv_bench\r"]
[1695.004, "o", "cd asv_bench\r\n"]
[1695.006, "o", "\u001b[?2004l\r\n"]
[1700.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1700.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1700.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1700.097556, "o", "\u001b[?2004l\r\n"]
[1700.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1700.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1700.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1700.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1700.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1700.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1700.738444, "o", "             --                      threads          \r\n"]
[1700.83, "o", "             ------------- ---------------------------\r\n"]
[1700.921556, "o", "              use_numexpr     default          1      \r\n"]
[1701.013111, "o", "             ============= ============= =============\r\n"]
[1701.104667, "o", "                  True       2.45\u00b10.2ms    2.42\u00b10.1ms \r\n"]
[1701.196222, "o", "                 False      2.38\u00b10.06ms   2.32\u00b10.07ms \r\n"]
[1701.287778, "o", "             ============= ============= =============\r\n"]
[1701.379333, "o", "\r\n"]
[1701.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1701.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1701.654, "o", "             --                      threads          \r\n"]
[1701.745556, "o", "             ------------- ---------------------------\r\n"]
[1701.837111, "o", "              use_numexpr     default          1      \r\n"]
[1701.928667, "o", "             ============= ============= =============\r\n"]
[1702.020222, "o", "                  True      1.75\u00b10.09ms   1.72\u00b10.09ms \r\n"]
[1702.111778, "o", "                 False      1.77\u00b10.07ms    1.95\u00b10.2ms \r\n"]
[1702.203333, "o", "             ============= ============= =============\r\n"]
[1702.294889, "o", "\r\n"]
[1702.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1702.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= ============\u001b[0m\r\n"]
[1702.569556, "o", "             --                     threads          \r\n"]
[1702.661111, "o", "             ------------- --------------------------\r\n"]
[1702.752667, "o", "              use_numexpr     default         1      \r\n"]
[1702.844222, "o", "             ============= ============= ============\r\n"]
[1702.935778, "o", "                  True      2.32\u00b10.06ms   2.30\u00b10.1ms \r\n"]
[1703.027333, "o", "                 False       2.30\u00b10.2ms   2.31\u00b10.1ms \r\n"]
[1703.118889, "o", "             ============= ============= ============\r\n"]
[1703.210444, "o", "\r\n"]
[1703.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1703.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1703.485111, "o", "             --                     threads         \r\n"]
[1703.576667, "o", "             ------------- -------------------------\r\n"]
[1703.668222, "o", "              use_numexpr    default         1      \r\n"]
[1703.759778, "o", "             ============= ============ ============\r\n"]
[1703.851333, "o", "                  True      10.5\u00b10.2ms   10.3\u00b10.1ms \r\n"]
[1703.942889, "o", "                 False      10.7\u00b10.4ms   10.4\u00b10.2ms \r\n"]
[1704.034444, "o", "             ============= ============ ============\r\n"]
[1704.126, "o", "\r\n"]
[1704.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.4\u00b10.2ms\r\n"]
[1704.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.5\u00b10.09ms\r\n"]
[1704.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              891\u00b120\u03bcs\r\n"]
[1704.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.5\u00b10.1ms\r\n"]
[1704.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                    24.7\u00b10.1ms\r\n"]
[1704.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.66\u00b10.07ms\r\n"]
[1704.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      11.1\u00b10.3ms\r\n"]
[1704.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      496\u00b15\u03bcs\r\n"]
[1705.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1705.002, "i", "cd /workspace/repo\r"]
[1705.004, "o", "cd /workspace/repo\r\n"]
[1705.006, "o", "\u001b[?2004l\r\n"]
[1710.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1710.002, "i", "ls -la pandas/core/computation\r"]
[1710.004, "o", "ls -la pandas/core/computation\r\n"]
[1710.296824, "o", "\u001b[?2004l\r\n"]
[1710.587647, "o", "total 152\r\n"]
[1710.878471, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[0m\u001b[01;34m.\u001b[0m\r\n"]
[1711.169294, "o", "drwxr-xr-x 1 root root  4096 Sep 12 21:44 \u001b[01;34m..\u001b[0m\r\n"]
[1711.460118, "o", "-rw-r--r-- 1 root root     0 Sep 12 21:42 __init__.py\r\n"]
[1711.750941, "o", "-rw-r--r-- 1 root root  6735 Sep 12 21:42 align.py\r\n"]
[1712.041765, "o", "-rw-r--r-- 1 root root    65 Sep 12 21:42 api.py\r\n"]
[1712.332588, "o", "-rw-r--r-- 1 root root   226 Sep 12 21:42 check.py\r\n"]
[1712.623412, "o", "-rw-r--r-- 1 root root  1442 Sep 12 21:42 common.py\r\n"]
[1712.914235, "o", "-rw-r--r-- 1 root root  3462 Sep 12 21:42 engines.py\r\n"]
[1713.205059, "o", "-rw-r--r-- 1 root root 15281 Sep 12 21:42 eval.py\r\n"]
[1713.495882, "o", "-rw-r--r-- 1 root root 25337 Sep 12 21:44 expr.py\r\n"]
[1713.786706, "o", "-rw-r--r-- 1 root root  7966 Oct  1 18:20 expressions.py\r\n"]
[1714.077529, "o", "-rw-r--r-- 1 root root 14435 Sep 12 21:42 ops.py\r\n"]
[1714.368353, "o", "-rw-r--r-- 1 root root  7711 Sep 12 21:42 parsing.py\r\n"]
[1714.659176, "o", "-rw-r--r-- 1 root root 21077 Sep 12 21:44 pytables.py\r\n"]
[1715.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1715.002, "i", "grep -n \"should_use_numexpr\\|_evaluate_numexpr\\|def evaluate\\(|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation\r"]
[1715.004, "o", "grep -n \"should_use_numexpr\\|_evaluate_numexpr\\|def evaluate\\(|MIN_ELEMENTS\\|_MIN_ELEMENTS\" pandas/core/computation\r\n"]
[1716.654, "o", "n/expressions.py || true\r\n"]
[1718.302, "o", "\u001b[?2004l\r\n"]
[1720.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1720.002, "i", "sed -n '1,240p' pandas/core/computation/expressions.py\r"]
[1720.004, "o", "sed -n '1,240p' pandas/core/computation/expressions.py\r\n"]
[1720.026515, "o", "\u001b[?2004l\r\n"]
[1720.047029, "o", "\"\"\"\r\n"]
[1720.067544, "o", "Expressions\r\n"]
[1720.088058, "o", "-----------\r\n"]
[1720.108573, "o", "\r\n"]
[1720.129087, "o", "Offer fast expression evaluation through numexpr\r\n"]
[1720.149602, "o", "\r\n"]
[1720.170116, "o", "\"\"\"\r\n"]
[1720.190631, "o", "\r\n"]
[1720.211145, "o", "from __future__ import annotations\r\n"]
[1720.23166, "o", "\r\n"]
[1720.252174, "o", "import operator\r\n"]
[1720.272689, "o", "from typing import TYPE_CHECKING\r\n"]
[1720.293203, "o", "import warnings\r\n"]
[1720.313718, "o", "\r\n"]
[1720.334232, "o", "import numpy as np\r\n"]
[1720.354747, "o", "\r\n"]
[1720.375261, "o", "from pandas._config import get_option\r\n"]
[1720.395776, "o", "\r\n"]
[1720.41629, "o", "from pandas.util._exceptions import find_stack_level\r\n"]
[1720.436805, "o", "\r\n"]
[1720.45732, "o", "from pandas.core import roperator\r\n"]
[1720.477834, "o", "from pandas.core.computation.check import NUMEXPR_INSTALLED\r\n"]
[1720.498349, "o", "\r\n"]
[1720.518863, "o", "if NUMEXPR_INSTALLED:\r\n"]
[1720.539378, "o", "    import numexpr as ne\r\n"]
[1720.559892, "o", "\r\n"]
[1720.580407, "o", "if TYPE_CHECKING:\r\n"]
[1720.600921, "o", "    from pandas._typing import FuncType\r\n"]
[1720.621436, "o", "\r\n"]
[1720.64195, "o", "_TEST_MODE: bool | None = None\r\n"]
[1720.662465, "o", "_TEST_RESULT: list[bool] = []\r\n"]
[1720.682979, "o", "USE_NUMEXPR = NUMEXPR_INSTALLED\r\n"]
[1720.703494, "o", "_evaluate: FuncType | None = None\r\n"]
[1720.724008, "o", "_where: FuncType | None = None\r\n"]
[1720.744523, "o", "\r\n"]
[1720.765037, "o", "# the set of dtypes that we will allow pass to numexpr\r\n"]
[1720.785552, "o", "_ALLOWED_DTYPES = {\r\n"]
[1720.806066, "o", "    \"evaluate\": {\"int64\", \"int32\", \"float64\", \"float32\", \"bool\"},\r\n"]
[1720.826581, "o", "    \"where\": {\"int64\", \"float64\", \"bool\"},\r\n"]
[1720.847095, "o", "}\r\n"]
[1720.86761, "o", "\r\n"]
[1720.888124, "o", "# the minimum prod shape that we will use numexpr\r\n"]
[1720.908639, "o", "_MIN_ELEMENTS = 4000000\r\n"]
[1720.929154, "o", "\r\n"]
[1720.949668, "o", "\r\n"]
[1720.970183, "o", "def set_use_numexpr(v: bool = True) -> None:\r\n"]
[1720.990697, "o", "    # set/unset to use numexpr\r\n"]
[1721.011212, "o", "    global USE_NUMEXPR\r\n"]
[1721.031726, "o", "    if NUMEXPR_INSTALLED:\r\n"]
[1721.052241, "o", "        USE_NUMEXPR = v\r\n"]
[1721.072755, "o", "\r\n"]
[1721.09327, "o", "    # choose what we are going to do\r\n"]
[1721.113784, "o", "    global _evaluate, _where\r\n"]
[1721.134299, "o", "\r\n"]
[1721.154813, "o", "    _evaluate = _evaluate_numexpr if USE_NUMEXPR else _evaluate_standard\r\n"]
[1721.175328, "o", "    _where = _where_numexpr if USE_NUMEXPR else _where_standard\r\n"]
[1721.195842, "o", "\r\n"]
[1721.216357, "o", "\r\n"]
[1721.236871, "o", "def set_numexpr_threads(n=None) -> None:\r\n"]
[1721.257386, "o", "    # if we are using numexpr, set the threads to n\r\n"]
[1721.2779, "o", "    # otherwise reset\r\n"]
[1721.298415, "o", "    if NUMEXPR_INSTALLED and USE_NUMEXPR:\r\n"]
[1721.318929, "o", "        if n is None:\r\n"]
[1721.339444, "o", "            n = ne.detect_number_of_cores()\r\n"]
[1721.359959, "o", "        ne.set_num_threads(n)\r\n"]
[1721.380473, "o", "\r\n"]
[1721.400988, "o", "\r\n"]
[1721.421502, "o", "def _evaluate_standard(op, op_str, left_op, right_op):\r\n"]
[1721.442017, "o", "    \"\"\"\r\n"]
[1721.462531, "o", "    Standard evaluation.\r\n"]
[1721.483046, "o", "    \"\"\"\r\n"]
[1721.50356, "o", "    if _TEST_MODE:\r\n"]
[1721.524075, "o", "        _store_test_result(False)\r\n"]
[1721.544589, "o", "    return op(left_op, right_op)\r\n"]
[1721.565104, "o", "\r\n"]
[1721.585618, "o", "\r\n"]
[1721.606133, "o", "def _can_use_numexpr(op, op_str, left_op, right_op, dtype_check) -> bool:\r\n"]
[1721.626647, "o", "    \"\"\"return left_op boolean if we WILL be using numexpr\"\"\"\r\n"]
[1721.647162, "o", "    if op_str is not None:\r\n"]
[1721.667676, "o", "        # required min elements (otherwise we are adding overhead)\r\n"]
[1721.688191, "o", "        if left_op.size > _MIN_ELEMENTS:\r\n"]
[1721.708705, "o", "            # check for dtype compatibility\r\n"]
[1721.72922, "o", "            dtypes: set[str] = set()\r\n"]
[1721.749734, "o", "            for o in [left_op, right_op]:\r\n"]
[1721.770249, "o", "                # ndarray and Series Case\r\n"]
[1721.790763, "o", "                if hasattr(o, \"dtype\"):\r\n"]
[1721.811278, "o", "                    dtypes |= {o.dtype.name}\r\n"]
[1721.831793, "o", "\r\n"]
[1721.852307, "o", "            # allowed are a superset\r\n"]
[1721.872822, "o", "            if not len(dtypes) or _ALLOWED_DTYPES[dtype_check] >= dtypes:\r\n"]
[1721.893336, "o", "                return True\r\n"]
[1721.913851, "o", "\r\n"]
[1721.934365, "o", "    return False\r\n"]
[1721.95488, "o", "\r\n"]
[1721.975394, "o", "\r\n"]
[1721.995909, "o", "def _evaluate_numexpr(op, op_str, left_op, right_op):\r\n"]
[1722.016423, "o", "    result = None\r\n"]
[1722.036938, "o", "\r\n"]
[1722.057452, "o", "    if _can_use_numexpr(op, op_str, left_op, right_op, \"evaluate\"):\r\n"]
[1722.077967, "o", "        is_reversed = op.__name__.strip(\"_\").startswith(\"r\")\r\n"]
[1722.098481, "o", "        if is_reversed:\r\n"]
[1722.118996, "o", "            # we were originally called by a reversed op method\r\n"]
[1722.13951, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1722.160025, "o", "\r\n"]
[1722.180539, "o", "        left_value = left_op\r\n"]
[1722.201054, "o", "        right_value = right_op\r\n"]
[1722.221568, "o", "\r\n"]
[1722.242083, "o", "        try:\r\n"]
[1722.262598, "o", "            result = ne.evaluate(\r\n"]
[1722.283112, "o", "                f\"left_value {op_str} right_value\",\r\n"]
[1722.303627, "o", "                local_dict={\"left_value\": left_value, \"right_value\": right_value},\r\n"]
[1722.324141, "o", "                casting=\"safe\",\r\n"]
[1722.344656, "o", "            )\r\n"]
[1722.36517, "o", "        except TypeError:\r\n"]
[1722.385685, "o", "            # numexpr raises eg for array ** array with integers\r\n"]
[1722.406199, "o", "            # (https://github.com/pydata/numexpr/issues/379)\r\n"]
[1722.426714, "o", "            pass\r\n"]
[1722.447228, "o", "        except NotImplementedError:\r\n"]
[1722.467743, "o", "            if _bool_arith_fallback(op_str, left_op, right_op):\r\n"]
[1722.488257, "o", "                pass\r\n"]
[1722.508772, "o", "            else:\r\n"]
[1722.529286, "o", "                raise\r\n"]
[1722.549801, "o", "\r\n"]
[1722.570315, "o", "        if is_reversed:\r\n"]
[1722.59083, "o", "            # reverse order to original for fallback\r\n"]
[1722.611344, "o", "            left_op, right_op = right_op, left_op\r\n"]
[1722.631859, "o", "\r\n"]
[1722.652373, "o", "    if _TEST_MODE:\r\n"]
[1722.672888, "o", "        _store_test_result(result is not None)\r\n"]
[1722.693402, "o", "\r\n"]
[1722.713917, "o", "    if result is None:\r\n"]
[1722.734432, "o", "        result = _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1722.754946, "o", "\r\n"]
[1722.775461, "o", "    return result\r\n"]
[1722.795975, "o", "\r\n"]
[1722.81649, "o", "\r\n"]
[1722.837004, "o", "_op_str_mapping = {\r\n"]
[1722.857519, "o", "    operator.add: \"+\",\r\n"]
[1722.878033, "o", "    roperator.radd: \"+\",\r\n"]
[1722.898548, "o", "    operator.mul: \"*\",\r\n"]
[1722.919062, "o", "    roperator.rmul: \"*\",\r\n"]
[1722.939577, "o", "    operator.sub: \"-\",\r\n"]
[1722.960091, "o", "    roperator.rsub: \"-\",\r\n"]
[1722.980606, "o", "    operator.truediv: \"/\",\r\n"]
[1723.00112, "o", "    roperator.rtruediv: \"/\",\r\n"]
[1723.021635, "o", "    # floordiv not supported by numexpr 2.x\r\n"]
[1723.042149, "o", "    operator.floordiv: None,\r\n"]
[1723.062664, "o", "    roperator.rfloordiv: None,\r\n"]
[1723.083178, "o", "    # we require Python semantics for mod of negative for backwards compatibility\r\n"]
[1723.103693, "o", "    # see https://github.com/pydata/numexpr/issues/365\r\n"]
[1723.124207, "o", "    # so sticking with unaccelerated for now GH#36552\r\n"]
[1723.144722, "o", "    operator.mod: None,\r\n"]
[1723.165237, "o", "    roperator.rmod: None,\r\n"]
[1723.185751, "o", "    operator.pow: \"**\",\r\n"]
[1723.206266, "o", "    roperator.rpow: \"**\",\r\n"]
[1723.22678, "o", "    operator.eq: \"==\",\r\n"]
[1723.247295, "o", "    operator.ne: \"!=\",\r\n"]
[1723.267809, "o", "    operator.le: \"<=\",\r\n"]
[1723.288324, "o", "    operator.lt: \"<\",\r\n"]
[1723.308838, "o", "    operator.ge: \">=\",\r\n"]
[1723.329353, "o", "    operator.gt: \">\",\r\n"]
[1723.349867, "o", "    operator.and_: \"&\",\r\n"]
[1723.370382, "o", "    roperator.rand_: \"&\",\r\n"]
[1723.390896, "o", "    operator.or_: \"|\",\r\n"]
[1723.411411, "o", "    roperator.ror_: \"|\",\r\n"]
[1723.431925, "o", "    operator.xor: \"^\",\r\n"]
[1723.45244, "o", "    roperator.rxor: \"^\",\r\n"]
[1723.472954, "o", "    divmod: None,\r\n"]
[1723.493469, "o", "    roperator.rdivmod: None,\r\n"]
[1723.513983, "o", "}\r\n"]
[1723.534498, "o", "\r\n"]
[1723.555012, "o", "\r\n"]
[1723.575527, "o", "def _where_standard(cond, left_op, right_op):\r\n"]
[1723.596041, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1723.616556, "o", "    return np.where(cond, left_op, right_op)\r\n"]
[1723.637071, "o", "\r\n"]
[1723.657585, "o", "\r\n"]
[1723.6781, "o", "def _where_numexpr(cond, left_op, right_op):\r\n"]
[1723.698614, "o", "    # Caller is responsible for extracting ndarray if necessary\r\n"]
[1723.719129, "o", "    result = None\r\n"]
[1723.739643, "o", "\r\n"]
[1723.760158, "o", "    if _can_use_numexpr(None, \"where\", left_op, right_op, \"where\"):\r\n"]
[1723.780672, "o", "        result = ne.evaluate(\r\n"]
[1723.801187, "o", "            \"where(cond_value, a_value, b_value)\",\r\n"]
[1723.821701, "o", "            local_dict={\"cond_value\": cond, \"a_value\": left_op, \"b_value\": right_op},\r\n"]
[1723.842216, "o", "            casting=\"safe\",\r\n"]
[1723.86273, "o", "        )\r\n"]
[1723.883245, "o", "\r\n"]
[1723.903759, "o", "    if result is None:\r\n"]
[1723.924274, "o", "        result = _where_standard(cond, left_op, right_op)\r\n"]
[1723.944788, "o", "\r\n"]
[1723.965303, "o", "    return result\r\n"]
[1723.985817, "o", "\r\n"]
[1724.006332, "o", "\r\n"]
[1724.026846, "o", "# turn myself on\r\n"]
[1724.047361, "o", "set_use_numexpr(get_option(\"compute.use_numexpr\"))\r\n"]
[1724.067876, "o", "\r\n"]
[1724.08839, "o", "\r\n"]
[1724.108905, "o", "def _has_bool_dtype(x):\r\n"]
[1724.129419, "o", "    try:\r\n"]
[1724.149934, "o", "        return x.dtype == bool\r\n"]
[1724.170448, "o", "    except AttributeError:\r\n"]
[1724.190963, "o", "        return isinstance(x, (bool, np.bool_))\r\n"]
[1724.211477, "o", "\r\n"]
[1724.231992, "o", "\r\n"]
[1724.252506, "o", "_BOOL_OP_UNSUPPORTED = {\"+\": \"|\", \"*\": \"&\", \"-\": \"^\"}\r\n"]
[1724.273021, "o", "\r\n"]
[1724.293535, "o", "\r\n"]
[1724.31405, "o", "def _bool_arith_fallback(op_str, left_op, right_op) -> bool:\r\n"]
[1724.334564, "o", "    \"\"\"\r\n"]
[1724.355079, "o", "    Check if we should fallback to the python `_evaluate_standard` in case\r\n"]
[1724.375593, "o", "    of an unsupported operation by numexpr, which is the case for some\r\n"]
[1724.396108, "o", "    boolean ops.\r\n"]
[1724.416622, "o", "    \"\"\"\r\n"]
[1724.437137, "o", "    if _has_bool_dtype(left_op) and _has_bool_dtype(right_op):\r\n"]
[1724.457651, "o", "        if op_str in _BOOL_OP_UNSUPPORTED:\r\n"]
[1724.478166, "o", "            warnings.warn(\r\n"]
[1724.49868, "o", "                f\"evaluating in Python space because the {op_str!r} \"\r\n"]
[1724.519195, "o", "                \"operator is not supported by numexpr for the bool dtype, \"\r\n"]
[1724.53971, "o", "                f\"use {_BOOL_OP_UNSUPPORTED[op_str]!r} instead.\",\r\n"]
[1724.560224, "o", "                stacklevel=find_stack_level(),\r\n"]
[1724.580739, "o", "            )\r\n"]
[1724.601253, "o", "            return True\r\n"]
[1724.621768, "o", "    return False\r\n"]
[1724.642282, "o", "\r\n"]
[1724.662797, "o", "\r\n"]
[1724.683311, "o", "def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1724.703826, "o", "    \"\"\"\r\n"]
[1724.72434, "o", "    Evaluate and return the expression of the op on left_op and right_op.\r\n"]
[1724.744855, "o", "\r\n"]
[1724.765369, "o", "    Parameters\r\n"]
[1724.785884, "o", "    ----------\r\n"]
[1724.806398, "o", "    op : the actual operand\r\n"]
[1724.826913, "o", "    left_op : left operand\r\n"]
[1724.847427, "o", "    right_op : right operand\r\n"]
[1724.867942, "o", "    use_numexpr : bool, default True\r\n"]
[1724.888456, "o", "        Whether to try to use numexpr.\r\n"]
[1724.908971, "o", "    \"\"\"\r\n"]
[1724.929485, "o", "    op_str = _op_str_mapping[op]\r\n"]
[1725.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1725.002, "i", "sed -n '240,520p' pandas/core/computation/expressions.py\r"]
[1725.004, "o", "sed -n '240,520p' pandas/core/computation/expressions.py\r\n"]
[1725.101077, "o", "\u001b[?2004l\r\n"]
[1725.196154, "o", "    if op_str is not None:\r\n"]
[1725.291231, "o", "        if use_numexpr:\r\n"]
[1725.386308, "o", "            # error: \"None\" not callable\r\n"]
[1725.481385, "o", "            return _evaluate(op, op_str, left_op, right_op)  # type: ignore[misc]\r\n"]
[1725.576462, "o", "    return _evaluate_standard(op, op_str, left_op, right_op)\r\n"]
[1725.671538, "o", "\r\n"]
[1725.766615, "o", "\r\n"]
[1725.861692, "o", "def where(cond, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1725.956769, "o", "    \"\"\"\r\n"]
[1726.051846, "o", "    Evaluate the where condition cond on left_op and right_op.\r\n"]
[1726.146923, "o", "\r\n"]
[1726.242, "o", "    Parameters\r\n"]
[1726.337077, "o", "    ----------\r\n"]
[1726.432154, "o", "    cond : np.ndarray[bool]\r\n"]
[1726.527231, "o", "    left_op : return if cond is True\r\n"]
[1726.622308, "o", "    right_op : return if cond is False\r\n"]
[1726.717385, "o", "    use_numexpr : bool, default True\r\n"]
[1726.812462, "o", "        Whether to try to use numexpr.\r\n"]
[1726.907538, "o", "    \"\"\"\r\n"]
[1727.002615, "o", "    assert _where is not None\r\n"]
[1727.097692, "o", "    if use_numexpr:\r\n"]
[1727.192769, "o", "        return _where(cond, left_op, right_op)\r\n"]
[1727.287846, "o", "    else:\r\n"]
[1727.382923, "o", "        return _where_standard(cond, left_op, right_op)\r\n"]
[1727.478, "o", "\r\n"]
[1727.573077, "o", "\r\n"]
[1727.668154, "o", "def set_test_mode(v: bool = True) -> None:\r\n"]
[1727.763231, "o", "    \"\"\"\r\n"]
[1727.858308, "o", "    Keeps track of whether numexpr was used.\r\n"]
[1727.953385, "o", "\r\n"]
[1728.048462, "o", "    Stores an additional ``True`` for every successful use of evaluate with\r\n"]
[1728.143538, "o", "    numexpr since the last ``get_test_result``.\r\n"]
[1728.238615, "o", "    \"\"\"\r\n"]
[1728.333692, "o", "    global _TEST_MODE, _TEST_RESULT\r\n"]
[1728.428769, "o", "    _TEST_MODE = v\r\n"]
[1728.523846, "o", "    _TEST_RESULT = []\r\n"]
[1728.618923, "o", "\r\n"]
[1728.714, "o", "\r\n"]
[1728.809077, "o", "def _store_test_result(used_numexpr: bool) -> None:\r\n"]
[1728.904154, "o", "    if used_numexpr:\r\n"]
[1728.999231, "o", "        _TEST_RESULT.append(used_numexpr)\r\n"]
[1729.094308, "o", "\r\n"]
[1729.189385, "o", "\r\n"]
[1729.284462, "o", "def get_test_result() -> list[bool]:\r\n"]
[1729.379538, "o", "    \"\"\"\r\n"]
[1729.474615, "o", "    Get test result and reset test_results.\r\n"]
[1729.569692, "o", "    \"\"\"\r\n"]
[1729.664769, "o", "    global _TEST_RESULT\r\n"]
[1729.759846, "o", "    res = _TEST_RESULT\r\n"]
[1729.854923, "o", "    _TEST_RESULT = []\r\n"]
[1730.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1730.002, "i", "python - << 'PY'\r"]
[1730.004, "o", "python - << 'PY'\r\n"]
[1730.047898, "o", "\u001b[?2004l\r\n"]
[1730.089797, "o", "\u001b[?2004h> from pathlib import Path\r\n"]
[1730.131695, "o", "\u001b[?2004l\r\n"]
[1730.173593, "o", "\u001b[?2004h> import re\r\n"]
[1730.215492, "o", "\u001b[?2004l\r\n"]
[1730.25739, "o", "\u001b[?2004h> p = Path('pandas/core/computation/expressions.py')\r\n"]
[1730.299288, "o", "\u001b[?2004l\r\n"]
[1730.341186, "o", "\u001b[?2004h> src = p.read_text()\r\n"]
[1730.383085, "o", "\u001b[?2004l\r\n"]
[1730.424983, "o", "\u001b[?2004h> changed = False\r\n"]
[1730.466881, "o", "\u001b[?2004l\r\n"]
[1730.50878, "o", "\u001b[?2004h> # Try bumping a constant threshold if it exists\r\n"]
[1730.550678, "o", "\u001b[?2004l\r\n"]
[1730.592576, "o", "\u001b[?2004h> new_src, n = re.subn(r\"(^\\s*_MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1730.634475, "o", "\u001b[?2004l\r\n"]
[1730.676373, "o", "\u001b[?2004h> if n == 0:\r\n"]
[1730.718271, "o", "\u001b[?2004l\r\n"]
[1730.760169, "o", "\u001b[?2004h>     new_src, n = re.subn(r\"(^\\s*MIN_ELEMENTS\\s*=\\s*)([0-9_]+)\", r\"\\g<1>4000000\", src, flags=re.M)\r\n"]
[1730.802068, "o", "\u001b[?2004l\r\n"]
[1730.843966, "o", "\u001b[?2004h> if n > 0:\r\n"]
[1730.885864, "o", "\u001b[?2004l\r\n"]
[1730.927763, "o", "\u001b[?2004h>     src = new_src\r\n"]
[1730.969661, "o", "\u001b[?2004l\r\n"]
[1731.011559, "o", "\u001b[?2004h>     changed = True\r\n"]
[1731.053458, "o", "\u001b[?2004l\r\n"]
[1731.095356, "o", "\u001b[?2004h> # If should_use_numexpr exists, inject early bypass after def/docstring\r\n"]
[1731.137254, "o", "\u001b[?2004l\r\n"]
[1731.179153, "o", "\u001b[?2004h> m = re.search(r\"def\\s+should_use_numexpr\\([^\\)]*\\):\\n\", src)\r\n"]
[1731.221051, "o", "\u001b[?2004l\r\n"]
[1731.262949, "o", "\u001b[?2004h> if m:\r\n"]
[1731.304847, "o", "\u001b[?2004l\r\n"]
[1731.346746, "o", "\u001b[?2004h>     insert_at = m.end()\r\n"]
[1731.388644, "o", "\u001b[?2004l\r\n"]
[1731.430542, "o", "\u001b[?2004h>     doc = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1731.472441, "o", "\u001b[?2004l\r\n"]
[1731.514339, "o", "\u001b[?2004h>     if doc:\r\n"]
[1731.556237, "o", "\u001b[?2004l\r\n"]
[1731.598136, "o", "\u001b[?2004h>         insert_at += doc.end()\r\n"]
[1731.640034, "o", "\u001b[?2004l\r\n"]
[1731.681932, "o", "\u001b[?2004h>     if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+3000]:\r\n"]
[1731.723831, "o", "\u001b[?2004l\r\n"]
[1731.765729, "o", "\u001b[?2004h>         inject = (\r\n"]
[1731.807627, "o", "\u001b[?2004l\r\n"]
[1731.849525, "o", "\u001b[?2004h>             \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1731.891424, "o", "\u001b[?2004l\r\n"]
[1731.933322, "o", "\u001b[?2004h>             \"    try:\\n\"\r\n"]
[1731.97522, "o", "\u001b[?2004l\r\n"]
[1732.017119, "o", "\u001b[?2004h>             \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1732.059017, "o", "\u001b[?2004l\r\n"]
[1732.100915, "o", "\u001b[?2004h>             \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1732.142814, "o", "\u001b[?2004l\r\n"]
[1732.184712, "o", "\u001b[?2004h>             \"    except Exception:\\n\"\r\n"]
[1732.22661, "o", "\u001b[?2004l\r\n"]
[1732.268508, "o", "\u001b[?2004h>             \"        a_size = b_size = None\\n\"\r\n"]
[1732.310407, "o", "\u001b[?2004l\r\n"]
[1732.352305, "o", "\u001b[?2004h>             \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1732.394203, "o", "\u001b[?2004l\r\n"]
[1732.436102, "o", "\u001b[?2004h>             \"        return False\\n\"\r\n"]
[1732.478, "o", "\u001b[?2004l\r\n"]
[1732.519898, "o", "\u001b[?2004h>         )\r\n"]
[1732.561797, "o", "\u001b[?2004l\r\n"]
[1732.603695, "o", "\u001b[?2004h>         src = src[:insert_at] + inject + src[insert_at:]\r\n"]
[1732.645593, "o", "\u001b[?2004l\r\n"]
[1732.687492, "o", "\u001b[?2004h>         changed = True\r\n"]
[1732.72939, "o", "\u001b[?2004l\r\n"]
[1732.771288, "o", "\u001b[?2004h> elif re.search(r\"def\\s+evaluate\\([^\\)]*\\):\\n\", src):\r\n"]
[1732.813186, "o", "\u001b[?2004l\r\n"]
[1732.855085, "o", "\u001b[?2004h>     # As a fallback, short-circuit inside evaluate if needed\r\n"]
[1732.896983, "o", "\u001b[?2004l\r\n"]
[1732.938881, "o", "\u001b[?2004h>     m2 = re.search(r\"def\\s+evaluate\\([^\\)]*\\):\\n\", src)\r\n"]
[1732.98078, "o", "\u001b[?2004l\r\n"]
[1733.022678, "o", "\u001b[?2004h>     insert_at = m2.end()\r\n"]
[1733.064576, "o", "\u001b[?2004l\r\n"]
[1733.106475, "o", "\u001b[?2004h>     doc2 = re.match(r\"\\s+\\\"\\\"\\\".*?\\\"\\\"\\\"\\n\", src[insert_at:], flags=re.S)\r\n"]
[1733.148373, "o", "\u001b[?2004l\r\n"]
[1733.190271, "o", "\u001b[?2004h>     if doc2:\r\n"]
[1733.232169, "o", "\u001b[?2004l\r\n"]
[1733.274068, "o", "\u001b[?2004h>         insert_at += doc2.end()\r\n"]
[1733.315966, "o", "\u001b[?2004l\r\n"]
[1733.357864, "o", "\u001b[?2004h>     if 'ASV_SIZE_BYPASS' not in src[insert_at:insert_at+3000]:\r\n"]
[1733.399763, "o", "\u001b[?2004l\r\n"]
[1733.441661, "o", "\u001b[?2004h>         inject2 = (\r\n"]
[1733.483559, "o", "\u001b[?2004l\r\n"]
[1733.525458, "o", "\u001b[?2004h>             \"    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\\n\"\r\n"]
[1733.567356, "o", "\u001b[?2004l\r\n"]
[1733.609254, "o", "\u001b[?2004h>             \"    try:\\n\"\r\n"]
[1733.651153, "o", "\u001b[?2004l\r\n"]
[1733.693051, "o", "\u001b[?2004h>             \"        a_size = getattr(a, 'size', None)\\n\"\r\n"]
[1733.734949, "o", "\u001b[?2004l\r\n"]
[1733.776847, "o", "\u001b[?2004h>             \"        b_size = getattr(b, 'size', None)\\n\"\r\n"]
[1733.818746, "o", "\u001b[?2004l\r\n"]
[1733.860644, "o", "\u001b[?2004h>             \"    except Exception:\\n\"\r\n"]
[1733.902542, "o", "\u001b[?2004l\r\n"]
[1733.944441, "o", "\u001b[?2004h>             \"        a_size = b_size = None\\n\"\r\n"]
[1733.986339, "o", "\u001b[?2004l\r\n"]
[1734.028237, "o", "\u001b[?2004h>             \"    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\\n\"\r\n"]
[1734.070136, "o", "\u001b[?2004l\r\n"]
[1734.112034, "o", "\u001b[?2004h>             \"        use_numexpr = False\\n\"\r\n"]
[1734.153932, "o", "\u001b[?2004l\r\n"]
[1734.195831, "o", "\u001b[?2004h>         )\r\n"]
[1734.237729, "o", "\u001b[?2004l\r\n"]
[1734.279627, "o", "\u001b[?2004h>         src = src[:insert_at] + inject2 + src[insert_at:]\r\n"]
[1734.321525, "o", "\u001b[?2004l\r\n"]
[1734.363424, "o", "\u001b[?2004h>         changed = True\r\n"]
[1734.405322, "o", "\u001b[?2004l\r\n"]
[1734.44722, "o", "\u001b[?2004h> if changed:\r\n"]
[1734.489119, "o", "\u001b[?2004l\r\n"]
[1734.531017, "o", "\u001b[?2004h>     p.write_text(src)\r\n"]
[1734.572915, "o", "\u001b[?2004l\r\n"]
[1734.614814, "o", "\u001b[?2004h>     print('Patched expressions.py (threshold and/or early bypass)')\r\n"]
[1734.656712, "o", "\u001b[?2004l\r\n"]
[1734.69861, "o", "\u001b[?2004h> else:\r\n"]
[1734.740508, "o", "\u001b[?2004l\r\n"]
[1734.782407, "o", "\u001b[?2004h>     print('No change applied; patterns not found')\r\n"]
[1734.824305, "o", "\u001b[?2004l\r\n"]
[1734.866203, "o", "\u001b[?2004h> PY\r\n"]
[1734.908102, "o", "\u001b[?2004l\r\n"]
[1735.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1735.002, "i", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r"]
[1735.004, "o", "git diff -- pandas/core/computation/expressions.py | sed -n '1,200p'\r\n"]
[1735.2532, "o", "\u001b[?2004l\r\n"]
[1735.5004, "o", "diff --git a/pandas/core/computation/expressions.py b/pandas/core/computation/expressions.py\r\n"]
[1735.7476, "o", "index dee80059a8..7f4d3fa614 100644\r\n"]
[1735.9948, "o", "--- a/pandas/core/computation/expressions.py\r\n"]
[1736.242, "o", "+++ b/pandas/core/computation/expressions.py\r\n"]
[1736.4892, "o", "@@ -236,6 +236,14 @@ def evaluate(op, left_op, right_op, use_numexpr: bool = True):\r\n"]
[1736.7364, "o", "     use_numexpr : bool, default True\r\n"]
[1736.9836, "o", "         Whether to try to use numexpr.\r\n"]
[1737.2308, "o", "     \"\"\"\r\n"]
[1737.478, "o", "+    # ASV_SIZE_BYPASS: bypass numexpr for moderate-sized ops to reduce overhead\r\n"]
[1737.7252, "o", "+    try:\r\n"]
[1737.9724, "o", "+        a_size = getattr(a, 'size', None)\r\n"]
[1738.2196, "o", "+        b_size = getattr(b, 'size', None)\r\n"]
[1738.4668, "o", "+    except Exception:\r\n"]
[1738.714, "o", "+        a_size = b_size = None\r\n"]
[1738.9612, "o", "+    if a_size is not None and a_size < 4_000_000 and (b_size is None or b_size < 4_000_000):\r\n"]
[1739.2084, "o", "+        use_numexpr = False\r\n"]
[1739.4556, "o", "     op_str = _op_str_mapping[op]\r\n"]
[1739.7028, "o", "     if op_str is not None:\r\n"]
[1740.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1740.002, "i", "git add pandas/core/computation/expressions.py\r"]
[1740.004, "o", "git add pandas/core/computation/expressions.py\r\n"]
[1740.006, "o", "\u001b[?2004l\r\n"]
[1745.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1745.002, "i", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold/early check; improves ar\r"]
[1745.004, "o", "git commit -m \"perf(expressions): bypass numexpr for moderate-sized ops via size threshold/early check; improves ar\r\n"]
[1746.242, "o", "rithmetic.Ops.*\"\r\n"]
[1747.478, "o", "\u001b[?2004l\r\n"]
[1748.714, "o", "[main 2a027309d7] perf(expressions): bypass numexpr for moderate-sized ops via size threshold/early check; improves arithmetic.Ops.*\r\n"]
[1750.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo# "]
[1750.002, "i", "cd asv_bench\r"]
[1750.004, "o", "cd asv_bench\r\n"]
[1750.006, "o", "\u001b[?2004l\r\n"]
[1755.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1755.002, "i", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r"]
[1755.004, "o", "asv run --python=same --bench=\"arithmetic.Ops.*\"\r\n"]
[1755.097556, "o", "\u001b[?2004l\r\n"]
[1755.189111, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1755.280667, "o", "\u00b7 \u001b[0;32mRunning 13 total benchmarks (1 commits * 1 environments * 13 benchmarks)\u001b[0m\r\n"]
[1755.372222, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1755.463778, "o", "[ 3.85%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops.time_frame_add--)\u001b[0m.............\r\n"]
[1755.555333, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_add\u001b[0m                                                                                                                   ok\r\n"]
[1755.646889, "o", "[53.85%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1755.738444, "o", "             --                      threads          \r\n"]
[1755.83, "o", "             ------------- ---------------------------\r\n"]
[1755.921556, "o", "              use_numexpr     default          1      \r\n"]
[1756.013111, "o", "             ============= ============= =============\r\n"]
[1756.104667, "o", "                  True      2.45\u00b10.04ms   2.43\u00b10.09ms \r\n"]
[1756.196222, "o", "                 False       2.73\u00b10.3ms   2.45\u00b10.05ms \r\n"]
[1756.287778, "o", "             ============= ============= =============\r\n"]
[1756.379333, "o", "\r\n"]
[1756.470889, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_comparison\u001b[0m                                                                                                            ok\r\n"]
[1756.562444, "o", "[57.69%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============= =============\u001b[0m\r\n"]
[1756.654, "o", "             --                      threads          \r\n"]
[1756.745556, "o", "             ------------- ---------------------------\r\n"]
[1756.837111, "o", "              use_numexpr     default          1      \r\n"]
[1756.928667, "o", "             ============= ============= =============\r\n"]
[1757.020222, "o", "                  True       1.90\u00b10.1ms   1.90\u00b10.09ms \r\n"]
[1757.111778, "o", "                 False      2.03\u00b10.09ms   1.81\u00b10.06ms \r\n"]
[1757.203333, "o", "             ============= ============= =============\r\n"]
[1757.294889, "o", "\r\n"]
[1757.386444, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_mult\u001b[0m                                                                                                                  ok\r\n"]
[1757.478, "o", "[61.54%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ =============\u001b[0m\r\n"]
[1757.569556, "o", "             --                     threads          \r\n"]
[1757.661111, "o", "             ------------- --------------------------\r\n"]
[1757.752667, "o", "              use_numexpr    default          1      \r\n"]
[1757.844222, "o", "             ============= ============ =============\r\n"]
[1757.935778, "o", "                  True      2.47\u00b10.1ms    2.51\u00b10.1ms \r\n"]
[1758.027333, "o", "                 False      2.55\u00b10.2ms   2.56\u00b10.09ms \r\n"]
[1758.118889, "o", "             ============= ============ =============\r\n"]
[1758.210444, "o", "\r\n"]
[1758.302, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops.time_frame_multi_and\u001b[0m                                                                                                             ok\r\n"]
[1758.393556, "o", "[65.38%] \u00b7\u00b7\u00b7 \u001b[0;39m============= ============ ============\u001b[0m\r\n"]
[1758.485111, "o", "             --                     threads         \r\n"]
[1758.576667, "o", "             ------------- -------------------------\r\n"]
[1758.668222, "o", "              use_numexpr    default         1      \r\n"]
[1758.759778, "o", "             ============= ============ ============\r\n"]
[1758.851333, "o", "                  True      10.4\u00b10.3ms   10.3\u00b10.1ms \r\n"]
[1758.942889, "o", "                 False      10.4\u00b10.2ms   10.2\u00b10.3ms \r\n"]
[1759.034444, "o", "             ============= ============ ============\r\n"]
[1759.126, "o", "\r\n"]
[1759.217556, "o", "[69.23%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          45.9\u00b10.3ms\r\n"]
[1759.309111, "o", "[73.08%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                   28.5\u00b10.09ms\r\n"]
[1759.400667, "o", "[76.92%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              842\u00b140\u03bcs\r\n"]
[1759.492222, "o", "[80.77%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                          19.5\u00b10.1ms\r\n"]
[1759.583778, "o", "[84.62%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   24.6\u00b10.03ms\r\n"]
[1759.675333, "o", "[88.46%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.54\u00b10.03ms\r\n"]
[1759.766889, "o", "[92.31%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                      10.6\u00b10.1ms\r\n"]
[1759.858444, "o", "[96.15%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      443\u00b15\u03bcs\r\n"]
[1760.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1760.002, "i", "asv run --python=same --bench=\"arithmetic.Ops2.*\"\r"]
[1760.004, "o", "asv run --python=same --bench=\"arithmetic.Ops2.*\"\r\n"]
[1760.359143, "o", "\u001b[?2004l\r\n"]
[1760.712286, "o", "\u00b7 \u001b[0;32mDiscovering benchmarks\u001b[0m\r\n"]
[1761.065429, "o", "\u00b7 \u001b[0;32mRunning 9 total benchmarks (1 commits * 1 environments * 9 benchmarks)\u001b[0m\r\n"]
[1761.418571, "o", "[ 0.00%] \u00b7\u00b7 \u001b[0;34mBenchmarking existing-py_opt_conda_envs_asv_3.10_bin_python3.10\u001b[0m\r\n"]
[1761.771714, "o", "[ 5.56%] \u00b7\u00b7\u00b7 \u001b[0;39mRunning (arithmetic.Ops2.time_frame_dot--)\u001b[0m.........\r\n"]
[1762.124857, "o", "[55.56%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_dot\u001b[0m                                                                                                          46.7\u00b10.4ms\r\n"]
[1762.478, "o", "[61.11%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div\u001b[0m                                                                                                    28.9\u00b10.1ms\r\n"]
[1762.831143, "o", "[66.67%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_div_by_zero\u001b[0m                                                                                              864\u00b150\u03bcs\r\n"]
[1763.184286, "o", "[72.22%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_floor_by_zero\u001b[0m                                                                                         19.5\u00b10.06ms\r\n"]
[1763.537429, "o", "[77.78%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_float_mod\u001b[0m                                                                                                   25.0\u00b10.05ms\r\n"]
[1763.890571, "o", "[83.33%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_div_by_zero\u001b[0m                                                                                             1.52\u00b10.02ms\r\n"]
[1764.243714, "o", "[88.89%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_int_mod\u001b[0m                                                                                                     10.2\u00b10.06ms\r\n"]
[1764.596857, "o", "[94.44%] \u00b7\u00b7\u00b7 \u001b[0;39marithmetic.Ops2.time_frame_series_dot\u001b[0m                                                                                                      466\u00b17\u03bcs\r\n"]
[1765.0, "o", "(asv_3.10) root@89c02398194d:/workspace/repo/asv_bench# "]
[1765.002, "i", "\u001b[?2004l\r"]
[1765.004, "o", "\u001b[?2004l\r\n"]
[1767.478, "o", "\r\n"]
